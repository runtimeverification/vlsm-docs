<!DOCTYPE html>
<html class="alectryon-standalone"><head><title>VLSM.v</title><meta charset="utf-8"><meta content="Alectryon" name="generator"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="alectryon.css" rel="stylesheet"><link href="pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" /><script src="alectryon.js"></script></head><body><article class="alectryon-root alectryon-windowed alectryon-coqdoc"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Coq+SerAPI v8.18.0+0.18.1. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+‚Üë</kbd> <kbd>Ctrl+‚Üì</kbd> to navigate, <kbd>Ctrl+üñ±Ô∏è</kbd> to focus. On Mac, use <kbd>‚åò</kbd> instead of <kbd>Ctrl</kbd>.</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk0"><span class="kn">From</span> VLSM.Lib <span class="kn">Require Import</span> Itauto.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">[Loading ML file ring_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file zify_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file micromega_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file btauto_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file coq-itauto.plugin ... <span class="bp">done</span>]</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> stdpp <span class="kn">Require Import</span> prelude.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> Coq <span class="kn">Require Import</span> Streams.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> VLSM.Lib <span class="kn">Require Import</span> Preamble ListExtras StreamExtras.</span></span></pre><div class="doc">
<a id="lab1"></a><h1 class="section">Core: VLSM Basics</h1>
<div class="paragraph"> </div>

  This module provides basic VLSM infrastructure.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
<a id="lab2"></a><h2 class="section">VLSM definition</h2>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
<a id="lab3"></a><h3 class="section">The type of a VLSM</h3>
<div class="paragraph"> </div>

  The type of a VLSM is a triple consisting of the underlying types of
  messages, states, and labels.

<div class="paragraph"> </div>

  In Coq it is defined as a record taking <code>message</code> as parameter and having
  <span class="inlinecode"><span class="id" title="var">state</span></span> and <span class="inlinecode"><span class="id" title="var">label</span></span> as fields.  <code>message</code> is a parameter to allow it to be
  easily shared by multiple VLSMs during composition.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Record</span> <span class="nf">VLSMType</span> (<span class="nv">message</span> : <span class="kt">Type</span>) : <span class="kt">Type</span> :=
{
  state : <span class="kt">Type</span>;
  label : <span class="kt">Type</span>;
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> state {_} _.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> label {_} _.</span></span></pre><div class="doc">
<a id="lab4"></a><h3 class="section">VLSM class definition</h3>
<div class="paragraph"> </div>
<span class="inlinecode"><span class="id" title="var">VLSMMachine</span></span> is parameterized by a <span class="inlinecode"><span class="id" title="var">VLSMType</span></span>, and contains the
  remaining parameters to define a VLSM over the given types.
  These are the properties for initial states (<span class="inlinecode"><span class="id" title="var">initial_state_prop</span></span>)
  and initial messages (<span class="inlinecode"><span class="id" title="var">initial_message_prop</span></span>), from which we can
  immediately define the types <span class="inlinecode"><span class="id" title="var">initial_state</span></span> (as <span class="inlinecode"><span class="id" title="var">state</span></span>s having
  the <span class="inlinecode"><span class="id" title="var">initial_state_prop</span></span>erty) and <span class="inlinecode"><span class="id" title="var">initial_message</span></span> (as <code>message</code>s
  having the <span class="inlinecode"><span class="id" title="var">initial_message_prop</span></span>erty), a witness <span class="inlinecode"><span class="id" title="var">s0</span></span> that the
  <span class="inlinecode"><span class="id" title="var">initial_state</span></span> is inhabited, and the <span class="inlinecode"><span class="id" title="var">transition</span></span> function and
  <span class="inlinecode"><span class="id" title="var">valid</span></span>ity predicate.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Record</span> <span class="nf">VLSMMachine</span> {<span class="nv">message</span> : <span class="kt">Type</span>} (<span class="nv">T</span> : VLSMType message) : <span class="kt">Type</span> :=
{
  initial_state_prop : state T -&gt; <span class="kt">Prop</span>;
  initial_state : <span class="kt">Type</span> := {s : state T | initial_state_prop s};
  s0 : Inhabited initial_state;
  initial_message_prop : message -&gt; <span class="kt">Prop</span>;
  initial_message : <span class="kt">Type</span> := {m : message | initial_message_prop m};
  transition : label T -&gt; state T * option message -&gt; state T * option message;
  valid : label T -&gt; state T * option message -&gt; <span class="kt">Prop</span>;
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* The &amp; is a &quot;bidirectionality hint&quot;, so that typechecking</span>
<span class="c">   a VLSMMachine record definition will try to use the expected</span>
<span class="c">   result type to determine &lt;&lt;T&gt;&gt; before typechecking the fields.</span>
<span class="c">   Without this, the types of the values given for the fields would</span>
<span class="c">   have to be written so they only mention the state and label type</span>
<span class="c">   in ways that can be matched with [state ?T] and [label ?T].</span>
<span class="c">*)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> Build_VLSMMachine _ _ &amp; _ _ _ _ _.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> initial_state_prop {message T} VLSMMachine _, {message T VLSMMachine} _ : <span class="nb">rename</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> initial_state {message T} VLSMMachine : <span class="nb">rename</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> initial_message_prop {message T} VLSMMachine _, {message T VLSMMachine} _ : <span class="nb">rename</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> initial_message {message T} VLSMMachine : <span class="nb">rename</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> transition {message T} VLSMMachine _ _, {message T VLSMMachine} _ _ : <span class="nb">rename</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> valid {message T} VLSMMachine _ _, {message T VLSMMachine} _ _ : <span class="nb">rename</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">option_initial_message_prop</span>
  {<span class="nv">message</span> : <span class="kt">Type</span>} {<span class="nv">T</span> : VLSMType message} (<span class="nv">M</span> : VLSMMachine T) : option message -&gt; <span class="kt">Prop</span> :=
    from_option (@initial_message_prop _ _ M) <span class="kt">True</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">decidable_initial_messages_prop</span>
  {<span class="nv">message</span> : <span class="kt">Type</span>} {<span class="nv">T</span> : VLSMType message} (<span class="nv">M</span> : VLSMMachine T) : <span class="kt">Type</span> :=
    <span class="kr">forall</span> (<span class="nv">m</span> : message), Decision (@initial_message_prop _ _ M m).</span></span></pre><div class="doc">
<a id="lab5"></a><h3 class="section">VLSM type definition</h3>
<div class="paragraph"> </div>

  For technical reasons, e.g., the need to easily talk about VLSMs over
  the same set of messages and about VLSMs of the same type (over the same
  set of messages, labels and states), the VLSM definition is split into
  two parts, <span class="inlinecode"><span class="id" title="var">VLSMType</span></span> and <span class="inlinecode"><span class="id" title="var">VLSMMachine</span></span>, which are packaged together by
  the following definition.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Record</span> <span class="nf">VLSM</span> (<span class="nv">message</span> : <span class="kt">Type</span>) : <span class="kt">Type</span> := mk_vlsm
{
  vlsm_type :&gt; VLSMType message;
  vlsm_machine :&gt; VLSMMachine vlsm_type;
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> vlsm_type [message] v.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> vlsm_machine [message] v.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> mk_vlsm [message] [vlsm_type] vlsm_machine.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">sec_traces</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  {<span class="nv">message</span> : <span class="kt">Type</span>}
  {<span class="nv">T</span> : VLSMType message}
  .</span></span></pre><div class="doc">
<a id="lab6"></a><h2 class="section">Traces</h2>
<div class="paragraph"> </div>

  We introduce the concept of a trace to formalize an execution of the protocol.
  It is abstracted as a pair <code>(start, steps)</code> where <code>start</code> is a state
  and <code>steps</code> is a tuple of objects which fully describe the transitions
  underwent during execution. Notably, <code>steps</code> might be infinite.

<div class="paragraph"> </div>

  In Coq, we can define these objects (which we name <span class="inlinecode"><span class="id" title="var">transition_item</span></span>s) as consisting of:
<ul class="doclist">
<li> the <span class="inlinecode"><span class="id" title="var">label</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span>
</li>
<li> the (optional) <span class="inlinecode"><span class="id" title="var">input</span></span> <code>message</code>
</li>
<li> the <span class="inlinecode"><span class="id" title="var">destination</span></span> <span class="inlinecode"><span class="id" title="var">state</span></span> of the transition

</li>
<li> the (optional) <span class="inlinecode"><span class="id" title="var">output</span></span> <code>message</code> generated by the transition

</li>
</ul>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Record</span> <span class="nf">transition_item</span> : <span class="kt">Type</span> :=
{
  l : label T;
  input : option message;
  destination : state T;
  output : option message;
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">field_selector</span>
  (<span class="nv">field</span> : transition_item -&gt; option message) (<span class="nv">m</span> : message) (<span class="nv">item</span> : transition_item) : <span class="kt">Prop</span> :=
    <span class="bp">field</span> item = Some m.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">item_sends_or_receives</span> (<span class="nv">m</span> : message) (<span class="nv">item</span> : transition_item) : <span class="kt">Prop</span> :=
  input item = Some m \/ output item = Some m.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">trace_has_message</span>
  (<span class="nv">message_selector</span> : message -&gt; transition_item -&gt; <span class="kt">Prop</span>)
  (<span class="nv">msg</span> : message) (<span class="nv">tr</span> : list transition_item) : <span class="kt">Prop</span> :=
    List.Exists (message_selector msg) tr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1"><span class="kn">Lemma</span> <span class="nf">trace_has_message_prefix</span>
  (<span class="nv">message_selector</span> : message -&gt; transition_item -&gt; <span class="kt">Prop</span>)
  (<span class="nv">msg</span> : message)
  (<span class="nv">prefix</span> <span class="nv">suffix</span> : list transition_item) :
    trace_has_message message_selector msg prefix -&gt;
    trace_has_message message_selector msg (prefix ++ suffix).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>message_selector</var><span class="hyp-type"><b>: </b><span>message ‚Üí transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>prefix, suffix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">trace_has_message message_selector msg prefix
‚Üí trace_has_message message_selector msg
    (prefix ++ suffix)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>message_selector</var><span class="hyp-type"><b>: </b><span>message ‚Üí transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>prefix, suffix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">trace_has_message message_selector msg prefix
‚Üí trace_has_message message_selector msg
    (prefix ++ suffix)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intro</span> Hprefix; <span class="nb">apply</span> Exists_app; <span class="nb">left</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3"><span class="kn">Lemma</span> <span class="nf">trace_has_message_observed_iff</span>
  (<span class="nv">m</span> : message) (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Hobserved</span> : trace_has_message item_sends_or_receives m tr) :
    trace_has_message (field_selector input) m tr \/
    trace_has_message (field_selector output) m tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hobserved</var><span class="hyp-type"><b>: </b><span>trace_has_message item_sends_or_receives m
  tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">trace_has_message (field_selector input) m tr
‚à® trace_has_message (field_selector output) m tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk4"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hobserved</var><span class="hyp-type"><b>: </b><span>trace_has_message item_sends_or_receives m
  tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">trace_has_message (field_selector input) m tr
‚à® trace_has_message (field_selector output) m tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">unfold</span> trace_has_message <span class="kr">in</span> *; <span class="nb">rewrite</span> !Exists_exists <span class="kr">in</span> *; <span class="nb">firstorder</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
Defines a message received but not sent by within the trace. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">trace_received_not_sent_before_or_after</span>
  (<span class="nv">tr</span> : list transition_item) (<span class="nv">m</span> : message) : <span class="kt">Prop</span> :=
    trace_has_message (field_selector input) m tr /\
    ~ trace_has_message (field_selector output) m tr.</span></span></pre><div class="doc">
States that a property holds for all messages received but not sent by a trace. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">trace_received_not_sent_before_or_after_invariant</span>
  (<span class="nv">tr</span> : list transition_item) (<span class="nv">P</span> : message -&gt; <span class="kt">Prop</span>) : <span class="kt">Prop</span> :=
    <span class="kr">forall</span> (<span class="nv">m</span> : message), trace_received_not_sent_before_or_after tr m -&gt; P m.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">Trace</span> : <span class="kt">Type</span> :=
| Finite : state T -&gt; list transition_item -&gt; Trace
| Infinite : state T -&gt; Stream transition_item -&gt; Trace.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">trace_first</span> (<span class="nv">tr</span> : Trace) : state T :=
  <span class="kr">match</span> tr <span class="kr">with</span>
  | Finite s _ =&gt; s
  | Infinite s _ =&gt; s
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">finite_trace_last</span> (<span class="nv">si</span> : state T) (<span class="nv">tr</span> : list transition_item) : state T :=
  List.<span class="nb">last</span> (List.map destination tr) si.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">finite_trace_last_output</span> (<span class="nv">tr</span> : list transition_item) : option message :=
  List.<span class="nb">last</span> (List.map output tr) None.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">finite_trace_nth</span>
  (<span class="nv">si</span> : state T) (<span class="nv">tr</span> : list transition_item) : nat -&gt; option (state T) :=
    nth_error (si :: List.map destination tr).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">trace_last</span> (<span class="nv">tr</span> : Trace) : option (state T) :=
  <span class="kr">match</span> tr <span class="kr">with</span>
  | Finite s ls =&gt; Some (finite_trace_last s ls)
  | Infinite _ _ =&gt; None
  <span class="kr">end</span>.</span></span></pre><div class="doc">
  This function extracts the nth state of a trace, where the sequence of
  states of a trace is obtained by appending the all destination
  states in the transition list/stream to the initial state of the trace.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">trace_nth</span> (<span class="nv">tr</span> : Trace) (<span class="nv">n</span> : nat) : option (state T) :=
  <span class="kr">match</span> tr <span class="kr">with</span>
  | Finite s ls =&gt; finite_trace_nth s ls n
  | Infinite s st =&gt; Some (Str_nth n (Cons s (Streams.map destination st)))
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">sec_traces</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> Trace {message T}, {message} T.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> transition_item {message} {T} , {message} T.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> Build_transition_item {message T}, {message} T.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> field_selector {_} {T} _ m item /.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> item_sends_or_receives {_} {_} m item /.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">sec_trace_lemmas</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  [message : <span class="kt">Type</span>]
  [T : VLSMType message]
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk5"><span class="kn">Lemma</span> <span class="nf">last_error_destination_last</span>
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">s</span> : state T)
  (<span class="nv">Hlast</span> : option_map destination (last_error tr) = Some s)
  (<span class="nv">default</span> : state T) :
    finite_trace_last default tr  = s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>option_map destination (last_error tr) =
Some s</span></span></span><br><span><var>default</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last default tr = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>option_map destination (last_error tr) =
Some s</span></span></span><br><span><var>default</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last default tr = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk7"><span class="nb">unfold</span> option_map <span class="kr">in</span> Hlast.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span><span class="kr">match</span> last_error tr <span class="kr">with</span>
| Some a =&gt; Some (destination a)
| None =&gt; None
<span class="kr">end</span> = Some s</span></span></span><br><span><var>default</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last default tr = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk8"><span class="nb">destruct</span> (last_error tr) <span class="nb">eqn</span>: eq; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>eq</var><span class="hyp-type"><b>: </b><span>last_error tr = Some t</span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>Some (destination t) = Some s</span></span></span><br><span><var>default</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last default tr = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk9"><span class="nb">inversion</span> Hlast.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>eq</var><span class="hyp-type"><b>: </b><span>last_error tr = Some t</span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>Some (destination t) = Some s</span></span></span><br><span><var>default</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>destination t = s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last default tr = destination t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka"><span class="nb">unfold</span> last_error <span class="kr">in</span> eq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>eq</var><span class="hyp-type"><b>: </b><span><span class="kr">match</span> tr <span class="kr">with</span>
| [] =&gt; None
| a :: t =&gt; Some (List.<span class="nb">last</span> t a)
<span class="kr">end</span> = Some t</span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>Some (destination t) = Some s</span></span></span><br><span><var>default</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>destination t = s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last default tr = destination t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb"><span class="nb">destruct</span> tr; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>eq</var><span class="hyp-type"><b>: </b><span>Some (List.<span class="nb">last</span> tr t0) = Some t</span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>Some (destination t) = Some s</span></span></span><br><span><var>default</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>destination t = s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last default (t0 :: tr) = destination t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkc"><span class="nb">inversion</span> eq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>eq</var><span class="hyp-type"><b>: </b><span>Some (List.<span class="nb">last</span> tr t0) = Some t</span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>Some (destination t) = Some s</span></span></span><br><span><var>default</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>destination t = s</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>List.<span class="nb">last</span> tr t0 = t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last default (t0 :: tr) =
destination (List.<span class="nb">last</span> tr t0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkd"><span class="nb">unfold</span> finite_trace_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>eq</var><span class="hyp-type"><b>: </b><span>Some (List.<span class="nb">last</span> tr t0) = Some t</span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>Some (destination t) = Some s</span></span></span><br><span><var>default</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>destination t = s</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>List.<span class="nb">last</span> tr t0 = t</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.<span class="nb">last</span> (List.map destination (t0 :: tr)) default =
destination (List.<span class="nb">last</span> tr t0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> last_map.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chke"><span class="kn">Lemma</span> <span class="nf">finite_trace_last_cons</span>
  (<span class="nv">s</span> : state T) (<span class="nv">x</span> : transition_item T) (<span class="nv">tl</span> : list (transition_item T)) :
    finite_trace_last s (x :: tl) = finite_trace_last (destination x) tl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s (x :: tl) =
finite_trace_last (destination x) tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkf"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s (x :: tl) =
finite_trace_last (destination x) tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">unfold</span> finite_trace_last; <span class="nb">rewrite</span> map_cons, unroll_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk10" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk10"><span class="kn">Lemma</span> <span class="nf">finite_trace_last_nil</span> :
  <span class="kr">forall</span> (<span class="nv">s</span> : state T),
    finite_trace_last s [] = s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state T, finite_trace_last s [] = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk11"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state T, finite_trace_last s [] = s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">done</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk12"><span class="kn">Lemma</span> <span class="nf">finite_trace_last_app</span>
  (<span class="nv">s</span> : state T) (<span class="nv">t1</span> <span class="nv">t2</span> : list (transition_item T)) :
    finite_trace_last s (t1 ++ t2) = finite_trace_last (finite_trace_last s t1) t2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s (t1 ++ t2) =
finite_trace_last (finite_trace_last s t1) t2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk13"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s (t1 ++ t2) =
finite_trace_last (finite_trace_last s t1) t2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">unfold</span> finite_trace_last; <span class="nb">rewrite</span> map_app, last_app.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk14"><span class="kn">Lemma</span> <span class="nf">finite_trace_last_is_last</span>
  (<span class="nv">s</span> : state T) (<span class="nv">x</span> : transition_item T) (<span class="nv">tl</span> : list (transition_item T)) :
    finite_trace_last s (tl ++ [x]) = destination x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s (tl ++ [x]) = destination x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk15" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk15"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s (tl ++ [x]) = destination x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">unfold</span> finite_trace_last; <span class="nb">rewrite</span> map_app; <span class="nb">cbn</span>; <span class="nb">rewrite</span> last_app.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk16"><span class="kn">Lemma</span> <span class="nf">finite_trace_last_output_is_last</span>
  (<span class="nv">x</span> : transition_item T) (<span class="nv">tl</span> : list (transition_item T)) :
    finite_trace_last_output (tl ++ [x]) = output x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last_output (tl ++ [x]) = output x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk17"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last_output (tl ++ [x]) = output x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">unfold</span> finite_trace_last_output; <span class="nb">rewrite</span> map_app; <span class="nb">cbn</span>; <span class="nb">rewrite</span> last_app.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk18" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk18"><span class="kn">Lemma</span> <span class="nf">finite_trace_nth_first</span>
  (<span class="nv">si</span> : state T) (<span class="nv">tr</span> : list transition_item) :
    finite_trace_nth si tr <span class="mi">0</span> = Some si.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si tr <span class="mi">0</span> = Some si</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk19" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk19"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si tr <span class="mi">0</span> = Some si</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">done</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a"><span class="kn">Lemma</span> <span class="nf">finite_trace_nth_last</span>
  (<span class="nv">si</span> : state T) (<span class="nv">tr</span> : list transition_item) :
    finite_trace_nth si tr (length tr) = Some (finite_trace_last si tr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si tr (length tr) =
Some (finite_trace_last si tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si tr (length tr) =
Some (finite_trace_last si tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1c"><span class="nb">unfold</span> finite_trace_nth, finite_trace_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (si :: List.map destination tr) (length tr) =
Some (List.<span class="nb">last</span> (List.map destination tr) si)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1d"><span class="nb">destruct</span> tr; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (si :: List.map destination (t :: tr))
  (length (t :: tr)) =
Some (List.<span class="nb">last</span> (List.map destination (t :: tr)) si)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e"><span class="nb">cbn</span> [nth_error length].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (List.map destination (t :: tr)) (length tr) =
Some (List.<span class="nb">last</span> (List.map destination (t :: tr)) si)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1f"><span class="nb">apply</span> nth_error_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S (length tr) =
length (List.map destination (t :: tr))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> map_length.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk20"><span class="kn">Lemma</span> <span class="nf">finite_trace_nth_app1</span>
  (<span class="nv">si</span> : state T) (<span class="nv">t1</span> <span class="nv">t2</span> : list transition_item) <span class="nv">n</span> :
    n &lt;= length t1 -&gt; finite_trace_nth si (t1 ++ t2) n = finite_trace_nth si t1 n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n ‚â§ length t1
‚Üí finite_trace_nth si (t1 ++ t2) n =
  finite_trace_nth si t1 n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk21" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk21"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n ‚â§ length t1
‚Üí finite_trace_nth si (t1 ++ t2) n =
  finite_trace_nth si t1 n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk22"><span class="nb">intros</span> Hle.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n ‚â§ length t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si (t1 ++ t2) n =
finite_trace_nth si t1 n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk23" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk23"><span class="nb">unfold</span> finite_trace_nth.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n ‚â§ length t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (si :: List.map destination (t1 ++ t2)) n =
nth_error (si :: List.map destination t1) n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk24" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk24"><span class="nb">rewrite</span> map_app, app_comm_cons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n ‚â§ length t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error
  ((si :: List.map destination t1) ++
   List.map destination t2) n =
nth_error (si :: List.map destination t1) n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk25" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk25"><span class="nb">apply</span> nth_error_app1; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n ‚â§ length t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n &lt; S (length (List.map destination t1))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk26" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk26"><span class="nb">rewrite</span> map_length.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n ‚â§ length t1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n &lt; S (length t1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk27" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk27"><span class="kn">Lemma</span> <span class="nf">finite_trace_nth_app2</span>
  (<span class="nv">si</span> : state T) (<span class="nv">t1</span> <span class="nv">t2</span> : list transition_item) (<span class="nv">n</span> : nat) :
    length t1 &lt;= n -&gt;
    finite_trace_nth si (t1 ++ t2) n =
    finite_trace_nth (finite_trace_last si t1) t2 (n - length t1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length t1 ‚â§ n
‚Üí finite_trace_nth si (t1 ++ t2) n =
  finite_trace_nth (finite_trace_last si t1) t2
    (n - length t1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk28" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk28"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length t1 ‚â§ n
‚Üí finite_trace_nth si (t1 ++ t2) n =
  finite_trace_nth (finite_trace_last si t1) t2
    (n - length t1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk29" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk29"><span class="nb">intros</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length t1 ‚â§ n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si (t1 ++ t2) n =
finite_trace_nth (finite_trace_last si t1) t2
  (n - length t1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2a"><span class="nb">apply</span> Compare_dec.le_lt_eq_dec <span class="kr">in</span> H <span class="kr">as</span> [H | &lt;-].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length t1 &lt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si (t1 ++ t2) n =
finite_trace_nth (finite_trace_last si t1) t2
  (n - length t1)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk2b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk2b"><hr></label><div class="goal-conclusion">finite_trace_nth si (t1 ++ t2) (length t1) =
finite_trace_nth (finite_trace_last si t1) t2
  (length t1 - length t1)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length t1 &lt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si (t1 ++ t2) n =
finite_trace_nth (finite_trace_last si t1) t2
  (n - length t1)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d"><span class="nb">unfold</span> finite_trace_nth.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length t1 &lt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (si :: List.map destination (t1 ++ t2)) n =
nth_error
  (finite_trace_last si t1 :: List.map destination t2)
  (n - length t1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2e"><span class="nb">rewrite</span> map_app, app_comm_cons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length t1 &lt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error
  ((si :: List.map destination t1) ++
   List.map destination t2) n =
nth_error
  (finite_trace_last si t1 :: List.map destination t2)
  (n - length t1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2f"><span class="nb">rewrite</span> nth_error_app2; <span class="nb">simpl</span> length; <span class="nb">rewrite</span> map_length; [| <span class="bp">by</span> <span class="nb">auto with</span> arith].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length t1 &lt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (List.map destination t2)
  (n - S (length t1)) =
nth_error
  (finite_trace_last si t1 :: List.map destination t2)
  (n - length t1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk30" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk30"><span class="nb">destruct</span> n; [<span class="bp">by</span> <span class="nb">exfalso</span>; <span class="bp">lia</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length t1 &lt; S n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (List.map destination t2)
  (S n - S (length t1)) =
nth_error
  (finite_trace_last si t1 :: List.map destination t2)
  (S n - length t1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> (Nat.sub_succ_l (length t1) n); [| <span class="bp">lia</span>].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk31" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk31">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si (t1 ++ t2) (length t1) =
finite_trace_nth (finite_trace_last si t1) t2
  (length t1 - length t1)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> finite_trace_nth_app1, finite_trace_nth_last,
      Nat.sub_diag, finite_trace_nth_first.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk32" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk32"><span class="kn">Lemma</span> <span class="nf">finite_trace_nth_length</span>
  (<span class="nv">si</span> : state T) (<span class="nv">tr</span> : list transition_item) (<span class="nv">n</span> : nat) (<span class="nv">s</span> : state T) :
    finite_trace_nth si tr n = Some s -&gt; n &lt;= length tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si tr n = Some s ‚Üí n ‚â§ length tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk33" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk33"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth si tr n = Some s ‚Üí n ‚â§ length tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk34" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk34"><span class="nb">intros</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>finite_trace_nth si tr n = Some s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n ‚â§ length tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk35" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk35"><span class="nb">apply</span> nth_error_length <span class="kr">in</span> H; <span class="nb">cbn</span> <span class="kr">in</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>S n ‚â§ S (length (List.map destination tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n ‚â§ length tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> map_length <span class="kr">in</span> H; <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk36" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk36"><span class="kn">Lemma</span> <span class="nf">finite_trace_last_prefix</span>
  (<span class="nv">s</span> : state T) (<span class="nv">tr</span> : list transition_item) (<span class="nv">n</span> : nat) (<span class="nv">s&#39;</span> : state T) :
    finite_trace_nth s tr n = Some s&#39; -&gt;
    finite_trace_last s (take n tr) = s&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth s tr n = Some s&#39;
‚Üí finite_trace_last s (take n tr) = s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk37" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk37"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth s tr n = Some s&#39;
‚Üí finite_trace_last s (take n tr) = s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk38" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk38"><span class="nb">unfold</span> finite_trace_nth, finite_trace_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (s :: List.map destination tr) n = Some s&#39;
‚Üí List.<span class="nb">last</span> (List.map destination (take n tr)) s = s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk39" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk39"><span class="nb">rewrite</span> &lt;- firstn_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (s :: List.map destination tr) n = Some s&#39;
‚Üí List.<span class="nb">last</span> (take n (List.map destination tr)) s = s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a"><span class="nb">generalize</span> (List.map destination tr); <span class="nb">intro</span> l; <span class="nb">clear</span> tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list (state T)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (s :: l) n = Some s&#39;
‚Üí List.<span class="nb">last</span> (take n l) s = s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b"><span class="nb">destruct</span> n; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list (state T)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some s = Some s&#39; ‚Üí List.<span class="nb">last</span> (take <span class="mi">0</span> l) s = s&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk3c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list (state T)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk3c"><hr></label><div class="goal-conclusion">nth_error l n = Some s&#39;
‚Üí List.<span class="nb">last</span> (take (S n) l) s = s&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list (state T)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some s = Some s&#39; ‚Üí List.<span class="nb">last</span> (take <span class="mi">0</span> l) s = s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> [= &lt;-]; <span class="nb">destruct</span> l.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list (state T)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error l n = Some s&#39;
‚Üí List.<span class="nb">last</span> (take (S n) l) s = s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> H; <span class="nb">symmetry</span>; <span class="nb">apply</span> take_nth_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3f"><span class="kn">Lemma</span> <span class="nf">finite_trace_last_suffix</span>
  (<span class="nv">s</span> : state T) (<span class="nv">tr</span> : list transition_item) (<span class="nv">n</span> : nat) :
    n &lt; length tr -&gt; finite_trace_last s (drop n tr) = finite_trace_last s tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n &lt; length tr
‚Üí finite_trace_last s (drop n tr) =
  finite_trace_last s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk40" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk40"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n &lt; length tr
‚Üí finite_trace_last s (drop n tr) =
  finite_trace_last s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk41" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk41"><span class="nb">intros</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n &lt; length tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s (drop n tr) =
finite_trace_last s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk42" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk42"><span class="nb">unfold</span> finite_trace_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n &lt; length tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.<span class="nb">last</span> (List.map destination (drop n tr)) s =
List.<span class="nb">last</span> (List.map destination tr) s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk43" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk43"><span class="nb">rewrite</span> &lt;- skipn_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n &lt; length tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.<span class="nb">last</span> (drop n (List.map destination tr)) s =
List.<span class="nb">last</span> (List.map destination tr) s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk44" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk44"><span class="nb">apply</span> drop_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n &lt; length tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n &lt; length (List.map destination tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> map_length.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk45" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk45"><span class="kn">Lemma</span> <span class="nf">unlock_finite_trace_last</span> (<span class="nv">s</span> : state T) (<span class="nv">tr</span> : list (transition_item T)) :
  finite_trace_last s tr = List.<span class="nb">last</span> (List.map destination tr) s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s tr =
List.<span class="nb">last</span> (List.map destination tr) s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk46" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk46"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>T</var><span class="hyp-type"><b>: </b><span>VLSMType message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state T</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s tr =
List.<span class="nb">last</span> (List.map destination tr) s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">done</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">sec_trace_lemmas</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">vs0</span> `(X : VLSM message) := @inhabitant _ (@s0 _ _ X).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk47" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk47"><span class="kn">Lemma</span> <span class="nf">mk_vlsm_machine</span>
  {<span class="nv">message</span> : <span class="kt">Type</span>}
  (<span class="nv">X</span> : VLSM message)
  : mk_vlsm (vlsm_machine X) = X.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{| vlsm_type := X; vlsm_machine := X |} = X</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk48" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk48"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{| vlsm_type := X; vlsm_machine := X |} = X</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> X.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">sec_VLSM</span>.</span></span></pre><div class="doc">
In this section we assume a fixed <span class="inlinecode"><span class="id" title="var">VLSM</span></span>. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  {<span class="nv">message</span> : <span class="kt">Type</span>}
  (<span class="nv">X</span> : VLSM message)
  .</span></span></pre><div class="doc">
<a id="lab7"></a><h3 class="section">Valid states and messages</h3>
<div class="paragraph"> </div>

  We further characterize certain objects as being <i>valid</i>, which means they can
  be witnessed or experienced during executions of the protocol. For example,
  a message is a <span class="inlinecode"><span class="id" title="var">valid_message</span></span> if there exists an execution of the protocol
  in which it is produced.

<div class="paragraph"> </div>

  We choose here to define valid states and messages together as the
  <span class="inlinecode"><span class="id" title="var">valid_state_message_prop</span></span>erty, inductively defined over the
  <span class="inlinecode"><span class="id" title="var">state</span></span> <span class="inlinecode">√ó</span> <span class="inlinecode"><span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">message</span></span> product type,
  as this definition avoids the need of using a mutually recursive definition.

<div class="paragraph"> </div>

  The inductive definition has three cases:
<ul class="doclist">
<li> if <code>s</code> is a <span class="inlinecode"><span class="id" title="var">state</span></span> with the <span class="inlinecode"><span class="id" title="var">initial_state_prop</span></span>erty, then <code>(s, None)</code>
    has the <span class="inlinecode"><span class="id" title="var">valid_state_message_prop</span></span>erty;

</li>
<li> if <code>m</code> is a <code>message</code> with the <span class="inlinecode"><span class="id" title="var">initial_message_prop</span></span>erty,
    then <code>(</code><span class="inlinecode"><span class="id" title="var">s0</span>,</span> <span class="inlinecode"><span class="id" title="var">Some</span></span><code>m)</code> has the <span class="inlinecode"><span class="id" title="var">valid_state_message_prop</span></span>erty;

</li>
<li> for all <span class="inlinecode"><span class="id" title="var">state</span></span>s <code>s</code>, <span class="inlinecode"><span class="id" title="var">option</span></span>al <code>message</code> <code>om</code>, and <span class="inlinecode"><span class="id" title="var">label</span></span> <code>l</code>:
<ul class="doclist">
<li> if there is an (optional) <code>message</code> <code>_om</code> such that <code>(s, _om)</code>
      has the <span class="inlinecode"><span class="id" title="var">valid_state_message_prop</span></span>erty;

</li>
<li> and if there is a <span class="inlinecode"><span class="id" title="var">state</span></span> <code>_s</code> such that <code>(_s, om)</code> has the
      <span class="inlinecode"><span class="id" title="var">valid_state_message_prop</span></span>erty;

</li>
<li> and if <code>l</code> <span class="inlinecode"><span class="id" title="var">valid</span></span> <code>(s, om)</code>,

</li>
<li> then <span class="inlinecode"><span class="id" title="var">transition</span></span> <code>l (s, om)</code> has the <span class="inlinecode"><span class="id" title="var">valid_state_message_prop</span></span>erty.

</li>
</ul>
</li>
</ul>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">valid_state_message_prop</span> : state X -&gt; option message -&gt; <span class="kt">Prop</span> :=
| valid_initial_state_message
    (s : state X)
    (Hs : initial_state_prop X s)
    (om : option message)
    (Hom : option_initial_message_prop X om) :
      valid_state_message_prop s om
| valid_generated_state_message
    (s : state X)
    (_om : option message)
    (Hps : valid_state_message_prop s _om)
    (_s : state X)
    (om : option message)
    (Hpm : valid_state_message_prop _s om)
    (l : label X)
    (Hv : valid X l (s, om))
    s&#39; om&#39;
    (Ht : transition X l (s, om) = (s&#39;, om&#39;)) :
      valid_state_message_prop s&#39; om&#39;.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">valid_initial_state</span>
  [s : state X] (Hs : initial_state_prop s) : valid_state_message_prop s None :=
    valid_initial_state_message s Hs None I.</span></span></pre><div class="doc">
  The <span class="inlinecode"><span class="id" title="var">valid_state_prop</span></span>erty and the <span class="inlinecode"><span class="id" title="var">valid_message_prop</span></span>erty are now
  definable as simple projections of the above definition.

<div class="paragraph"> </div>

  Moreover, we use these derived properties to define the corresponding
  dependent types <span class="inlinecode"><span class="id" title="var">valid_state</span></span> and <span class="inlinecode"><span class="id" title="var">valid_message</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">valid_state_prop</span> (<span class="nv">s</span> : state X) :=
  <span class="kr">exists</span> (<span class="nv">om</span> : option message),
    valid_state_message_prop s om.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">valid_message_prop</span> (<span class="nv">m</span> : message) :=
  <span class="kr">exists</span> (<span class="nv">s</span> : state X),
    valid_state_message_prop s (Some m).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">valid_state</span> : <span class="kt">Type</span> :=
  {s : state X | valid_state_prop s}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">valid_message</span> : <span class="kt">Type</span> :=
  {m : message | valid_message_prop m}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk49" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk49"><span class="kn">Lemma</span> <span class="nf">initial_state_is_valid</span>
  (<span class="nv">s</span> : state X) (<span class="nv">Hinitial</span> : initial_state_prop X s) :
    valid_state_prop s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk4a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk4a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk4b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk4b"><span class="kr">exists</span> <span class="nv">None</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_initial_state_message.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk4c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk4c"><span class="kn">Lemma</span> <span class="nf">initial_message_is_valid</span>
  (<span class="nv">m</span> : message) (<span class="nv">Hinitial</span> : initial_message_prop X m) :
    valid_message_prop m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>initial_message_prop m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk4d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk4d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>initial_message_prop m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk4e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk4e"><span class="kr">exists</span> (<span class="nv">proj1_sig</span> (vs0 X)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>initial_message_prop m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop (`(vs0 X)) (Some m)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_initial_state_message; [<span class="nb">apply</span> proj2_sig |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  As often times we work with optional valid messages, it is convenient
  to define a valid message property for optional messages.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">option_valid_message_prop</span> (<span class="nv">om</span> : option message) :=
  <span class="kr">exists</span> (<span class="nv">s</span> : state X),
    valid_state_message_prop s om.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk4f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk4f"><span class="kn">Lemma</span> <span class="nf">option_valid_message_None</span> :
  option_valid_message_prop None.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk50" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk50"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk51" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk51"><span class="kr">exists</span> (<span class="nv">proj1_sig</span> (vs0 X)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop (`(vs0 X)) None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_initial_state_message; [<span class="nb">apply</span> proj2_sig |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk52" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk52"><span class="kn">Lemma</span> <span class="nf">option_valid_message_Some</span>
  (<span class="nv">m</span> : message) (<span class="nv">Hpm</span> : valid_message_prop m) :
    option_valid_message_prop (Some m).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_message_prop m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop (Some m)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk53" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk53"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_message_prop m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop (Some m)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> Hpm <span class="kr">as</span> [s Hpm]; <span class="kr">exists</span> <span class="nv">s</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk54" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk54"><span class="kn">Lemma</span> <span class="nf">option_initial_message_is_valid</span>
  (<span class="nv">om</span> : option message) (<span class="nv">Hinitial</span> : option_initial_message_prop X om) :
    option_valid_message_prop om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk55" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk55"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk56" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk56"><span class="nb">destruct</span> om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X (Some m)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop (Some m)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk57" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X None</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk57"><hr></label><div class="goal-conclusion">option_valid_message_prop None</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk58" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk58">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X (Some m)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop (Some m)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> option_valid_message_Some, initial_message_is_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk59" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk59">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Hinitial</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X None</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> option_valid_message_None.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  We also include the more intuitive, mutually recursive definition
  of valid states and messages.

<div class="paragraph"> </div>

  This definition has three cases for <span class="inlinecode"><span class="id" title="var">valid_message_mrec</span></span>:

<div class="paragraph"> </div>
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">None</span></span> is a valid message (<span class="inlinecode"><span class="id" title="var">valid_message_mrec_None</span></span>);

</li>
<li> if <code>m</code> is an optional <code>message</code> with the <span class="inlinecode"><span class="id" title="var">initial_message_prop</span></span>erty,
    then it constitutes a valid message

</li>
<li> for all <span class="inlinecode"><span class="id" title="var">state</span></span>s <code>st</code>, <span class="inlinecode"><span class="id" title="var">option</span></span>al <code>message</code>s <code>om</code>, and <span class="inlinecode"><span class="id" title="var">label</span></span> <code>l</code>:
<ul class="doclist">
<li> if <code>om</code> is a valid message (<span class="inlinecode"><span class="id" title="var">valid_message_mrec</span></span>);

</li>
<li> and if <code>st</code> is a valid state (<span class="inlinecode"><span class="id" title="var">valid_state_mrec</span></span>);

</li>
<li> and if <code>l</code> <span class="inlinecode"><span class="id" title="var">valid</span></span> <code>l (st, om)</code>;

</li>
<li> the <span class="inlinecode"><span class="id" title="var">transition</span></span> <code>l (st, om)</code> emits a message which has the
      <span class="inlinecode"><span class="id" title="var">valid_message_mrec</span></span> property.

</li>
</ul>
</li>
</ul>
<div class="paragraph"> </div>

  There are also two cases for <span class="inlinecode"><span class="id" title="var">valid_state_mrec</span></span>:

<div class="paragraph"> </div>
<ul class="doclist">
<li> if <code>s</code> is a <span class="inlinecode"><span class="id" title="var">state</span></span> with the <span class="inlinecode"><span class="id" title="var">initial_state_prop</span></span>erty, then it has the
    <span class="inlinecode"><span class="id" title="var">valid_state_mrec</span></span>;

</li>
<li> for all <span class="inlinecode"><span class="id" title="var">state</span></span>s <code>st</code>, <span class="inlinecode"><span class="id" title="var">option</span></span>al <code>message</code>s <code>om</code>, and <span class="inlinecode"><span class="id" title="var">label</span></span> <code>l</code>:
<ul class="doclist">
<li> if <code>st</code> is a valid state (<span class="inlinecode"><span class="id" title="var">valid_state_mrec</span></span>);

</li>
<li> and if <code>om</code> is a valid message (<span class="inlinecode"><span class="id" title="var">valid_message_mrec</span></span>);

</li>
<li> and if <code>l</code> <span class="inlinecode"><span class="id" title="var">valid</span></span> <code>l (st, om)</code>;

</li>
<li> then the state resulting from <span class="inlinecode"><span class="id" title="var">transition</span></span> <code>l (st, om)</code> has the
      <span class="inlinecode"><span class="id" title="var">valid_state_mrec</span></span> property.

</li>
</ul>
</li>
</ul>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">valid_message_mrec</span> : option message -&gt; <span class="kt">Prop</span> :=
| valid_message_mrec_None :
    valid_message_mrec None
| valid_message_mrec_initial :
    <span class="kr">forall</span> (<span class="nv">m</span> : message),
      initial_message_prop X m -&gt; valid_message_mrec (Some m)
| valid_message_mrec_generated :
    <span class="kr">forall</span> {<span class="nv">l</span> : label X} {<span class="nv">om</span> <span class="nv">om&#39;</span> : option message} {<span class="nv">st</span> <span class="nv">st&#39;</span> : state X},
      valid X l (st, om) -&gt; valid_state_mrec st -&gt; valid_message_mrec om -&gt;
      transition X l (st, om) = (st&#39;, om&#39;) -&gt; valid_message_mrec om&#39;
<span class="kr">with</span> valid_state_mrec : state X -&gt; <span class="kt">Prop</span> :=
| valid_state_mrec_initial :
    <span class="kr">forall</span> (<span class="nv">s</span> : state X),
      initial_state_prop X s -&gt; valid_state_mrec s
| valid_state_mrec_generated :
    <span class="kr">forall</span> {<span class="nv">l</span> : label X} {<span class="nv">om</span> <span class="nv">om&#39;</span> : option message} {<span class="nv">st</span> <span class="nv">st&#39;</span> : state X},
      valid X l (st, om) -&gt; valid_state_mrec st -&gt; valid_message_mrec om -&gt;
      transition X l (st, om) = (st&#39;, om&#39;) -&gt; valid_state_mrec st&#39;.</span></span></pre><div class="doc">
  Reasoning about this mutually recursive definition is facilitated
  by a custom induction scheme.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Scheme</span> <span class="nf">valid_message_ind</span> := <span class="kn">Induction for</span> valid_message_mrec <span class="kn">Sort</span> <span class="kt">Prop</span>
<span class="kr">with</span> valid_state_ind := <span class="kn">Induction for</span> valid_state_mrec <span class="kn">Sort</span> <span class="kt">Prop</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> valid_message_ind Pmsg Pstate : <span class="nb">rename</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> valid_state_ind Pmsg Pstate : <span class="nb">rename</span>.</span></span></pre><div class="doc">
  To guarantee the equivalence between <span class="inlinecode"><span class="id" title="var">valid_message_mrec</span></span> coupled with
  <span class="inlinecode"><span class="id" title="var">valid_state_mrec</span></span> and <span class="inlinecode"><span class="id" title="var">valid_state_message_prop</span></span> we prove the
  following lemmas.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk5a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk5a"><span class="kn">Lemma</span> <span class="nf">valid_state_message_prop_impl_valid</span> :
  <span class="kr">forall</span> (<span class="nv">s</span> : state X) (<span class="nv">om</span> : option message),
    valid_state_message_prop s om -&gt;
    valid_message_mrec om /\ valid_state_mrec s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">om</span> : option message),
  valid_state_message_prop s om
  ‚Üí valid_message_mrec om ‚àß valid_state_mrec s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk5b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk5b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">om</span> : option message),
  valid_state_message_prop s om
  ‚Üí valid_message_mrec om ‚àß valid_state_mrec s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk5c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk5c"><span class="nb">induction</span> <span class="mi">1</span>; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_mrec om</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk5d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk5d"><hr></label><div class="goal-conclusion">valid_state_mrec s</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk5e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk5e"><hr></label><div class="goal-conclusion">valid_message_mrec om&#39;</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk5f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk5f"><hr></label><div class="goal-conclusion">valid_state_mrec s&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk60" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk60">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_mrec om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> om; [<span class="nb">apply</span> valid_message_mrec_initial | <span class="nb">constructor</span>].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk61" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk61">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_mrec s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_state_mrec_initial.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk62" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk62">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_mrec om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk63" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk63"><span class="nb">replace</span> om&#39; <span class="kr">with</span> (transition X l0 (s, om)).<span class="mi">2</span>
      <span class="bp">by</span> (<span class="nb">cbn</span> <span class="kr">in</span> Ht; <span class="nb">rewrite</span> Ht; <span class="bp">done</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_mrec (transition l0 (s, om)).<span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk64" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk64"><span class="nb">rewrite</span> Ht; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_mrec om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eapply</span> valid_message_mrec_generated; [<span class="bp">done</span> | itauto.. |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk65" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk65">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_mrec s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk66" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk66"><span class="nb">replace</span> s&#39; <span class="kr">with</span> (transition X l0 (s, om)).<span class="mi">1</span>
      <span class="bp">by</span> (<span class="nb">cbn</span> <span class="kr">in</span> Ht; <span class="nb">rewrite</span> Ht; <span class="bp">done</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_mrec (transition l0 (s, om)).<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk67" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk67"><span class="nb">eapply</span> valid_state_mrec_generated; [<span class="bp">done</span> | ..].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_mrec s</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk68" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk68"><hr></label><div class="goal-conclusion">valid_message_mrec om</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk69" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk69"><hr></label><div class="goal-conclusion">transition l0 (s, om) =
((transition l0 (s, om)).<span class="mi">1</span>, <span class="nl">?om&#39;</span>)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk6a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk6a">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_mrec s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> IHvalid_state_message_prop1.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk6b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk6b">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_mrec om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> IHvalid_state_message_prop2.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk6c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk6c">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHvalid_state_message_prop1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec _om
‚àß valid_state_mrec s</span></span></span><br><span><var>IHvalid_state_message_prop2</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om
‚àß valid_state_mrec _s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">transition l0 (s, om) =
((transition l0 (s, om)).<span class="mi">1</span>, <span class="nl">?om&#39;</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> Ht.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk6d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk6d"><span class="kn">Lemma</span> <span class="nf">valid_impl_valid_state_prop</span> :
  <span class="kr">forall</span> (<span class="nv">s</span> : state X),
    valid_state_mrec s -&gt; valid_state_prop s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_mrec s ‚Üí valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk6e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk6e"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_mrec s ‚Üí valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk6f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk6f"><span class="nb">apply</span> valid_state_ind <span class="kr">with</span> (Pmsg := <span class="kr">fun</span> <span class="nv">m</span> <span class="nv">_</span> =&gt; option_valid_message_prop m).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop None</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk70" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk70"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m</span> : message,
  initial_message_prop m
  ‚Üí option_valid_message_prop (Some m)</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk71" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk71"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">st</span> <span class="nv">st&#39;</span> : state X),
  valid l (st, om)
  ‚Üí valid_state_mrec st
    ‚Üí valid_state_prop st
      ‚Üí valid_message_mrec om
        ‚Üí option_valid_message_prop om
          ‚Üí transition l (st, om) = (st&#39;, om&#39;)
            ‚Üí option_valid_message_prop om&#39;</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk72" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk72"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  initial_state_prop s ‚Üí valid_state_prop s</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk73" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk73"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">st</span> <span class="nv">st&#39;</span> : state X),
  valid l (st, om)
  ‚Üí valid_state_mrec st
    ‚Üí valid_state_prop st
      ‚Üí valid_message_mrec om
        ‚Üí option_valid_message_prop om
          ‚Üí transition l (st, om) = (st&#39;, om&#39;)
            ‚Üí valid_state_prop st&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk74" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk74">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> option_valid_message_None.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk75" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk75">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m</span> : message,
  initial_message_prop m
  ‚Üí option_valid_message_prop (Some m)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> initial_message_is_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk76" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk76">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) (<span class="nv">st</span>
                                           <span class="nv">st&#39;</span> : state
                                                 X),
  valid l (st, om)
  ‚Üí valid_state_mrec st
    ‚Üí valid_state_prop st
      ‚Üí valid_message_mrec om
        ‚Üí option_valid_message_prop om
          ‚Üí transition l (st, om) = (st&#39;, om&#39;)
            ‚Üí option_valid_message_prop om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk77" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk77"><span class="nb">intros</span> * ? ? [] ? [] Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>st, st'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>valid l0 (st, om)</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>valid_state_mrec st</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop st x</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop x0 om</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>transition l0 (st, om) = (st&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eexists</span>; <span class="nb">eapply</span> valid_generated_state_message; <span class="nb">cycle</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk78" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk78">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  initial_state_prop s ‚Üí valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span>; <span class="nb">apply</span> initial_state_is_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk79" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk79">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) (<span class="nv">st</span>
                                           <span class="nv">st&#39;</span> : state
                                                 X),
  valid l (st, om)
  ‚Üí valid_state_mrec st
    ‚Üí valid_state_prop st
      ‚Üí valid_message_mrec om
        ‚Üí option_valid_message_prop om
          ‚Üí transition l (st, om) = (st&#39;, om&#39;)
            ‚Üí valid_state_prop st&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk7a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk7a"><span class="nb">intros</span> * ? ? [] ? [] Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>st, st'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>valid l0 (st, om)</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>valid_state_mrec st</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop st x</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop x0 om</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>transition l0 (st, om) = (st&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop st&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eexists</span>; <span class="nb">eapply</span> valid_generated_state_message; <span class="nb">cycle</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk7b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk7b"><span class="kn">Lemma</span> <span class="nf">valid_impl_valid_message_prop</span> :
  <span class="kr">forall</span> (<span class="nv">om</span> : option message),
    valid_message_mrec om -&gt; option_valid_message_prop om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">om</span> : option message,
  valid_message_mrec om ‚Üí option_valid_message_prop om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk7c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk7c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">om</span> : option message,
  valid_message_mrec om ‚Üí option_valid_message_prop om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk7d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk7d"><span class="nb">apply</span> valid_message_ind <span class="kr">with</span> (Pstate := <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">_</span> =&gt; valid_state_prop s).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop None</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk7e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk7e"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m</span> : message,
  initial_message_prop m
  ‚Üí option_valid_message_prop (Some m)</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk7f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk7f"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">st</span> <span class="nv">st&#39;</span> : state X),
  valid l (st, om)
  ‚Üí valid_state_mrec st
    ‚Üí valid_state_prop st
      ‚Üí valid_message_mrec om
        ‚Üí option_valid_message_prop om
          ‚Üí transition l (st, om) = (st&#39;, om&#39;)
            ‚Üí option_valid_message_prop om&#39;</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk80" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk80"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  initial_state_prop s ‚Üí valid_state_prop s</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk81" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk81"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">st</span> <span class="nv">st&#39;</span> : state X),
  valid l (st, om)
  ‚Üí valid_state_mrec st
    ‚Üí valid_state_prop st
      ‚Üí valid_message_mrec om
        ‚Üí option_valid_message_prop om
          ‚Üí transition l (st, om) = (st&#39;, om&#39;)
            ‚Üí valid_state_prop st&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk82" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk82">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> option_valid_message_None.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk83" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk83">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m</span> : message,
  initial_message_prop m
  ‚Üí option_valid_message_prop (Some m)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> initial_message_is_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk84" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk84">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) (<span class="nv">st</span>
                                           <span class="nv">st&#39;</span> : state
                                                 X),
  valid l (st, om)
  ‚Üí valid_state_mrec st
    ‚Üí valid_state_prop st
      ‚Üí valid_message_mrec om
        ‚Üí option_valid_message_prop om
          ‚Üí transition l (st, om) = (st&#39;, om&#39;)
            ‚Üí option_valid_message_prop om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk85" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk85"><span class="nb">intros</span> * ? ? [] ? [] Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>st, st'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>valid l0 (st, om)</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>valid_state_mrec st</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop st x</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop x0 om</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>transition l0 (st, om) = (st&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eexists</span>; <span class="nb">eapply</span> valid_generated_state_message; <span class="nb">cycle</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk86" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk86">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  initial_state_prop s ‚Üí valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span>; <span class="nb">apply</span> initial_state_is_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk87" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk87">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) (<span class="nv">st</span>
                                           <span class="nv">st&#39;</span> : state
                                                 X),
  valid l (st, om)
  ‚Üí valid_state_mrec st
    ‚Üí valid_state_prop st
      ‚Üí valid_message_mrec om
        ‚Üí option_valid_message_prop om
          ‚Üí transition l (st, om) = (st&#39;, om&#39;)
            ‚Üí valid_state_prop st&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk88" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk88"><span class="nb">intros</span> * ? ? [] ? [] Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>st, st'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>valid l0 (st, om)</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>valid_state_mrec st</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop st x</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>valid_message_mrec om</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop x0 om</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>transition l0 (st, om) = (st&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop st&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eexists</span>; <span class="nb">eapply</span> valid_generated_state_message; <span class="nb">cycle</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk89" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk89"><span class="kn">Lemma</span> <span class="nf">valid_iff_valid_message_prop</span> :
  <span class="kr">forall</span> (<span class="nv">om</span> : option message),
    valid_message_mrec om &lt;-&gt; option_valid_message_prop om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">om</span> : option message,
  valid_message_mrec om ‚Üî option_valid_message_prop om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk8a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk8a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">om</span> : option message,
  valid_message_mrec om ‚Üî option_valid_message_prop om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk8b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk8b"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_mrec om ‚Üí option_valid_message_prop om</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk8c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk8c"><hr></label><div class="goal-conclusion">option_valid_message_prop om ‚Üí valid_message_mrec om</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk8d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk8d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_mrec om ‚Üí option_valid_message_prop om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_impl_valid_message_prop.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk8e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk8e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om ‚Üí valid_message_mrec om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> []; <span class="nb">eapply</span> valid_state_message_prop_impl_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk8f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk8f"><span class="kn">Lemma</span> <span class="nf">valid_iff_valid_state_prop</span> :
  <span class="kr">forall</span> (<span class="nv">s</span> : state X),
    valid_state_mrec s &lt;-&gt; valid_state_prop s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_mrec s ‚Üî valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk90" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk90"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_mrec s ‚Üî valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk91" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk91"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_mrec s ‚Üí valid_state_prop s</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk92" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk92"><hr></label><div class="goal-conclusion">valid_state_prop s ‚Üí valid_state_mrec s</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk93" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk93">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_mrec s ‚Üí valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_impl_valid_state_prop.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk94" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk94">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s ‚Üí valid_state_mrec s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> []; <span class="nb">eapply</span> valid_state_message_prop_impl_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab8"></a><h3 class="section">Input validity and input valid transitions</h3>
<div class="paragraph"> </div>

  To specify that a particular (input of a) transition can actually be
  encountered as part of a protocol execution, we define the notions of
  <span class="inlinecode"><span class="id" title="var">input_valid</span></span>ity and <span class="inlinecode"><span class="id" title="var">input_valid_transition</span></span>.

<div class="paragraph"> </div>

  Input validity requires that the <span class="inlinecode"><span class="id" title="var">valid</span></span> predicate holds for the
  given inputs and that they have a <span class="inlinecode"><span class="id" title="var">valid_state</span></span> and a <span class="inlinecode"><span class="id" title="var">valid_message</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">input_valid</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) : <span class="kt">Prop</span> :=
  <span class="kr">let</span> (<span class="nv">s</span>, om) := som <span class="kr">in</span>
    valid_state_prop s /\ option_valid_message_prop om /\ valid X l (s, om).</span></span></pre><div class="doc">
Input valid transitions are transitions with <span class="inlinecode"><span class="id" title="var">input_valid</span></span> inputs. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">input_valid_transition</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> <span class="nv">som&#39;</span> : state X * option message) : <span class="kt">Prop</span> :=
  input_valid l som /\ transition X l som = som&#39;.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">input_valid_transition_item</span> (<span class="nv">s</span> : state X) (<span class="nv">item</span> : transition_item) : <span class="kt">Prop</span> :=
  input_valid_transition (l item) (s, input item) (destination item, output item).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">input_valid_transition_preserving</span> (<span class="nv">R</span> : state X -&gt; state X -&gt; <span class="kt">Prop</span>) : <span class="kt">Prop</span> :=
  <span class="kr">forall</span> (<span class="nv">s1</span> <span class="nv">s2</span> : state X) (<span class="nv">l</span> : label X) (<span class="nv">om1</span> <span class="nv">om2</span> : option message),
    input_valid_transition l (s1, om1) (s2, om2) -&gt; R s1 s2.</span></span></pre><div class="doc">
Next three lemmas show the two definitions above are strongly related. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk95" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk95"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_valid</span>
  (<span class="nv">l</span> : label X)
  (<span class="nv">som</span> : state X * option message)
  (<span class="nv">som&#39;</span> : state X * option message)
  (<span class="nv">Ht</span> : input_valid_transition l som som&#39;) :
    input_valid l som.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som, som'</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l som som&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid l som</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk96" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk96"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som, som'</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l som som&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid l som</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> Ht.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk97" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk97"><span class="kn">Lemma</span> <span class="nf">input_valid_can_transition</span>
  (<span class="nv">l</span> : label X)
  (<span class="nv">som</span> : state X * option message)
  (<span class="nv">Hv</span> : input_valid l som) :
    <span class="kr">forall</span> (<span class="nv">som&#39;</span> : state X * option message),
      transition X l som = som&#39; -&gt; input_valid_transition l som som&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>input_valid l som</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">som&#39;</span> : state X * option message,
  transition l som = som&#39;
  ‚Üí input_valid_transition l som som&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk98" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk98"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>input_valid l som</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">som&#39;</span> : state X * option message,
  transition l som = som&#39;
  ‚Üí input_valid_transition l som som&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">done</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk99" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk99"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_iff</span>
  (<span class="nv">l</span> : label X)
  (<span class="nv">som</span> : state X * option message) :
    input_valid l som
      &lt;-&gt;
    <span class="kr">exists</span> (<span class="nv">som&#39;</span> : state X * option message),
      input_valid_transition l som som&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid l som
‚Üî (<span class="kr">‚àÉ</span> <span class="nv">som&#39;</span> : state X * option message,
     input_valid_transition l som som&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk9a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk9a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid l som
‚Üî (<span class="kr">‚àÉ</span> <span class="nv">som&#39;</span> : state X * option message,
     input_valid_transition l som som&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk9b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk9b"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid l som
‚Üí <span class="kr">‚àÉ</span> <span class="nv">som&#39;</span> : state X * option message,
    input_valid_transition l som som&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk9c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk9c"><hr></label><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">som&#39;</span> : state X * option message,
   input_valid_transition l som som&#39;)
‚Üí input_valid l som</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk9d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk9d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid l som
‚Üí <span class="kr">‚àÉ</span> <span class="nv">som&#39;</span> : state X * option message,
    input_valid_transition l som som&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eexists</span>; <span class="nb">apply</span> input_valid_can_transition.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk9e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk9e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">som&#39;</span> : state X * option message,
   input_valid_transition l som som&#39;)
‚Üí input_valid l som</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk9f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk9f"><span class="nb">intros</span> [som&#39; Hivt].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>som, som'</var><span class="hyp-type"><b>: </b><span>(state X * option message)%type</span></span></span><br><span><var>Hivt</var><span class="hyp-type"><b>: </b><span>input_valid_transition l som som&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid l som</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> input_valid_transition_valid <span class="kr">with</span> som&#39;.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  The next couple of lemmas relate the two definitions above with
  pre-existing concepts.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka0"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_origin</span>
  {<span class="nv">l</span> : label X}
  {<span class="nv">s</span> <span class="nv">s&#39;</span> : state X}
  {<span class="nv">om</span> <span class="nv">om&#39;</span> : option message}
  (<span class="nv">Ht</span> : input_valid_transition l (s, om) (s&#39;, om&#39;)) :
    valid_state_prop s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> Ht <span class="kr">as</span> [[[_om Hp] _] _]; <span class="kr">exists</span> <span class="nv">_om</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka2"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_destination</span>
  {<span class="nv">l</span> : label X}
  {<span class="nv">s</span> <span class="nv">s&#39;</span> : state X}
  {<span class="nv">om</span> <span class="nv">om&#39;</span> : option message}
  (<span class="nv">Ht</span> : input_valid_transition l (s, om) (s&#39;, om&#39;)) :
    valid_state_prop s&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka4"><span class="kr">exists</span> <span class="nv">om&#39;</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s&#39; om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka5"><span class="nb">destruct</span> Ht <span class="kr">as</span> [[[_om Hs] [[_s Hom] Hv]] Ht].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om', _om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l (s, om)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l (s, om) = (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s&#39; om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_generated_state_message <span class="kr">with</span> s _om _s om l.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka6"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_in</span>
  {<span class="nv">l</span> : label X}
  {<span class="nv">s</span> <span class="nv">s&#39;</span> : state X}
  {<span class="nv">om</span> <span class="nv">om&#39;</span> : option message}
  (<span class="nv">Ht</span> : input_valid_transition l (s, om) (s&#39;, om&#39;)) :
    option_valid_message_prop om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka7"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka8"><span class="nb">destruct</span> Ht <span class="kr">as</span> [[_ [[_s Hom] _]] _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="nv">_s</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chka9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chka9"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_outputs_valid_state_message</span>
  {<span class="nv">l</span> : label X}
  {<span class="nv">s</span> <span class="nv">s&#39;</span> : state X}
  {<span class="nv">om</span> <span class="nv">om&#39;</span> : option message}
  (<span class="nv">Ht</span> : input_valid_transition l (s, om) (s&#39;, om&#39;)) :
    valid_state_message_prop s&#39; om&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s&#39; om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkaa" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkaa"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s&#39; om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkab" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkab"><span class="nb">destruct</span> Ht <span class="kr">as</span> [[[_om Hps] [[_s Hpm] Hv]] Ht].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om', _om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l (s, om)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l (s, om) = (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s&#39; om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_generated_state_message <span class="kr">with</span> s _om _s om l.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkac" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkac"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_out</span>
  {<span class="nv">l</span> : label X}
  {<span class="nv">s</span> <span class="nv">s&#39;</span> : state X}
  {<span class="nv">om</span> <span class="nv">om&#39;</span> : option message}
  (<span class="nv">Ht</span> : input_valid_transition l (s, om) (s&#39;, om&#39;)) :
    option_valid_message_prop om&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkad" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkad"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkae" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkae"><span class="nb">apply</span> input_valid_transition_outputs_valid_state_message <span class="kr">in</span> Ht.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; om&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_valid_message_prop om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="nv">s&#39;</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkaf" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkaf"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_is_valid</span>
  {<span class="nv">l</span> : label X}
  {<span class="nv">s</span> <span class="nv">s&#39;</span> : state X}
  {<span class="nv">om</span> <span class="nv">om&#39;</span> : option message}
  (<span class="nv">Ht</span> : input_valid_transition l (s, om) (s&#39;, om&#39;)) :
    valid X l (s, om).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid l (s, om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb0"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid l (s, om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> Ht <span class="kr">as</span> [[_ [_ Hv]] _].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb1"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_transition</span>
  {<span class="nv">l</span> : label X}
  {<span class="nv">s</span> <span class="nv">s&#39;</span> : state X}
  {<span class="nv">om</span> <span class="nv">om&#39;</span> : option message}
  (<span class="nv">Ht</span> : input_valid_transition l (s, om) (s&#39;, om&#39;)) :
    transition X l (s, om) = (s&#39;, om&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">transition l (s, om) = (s&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb2"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, om) (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">transition l (s, om) = (s&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> Ht <span class="kr">as</span> [_ Ht].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb3"><span class="kn">Lemma</span> <span class="nf">input_valid_state_message_outputs</span>
  (<span class="nv">l</span> : label X)
  (<span class="nv">s</span> : state X)
  (<span class="nv">om</span> : option message)
  (<span class="nv">Hv</span> : input_valid l (s, om))
  (<span class="nv">s&#39;</span> : state X) (<span class="nv">om&#39;</span> : option message)
  (<span class="nv">Ht</span> : transition X l (s, om) = (s&#39;, om&#39;)) :
    valid_state_message_prop s&#39; om&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>input_valid l (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l (s, om) = (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s&#39; om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb4"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>input_valid l (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l (s, om) = (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s&#39; om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb5"><span class="nb">destruct</span> Hv <span class="kr">as</span> [[_om Hs] [[_s Hom] Hv]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, _om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l (s, om) = (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s&#39; om&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_generated_state_message <span class="kr">with</span> s _om _s om l.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<span class="inlinecode"><span class="id" title="var">transition</span></span>s are deterministic, i.e. the final state and output message
  are determined by the label, initial state and input message of the
  transition. This is because <span class="inlinecode"><span class="id" title="var">transition</span></span> is a function.

<div class="paragraph"> </div>

  Because of the above, <span class="inlinecode"><span class="id" title="var">input_valid_transition</span></span>s are also deterministic.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb6"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_deterministic</span> :
  <span class="kr">forall</span> {<span class="nv">lbl</span> : label X} {<span class="nv">s</span> <span class="nv">s1</span> <span class="nv">s2</span> : state X} {<span class="nv">iom</span> <span class="nv">oom1</span> <span class="nv">oom2</span> : option message},
    input_valid_transition lbl (s, iom) (s1, oom1) -&gt;
    input_valid_transition lbl (s, iom) (s2, oom2) -&gt;
      s1 = s2 /\ oom1 = oom2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">lbl</span> : label X) (<span class="nv">s</span> <span class="nv">s1</span> <span class="nv">s2</span> : state X) (<span class="nv">iom</span> <span class="nv">oom1</span>
                                       <span class="nv">oom2</span> : option
                                                message),
  input_valid_transition lbl (s, iom) (s1, oom1)
  ‚Üí input_valid_transition lbl (s, iom) (s2, oom2)
    ‚Üí s1 = s2 ‚àß oom1 = oom2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb7"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">lbl</span> : label X) (<span class="nv">s</span> <span class="nv">s1</span> <span class="nv">s2</span> : state X) (<span class="nv">iom</span> <span class="nv">oom1</span>
                                       <span class="nv">oom2</span> : option
                                                message),
  input_valid_transition lbl (s, iom) (s1, oom1)
  ‚Üí input_valid_transition lbl (s, iom) (s2, oom2)
    ‚Üí s1 = s2 ‚àß oom1 = oom2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kp">do</span> <span class="mi">2</span> <span class="nb">inversion</span> <span class="mi">1</span>; itauto <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  For VLSMs initialized with many initial messages such as
  the <span class="inlinecode"><span class="id" title="var">composite_vlsm_induced_projection</span></span> the question of
  whether a <span class="inlinecode"><span class="id" title="var">VLSM</span></span> <span class="inlinecode"><span class="id" title="var">can_emit</span></span> a message <code>m</code> becomes more
  useful than that whether <code>m</code> is a <span class="inlinecode"><span class="id" title="var">valid_message</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">option_can_produce</span> (<span class="nv">s</span> : state X) (<span class="nv">om</span> : option message) : <span class="kt">Prop</span> :=
  <span class="kr">exists</span> (<span class="nv">som</span> : state X * option message) (<span class="nv">l</span> : label X),
    input_valid_transition l som (s, om).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">can_produce</span> (<span class="nv">s</span> : state X) (<span class="nv">m</span> : message) : <span class="kt">Prop</span> :=
  option_can_produce s (Some m).</span></span></pre><div class="doc">
Of course, if a VLSM <span class="inlinecode"><span class="id" title="var">can_emit</span></span> <code>(s, m)</code>, then <code>(s, m)</code> is valid. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb8"><span class="kn">Lemma</span> <span class="nf">option_can_produce_valid</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">om</span> : option message)
  (<span class="nv">Hm</span> : option_can_produce s om) :
    valid_state_message_prop s om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>option_can_produce s om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkb9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkb9"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>option_can_produce s om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkba" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkba"><span class="nb">destruct</span> Hm <span class="kr">as</span> [(s0, om0) [l [[[_om0 Hs0] [[_s0 Hom0] Hv]] Ht]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>_om0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s0 _om0</span></span></span><br><span><var>_s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hom0</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s0 om0</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l (s0, om0)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l (s0, om0) = (s, om)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_generated_state_message <span class="kr">with</span> s0 _om0 _s0 om0 l.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkbb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkbb"><span class="kn">Lemma</span> <span class="nf">can_produce_valid</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">m</span> : message)
  (<span class="nv">Hm</span> : can_produce s m) :
    valid_state_message_prop s (Some m).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>can_produce s m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s (Some m)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkbc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkbc"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>can_produce s m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s (Some m)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (option_can_produce_valid s (Some m) Hm).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkbd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkbd"><span class="kn">Lemma</span> <span class="nf">option_can_produce_valid_iff</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">om</span> : option message) :
    valid_state_message_prop s om &lt;-&gt;
    option_can_produce s om \/ initial_state_prop X s /\ option_initial_message_prop X om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s om
‚Üî option_can_produce s om
  ‚à® initial_state_prop s
    ‚àß option_initial_message_prop X om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkbe" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkbe"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s om
‚Üî option_can_produce s om
  ‚à® initial_state_prop s
    ‚àß option_initial_message_prop X om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkbf" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkbf"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s om
‚Üí option_can_produce s om
  ‚à® initial_state_prop s
    ‚àß option_initial_message_prop X om</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chkc0" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chkc0"><hr></label><div class="goal-conclusion">option_can_produce s om
‚à® initial_state_prop s
  ‚àß option_initial_message_prop X om
‚Üí valid_state_message_prop s om</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkc1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkc1">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s om
‚Üí option_can_produce s om
  ‚à® initial_state_prop s
    ‚àß option_initial_message_prop X om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkc2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkc2"><span class="nb">intros</span> Hm; <span class="nb">inversion</span> Hm; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s om</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_can_produce s om
‚à® initial_state_prop s
  ‚àß option_initial_message_prop X om</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chkc3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s om</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s1 _om</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om0</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s1, om0)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s1, om0) = (s, om)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chkc3"><hr></label><div class="goal-conclusion">option_can_produce s om
‚à® initial_state_prop s
  ‚àß option_initial_message_prop X om</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkc4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkc4">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s om</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_can_produce s om
‚à® initial_state_prop s
  ‚àß option_initial_message_prop X om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">right</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkc5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkc5">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s om</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s1 _om</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om0</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s1, om0)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s1, om0) = (s, om)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_can_produce s om
‚à® initial_state_prop s
  ‚àß option_initial_message_prop X om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">left</span>; <span class="kr">exists</span> (<span class="nv">s1</span>, om0), l0; <span class="nb">firstorder</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkc6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkc6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_can_produce s om
‚à® initial_state_prop s
  ‚àß option_initial_message_prop X om
‚Üí valid_state_message_prop s om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkc7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkc7"><span class="nb">intros</span> [Hem | Him].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hem</var><span class="hyp-type"><b>: </b><span>option_can_produce s om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s om</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chkc8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>initial_state_prop s
‚àß option_initial_message_prop X om</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chkc8"><hr></label><div class="goal-conclusion">valid_state_message_prop s om</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkc9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkc9">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hem</var><span class="hyp-type"><b>: </b><span>option_can_produce s om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> option_can_produce_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkca" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkca">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>initial_state_prop s
‚àß option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>; <span class="nb">apply</span> Him.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkcb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkcb"><span class="kn">Lemma</span> <span class="nf">can_produce_valid_iff</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">m</span> : message) :
    valid_state_message_prop s (Some m) &lt;-&gt;
    can_produce s m \/ initial_state_prop X s /\ initial_message_prop X m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s (Some m)
‚Üî can_produce s m
  ‚à® initial_state_prop s ‚àß initial_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkcc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkcc"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s (Some m)
‚Üî can_produce s m
  ‚à® initial_state_prop s ‚àß initial_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (option_can_produce_valid_iff s (Some m)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">can_emit</span> (<span class="nv">m</span> : message) : <span class="kt">Prop</span> :=
  <span class="kr">exists</span> (<span class="nv">som</span> : state X * option message) (<span class="nv">l</span> : label X) (<span class="nv">s</span> : state X),
   input_valid_transition l som (s, Some m).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkcd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkcd"><span class="kn">Lemma</span> <span class="nf">can_emit_iff</span> :
  <span class="kr">forall</span> (<span class="nv">m</span> : message),
    can_emit m &lt;-&gt; <span class="kr">exists</span> <span class="nv">s</span>, can_produce s m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m</span> : message,
  can_emit m ‚Üî (<span class="kr">‚àÉ</span> <span class="nv">s</span> : state X, can_produce s m)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkce" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkce"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m</span> : message,
  can_emit m ‚Üî (<span class="kr">‚àÉ</span> <span class="nv">s</span> : state X, can_produce s m)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkcf" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkcf"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_emit m ‚Üí <span class="kr">‚àÉ</span> <span class="nv">s</span> : state X, can_produce s m</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chkd0" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chkd0"><hr></label><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">s</span> : state X, can_produce s m) ‚Üí can_emit m</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkd1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkd1">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_emit m ‚Üí <span class="kr">‚àÉ</span> <span class="nv">s</span> : state X, can_produce s m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> [som [l [s Ht]]]; <span class="kr">exists</span> <span class="nv">s</span>, som, l.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkd2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkd2">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">s</span> : state X, can_produce s m) ‚Üí can_emit m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> [s [som [l Ht]]]; <span class="kr">exists</span> <span class="nv">som</span>, l, s.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
If a VLSM <span class="inlinecode"><span class="id" title="var">can_emit</span></span> a message <code>m</code>, then <code>m</code> is valid. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkd3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkd3"><span class="kn">Lemma</span> <span class="nf">emitted_messages_are_valid</span>
  (<span class="nv">m</span> : message)
  (<span class="nv">Hm</span> : can_emit m) :
    valid_message_prop m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>can_emit m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkd4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkd4"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>can_emit m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkd5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkd5"><span class="nb">apply</span> can_emit_iff <span class="kr">in</span> Hm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> <span class="nv">s</span> : state X, can_produce s m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkd6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkd6"><span class="nb">destruct</span> Hm <span class="kr">as</span> [s Hm].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>can_produce s m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkd7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkd7"><span class="nb">apply</span> can_produce_valid <span class="kr">in</span> Hm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s (Some m)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="nv">s</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
A characterization of valid messages in terms of <span class="inlinecode"><span class="id" title="var">can_emit</span></span>. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkd8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkd8"><span class="kn">Lemma</span> <span class="nf">emitted_messages_are_valid_iff</span> :
  <span class="kr">forall</span> (<span class="nv">m</span> : message),
    valid_message_prop m &lt;-&gt; initial_message_prop X m \/ can_emit m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m</span> : message,
  valid_message_prop m
  ‚Üî initial_message_prop m ‚à® can_emit m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkd9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkd9"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m</span> : message,
  valid_message_prop m
  ‚Üî initial_message_prop m ‚à® can_emit m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkda" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkda"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m
‚Üí initial_message_prop m ‚à® can_emit m</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chkdb" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chkdb"><hr></label><div class="goal-conclusion">initial_message_prop m ‚à® can_emit m
‚Üí valid_message_prop m</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkdc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkdc">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m
‚Üí initial_message_prop m ‚à® can_emit m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkdd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkdd"><span class="nb">intros</span> [s Hm].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s (Some m)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_message_prop m ‚à® can_emit m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkde" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkde"><span class="nb">apply</span> can_produce_valid_iff <span class="kr">in</span> Hm <span class="kr">as</span> [Hgen | [_ Him]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hgen</var><span class="hyp-type"><b>: </b><span>can_produce s m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_message_prop m ‚à® can_emit m</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chkdf" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>initial_message_prop m</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chkdf"><hr></label><div class="goal-conclusion">initial_message_prop m ‚à® can_emit m</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chke0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chke0">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hgen</var><span class="hyp-type"><b>: </b><span>can_produce s m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_message_prop m ‚à® can_emit m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">right</span>; <span class="nb">apply</span> can_emit_iff; <span class="kr">exists</span> <span class="nv">s</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chke1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chke1">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>initial_message_prop m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_message_prop m ‚à® can_emit m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">left</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chke2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chke2">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_message_prop m ‚à® can_emit m
‚Üí valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chke3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chke3"><span class="nb">intros</span> [Him | Hm].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>initial_message_prop m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chke4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>can_emit m</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chke4"><hr></label><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chke5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chke5">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>initial_message_prop m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> initial_message_is_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chke6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chke6">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>can_emit m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> emitted_messages_are_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab9"></a><h3 class="section">Valid state and valid message characterization</h3>
<div class="paragraph"> </div>

  The definition and results below show that the mutually-recursive definitions
  for <span class="inlinecode"><span class="id" title="var">valid_state</span></span>s and <span class="inlinecode"><span class="id" title="var">valid_message</span></span>s can be derived from the
  prior definitions.

<div class="paragraph"> </div>

  The results below offers equivalent characterizations for <span class="inlinecode"><span class="id" title="var">valid_state</span></span>s
  and <span class="inlinecode"><span class="id" title="var">valid_message</span></span>s, similar to their recursive definition.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chke7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chke7"><span class="kn">Lemma</span> <span class="nf">valid_state_prop_iff</span> :
  <span class="kr">forall</span> (<span class="nv">s&#39;</span> : state X),
    valid_state_prop s&#39;
      &lt;-&gt;
    (<span class="kr">exists</span> <span class="nv">is</span> : initial_state X, s&#39; = proj1_sig <span class="kr">is</span>) \/
    <span class="kr">exists</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) (<span class="nv">om&#39;</span> : option message),
      input_valid_transition l som (s&#39;, om&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s&#39;</span> : state X,
  valid_state_prop s&#39;
  ‚Üî (<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
    ‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
         (<span class="nv">om&#39;</span> : option message),
         input_valid_transition l som (s&#39;, om&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chke8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chke8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s&#39;</span> : state X,
  valid_state_prop s&#39;
  ‚Üî (<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
    ‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
         (<span class="nv">om&#39;</span> : option message),
         input_valid_transition l som (s&#39;, om&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chke9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chke9"><span class="nb">intros</span>; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s&#39;
‚Üí (<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
  ‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
       (<span class="nv">om&#39;</span> : option message),
       input_valid_transition l som (s&#39;, om&#39;))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chkea" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chkea"><hr></label><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">om&#39;</span> : option message),
     input_valid_transition l som (s&#39;, om&#39;))
‚Üí valid_state_prop s&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkeb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkeb">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s&#39;
‚Üí (<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
  ‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
       (<span class="nv">om&#39;</span> : option message),
       input_valid_transition l som (s&#39;, om&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkec" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkec"><span class="nb">intro</span> Hps&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hps'</var><span class="hyp-type"><b>: </b><span>valid_state_prop s&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">om&#39;</span> : option message),
     input_valid_transition l som (s&#39;, om&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chked" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chked"><span class="nb">destruct</span> Hps&#39; <span class="kr">as</span> [om&#39; Hs].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; om&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">om&#39;</span> : option message),
     input_valid_transition l som (s&#39;, om&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkee" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkee"><span class="nb">inversion</span> Hs; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; om&#39;</span></span></span><br><span><var>Hs0</var><span class="hyp-type"><b>: </b><span>initial_state_prop s&#39;</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">om&#39;</span> : option message),
     input_valid_transition l som (s&#39;, om&#39;))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chkef" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; om&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chkef"><hr></label><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">om&#39;</span> : option message),
     input_valid_transition l som (s&#39;, om&#39;))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkf0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkf0">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; om&#39;</span></span></span><br><span><var>Hs0</var><span class="hyp-type"><b>: </b><span>initial_state_prop s&#39;</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">om&#39;</span> : option message),
     input_valid_transition l som (s&#39;, om&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">left</span>; <span class="kr">exists</span> (<span class="nv">exist</span> <span class="nv">_</span> <span class="nv">_</span> <span class="nv">Hs0</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkf1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkf1">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; om&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">om&#39;</span> : option message),
     input_valid_transition l som (s&#39;, om&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">right</span>; <span class="kr">exists</span> <span class="nv">l0</span>, (s, om), om&#39;; <span class="nb">firstorder</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkf2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkf2">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">is</span> : initial_state X, s&#39; = `<span class="kr">is</span>)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">om&#39;</span> : option message),
     input_valid_transition l som (s&#39;, om&#39;))
‚Üí valid_state_prop s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkf3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkf3"><span class="nb">intros</span> [[[s His] Heq] | [l [[s om] [om&#39; [[[_om Hps] [[_s Hpm] Hv]] Ht]]]]]; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop (`(s ‚Üæ His))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chkf4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om', _om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l (s, om)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l (s, om) = (s&#39;, om&#39;)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chkf4"><hr></label><div class="goal-conclusion">valid_state_prop s&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkf5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkf5">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop (`(s ‚Üæ His))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="nv">None</span>; <span class="nb">apply</span> valid_initial_state_message.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkf6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkf6">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om', _om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l (s, om)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l (s, om) = (s&#39;, om&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="nv">om&#39;</span>; <span class="nb">apply</span> valid_generated_state_message <span class="kr">with</span> s _om _s om l.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  A specialized induction principle for <span class="inlinecode"><span class="id" title="var">valid_state_prop</span></span>.

<div class="paragraph"> </div>

  Compared to opening the existential and using <span class="inlinecode"><span class="id" title="var">valid_state_message_prop_ind</span></span>,
  this expresses the inductive assumptions simply in terms of
  <span class="inlinecode"><span class="id" title="var">input_valid_transition</span></span>, rather than than having everything exploded
  as <span class="inlinecode"><span class="id" title="var">valid_state_message_prop</span></span> assumptions over witnesses <code>_s</code>
  and <code>_om</code>, and a spurious inductive assumption <code>P _s</code>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkf7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkf7"><span class="kn">Lemma</span> <span class="nf">valid_state_prop_ind</span>
  (<span class="nv">P</span> : state X -&gt; <span class="kt">Prop</span>)
  (<span class="nv">IHinit</span> : <span class="kr">forall</span> (<span class="nv">s</span> : state X) (<span class="nv">Hs</span> : initial_state_prop X s), P s)
  (<span class="nv">IHgen</span> :
    <span class="kr">forall</span> (<span class="nv">s&#39;</span> : state X) (<span class="nv">l</span> : label X) (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) (<span class="nv">s</span> : state X)
      (<span class="nv">Ht</span> : input_valid_transition l (s, om) (s&#39;, om&#39;)) (<span class="nv">Hs</span> : P s),
      P s&#39;) :
    <span class="kr">forall</span> (<span class="nv">s</span> : state X) (<span class="nv">Hs</span> : valid_state_prop s), P s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>IHinit</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, initial_state_prop s ‚Üí P s</span></span></span><br><span><var>IHgen</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s&#39;</span> : state X) (<span class="nv">l</span> : label X) 
  (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">s</span> : state X),
  input_valid_transition l (s, om) (s&#39;, om&#39;)
  ‚Üí P s ‚Üí P s&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkf8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkf8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>IHinit</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, initial_state_prop s ‚Üí P s</span></span></span><br><span><var>IHgen</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s&#39;</span> : state X) (<span class="nv">l</span> : label X) 
  (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">s</span> : state X),
  input_valid_transition l (s, om) (s&#39;, om&#39;)
  ‚Üí P s ‚Üí P s&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkf9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkf9"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>IHinit</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, initial_state_prop s ‚Üí P s</span></span></span><br><span><var>IHgen</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s&#39;</span> : state X) (<span class="nv">l</span> : label X) 
  (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">s</span> : state X),
  input_valid_transition l (s, om) (s&#39;, om&#39;)
  ‚Üí P s ‚Üí P s&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkfa" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkfa"><span class="nb">destruct</span> Hs <span class="kr">as</span> [om Hs].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>IHinit</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, initial_state_prop s ‚Üí P s</span></span></span><br><span><var>IHgen</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s&#39;</span> : state X) (<span class="nv">l</span> : label X) 
  (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">s</span> : state X),
  input_valid_transition l (s, om) (s&#39;, om&#39;)
  ‚Üí P s ‚Üí P s&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkfb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkfb"><span class="nb">induction</span> Hs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>IHinit</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, initial_state_prop s ‚Üí P s</span></span></span><br><span><var>IHgen</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s&#39;</span> : state X) (<span class="nv">l</span> : label X) 
  (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">s</span> : state X),
  input_valid_transition l (s, om) (s&#39;, om&#39;)
  ‚Üí P s ‚Üí P s&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chkfc" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>IHinit</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, initial_state_prop s ‚Üí P s</span></span></span><br><span><var>IHgen</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s&#39;</span> : state X) (<span class="nv">l</span> : label X) 
  (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">s</span> : state X),
  input_valid_transition l (s, om) (s&#39;, om&#39;)
  ‚Üí P s ‚Üí P s&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHHs1</var><span class="hyp-type"><b>: </b><span>P s</span></span></span><br><span><var>IHHs2</var><span class="hyp-type"><b>: </b><span>P _s</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chkfc"><hr></label><div class="goal-conclusion">P s&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkfd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkfd">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>IHinit</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, initial_state_prop s ‚Üí P s</span></span></span><br><span><var>IHgen</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s&#39;</span> : state X) (<span class="nv">l</span> : label X) 
  (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">s</span> : state X),
  input_valid_transition l (s, om) (s&#39;, om&#39;)
  ‚Üí P s ‚Üí P s&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> IHinit.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkfe" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkfe">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>IHinit</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, initial_state_prop s ‚Üí P s</span></span></span><br><span><var>IHgen</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s&#39;</span> : state X) (<span class="nv">l</span> : label X) 
  (<span class="nv">om</span> <span class="nv">om&#39;</span> : option message) 
  (<span class="nv">s</span> : state X),
  input_valid_transition l (s, om) (s&#39;, om&#39;)
  ‚Üí P s ‚Üí P s&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHHs1</var><span class="hyp-type"><b>: </b><span>P s</span></span></span><br><span><var>IHHs2</var><span class="hyp-type"><b>: </b><span>P _s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (IHgen s&#39; l0 om om&#39; s); <span class="nb">firstorder</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
Valid message characterization. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chkff" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chkff"><span class="kn">Lemma</span> <span class="nf">valid_message_prop_iff</span> :
  <span class="kr">forall</span> (<span class="nv">m&#39;</span> : message),
    valid_message_prop m&#39;
      &lt;-&gt;
    (<span class="kr">exists</span> <span class="nv">im</span> : initial_message X, m&#39; = proj1_sig im) \/
    <span class="kr">exists</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) (<span class="nv">s&#39;</span> : state X),
      input_valid_transition l som (s&#39;, Some m&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m&#39;</span> : message,
  valid_message_prop m&#39;
  ‚Üî (<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
    ‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
         (<span class="nv">s&#39;</span> : state X),
         input_valid_transition l som (s&#39;, Some m&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk100" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk100"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m&#39;</span> : message,
  valid_message_prop m&#39;
  ‚Üî (<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
    ‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
         (<span class="nv">s&#39;</span> : state X),
         input_valid_transition l som (s&#39;, Some m&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk101" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk101"><span class="nb">intros</span>; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m&#39;
‚Üí (<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
  ‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
       (<span class="nv">s&#39;</span> : state X),
       input_valid_transition l som (s&#39;, Some m&#39;))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk102" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk102"><hr></label><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">s&#39;</span> : state X),
     input_valid_transition l som (s&#39;, Some m&#39;))
‚Üí valid_message_prop m&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk103" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk103">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m&#39;
‚Üí (<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
  ‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
       (<span class="nv">s&#39;</span> : state X),
       input_valid_transition l som (s&#39;, Some m&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk104" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk104"><span class="nb">intros</span> [s&#39; Hpm&#39;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hpm'</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; (Some m&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">s&#39;</span> : state X),
     input_valid_transition l som (s&#39;, Some m&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk105" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk105"><span class="nb">inversion</span> Hpm&#39;; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hpm'</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; (Some m&#39;)</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s&#39;</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X (Some m&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">s&#39;</span> : state X),
     input_valid_transition l som (s&#39;, Some m&#39;))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk106" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hpm'</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; (Some m&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, Some m&#39;)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk106"><hr></label><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">s&#39;</span> : state X),
     input_valid_transition l som (s&#39;, Some m&#39;))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk107" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk107">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hpm'</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; (Some m&#39;)</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s&#39;</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X (Some m&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">s&#39;</span> : state X),
     input_valid_transition l som (s&#39;, Some m&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">left</span>; <span class="kr">exists</span> (<span class="nv">exist</span> <span class="nv">_</span> <span class="nv">m&#39;</span> <span class="nv">Hom</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk108" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk108">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hpm'</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s&#39; (Some m&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, Some m&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">s&#39;</span> : state X),
     input_valid_transition l som (s&#39;, Some m&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">right</span>; <span class="kr">exists</span> <span class="nv">l0</span>, (s, om), s&#39;; <span class="nb">firstorder</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk109" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk109">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> <span class="nv">im</span> : initial_message X, m&#39; = `im)
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) 
     (<span class="nv">s&#39;</span> : state X),
     input_valid_transition l som (s&#39;, Some m&#39;))
‚Üí valid_message_prop m&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk10a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk10a"><span class="nb">intros</span> [[[s His] Heq] | [l [[s om] [s&#39; [[[_om Hps] [[_s Hpm] Hv]] Ht]]]]]; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_message_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop (`(s ‚Üæ His))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk10b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l (s, om)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l (s, om) = (s&#39;, Some m&#39;)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk10b"><hr></label><div class="goal-conclusion">valid_message_prop m&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk10c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk10c">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_message_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop (`(s ‚Üæ His))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> initial_message_is_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk10d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk10d">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hpm</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l (s, om)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l (s, om) = (s&#39;, Some m&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="nv">s&#39;</span>; <span class="nb">apply</span> valid_generated_state_message <span class="kr">with</span> s _om _s om l.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab10"></a><h2 class="section">Trace Properties</h2>
<div class="paragraph"> </div>

  Note that it is unnecessary to specify the source state of the transition,
  as it is implied by the preceding <span class="inlinecode"><span class="id" title="var">transition_item</span></span> (or by the <code>start</code> state,
  if such an item doesn't exist).

<div class="paragraph"> </div>

  We will now split our groundwork for defining traces into the finite case and
  the infinite case.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
<a id="lab11"></a><h3 class="section">Finite valid traces</h3>
<div class="paragraph"> </div>

  A <span class="inlinecode"><span class="id" title="var">finite_valid_trace_from</span></span> a <span class="inlinecode"><span class="id" title="var">state</span></span> <code>start</code> is a pair <code>(start, steps)</code> where <code>steps</code>
  is a list of <span class="inlinecode"><span class="id" title="var">transition_item</span></span>s, and is inductively defined by:

<div class="paragraph"> </div>
<ul class="doclist">
<li> <code>(s, [])</code> is a <span class="inlinecode"><span class="id" title="var">finite_valid_trace_from</span></span> <code>s</code> if <code>s</code> is valid

</li>
<li> if there is an <span class="inlinecode"><span class="id" title="var">input_valid_transition</span></span> <code>l (s', iom) (s, oom)</code>,
    and if <code>(s, steps)</code> is a <span class="inlinecode"><span class="id" title="var">valid_trace_from</span></span> <code>s</code>,
    then <code>(s', ({| l := l; input := iom; destination := s; output := oom |} :: steps)</code>
    is a <span class="inlinecode"><span class="id" title="var">finite_valid_trace_from</span></span> <code>s'</code>.

</li>
</ul>
<div class="paragraph"> </div>

  Note that the definition is designed so that it extends an existing trace by
  adding a transition to its front. The reason for this choice is to have this
  definition be similar to the one for infinite traces, which can only be extended
  at the front.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">finite_valid_trace_from</span> : state X -&gt; list transition_item -&gt; <span class="kt">Prop</span> :=
| finite_valid_trace_from_empty :
    <span class="kr">forall</span> (<span class="nv">s</span> : state X) (<span class="nv">Hs</span> : valid_state_prop s),
      finite_valid_trace_from s []
| finite_valid_trace_from_extend :
    <span class="kr">forall</span>  (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item)
      (<span class="nv">Htl</span> : finite_valid_trace_from s tl)
      (<span class="nv">s&#39;</span> : state X) (<span class="nv">iom</span> <span class="nv">oom</span> : option message) (<span class="nv">l</span> : label X)
      (<span class="nv">Ht</span> : input_valid_transition l (s&#39;, iom) (s, oom)),
        finite_valid_trace_from  s&#39; (Build_transition_item l iom s oom :: tl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk10e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk10e"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_singleton</span> :
  <span class="kr">forall</span> {<span class="nv">l</span> : label X} {<span class="nv">s</span> <span class="nv">s&#39;</span> : state X} {<span class="nv">iom</span> <span class="nv">oom</span> : option message},
    input_valid_transition l (s, iom) (s&#39;, oom) -&gt;
      finite_valid_trace_from  s [Build_transition_item l iom s&#39; oom].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">s</span> <span class="nv">s&#39;</span> : state X) (<span class="nv">iom</span>
                                  <span class="nv">oom</span> : option message),
  input_valid_transition l (s, iom) (s&#39;, oom)
  ‚Üí finite_valid_trace_from s
      [{|
         l := l;
         input := iom;
         destination := s&#39;;
         output := oom
       |}]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk10f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk10f"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">s</span> <span class="nv">s&#39;</span> : state X) (<span class="nv">iom</span>
                                  <span class="nv">oom</span> : option message),
  input_valid_transition l (s, iom) (s&#39;, oom)
  ‚Üí finite_valid_trace_from s
      [{|
         l := l;
         input := iom;
         destination := s&#39;;
         output := oom
       |}]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk110" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk110"><span class="nb">intros</span> l s s&#39; iom oom Hptrans.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hptrans</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, iom) (s&#39;, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  [{|
     l := l;
     input := iom;
     destination := s&#39;;
     output := oom
   |}]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk111" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk111"><span class="nb">apply</span> finite_valid_trace_from_extend; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hptrans</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, iom) (s&#39;, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s&#39; []</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>; <span class="nb">apply</span> input_valid_transition_destination <span class="kr">in</span> Hptrans.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Defined</span>.</span></span></pre><div class="doc">
  To complete our definition of a finite valid trace, we must also guarantee
  that <code>start</code> is an initial state according to the protocol.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">finite_valid_trace</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : list (transition_item X)) : <span class="kt">Prop</span> :=
  finite_valid_trace_from s ls /\ initial_state_prop X s.</span></span></pre><div class="doc">
  In the remainder of the section we provide various results allowing us to
  prove or decompose the above properties in proofs.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
<span class="inlinecode"><span class="id" title="var">finite_valid_trace_empty</span></span> is a bit more useful than the small proof suggests,
  because applying it always leaves just one subgoal.

<div class="paragraph"> </div>

  The tactical <code>by split; [constructor; apply initial_state_is_valid |]</code>
  only works if the premise is available in the context, which may
  require an <code>assert</code> and writing out the full VLSM and state expressions
  as part of the proof script.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk112" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk112"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_empty</span> :
  <span class="kr">forall</span> (<span class="nv">s</span> : state X),
    initial_state_prop X s -&gt; finite_valid_trace s [].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  initial_state_prop s ‚Üí finite_valid_trace s []</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk113" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk113"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  initial_state_prop s ‚Üí finite_valid_trace s []</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">split</span>; [<span class="nb">constructor</span>; <span class="nb">apply</span> initial_state_is_valid |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk114" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk114"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_first_valid_transition</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">te</span> : transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from s (te :: tr)) :
    input_valid_transition (l te) (s, input te) (destination te, output te).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (te :: tr)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te) (s, input te)
  (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk115" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk115"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (te :: tr)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te) (s, input te)
  (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> Htr.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk116" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk116"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_first_pstate</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from s tr) :
    valid_state_prop s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk117" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk117"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> Htr; <span class="nb">subst</span>; [| <span class="nb">apply</span> Ht].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk118" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk118"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_tail</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">te</span> : transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from s (te :: tr)) :
    finite_valid_trace_from (destination te) tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (te :: tr)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from (destination te) tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk119" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk119"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (te :: tr)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from (destination te) tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> Htr.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk11a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk11a"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_last_pstate</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from s tr) :
    valid_state_prop (finite_trace_last s tr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop (finite_trace_last s tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk11b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk11b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop (finite_trace_last s tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk11c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk11c"><span class="nb">generalize dependent</span> s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s tr
  ‚Üí valid_state_prop (finite_trace_last s tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk11d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk11d"><span class="nb">induction</span> tr; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop (finite_trace_last s [])</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk11e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s tr
  ‚Üí valid_state_prop (finite_trace_last s tr)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (a :: tr)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk11e"><hr></label><div class="goal-conclusion">valid_state_prop (finite_trace_last s (a :: tr))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk11f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk11f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop (finite_trace_last s [])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_first_pstate <span class="kr">with</span> [].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk120" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk120">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s tr
  ‚Üí valid_state_prop (finite_trace_last s tr)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (a :: tr)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop (finite_trace_last s (a :: tr))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk121" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk121"><span class="nb">apply</span> finite_valid_trace_tail <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s tr
  ‚Üí valid_state_prop (finite_trace_last s tr)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from (destination a) tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop (finite_trace_last s (a :: tr))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk122" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk122"><span class="nb">apply</span> IHtr <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s tr
  ‚Üí valid_state_prop (finite_trace_last s tr)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_state_prop
  (finite_trace_last (destination a) tr)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop (finite_trace_last s (a :: tr))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk123" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk123"><span class="nb">replace</span>
      (finite_trace_last s (a :: tr))
      <span class="kr">with</span> (finite_trace_last (destination a) tr)
    ; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s tr
  ‚Üí valid_state_prop (finite_trace_last s tr)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_state_prop
  (finite_trace_last (destination a) tr)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last (destination a) tr =
finite_trace_last s (a :: tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk124" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk124"><span class="nb">unfold</span> finite_trace_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s tr
  ‚Üí valid_state_prop (finite_trace_last s tr)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_state_prop
  (finite_trace_last (destination a) tr)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.<span class="nb">last</span> (List.map destination tr) (destination a) =
List.<span class="nb">last</span> (List.map destination (a :: tr)) s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> map_cons, unroll_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk125" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk125"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_to</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">tr1</span> <span class="nv">tr2</span> : list transition_item)
  (<span class="nv">te</span> : transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from s tr)
  (<span class="nv">Heq</span> : tr = tr1 ++ [te] ++ tr2)
  (<span class="nv">lst1</span> := finite_trace_last s tr1) :
    input_valid_transition (l te) (lst1, input te) (destination te, output te).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = tr1 ++ [te] ++ tr2</span></span></span><br><span><var>lst1</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s tr1</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te) (lst1, input te)
  (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk126" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk126"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = tr1 ++ [te] ++ tr2</span></span></span><br><span><var>lst1</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s tr1</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te) (lst1, input te)
  (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk127" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk127"><span class="nb">generalize dependent</span> s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr, tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = tr1 ++ [te] ++ tr2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s tr
  ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s tr1 <span class="kr">in</span>
    input_valid_transition (l te) (lst1, input te)
      (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk128" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk128"><span class="nb">generalize dependent</span> tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : list transition_item,
  tr = tr1 ++ [te] ++ tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
      finite_valid_trace_from s tr
      ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s tr1 <span class="kr">in</span>
        input_valid_transition (l te) (lst1, input te)
          (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk129" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk129"><span class="nb">induction</span> tr1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : list transition_item,
  tr = [] ++ [te] ++ tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
      finite_valid_trace_from s tr
      ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s [] <span class="kr">in</span>
        input_valid_transition (l te) (lst1, input te)
          (destination te, output te)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk12a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">tr</span> : list transition_item,
  tr = tr1 ++ [te] ++ tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
      finite_valid_trace_from s tr
      ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s tr1 <span class="kr">in</span>
        input_valid_transition 
          (l te) (lst1, input te)
          (destination te, output te)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk12a"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : list transition_item,
  tr = (a :: tr1) ++ [te] ++ tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
      finite_valid_trace_from s tr
      ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s (a :: tr1) <span class="kr">in</span>
        input_valid_transition 
          (l te) (lst1, input te)
          (destination te, output te)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk12b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk12b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : list transition_item,
  tr = [] ++ [te] ++ tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
      finite_valid_trace_from s tr
      ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s [] <span class="kr">in</span>
        input_valid_transition (l te) (lst1, input te)
          (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> tr [= -&gt;] s; <span class="nb">inversion</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk12c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk12c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">tr</span> : list transition_item,
  tr = tr1 ++ [te] ++ tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
      finite_valid_trace_from s tr
      ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s tr1 <span class="kr">in</span>
        input_valid_transition 
          (l te) (lst1, input te)
          (destination te, output te)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : list transition_item,
  tr = (a :: tr1) ++ [te] ++ tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
      finite_valid_trace_from s tr
      ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s (a :: tr1) <span class="kr">in</span>
        input_valid_transition (l te) (lst1, input te)
          (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk12d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk12d"><span class="nb">specialize</span> (IHtr1 (tr1 ++ [te] ++ tr2) eq_refl).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s
    (tr1 ++ [te] ++ tr2)
  ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s tr1 <span class="kr">in</span>
    input_valid_transition 
      (l te) (lst1, input te)
      (destination te, output te)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : list transition_item,
  tr = (a :: tr1) ++ [te] ++ tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
      finite_valid_trace_from s tr
      ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s (a :: tr1) <span class="kr">in</span>
        input_valid_transition (l te) (lst1, input te)
          (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk12e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk12e"><span class="nb">intros</span> tr Heq <span class="kr">is</span> Htr; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s
    (tr1 ++ [te] ++ tr2)
  ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s tr1 <span class="kr">in</span>
    input_valid_transition 
      (l te) (lst1, input te)
      (destination te, output te)</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ((a :: tr1) ++ [te] ++ tr2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last <span class="kr">is</span> (a :: tr1) <span class="kr">in</span>
input_valid_transition (l te) (lst1, input te)
  (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk12f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk12f"><span class="nb">inversion</span> Htr; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s
    (tr1 ++ [te] ++ tr2)
  ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s tr1 <span class="kr">in</span>
    input_valid_transition 
      (l te) (lst1, input te)
      (destination te, output te)</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  (({|
      l := l0;
      input := iom;
      destination := s;
      output := oom
    |} :: tr1) ++ [te] ++ tr2)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (tr1 ++ te :: tr2)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">let</span> <span class="nv">lst1</span> :=
  finite_trace_last <span class="kr">is</span>
    ({|
       l := l0;
       input := iom;
       destination := s;
       output := oom
     |} :: tr1) <span class="kr">in</span>
input_valid_transition (l te) (lst1, input te)
  (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk130" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk130"><span class="nb">rewrite</span> finite_trace_last_cons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s
    (tr1 ++ [te] ++ tr2)
  ‚Üí <span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s tr1 <span class="kr">in</span>
    input_valid_transition 
      (l te) (lst1, input te)
      (destination te, output te)</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  (({|
      l := l0;
      input := iom;
      destination := s;
      output := oom
    |} :: tr1) ++ [te] ++ tr2)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (tr1 ++ te :: tr2)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">let</span> <span class="nv">lst1</span> :=
  finite_trace_last
    (destination
       {|
         l := l0;
         input := iom;
         destination := s;
         output := oom
       |}) tr1 <span class="kr">in</span>
input_valid_transition (l te) (lst1, input te)
  (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> IHtr1.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk131" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk131"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_consecutive_valid_transition</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">tr1</span> <span class="nv">tr2</span> : list transition_item)
  (<span class="nv">te1</span> <span class="nv">te2</span> : transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from s tr)
  (<span class="nv">Heq</span> : tr = tr1 ++ [te1; te2] ++ tr2) :
    input_valid_transition (l te2) (destination te1, input te2) (destination te2, output te2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = tr1 ++ [te1; te2] ++ tr2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te2)
  (destination te1, input te2)
  (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk132" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk132"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = tr1 ++ [te1; te2] ++ tr2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te2)
  (destination te1, input te2)
  (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk133" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk133"><span class="nb">change</span> ([te1; te2] ++ tr2) <span class="kr">with</span> ([te1] ++ [te2] ++ tr2) <span class="kr">in</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = tr1 ++ [te1] ++ [te2] ++ tr2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te2)
  (destination te1, input te2)
  (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk134" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk134"><span class="nb">rewrite</span> app_assoc <span class="kr">in</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = (tr1 ++ [te1]) ++ [te2] ++ tr2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te2)
  (destination te1, input te2)
  (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk135" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk135"><span class="nb">specialize</span> (input_valid_transition_to s tr (tr1 ++ [te1]) tr2 te2 Htr Heq)
    <span class="kr">as</span> Ht.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = (tr1 ++ [te1]) ++ [te2] ++ tr2</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span><span class="kr">let</span> <span class="nv">lst1</span> := finite_trace_last s (tr1 ++ [te1]) <span class="kr">in</span>
input_valid_transition 
  (l te2) (lst1, input te2)
  (destination te2, output te2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te2)
  (destination te1, input te2)
  (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> finite_trace_last_is_last <span class="kr">in</span> Ht.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk136" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk136"><span class="kn">Lemma</span> <span class="nf">valid_trace_output_is_valid</span>
  (<span class="nv">is</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from <span class="kr">is</span> tr)
  (<span class="nv">m</span> : message)
  (<span class="nv">Houtput</span> : trace_has_message (field_selector output) m tr) :
    valid_message_prop m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span> tr</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>trace_has_message (field_selector output) m
  tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk137" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk137"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span> tr</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>trace_has_message (field_selector output) m
  tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk138" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk138"><span class="nb">revert</span> <span class="kr">is</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>trace_has_message (field_selector output) m
  tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  finite_valid_trace_from <span class="kr">is</span> tr ‚Üí valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk139" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk139"><span class="nb">induction</span> Houtput <span class="kr">as</span> [item tr&#39; Hm | item tr&#39;]; <span class="nb">intros</span>; <span class="nb">inversion</span> Htr; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>field_selector output m
  {|
    l := l0;
    input := iom;
    destination := s;
    output := oom
  |}</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk13a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>List.Exists (field_selector output m) tr&#39;</span></span></span><br><span><var>IHHoutput</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  finite_valid_trace_from <span class="kr">is</span> tr&#39;
  ‚Üí valid_message_prop m</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk13a"><hr></label><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk13b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk13b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>field_selector output m
  {|
    l := l0;
    input := iom;
    destination := s;
    output := oom
  |}</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk13c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk13c"><span class="nb">simpl</span> <span class="kr">in</span> Hm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>oom = Some m</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk13d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk13d"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := Some m
   |} :: tr&#39;)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (<span class="kr">is</span>, iom) (s, Some m)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> input_valid_transition_out <span class="kr">in</span> Ht.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk13e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk13e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>List.Exists (field_selector output m) tr&#39;</span></span></span><br><span><var>IHHoutput</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  finite_valid_trace_from <span class="kr">is</span> tr&#39;
  ‚Üí valid_message_prop m</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (IHHoutput s).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk13f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk13f"><span class="kn">Lemma</span> <span class="nf">valid_trace_input_is_valid</span>
  (<span class="nv">is</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from <span class="kr">is</span> tr)
  (<span class="nv">m</span> : message)
  (<span class="nv">Hinput</span> : trace_has_message (field_selector input) m tr) :
    valid_message_prop m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span> tr</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hinput</var><span class="hyp-type"><b>: </b><span>trace_has_message (field_selector input) m tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk140" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk140"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span> tr</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hinput</var><span class="hyp-type"><b>: </b><span>trace_has_message (field_selector input) m tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk141" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk141"><span class="nb">revert</span> <span class="kr">is</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hinput</var><span class="hyp-type"><b>: </b><span>trace_has_message (field_selector input) m tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  finite_valid_trace_from <span class="kr">is</span> tr ‚Üí valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk142" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk142"><span class="nb">induction</span> Hinput <span class="kr">as</span> [item tr&#39; Hm | item tr&#39;]; <span class="nb">intros</span>
  ; <span class="nb">inversion</span> Htr <span class="kr">as</span> [| s _tr&#39;  Htr&#39; _is iom oom l Ht]; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>field_selector input m
  {|
    l := l;
    input := iom;
    destination := s;
    output := oom
  |}</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l;
     input := iom;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk143" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hinput</var><span class="hyp-type"><b>: </b><span>List.Exists (field_selector input m) tr&#39;</span></span></span><br><span><var>IHHinput</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  finite_valid_trace_from <span class="kr">is</span> tr&#39;
  ‚Üí valid_message_prop m</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l;
     input := iom;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk143"><hr></label><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk144" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk144">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>field_selector input m
  {|
    l := l;
    input := iom;
    destination := s;
    output := oom
  |}</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l;
     input := iom;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk145" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk145"><span class="nb">simpl</span> <span class="kr">in</span> Hm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>iom = Some m</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l;
     input := iom;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk146" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk146"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l;
     input := Some m;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (<span class="kr">is</span>, Some m) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> input_valid_transition_in <span class="kr">in</span> Ht.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk147" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk147">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hinput</var><span class="hyp-type"><b>: </b><span>List.Exists (field_selector input m) tr&#39;</span></span></span><br><span><var>IHHinput</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  finite_valid_trace_from <span class="kr">is</span> tr&#39;
  ‚Üí valid_message_prop m</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span>
  ({|
     l := l;
     input := iom;
     destination := s;
     output := oom
   |} :: tr&#39;)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (IHHinput s).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk148" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk148"><span class="kn">Lemma</span> <span class="nf">valid_trace_observed_is_valid</span>
  (<span class="nv">is</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from <span class="kr">is</span> tr)
  (<span class="nv">m</span> : message)
  (<span class="nv">Hobserved</span> : trace_has_message item_sends_or_receives m tr) :
    valid_message_prop m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span> tr</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hobserved</var><span class="hyp-type"><b>: </b><span>trace_has_message item_sends_or_receives m
  tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk149" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk149"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span> tr</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Hobserved</var><span class="hyp-type"><b>: </b><span>trace_has_message item_sends_or_receives m
  tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> trace_has_message_observed_iff <span class="kr">in</span> Hobserved <span class="kr">as</span> [Hm | Hm]
  ; <span class="nb">revert</span> Htr m Hm; [<span class="nb">apply</span> valid_trace_input_is_valid | <span class="nb">apply</span> valid_trace_output_is_valid].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk14a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk14a"><span class="kn">Lemma</span> <span class="nf">first_transition_valid</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">te</span> : transition_item) :
    finite_valid_trace_from s [te] &lt;-&gt;
    input_valid_transition (l te) (s, input te) (destination te, output te).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s [te]
‚Üî input_valid_transition (l te) (s, input te)
    (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk14b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk14b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s [te]
‚Üî input_valid_transition (l te) (s, input te)
    (destination te, output te)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk14c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk14c"><span class="nb">split</span>; [<span class="bp">by</span> <span class="nb">inversion</span> <span class="mi">1</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>te</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te) (s, input te)
  (destination te, output te)
‚Üí finite_valid_trace_from s [te]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk14d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk14d"><span class="nb">destruct</span> te.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition
  (l
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |})
  (s,
   input
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |})
  (destination
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |},
   output
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |})
‚Üí finite_valid_trace_from s
    [{|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |}]</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk14e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk14e"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (s, input0)
  (destination0, output0)
‚Üí finite_valid_trace_from s
    [{|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |}]</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk14f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk14f"><span class="nb">intro</span> Ht.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (
  s, input0) (destination0, output0)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  [{|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |}]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk150" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk150"><span class="nb">apply</span> input_valid_transition_destination <span class="kr">in</span> Ht <span class="kr">as</span> Hdestination0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (
  s, input0) (destination0, output0)</span></span></span><br><span><var>Hdestination0</var><span class="hyp-type"><b>: </b><span>valid_state_prop destination0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  [{|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |}]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>; [<span class="nb">constructor</span> |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk151" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk151"><span class="kn">Lemma</span> <span class="nf">extend_right_finite_trace_from</span>
  (<span class="nv">s1</span> : state X)
  (<span class="nv">ts</span> : list transition_item)
  (<span class="nv">Ht12</span> : finite_valid_trace_from s1 ts)
  (<span class="nv">l3</span> : label X)
  (<span class="nv">s2</span> := finite_trace_last s1 ts)
  (<span class="nv">iom3</span> : option message)
  (<span class="nv">s3</span> : state X)
  (<span class="nv">oom3</span> : option message)
  (<span class="nv">Hv23</span> : input_valid_transition l3 (s2, iom3) (s3, oom3)) :
    finite_valid_trace_from s1 (ts ++ [Build_transition_item l3 iom3 s3 oom3]).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ts</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ts</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s2</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s1 ts</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s1
  (ts ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk152" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk152"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ts</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ts</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s2</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s1 ts</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s1
  (ts ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk153" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk153"><span class="nb">induction</span> Ht12.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s2</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s []</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  ([] ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk154" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s2</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br><span><var>IHHt12</var><span class="hyp-type"><b>: </b><span><span class="kr">let</span> <span class="nv">s2</span> := finite_trace_last s tl <span class="kr">in</span>
input_valid_transition l3 (
  s2, iom3) (s3, oom3)
‚Üí finite_valid_trace_from s
    (tl ++
     [{|
        l := l3;
        input := iom3;
        destination := s3;
        output := oom3
      |}])</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk154"><hr></label><div class="goal-conclusion">finite_valid_trace_from s&#39;
  (({|
      l := l0;
      input := iom;
      destination := s;
      output := oom
    |} :: tl) ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk155" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk155">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s2</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s []</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  ([] ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_singleton.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk156" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk156">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s2</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br><span><var>IHHt12</var><span class="hyp-type"><b>: </b><span><span class="kr">let</span> <span class="nv">s2</span> := finite_trace_last s tl <span class="kr">in</span>
input_valid_transition l3 (
  s2, iom3) (s3, oom3)
‚Üí finite_valid_trace_from s
    (tl ++
     [{|
        l := l3;
        input := iom3;
        destination := s3;
        output := oom3
      |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s&#39;
  (({|
      l := l0;
      input := iom;
      destination := s;
      output := oom
    |} :: tl) ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk157" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk157"><span class="nb">rewrite</span> &lt;- app_comm_cons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s2</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br><span><var>IHHt12</var><span class="hyp-type"><b>: </b><span><span class="kr">let</span> <span class="nv">s2</span> := finite_trace_last s tl <span class="kr">in</span>
input_valid_transition l3 (
  s2, iom3) (s3, oom3)
‚Üí finite_valid_trace_from s
    (tl ++
     [{|
        l := l3;
        input := iom3;
        destination := s3;
        output := oom3
      |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |}
   :: tl ++
      [{|
         l := l3;
         input := iom3;
         destination := s3;
         output := oom3
       |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk158" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk158"><span class="nb">apply</span> finite_valid_trace_from_extend; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s2</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br><span><var>IHHt12</var><span class="hyp-type"><b>: </b><span><span class="kr">let</span> <span class="nv">s2</span> := finite_trace_last s tl <span class="kr">in</span>
input_valid_transition l3 (
  s2, iom3) (s3, oom3)
‚Üí finite_valid_trace_from s
    (tl ++
     [{|
        l := l3;
        input := iom3;
        destination := s3;
        output := oom3
      |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  (tl ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk159" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk159"><span class="nb">simpl</span> <span class="kr">in</span> IHHt12.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s2</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br><span><var>IHHt12</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3
  (finite_trace_last s tl, iom3) (
  s3, oom3)
‚Üí finite_valid_trace_from s
    (tl ++
     [{|
        l := l3;
        input := iom3;
        destination := s3;
        output := oom3
      |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  (tl ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk15a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk15a"><span class="nb">apply</span> IHHt12.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s2</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br><span><var>IHHt12</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3
  (finite_trace_last s tl, iom3) (
  s3, oom3)
‚Üí finite_valid_trace_from s
    (tl ++
     [{|
        l := l3;
        input := iom3;
        destination := s3;
        output := oom3
      |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l3
  (finite_trace_last s tl, iom3) (s3, oom3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk15b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk15b"><span class="nb">unfold</span> s2 <span class="kr">in</span> *; <span class="nb">clear</span> s2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3
  (finite_trace_last s&#39;
     ({|
        l := l0;
        input := iom;
        destination := s;
        output := oom
      |} :: tl), iom3) (
  s3, oom3)</span></span></span><br><span><var>IHHt12</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3
  (finite_trace_last s tl, iom3) (
  s3, oom3)
‚Üí finite_valid_trace_from s
    (tl ++
     [{|
        l := l3;
        input := iom3;
        destination := s3;
        output := oom3
      |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l3
  (finite_trace_last s tl, iom3) (s3, oom3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> finite_trace_last_cons <span class="kr">in</span> Hv23.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  We can now prove several general properties of <span class="inlinecode"><span class="id" title="var">finite_valid_trace</span></span>s. For example,
  the following lemma states that given two such traces, such that the latter's starting state
  is equal to the former's last state, it is possible to <i>concatenate</i> them into a single
  <span class="inlinecode"><span class="id" title="var">finite_valid_trace</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk15c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk15c"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_app_iff</span>
  (<span class="nv">s</span> : state X) (<span class="nv">ls</span> <span class="nv">ls&#39;</span> : list transition_item) (<span class="nv">s&#39;</span> := finite_trace_last s ls) :
    finite_valid_trace_from s ls /\ finite_valid_trace_from s&#39; ls&#39;
      &lt;-&gt;
    finite_valid_trace_from s (ls ++ ls&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s ls</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s ls
‚àß finite_valid_trace_from s&#39; ls&#39;
‚Üî finite_valid_trace_from s (ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk15d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk15d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s ls</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s ls
‚àß finite_valid_trace_from s&#39; ls&#39;
‚Üî finite_valid_trace_from s (ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk15e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk15e"><span class="nb">subst</span> s&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s ls
‚àß finite_valid_trace_from (finite_trace_last s ls) ls&#39;
‚Üî finite_valid_trace_from s (ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk15f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk15f"><span class="nb">revert</span> s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s ls
  ‚àß finite_valid_trace_from (finite_trace_last s ls)
      ls&#39; ‚Üî finite_valid_trace_from s (ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk160" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk160"><span class="nb">induction</span> ls; <span class="nb">intro</span> s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s []
‚àß finite_valid_trace_from (finite_trace_last s []) ls&#39;
‚Üî finite_valid_trace_from s ([] ++ ls&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk161" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s ls
  ‚àß finite_valid_trace_from
      (finite_trace_last s ls) ls&#39;
  ‚Üî finite_valid_trace_from s (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk161"><hr></label><div class="goal-conclusion">finite_valid_trace_from s (a :: ls)
‚àß finite_valid_trace_from
    (finite_trace_last s (a :: ls)) ls&#39;
‚Üî finite_valid_trace_from s ((a :: ls) ++ ls&#39;)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk162" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk162">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s []
‚àß finite_valid_trace_from (finite_trace_last s []) ls&#39;
‚Üî finite_valid_trace_from s ([] ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk163" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk163"><span class="nb">rewrite</span> finite_trace_last_nil.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s []
‚àß finite_valid_trace_from s ls&#39;
‚Üî finite_valid_trace_from s ([] ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk164" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk164"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s []
‚àß finite_valid_trace_from s ls&#39;
‚Üî finite_valid_trace_from s ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> itauto (<span class="nb">eauto using</span> finite_valid_trace_first_pstate, finite_valid_trace_from_empty).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk165" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk165">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s ls
  ‚àß finite_valid_trace_from
      (finite_trace_last s ls) ls&#39;
  ‚Üî finite_valid_trace_from s (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (a :: ls)
‚àß finite_valid_trace_from
    (finite_trace_last s (a :: ls)) ls&#39;
‚Üî finite_valid_trace_from s ((a :: ls) ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk166" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk166"><span class="nb">rewrite</span> finite_trace_last_cons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s ls
  ‚àß finite_valid_trace_from
      (finite_trace_last s ls) ls&#39;
  ‚Üî finite_valid_trace_from s (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (a :: ls)
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üî finite_valid_trace_from s ((a :: ls) ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk167" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk167"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from s ls
  ‚àß finite_valid_trace_from
      (finite_trace_last s ls) ls&#39;
  ‚Üî finite_valid_trace_from s (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (a :: ls)
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üî finite_valid_trace_from s (a :: ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk168" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk168"><span class="nb">specialize</span> (IHls (destination a)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from (destination a) ls
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üî finite_valid_trace_from 
    (destination a) (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (a :: ls)
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üî finite_valid_trace_from s (a :: ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk169" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk169"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from (destination a) ls
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üî finite_valid_trace_from 
    (destination a) (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (a :: ls)
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üí finite_valid_trace_from s (a :: ls ++ ls&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk16a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from (destination a) ls
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üî finite_valid_trace_from 
    (destination a) (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk16a"><hr></label><div class="goal-conclusion">finite_valid_trace_from s (a :: ls ++ ls&#39;)
‚Üí finite_valid_trace_from s (a :: ls)
  ‚àß finite_valid_trace_from
      (finite_trace_last (destination a) ls) ls&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk16b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk16b">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from (destination a) ls
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üî finite_valid_trace_from 
    (destination a) (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (a :: ls)
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üí finite_valid_trace_from s (a :: ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk16c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk16c"><span class="nb">intros</span> [Hal Hl&#39;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from (destination a) ls
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üî finite_valid_trace_from 
    (destination a) (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hal</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (a :: ls)</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last (destination a) ls) ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (a :: ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk16d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk16d"><span class="nb">inversion</span> Hal; <span class="nb">subst</span>; <span class="nb">simpl</span> <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ls
‚àß finite_valid_trace_from
    (finite_trace_last s1 ls) ls&#39;
‚Üî finite_valid_trace_from s1 (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s1 ls) ls&#39;</span></span></span><br><span><var>Hal</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ls</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>; [<span class="nb">apply</span> IHls |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk16e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk16e">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from (destination a) ls
‚àß finite_valid_trace_from
    (finite_trace_last (destination a) ls) ls&#39;
‚Üî finite_valid_trace_from 
    (destination a) (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (a :: ls ++ ls&#39;)
‚Üí finite_valid_trace_from s (a :: ls)
  ‚àß finite_valid_trace_from
      (finite_trace_last (destination a) ls) ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk16f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk16f"><span class="nb">inversion</span> <span class="mi">1</span>; <span class="nb">subst</span>; <span class="nb">simpl</span> <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ls
‚àß finite_valid_trace_from
    (finite_trace_last s1 ls) ls&#39;
‚Üî finite_valid_trace_from s1 (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls ++ ls&#39;)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 (ls ++ ls&#39;)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)
‚àß finite_valid_trace_from (finite_trace_last s1 ls)
    ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk170" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk170"><span class="nb">apply</span> IHls <span class="kr">in</span> Htl <span class="kr">as</span> [Hl Hl&#39;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ls
‚àß finite_valid_trace_from
    (finite_trace_last s1 ls) ls&#39;
‚Üî finite_valid_trace_from s1 (ls ++ ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls ++ ls&#39;)</span></span></span><br><span><var>Hl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ls</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s1 ls) ls&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)
‚àß finite_valid_trace_from (finite_trace_last s1 ls)
    ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">split</span>; [<span class="nb">constructor</span> |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk171" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk171"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_rev_ind</span>
  (<span class="nv">P</span> : state X -&gt; list transition_item -&gt; <span class="kt">Prop</span>)
  (<span class="nv">Hempty</span> : <span class="kr">forall</span> (<span class="nv">s</span> : state X) (<span class="nv">H</span> : valid_state_prop s), P s nil)
  (<span class="nv">Hextend</span> : <span class="kr">forall</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_from s tr -&gt;
    P s tr -&gt;
    <span class="kr">forall</span> (<span class="nv">sf</span> : state X) (<span class="nv">iom</span> <span class="nv">oom</span> : option message) (<span class="nv">l</span> : label X)
      (<span class="nv">Hx</span> : input_valid_transition l (finite_trace_last s tr, iom) (sf, oom)),
        <span class="kr">let</span> <span class="nv">x</span> := Build_transition_item l iom sf oom <span class="kr">in</span> P s (tr ++ [x])) :
  <span class="kr">forall</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_from s tr -&gt;
    P s tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí P s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last s tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P s (tr ++ [x])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr ‚Üí P s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk172" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk172"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí P s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last s tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P s (tr ++ [x])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr ‚Üí P s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk173" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk173"><span class="nb">induction</span> tr <span class="nb">using</span> rev_ind; <span class="nb">intro</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí P s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last s tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P s (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk174" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí P s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last s tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P s (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr ‚Üí P s tr</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (tr ++ [x])</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk174"><hr></label><div class="goal-conclusion">P s (tr ++ [x])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk175" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk175">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí P s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last s tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P s (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> Htr; <span class="nb">apply</span> Hempty; <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk176" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk176">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí P s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last s tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P s (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr ‚Üí P s tr</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (tr ++ [x])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s (tr ++ [x])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk177" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk177"><span class="nb">apply</span> finite_valid_trace_from_app_iff <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí P s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last s tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P s (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr ‚Üí P s tr</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr
‚àß finite_valid_trace_from
    (finite_trace_last s tr) [x]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s (tr ++ [x])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk178" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk178"><span class="nb">destruct</span> Htr <span class="kr">as</span> [Htr Hx].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí P s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last s tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P s (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr ‚Üí P s tr</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Hx</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from 
  (finite_trace_last s tr) [x]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s (tr ++ [x])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk179" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk179"><span class="nb">destruct</span> x; <span class="nb">apply</span> (Hextend _ _ Htr (IHtr Htr)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X, valid_state_prop s ‚Üí P s []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí P s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last s tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P s (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr ‚Üí P s tr</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Hx</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from 
  (finite_trace_last s tr)
  [{|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |}]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0
  (finite_trace_last s tr, input0)
  (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> Hx; <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk17a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk17a"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_rev_ind</span>
  (<span class="nv">P</span> : state X -&gt; list (transition_item X) -&gt; <span class="kt">Prop</span>)
  (<span class="nv">Hempty</span> : <span class="kr">forall</span> (<span class="nv">si</span> : state X) (<span class="nv">Hsi</span> : initial_state_prop X si), P si nil)
  (<span class="nv">Hextend</span> : <span class="kr">forall</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace si tr -&gt;
    P si tr -&gt;
    <span class="kr">forall</span> (<span class="nv">sf</span> : state X) (<span class="nv">iom</span> <span class="nv">oom</span> : option message) (<span class="nv">l</span> : label X)
      (<span class="nv">Hx</span> : input_valid_transition l (finite_trace_last si tr, iom) (sf, oom)),
        <span class="kr">let</span> <span class="nv">x</span> := Build_transition_item l iom sf oom <span class="kr">in</span> P si (tr ++ [x])) :
  <span class="kr">forall</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace si tr -&gt;
    P si tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace si tr
  ‚Üí P si tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last si tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P si (tr ++ [x])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace si tr ‚Üí P si tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk17b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk17b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace si tr
  ‚Üí P si tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last si tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P si (tr ++ [x])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace si tr ‚Üí P si tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk17c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk17c"><span class="nb">intros</span> si tr [Htr Hinit].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace si tr
  ‚Üí P si tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last si tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P si (tr ++ [x])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from si tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk17d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk17d"><span class="nb">induction</span> Htr <span class="nb">using</span> finite_valid_trace_from_rev_ind.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace si tr
  ‚Üí P si tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last si tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P si (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk17e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace si tr
  ‚Üí P si tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last si tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P si (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hx</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0
  (finite_trace_last s tr, iom) (
  sf, oom)</span></span></span><br><span><var>x</var><span><span class="hyp-body"><b>:= </b><span>{|
  l := l0;
  input := iom;
  destination := sf;
  output := oom
|}</span></span><span class="hyp-type"><b>: </b><span>transition_item</span></span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>IHHtr</var><span class="hyp-type"><b>: </b><span>initial_state_prop s ‚Üí P s tr</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk17e"><hr></label><div class="goal-conclusion">P s (tr ++ [x])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk17f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk17f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace si tr
  ‚Üí P si tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last si tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P si (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> Hempty.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk180" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk180">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace si tr
  ‚Üí P si tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l
          (finite_trace_last si tr, iom)
          (sf, oom)
        ‚Üí <span class="kr">let</span> <span class="nv">x</span> :=
            {|
              l := l;
              input := iom;
              destination := sf;
              output := oom
            |} <span class="kr">in</span>
          P si (tr ++ [x])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hx</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0
  (finite_trace_last s tr, iom) (
  sf, oom)</span></span></span><br><span><var>x</var><span><span class="hyp-body"><b>:= </b><span>{|
  l := l0;
  input := iom;
  destination := sf;
  output := oom
|}</span></span><span class="hyp-type"><b>: </b><span>transition_item</span></span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>IHHtr</var><span class="hyp-type"><b>: </b><span>initial_state_prop s ‚Üí P s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s (tr ++ [x])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> Hextend; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  Several other lemmas in this vein are necessary for proving results regarding
  traces.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk181" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk181"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_prefix</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">ls</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from s ls)
  (<span class="nv">n</span> : nat) :
    finite_valid_trace_from s (take n ls).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (take n ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk182" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk182"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (take n ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk183" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk183"><span class="nb">specialize</span> (take_drop n ls); <span class="nb">intro</span> Hdecompose.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hdecompose</var><span class="hyp-type"><b>: </b><span>take n ls ++ drop n ls = ls</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (take n ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk184" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk184"><span class="nb">rewrite</span> &lt;- Hdecompose <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (take n ls ++ drop n ls)</span></span></span><br><span><var>Hdecompose</var><span class="hyp-type"><b>: </b><span>take n ls ++ drop n ls = ls</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (take n ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_app_iff <span class="kr">in</span> Htr <span class="kr">as</span> [Hpr _].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk185" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk185"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_suffix</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">ls</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from s ls)
  (<span class="nv">n</span> : nat)
  (<span class="nv">nth</span> : state X)
  (<span class="nv">Hnth</span> : finite_trace_nth s ls n = Some nth) :
    finite_valid_trace_from nth (drop n ls).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from nth (drop n ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk186" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk186"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from nth (drop n ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk187" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk187"><span class="nb">rewrite</span> &lt;- (take_drop n ls) <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (take n ls ++ drop n ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from nth (drop n ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk188" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk188"><span class="nb">apply</span> finite_valid_trace_from_app_iff <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (take n ls)
‚àß finite_valid_trace_from
    (finite_trace_last s (take n ls))
    (drop n ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from nth (drop n ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk189" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk189"><span class="nb">destruct</span> Htr <span class="kr">as</span> [_ Htr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s (take n ls)) 
  (drop n ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from nth (drop n ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk18a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk18a"><span class="nb">replace</span> (finite_trace_last s (take n ls)) <span class="kr">with</span> nth <span class="kr">in</span> Htr; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s (take n ls)) 
  (drop n ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth = finite_trace_last s (take n ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk18b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk18b"><span class="nb">destruct</span> n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s (take <span class="mi">0</span> ls)) 
  (drop <span class="mi">0</span> ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls <span class="mi">0</span> = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth = finite_trace_last s (take <span class="mi">0</span> ls)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk18c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s (take (S n) ls))
  (drop (S n) ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls (S n) = Some nth</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk18c"><hr></label><div class="goal-conclusion">nth = finite_trace_last s (take (S n) ls)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk18d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk18d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s (take <span class="mi">0</span> ls)) 
  (drop <span class="mi">0</span> ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls <span class="mi">0</span> = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth = finite_trace_last s (take <span class="mi">0</span> ls)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk18e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk18e"><span class="nb">rewrite</span> finite_trace_nth_first <span class="kr">in</span> Hnth.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s (take <span class="mi">0</span> ls)) 
  (drop <span class="mi">0</span> ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Some s = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth = finite_trace_last s (take <span class="mi">0</span> ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> ls; <span class="nb">cbn</span>; <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk18f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk18f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s (take (S n) ls))
  (drop (S n) ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls (S n) = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth = finite_trace_last s (take (S n) ls)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk190" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk190"><span class="nb">unfold</span> finite_trace_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s (take (S n) ls))
  (drop (S n) ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls (S n) = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth =
List.<span class="nb">last</span> (List.map destination (take (S n) ls)) s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk191" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk191"><span class="nb">rewrite</span> &lt;- firstn_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last s (take (S n) ls))
  (drop (S n) ls)</span></span></span><br><span><var>nth</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls (S n) = Some nth</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth =
List.<span class="nb">last</span> (take (S n) (List.map destination ls)) s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> take_nth_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk192" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk192"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_segment</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">ls</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from s ls)
  (<span class="nv">n1</span> <span class="nv">n2</span> : nat)
  (<span class="nv">Hle</span> : n1 &lt;= n2)
  (<span class="nv">n1th</span> : state X)
  (<span class="nv">Hnth</span> : finite_trace_nth s ls n1 = Some n1th) :
    finite_valid_trace_from n1th (list_segment ls n1 n2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n1 = Some n1th</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from n1th (list_segment ls n1 n2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk193" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk193"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n1 = Some n1th</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from n1th (list_segment ls n1 n2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk194" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk194"><span class="nb">apply</span> finite_valid_trace_from_suffix <span class="kr">with</span> s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n1 = Some n1th</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (take n2 ls)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk195" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n1 = Some n1th</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk195"><hr></label><div class="goal-conclusion">finite_trace_nth s (take n2 ls) n1 = Some n1th</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk196" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk196">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n1 = Some n1th</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (take n2 ls)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_prefix.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk197" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk197">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls n1 = Some n1th</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth s (take n2 ls) n1 = Some n1th</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk198" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk198"><span class="nb">destruct</span> n1; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>S n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s ls (S n1) = Some n1th</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth s (take n2 ls) (S n1) = Some n1th</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk199" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk199"><span class="nb">unfold</span> finite_trace_nth <span class="kr">in</span> Hnth |- *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>S n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>nth_error (s :: List.map destination ls) (S n1) =
Some n1th</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (s :: List.map destination (take n2 ls))
  (S n1) = Some n1th</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk19a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk19a"><span class="nb">simpl</span> <span class="kr">in</span> Hnth |- *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>S n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>nth_error (List.map destination ls) n1 =
Some n1th</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (List.map destination (take n2 ls)) n1 =
Some n1th</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> &lt;- firstn_map, take_nth.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk19b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk19b"><span class="kn">Lemma</span> <span class="nf">can_produce_from_valid_trace</span>
  (<span class="nv">si</span> : state X) (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from si tr) :
    <span class="kr">forall</span> <span class="nv">item</span> : transition_item,
      item ‚àà tr -&gt; option_can_produce (destination item) (output item).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from si tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">item</span> : transition_item,
  item ‚àà tr
  ‚Üí option_can_produce (destination item)
      (output item)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk19c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk19c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from si tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">item</span> : transition_item,
  item ‚àà tr
  ‚Üí option_can_produce (destination item)
      (output item)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk19d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk19d"><span class="nb">intros</span> item Hitem.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from si tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>item ‚àà tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_can_produce (destination item) (output item)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk19e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk19e"><span class="nb">apply</span> elem_of_list_split <span class="kr">in</span> Hitem <span class="kr">as</span> (l1 &amp; l2 &amp; Heq).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from si tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>l1, l2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = l1 ++ item :: l2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_can_produce (destination item) (output item)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk19f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk19f"><span class="nb">eexists</span> _, _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from si tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>l1, l2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = l1 ++ item :: l2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition <span class="nl">?Goal0</span> <span class="nl">?Goal</span>
  (destination item, output item)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eapply</span> input_valid_transition_to; <span class="nb">cbn</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a0"><span class="kn">Lemma</span> <span class="nf">can_emit_from_valid_trace</span>
  (<span class="nv">si</span> : state X)
  (<span class="nv">m</span> : message)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace si tr)
  (<span class="nv">Hm</span> : trace_has_message (field_selector output) m tr) :
    can_emit m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace si tr</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>trace_has_message (field_selector output) m tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_emit m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace si tr</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>trace_has_message (field_selector output) m tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_emit m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a2"><span class="nb">apply</span> can_emit_iff.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace si tr</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>trace_has_message (field_selector output) m tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">s</span> : state X, can_produce s m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a3"><span class="nb">setoid_rewrite</span> Exists_exists <span class="kr">in</span> Hm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace si tr</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> <span class="nv">x</span> : transition_item,
  x ‚àà tr ‚àß field_selector output m x</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">s</span> : state X, can_produce s m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a4"><span class="nb">destruct</span> Hm <span class="kr">as</span> (item &amp; Hitem &amp; Houtput).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace si tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>item ‚àà tr</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>field_selector output m item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">s</span> : state X, can_produce s m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a5"><span class="kr">exists</span> (<span class="nv">destination</span> <span class="nv">item</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace si tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>item ‚àà tr</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>field_selector output m item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce (destination item) m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a6"><span class="nb">unfold</span> can_produce; <span class="nb">rewrite</span> &lt;- Houtput.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace si tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>item ‚àà tr</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>field_selector output m item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_can_produce (destination item) (output item)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eapply</span> can_produce_from_valid_trace; [<span class="nb">apply</span> Htr |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab12"></a><h2 class="section">Finite valid traces with a final state</h2>
<div class="paragraph"> </div>

  It is often necessary to refer to know ending state of a <span class="inlinecode"><span class="id" title="var">finite_valid_trace_from</span></span>.
  This is either the <span class="inlinecode"><span class="id" title="var">destination</span></span> of the <span class="inlinecode"><span class="id" title="var">last</span></span> <span class="inlinecode"><span class="id" title="var">transition_item</span></span> in the trace, or
  the starting state.

<div class="paragraph"> </div>

  To avoid repeating reasoning about <span class="inlinecode"><span class="id" title="var">last</span></span>, we define variants of
  <span class="inlinecode"><span class="id" title="var">finite_valid_trace_from</span></span> and <span class="inlinecode"><span class="id" title="var">finite_valid_trace</span></span>
  that include the final state, and give appropriate induction principles.

<div class="paragraph"> </div>

  The final state of a finite portion of a valid trace.
  This is defined over <span class="inlinecode"><span class="id" title="var">finite_valid_trace_from</span></span> because
  an initial state is necessary in case <code>tr</code> is empty,
  and this allows the definition to have only one non-implicit
  parameter.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">finite_valid_trace_from_to</span> : state X -&gt; state X -&gt; list transition_item -&gt; <span class="kt">Prop</span> :=
| finite_valid_trace_from_to_empty :
    <span class="kr">forall</span> (<span class="nv">s</span> : state X)
      (<span class="nv">Hs</span> : valid_state_prop s),
        finite_valid_trace_from_to s s []
| finite_valid_trace_from_to_extend :
    <span class="kr">forall</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tl</span> : list transition_item)
      (<span class="nv">Htl</span> : finite_valid_trace_from_to s f tl)
      (<span class="nv">s&#39;</span> : state X) (<span class="nv">iom</span> <span class="nv">oom</span> : option message) (<span class="nv">l</span> : label X)
      (<span class="nv">Ht</span> : input_valid_transition l (s&#39;, iom) (s, oom)),
        finite_valid_trace_from_to s&#39; f (Build_transition_item l iom s oom :: tl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a7"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_singleton</span>
  (<span class="nv">s</span> <span class="nv">s&#39;</span> : state X) (<span class="nv">iom</span> <span class="nv">oom</span> : option message) (<span class="nv">l</span> : label X) :
  input_valid_transition l (s, iom) (s&#39;, oom) -&gt;
    finite_valid_trace_from_to s s&#39; [Build_transition_item l iom s&#39; oom].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l (s, iom) (s&#39;, oom)
‚Üí finite_valid_trace_from_to s s&#39;
    [{|
       l := l;
       input := iom;
       destination := s&#39;;
       output := oom
     |}]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l (s, iom) (s&#39;, oom)
‚Üí finite_valid_trace_from_to s s&#39;
    [{|
       l := l;
       input := iom;
       destination := s&#39;;
       output := oom
     |}]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1a9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1a9"><span class="nb">intro</span> Ht.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, iom) (s&#39;, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s s&#39;
  [{|
     l := l;
     input := iom;
     destination := s&#39;;
     output := oom
   |}]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1aa" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1aa"><span class="nb">constructor</span>; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, iom) (s&#39;, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s&#39; s&#39; []</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ab" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ab"><span class="nb">constructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, iom) (s&#39;, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> input_valid_transition_destination <span class="kr">in</span> Ht.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ac" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ac"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_forget_last</span> :
  <span class="kr">forall</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_from_to s f tr -&gt; finite_valid_trace_from s tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from_to s f tr
  ‚Üí finite_valid_trace_from s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ad" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ad"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from_to s f tr
  ‚Üí finite_valid_trace_from s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">induction</span> <span class="mi">1</span>; <span class="nb">constructor</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ae" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ae"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_last</span> :
  <span class="kr">forall</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_from_to s f tr -&gt; finite_trace_last s tr = f.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from_to s f tr
  ‚Üí finite_trace_last s tr = f</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1af" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1af"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from_to s f tr
  ‚Üí finite_trace_last s tr = f</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1b0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1b0"><span class="nb">induction</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s [] = s</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk1b1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>IHfinite_valid_trace_from_to</var><span class="hyp-type"><b>: </b><span>finite_trace_last s tl =
f</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk1b1"><hr></label><div class="goal-conclusion">finite_trace_last s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl) = f</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1b2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1b2">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s [] = s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_trace_last_nil.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1b3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1b3">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>IHfinite_valid_trace_from_to</var><span class="hyp-type"><b>: </b><span>finite_trace_last s tl =
f</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl) = f</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> finite_trace_last_cons.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1b4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1b4"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_add_last</span> :
  <span class="kr">forall</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_from s tr -&gt;
    finite_trace_last s tr = f -&gt;
    finite_valid_trace_from_to s f tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí finite_trace_last s tr = f
    ‚Üí finite_valid_trace_from_to s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1b5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1b5"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from s tr
  ‚Üí finite_trace_last s tr = f
    ‚Üí finite_valid_trace_from_to s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1b6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1b6"><span class="nb">induction</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s [] = f
‚Üí finite_valid_trace_from_to s f []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk1b7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>IHfinite_valid_trace_from</var><span class="hyp-type"><b>: </b><span>finite_trace_last s tl = f
‚Üí finite_valid_trace_from_to
    s f tl</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk1b7"><hr></label><div class="goal-conclusion">finite_trace_last s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl) = f
‚Üí finite_valid_trace_from_to s&#39; f
    ({|
       l := l0;
       input := iom;
       destination := s;
       output := oom
     |} :: tl)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1b8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1b8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s [] = f
‚Üí finite_valid_trace_from_to s f []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> finite_trace_last_nil; <span class="nb">intros</span> &lt;-; <span class="nb">constructor</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1b9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1b9">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>IHfinite_valid_trace_from</var><span class="hyp-type"><b>: </b><span>finite_trace_last s tl = f
‚Üí finite_valid_trace_from_to
    s f tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last s&#39;
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl) = f
‚Üí finite_valid_trace_from_to s&#39; f
    ({|
       l := l0;
       input := iom;
       destination := s;
       output := oom
     |} :: tl)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> finite_trace_last_cons; <span class="nb">intros</span> &lt;-; <span class="nb">constructor</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ba" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ba"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_first_pstate</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item) :
    finite_valid_trace_from_to s f tr -&gt; valid_state_prop s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f tr ‚Üí valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1bb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1bb"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f tr ‚Üí valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1bc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1bc"><span class="nb">intro</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_forget_last,
    finite_valid_trace_first_pstate <span class="kr">in</span> Htr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1bd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1bd"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_last_pstate</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list transition_item) :
    finite_valid_trace_from_to s f tr -&gt; valid_state_prop f.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f tr ‚Üí valid_state_prop f</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1be" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1be"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f tr ‚Üí valid_state_prop f</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1bf" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1bf"><span class="nb">intro</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop f</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1c0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1c0"><span class="nb">rewrite</span> &lt;- (finite_valid_trace_from_to_last _ _ _ Htr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop (finite_trace_last s tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1c1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1c1"><span class="nb">apply</span> finite_valid_trace_last_pstate.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_forget_last <span class="kr">in</span> Htr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1c2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1c2"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_app</span>
  (<span class="nv">m</span> <span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">ls</span> <span class="nv">ls&#39;</span> : list transition_item) :
    finite_valid_trace_from_to s m ls -&gt;
    finite_valid_trace_from_to m f ls&#39; -&gt;
    finite_valid_trace_from_to s f (ls ++ ls&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m, s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s m ls
‚Üí finite_valid_trace_from_to m f ls&#39;
  ‚Üí finite_valid_trace_from_to s f (ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1c3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1c3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m, s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s m ls
‚Üí finite_valid_trace_from_to m f ls&#39;
  ‚Üí finite_valid_trace_from_to s f (ls ++ ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> Hl Hl&#39;; <span class="nb">induction</span> Hl; [| <span class="nb">constructor</span>; <span class="nb">auto</span>].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1c4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1c4"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_app_split</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">ls</span> <span class="nv">ls&#39;</span> : list transition_item) :
    finite_valid_trace_from_to s f (ls ++ ls&#39;) -&gt;
    <span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
      finite_valid_trace_from_to s m ls /\ finite_valid_trace_from_to m f ls&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f (ls ++ ls&#39;)
‚Üí <span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
  finite_valid_trace_from_to s m ls
  ‚àß finite_valid_trace_from_to m f ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1c5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1c5"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f (ls ++ ls&#39;)
‚Üí <span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
  finite_valid_trace_from_to s m ls
  ‚àß finite_valid_trace_from_to m f ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1c6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1c6"><span class="nb">revert</span> s; <span class="nb">induction</span> ls; <span class="nb">intros</span> s; <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f ls&#39;
‚Üí finite_valid_trace_from_to s
    (finite_trace_last s []) []
  ‚àß finite_valid_trace_from_to
      (finite_trace_last s []) f ls&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk1c7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from_to s f (ls ++ ls&#39;)
  ‚Üí <span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
    finite_valid_trace_from_to s m ls
    ‚àß finite_valid_trace_from_to m f ls&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk1c7"><hr></label><div class="goal-conclusion">finite_valid_trace_from_to s f (a :: ls ++ ls&#39;)
‚Üí finite_valid_trace_from_to s
    (finite_trace_last s (a :: ls)) 
    (a :: ls)
  ‚àß finite_valid_trace_from_to
      (finite_trace_last s (a :: ls)) f ls&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1c8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1c8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f ls&#39;
‚Üí finite_valid_trace_from_to s
    (finite_trace_last s []) []
  ‚àß finite_valid_trace_from_to
      (finite_trace_last s []) f ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1c9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1c9"><span class="nb">rewrite</span> finite_trace_last_nil.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f ls&#39;
‚Üí finite_valid_trace_from_to s s []
  ‚àß finite_valid_trace_from_to s f ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ca" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ca"><span class="nb">intro</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s s []
‚àß finite_valid_trace_from_to s f ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1cb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1cb"><span class="nb">split</span>; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s s []</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1cc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1cc"><span class="nb">apply</span> finite_valid_trace_from_to_first_pstate <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s s []</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1cd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1cd">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from_to s f (ls ++ ls&#39;)
  ‚Üí <span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
    finite_valid_trace_from_to s m ls
    ‚àß finite_valid_trace_from_to m f ls&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f (a :: ls ++ ls&#39;)
‚Üí finite_valid_trace_from_to s
    (finite_trace_last s (a :: ls)) (a :: ls)
  ‚àß finite_valid_trace_from_to
      (finite_trace_last s (a :: ls)) f ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ce" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ce"><span class="nb">rewrite</span> finite_trace_last_cons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from_to s f (ls ++ ls&#39;)
  ‚Üí <span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
    finite_valid_trace_from_to s m ls
    ‚àß finite_valid_trace_from_to m f ls&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f (a :: ls ++ ls&#39;)
‚Üí finite_valid_trace_from_to s
    (finite_trace_last (destination a) ls) (a :: ls)
  ‚àß finite_valid_trace_from_to
      (finite_trace_last (destination a) ls) f ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1cf" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1cf"><span class="nb">inversion</span> <span class="mi">1</span>; <span class="nb">subst</span>; <span class="nb">simpl</span> <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from_to s f (ls ++ ls&#39;)
  ‚Üí finite_valid_trace_from_to s
      (finite_trace_last s ls) ls
    ‚àß finite_valid_trace_from_to
        (finite_trace_last s ls) f ls&#39;</span></span></span><br><span><var>s, s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls ++ ls&#39;)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s1 f (ls ++ ls&#39;)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s (finite_trace_last s1 ls)
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)
‚àß finite_valid_trace_from_to (finite_trace_last s1 ls)
    f ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1d0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1d0"><span class="nb">apply</span> IHls <span class="kr">in</span> Htl <span class="kr">as</span> [].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls, ls'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  finite_valid_trace_from_to s f (ls ++ ls&#39;)
  ‚Üí finite_valid_trace_from_to s
      (finite_trace_last s ls) ls
    ‚àß finite_valid_trace_from_to
        (finite_trace_last s ls) f ls&#39;</span></span></span><br><span><var>s, s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls ++ ls&#39;)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s1
  (finite_trace_last s1 ls) ls</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to
  (finite_trace_last s1 ls) f ls&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s (finite_trace_last s1 ls)
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)
‚àß finite_valid_trace_from_to (finite_trace_last s1 ls)
    f ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">auto using</span> finite_valid_trace_from_to_extend.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1d1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1d1"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_snoc</span> :
  <span class="kr">forall</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">ls</span> : list transition_item) (<span class="nv">item</span> : transition_item X),
    finite_valid_trace_from_to s f (ls ++ [item]) &lt;-&gt;
    <span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
      finite_valid_trace_from_to s m ls /\
      input_valid_transition_item m item /\
      destination item = f.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">ls</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace_from_to s f (ls ++ [item])
  ‚Üî (<span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
     finite_valid_trace_from_to s m ls
     ‚àß input_valid_transition_item m item
       ‚àß destination item = f)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1d2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1d2"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">ls</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace_from_to s f (ls ++ [item])
  ‚Üî (<span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
     finite_valid_trace_from_to s m ls
     ‚àß input_valid_transition_item m item
       ‚àß destination item = f)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1d3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1d3"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f (ls ++ [item])
‚Üí <span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
  finite_valid_trace_from_to s m ls
  ‚àß input_valid_transition_item m item
    ‚àß destination item = f</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk1d4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk1d4"><hr></label><div class="goal-conclusion">(<span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
 finite_valid_trace_from_to s m ls
 ‚àß input_valid_transition_item m item
   ‚àß destination item = f)
‚Üí finite_valid_trace_from_to s f (ls ++ [item])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1d5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1d5">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f (ls ++ [item])
‚Üí <span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
  finite_valid_trace_from_to s m ls
  ‚àß input_valid_transition_item m item
    ‚àß destination item = f</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1d6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1d6"><span class="nb">intros</span> Htr; <span class="nb">apply</span> finite_valid_trace_from_to_app_split <span class="kr">in</span> Htr <span class="kr">as</span> [Htr Hitem].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s
  (finite_trace_last s ls) ls</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to
  (finite_trace_last s ls) f [item]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
finite_valid_trace_from_to s m ls
‚àß input_valid_transition_item m item
  ‚àß destination item = f</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> Hitem; <span class="nb">inversion</span> Htl; <span class="nb">subst</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1d7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1d7">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">let</span> <span class="nv">m</span> := finite_trace_last s ls <span class="kr">in</span>
 finite_valid_trace_from_to s m ls
 ‚àß input_valid_transition_item m item
   ‚àß destination item = f)
‚Üí finite_valid_trace_from_to s f (ls ++ [item])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1d8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1d8"><span class="nb">intros</span> (Htr &amp; Hitem &amp; &lt;-).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s
  (finite_trace_last s ls) ls</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>input_valid_transition_item
  (finite_trace_last s ls) item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s (destination item)
  (ls ++ [item])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1d9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1d9"><span class="nb">eapply</span> finite_valid_trace_from_to_app; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s
  (finite_trace_last s ls) ls</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>input_valid_transition_item
  (finite_trace_last s ls) item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to (finite_trace_last s ls)
  (destination item) [item]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> item; <span class="nb">apply</span> finite_valid_trace_from_to_singleton.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">finite_valid_trace_init_to</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item) : <span class="kt">Prop</span> :=
  finite_valid_trace_from_to si sf tr /\ initial_state_prop X si.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1da" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1da"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_add_last</span>
  (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item) :
    finite_valid_trace si tr -&gt;
    finite_trace_last si tr = sf -&gt;
    finite_valid_trace_init_to si sf tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace si tr
‚Üí finite_trace_last si tr = sf
  ‚Üí finite_valid_trace_init_to si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1db" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1db"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace si tr
‚Üí finite_trace_last si tr = sf
  ‚Üí finite_valid_trace_init_to si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1dc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1dc"><span class="nb">intros</span> [Htr Hinit] Hf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from si tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br><span><var>Hf</var><span class="hyp-type"><b>: </b><span>finite_trace_last si tr = sf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">split</span>; <span class="nb">eauto using</span> finite_valid_trace_from_add_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1dd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1dd"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_forget_last</span>
  (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item) :
    finite_valid_trace_init_to si sf tr -&gt;
    finite_valid_trace si tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to si sf tr
‚Üí finite_valid_trace si tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1de" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1de"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to si sf tr
‚Üí finite_valid_trace si tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1df" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1df"><span class="nb">intros</span> [Hinit Htr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf tr</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace si tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">split</span>; <span class="nb">eauto using</span> finite_valid_trace_from_to_forget_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e0"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_last</span>
  (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item) :
    finite_valid_trace_init_to si sf tr -&gt;
    finite_trace_last si tr = sf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to si sf tr
‚Üí finite_trace_last si tr = sf</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to si sf tr
‚Üí finite_trace_last si tr = sf</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e2"><span class="nb">intros</span> [Htr _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last si tr = sf</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eauto using</span> finite_valid_trace_from_to_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e3"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_snoc</span> :
  <span class="kr">forall</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item X),
    finite_valid_trace_init_to si sf (tr ++ [item]) &lt;-&gt;
    finite_valid_trace_init_to si (finite_trace_last si tr) tr /\
    input_valid_transition_item (finite_trace_last si tr) item /\
    destination item = sf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace_init_to si sf (tr ++ [item])
  ‚Üî finite_valid_trace_init_to si
      (finite_trace_last si tr) tr
    ‚àß input_valid_transition_item
        (finite_trace_last si tr) item
      ‚àß destination item = sf</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e4"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace_init_to si sf (tr ++ [item])
  ‚Üî finite_valid_trace_init_to si
      (finite_trace_last si tr) tr
    ‚àß input_valid_transition_item
        (finite_trace_last si tr) item
      ‚àß destination item = sf</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e5"><span class="nb">unfold</span> finite_valid_trace_init_to; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to si sf (tr ++ [item])
‚àß initial_state_prop si
‚Üî (finite_valid_trace_from_to si
     (finite_trace_last si tr) tr
   ‚àß initial_state_prop si)
  ‚àß input_valid_transition_item
      (finite_trace_last si tr) item
    ‚àß destination item = sf</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e6"><span class="nb">rewrite</span> finite_valid_trace_from_to_snoc.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">let</span> <span class="nv">m</span> := finite_trace_last si tr <span class="kr">in</span>
 finite_valid_trace_from_to si m tr
 ‚àß input_valid_transition_item m item
   ‚àß destination item = sf) ‚àß initial_state_prop si
‚Üî (finite_valid_trace_from_to si
     (finite_trace_last si tr) tr
   ‚àß initial_state_prop si)
  ‚àß input_valid_transition_item
      (finite_trace_last si tr) item
    ‚àß destination item = sf</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> itauto.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e7"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_snoc_rev</span> :
  <span class="kr">forall</span> {<span class="nv">si</span> <span class="nv">sf</span> : state X} {<span class="nv">tr</span> : list transition_item} {<span class="nv">item</span> : transition_item X},
    finite_valid_trace_init_to si sf tr -&gt;
    input_valid_transition_item sf item -&gt;
    finite_valid_trace_init_to si (destination item) (tr ++ [item]).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace_init_to si sf tr
  ‚Üí input_valid_transition_item sf item
    ‚Üí finite_valid_trace_init_to si (destination item)
        (tr ++ [item])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace_init_to si sf tr
  ‚Üí input_valid_transition_item sf item
    ‚Üí finite_valid_trace_init_to si (destination item)
        (tr ++ [item])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1e9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1e9"><span class="nb">unfold</span> finite_valid_trace_init_to.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace_from_to si sf tr
  ‚àß initial_state_prop si
  ‚Üí input_valid_transition_item sf item
    ‚Üí finite_valid_trace_from_to si (destination item)
        (tr ++ [item]) ‚àß initial_state_prop si</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ea" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ea"><span class="nb">intros</span> * [Htr Hinit] Hivt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br><span><var>Hivt</var><span class="hyp-type"><b>: </b><span>input_valid_transition_item sf item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to si (destination item)
  (tr ++ [item]) ‚àß initial_state_prop si</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1eb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1eb"><span class="nb">rewrite</span> finite_valid_trace_from_to_snoc.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br><span><var>Hivt</var><span class="hyp-type"><b>: </b><span>input_valid_transition_item sf item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">let</span> <span class="nv">m</span> := finite_trace_last si tr <span class="kr">in</span>
 finite_valid_trace_from_to si m tr
 ‚àß input_valid_transition_item m item
   ‚àß destination item = destination item)
‚àß initial_state_prop si</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ec" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ec"><span class="nb">apply</span> finite_valid_trace_from_to_last <span class="kr">in</span> Htr <span class="kr">as</span> Hsf; <span class="nb">subst</span> sf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si
  (finite_trace_last si tr) tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br><span><var>Hivt</var><span class="hyp-type"><b>: </b><span>input_valid_transition_item
  (finite_trace_last si tr) item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">let</span> <span class="nv">m</span> := finite_trace_last si tr <span class="kr">in</span>
 finite_valid_trace_from_to si m tr
 ‚àß input_valid_transition_item m item
   ‚àß destination item = destination item)
‚àß initial_state_prop si</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> itauto.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ed" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ed"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_prefix</span> :
  <span class="kr">forall</span> {<span class="nv">si</span> <span class="nv">sf</span> : state X} {<span class="nv">pre</span> <span class="nv">tr</span> : list (transition_item X)},
    finite_valid_trace_init_to si sf tr -&gt;
    pre `prefix_of` tr -&gt;
    finite_valid_trace_init_to si (finite_trace_last si pre) pre.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">pre</span> <span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to si sf tr
  ‚Üí pre `prefix_of` tr
    ‚Üí finite_valid_trace_init_to si
        (finite_trace_last si pre) pre</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ee" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ee"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">pre</span> <span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to si sf tr
  ‚Üí pre `prefix_of` tr
    ‚Üí finite_valid_trace_init_to si
        (finite_trace_last si pre) pre</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ef" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ef"><span class="nb">intros</span> * [] [suf -&gt;]; <span class="nb">split</span>; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>pre, suf</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf (pre ++ suf)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to si
  (finite_trace_last si pre) pre</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eapply</span> finite_valid_trace_from_to_app_split.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1f0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1f0"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_prefix_1</span> :
  <span class="kr">forall</span> {<span class="nv">si</span> <span class="nv">sf</span> : state X} {<span class="nv">pre</span> <span class="nv">suf</span> : list (transition_item X)},
    finite_valid_trace_init_to si sf (pre ++ suf) -&gt;
    finite_valid_trace_init_to si (finite_trace_last si pre) pre.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">pre</span> <span class="nv">suf</span> : list transition_item),
  finite_valid_trace_init_to si sf (pre ++ suf)
  ‚Üí finite_valid_trace_init_to si
      (finite_trace_last si pre) pre</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1f1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1f1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">pre</span> <span class="nv">suf</span> : list transition_item),
  finite_valid_trace_init_to si sf (pre ++ suf)
  ‚Üí finite_valid_trace_init_to si
      (finite_trace_last si pre) pre</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span>; <span class="nb">eapply</span> finite_valid_trace_init_to_prefix; [| <span class="nb">eexists</span>].</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1f2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1f2"><span class="kn">Lemma</span> <span class="nf">extend_right_finite_trace_from_to</span>
  (<span class="nv">s1</span> <span class="nv">s2</span> : state X)
  (<span class="nv">ts</span> : list transition_item)
  (<span class="nv">Ht12</span> : finite_valid_trace_from_to s1 s2 ts)
  (<span class="nv">l3</span> : label X)
  (<span class="nv">iom3</span> : option message)
  (<span class="nv">s3</span> : state X)
  (<span class="nv">oom3</span> : option message)
  (<span class="nv">Hv23</span> : input_valid_transition l3 (s2, iom3) (s3, oom3)) :
    finite_valid_trace_from_to s1 s3 (ts ++ [Build_transition_item l3 iom3 s3 oom3]).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ts</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s1 s2 ts</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s1 s3
  (ts ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1f3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1f3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ts</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s1 s2 ts</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s2, iom3) (s3, oom3)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s1 s3
  (ts ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1f4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1f4"><span class="nb">induction</span> Ht12.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s, iom3) (s3, oom3)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s s3
  ([] ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk1f5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (f, iom3) (s3, oom3)</span></span></span><br><span><var>IHHt12</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (
  f, iom3) (s3, oom3)
‚Üí finite_valid_trace_from_to s s3
    (tl ++
     [{|
        l := l3;
        input := iom3;
        destination := s3;
        output := oom3
      |}])</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk1f5"><hr></label><div class="goal-conclusion">finite_valid_trace_from_to s&#39; s3
  (({|
      l := l0;
      input := iom;
      destination := s;
      output := oom
    |} :: tl) ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1f6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1f6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (s, iom3) (s3, oom3)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s s3
  ([] ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_singleton.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1f7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1f7">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (f, iom3) (s3, oom3)</span></span></span><br><span><var>IHHt12</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (
  f, iom3) (s3, oom3)
‚Üí finite_valid_trace_from_to s s3
    (tl ++
     [{|
        l := l3;
        input := iom3;
        destination := s3;
        output := oom3
      |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s&#39; s3
  (({|
      l := l0;
      input := iom;
      destination := s;
      output := oom
    |} :: tl) ++
   [{|
      l := l3;
      input := iom3;
      destination := s3;
      output := oom3
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1f8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1f8"><span class="nb">rewrite</span> &lt;- app_comm_cons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Ht12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>l3</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>iom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom3</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hv23</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (f, iom3) (s3, oom3)</span></span></span><br><span><var>IHHt12</var><span class="hyp-type"><b>: </b><span>input_valid_transition l3 (
  f, iom3) (s3, oom3)
‚Üí finite_valid_trace_from_to s s3
    (tl ++
     [{|
        l := l3;
        input := iom3;
        destination := s3;
        output := oom3
      |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s&#39; s3
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |}
   :: tl ++
      [{|
         l := l3;
         input := iom3;
         destination := s3;
         output := oom3
       |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_extend; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1f9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1f9"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_rev_ind</span>
  (<span class="nv">P</span> : state X -&gt; state X -&gt; list transition_item -&gt; <span class="kt">Prop</span>)
  (<span class="nv">Hempty</span> : <span class="kr">forall</span> (<span class="nv">si</span> : state X) (<span class="nv">Hsi</span> : valid_state_prop si), P si si nil)
  (<span class="nv">Hextend</span> : <span class="kr">forall</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item)
    (<span class="nv">IHtr</span> : P si s tr)
    (<span class="nv">Htr</span> : finite_valid_trace_from_to si s tr)
    (<span class="nv">sf</span> : state X) (<span class="nv">iom</span> <span class="nv">oom</span> : option message) (<span class="nv">l</span> : label X)
    (<span class="nv">Ht</span> : input_valid_transition l (s, iom) (sf, oom)),
      P si sf (tr ++ [Build_transition_item l iom sf oom])) :
  <span class="kr">forall</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_from_to si sf tr -&gt;
    P si sf tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from_to si sf tr ‚Üí P si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1fa" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1fa"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_from_to si sf tr ‚Üí P si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1fb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1fb"><span class="nb">intros</span> si sf tr Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1fc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1fc"><span class="nb">revert</span> sf Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">sf</span> : state X,
  finite_valid_trace_from_to si sf tr ‚Üí P si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1fd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1fd"><span class="nb">induction</span> tr <span class="nb">using</span> rev_ind;
  <span class="nb">intros</span> sf Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk1fe" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sf</span> : state X,
  finite_valid_trace_from_to si sf tr
  ‚Üí P si sf tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf (tr ++ [x])</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk1fe"><hr></label><div class="goal-conclusion">P si sf (tr ++ [x])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk1ff" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk1ff">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> Htr; <span class="nb">subst</span>; <span class="nb">apply</span> Hempty.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk200" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk200">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sf</span> : state X,
  finite_valid_trace_from_to si sf tr
  ‚Üí P si sf tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf (tr ++ [x])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf (tr ++ [x])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk201" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk201"><span class="nb">apply</span> finite_valid_trace_from_to_app_split <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sf</span> : state X,
  finite_valid_trace_from_to si sf tr
  ‚Üí P si sf tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si
  (finite_trace_last si tr) tr
‚àß finite_valid_trace_from_to
    (finite_trace_last si tr) sf [x]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf (tr ++ [x])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk202" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk202"><span class="nb">destruct</span> Htr <span class="kr">as</span> [Htr Hstep].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sf</span> : state X,
  finite_valid_trace_from_to si sf tr
  ‚Üí P si sf tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si
  (finite_trace_last si tr) tr</span></span></span><br><span><var>Hstep</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to
  (finite_trace_last si tr) sf [x]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf (tr ++ [x])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk203" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk203"><span class="nb">inversion</span> Hstep; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sf</span> : state X,
  finite_valid_trace_from_to si sf tr
  ‚Üí P si sf tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si
  (finite_trace_last si tr) tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hstep</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to
  (finite_trace_last si tr) sf
  [{|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |}]</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s sf []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0
  (finite_trace_last si tr, iom) (
  s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf
  (tr ++
   [{|
      l := l0;
      input := iom;
      destination := s;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk204" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk204"><span class="nb">inversion</span> Htl; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sf</span> : state X,
  finite_valid_trace_from_to si sf tr
  ‚Üí P si sf tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si
  (finite_trace_last si tr) tr</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0
  (finite_trace_last si tr, iom) (
  sf, oom)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to sf sf []</span></span></span><br><span><var>Hstep</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to
  (finite_trace_last si tr) sf
  [{|
     l := l0;
     input := iom;
     destination := sf;
     output := oom
   |}]</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop sf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf
  (tr ++
   [{|
      l := l0;
      input := iom;
      destination := sf;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk205" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk205"><span class="nb">revert</span> Ht.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sf</span> : state X,
  finite_valid_trace_from_to si sf tr
  ‚Üí P si sf tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si
  (finite_trace_last si tr) tr</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to sf sf []</span></span></span><br><span><var>Hstep</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to
  (finite_trace_last si tr) sf
  [{|
     l := l0;
     input := iom;
     destination := sf;
     output := oom
   |}]</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop sf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0
  (finite_trace_last si tr, iom) (sf, oom)
‚Üí P si sf
    (tr ++
     [{|
        l := l0;
        input := iom;
        destination := sf;
        output := oom
      |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk206" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk206"><span class="nb">apply</span> Hextend; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  valid_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_from_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sf</span> : state X,
  finite_valid_trace_from_to si sf tr
  ‚Üí P si sf tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si
  (finite_trace_last si tr) tr</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to sf sf []</span></span></span><br><span><var>Hstep</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to
  (finite_trace_last si tr) sf
  [{|
     l := l0;
     input := iom;
     destination := sf;
     output := oom
   |}]</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop sf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si (finite_trace_last si tr) tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> IHtr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk207" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk207"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_rev_ind</span>
  (<span class="nv">P</span> : state X -&gt; state X -&gt; list (transition_item X) -&gt; <span class="kt">Prop</span>)
  (<span class="nv">Hempty</span> : <span class="kr">forall</span> (<span class="nv">si</span> : state X) (<span class="nv">Hsi</span> : initial_state_prop X si), P si si nil)
  (<span class="nv">Hextend</span> : <span class="kr">forall</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item)
    (<span class="nv">IHtr</span> : P si s tr)
    (<span class="nv">Htr</span> : finite_valid_trace_init_to si s tr)
    (<span class="nv">sf</span> : state X) (<span class="nv">iom</span> <span class="nv">oom</span> : option message) (<span class="nv">l</span> : label X)
    (<span class="nv">Ht</span> : input_valid_transition l (s, iom) (sf, oom)),
      P si sf (tr ++ [Build_transition_item l iom sf oom])) :
  <span class="kr">forall</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_init_to si sf tr -&gt;
    P si sf tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_init_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to si sf tr ‚Üí P si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk208" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk208"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_init_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to si sf tr ‚Üí P si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk209" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk209"><span class="nb">intros</span> si sf tr Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_init_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to si sf tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk20a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk20a"><span class="nb">destruct</span> Htr <span class="kr">as</span> [Htr Hinit].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_init_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si sf tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk20b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk20b"><span class="nb">induction</span> Htr <span class="nb">using</span> finite_valid_trace_from_to_rev_ind.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_init_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hsi</var><span class="hyp-type"><b>: </b><span>valid_state_prop si</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si si []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk20c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_init_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si s tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (sf, oom)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br><span><var>IHHtr</var><span class="hyp-type"><b>: </b><span>initial_state_prop si ‚Üí P si s tr</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk20c"><hr></label><div class="goal-conclusion">P si sf
  (tr ++
   [{|
      l := l0;
      input := iom;
      destination := sf;
      output := oom
    |}])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk20d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk20d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_init_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hsi</var><span class="hyp-type"><b>: </b><span>valid_state_prop si</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si si []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> Hempty.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk20e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk20e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">si</span> : state X,
  initial_state_prop si ‚Üí P si si []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P si s tr
  ‚Üí finite_valid_trace_init_to si s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
        (<span class="nv">iom</span> <span class="nv">oom</span> : option message) 
        (<span class="nv">l</span> : label X),
        input_valid_transition l (
          s, iom) (sf, oom)
        ‚Üí P si sf
            (tr ++
             [{|
                l := l;
                input := iom;
                destination := sf;
                output := oom
              |}])</span></span></span><br><span><var>si, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to si s tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (sf, oom)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop si</span></span></span><br><span><var>IHHtr</var><span class="hyp-type"><b>: </b><span>initial_state_prop si ‚Üí P si s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P si sf
  (tr ++
   [{|
      l := l0;
      input := iom;
      destination := sf;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> Hextend <span class="kr">with</span> s; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  An inductive valid trace property which also identifies the final message.

<div class="paragraph"> </div>

  As shown by the <span class="inlinecode"><span class="id" title="var">finite_valid_trace_init_to_emit_valid_state_message</span></span>  and
  <span class="inlinecode"><span class="id" title="var">finite_valid_trace_init_to_emit_valid_state_message_rev</span></span> lemmas below, this definition
  is the trace-equivalent of the <span class="inlinecode"><span class="id" title="var">valid_state_message_prop</span></span>erty.

<div class="paragraph"> </div>

  This inductive property is reflecting that fact that a that <code>valid_state_message_prop (s, om)</code>
  holds only if <code>s</code> and <code>om</code> are the final state and output of an initial valid
  trace, or a pair of an initial state and option-initial message.
  It follows the inductive structure of <code>valid_state_message_prop</code>, but augments every
  branch of the tree with such an exhibiting trace.

<div class="paragraph"> </div>

  Its main benefit is that when performing induction over it, one can also use the
  induction hypothesis for the (trace generating the) message being received.

<div class="paragraph"> </div>

  Although this definition could be used directly, we prefer to use it to derive
  a stronger induction principle (<span class="inlinecode"><span class="id" title="var">finite_valid_trace_init_to_rev_strong_ind</span></span>)
  over <span class="inlinecode"><span class="id" title="var">finite_valid_trace_init_to</span></span> traces.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">finite_valid_trace_init_to_emit</span>
  : state X -&gt; state X -&gt; option message -&gt; list (transition_item X) -&gt; <span class="kt">Prop</span> :=
| finite_valid_trace_init_to_emit_empty :
    <span class="kr">forall</span> (<span class="nv">is</span> : state X) (<span class="nv">om</span> : option message)
      (<span class="nv">His</span> : initial_state_prop X <span class="kr">is</span>)
      (<span class="nv">Him</span> : option_initial_message_prop X om),
        finite_valid_trace_init_to_emit <span class="kr">is</span> <span class="kr">is</span> om []
| finite_valid_trace_init_to_emit_extend :
    <span class="kr">forall</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">_om</span> : option message) (<span class="nv">tl</span> : list (transition_item X))
      (<span class="nv">Hs</span> : finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl)
      (<span class="nv">iom_is</span> <span class="nv">iom_s</span> : state X) (<span class="nv">iom</span> : option message) (<span class="nv">iom_tl</span> : list (transition_item X))
      (<span class="nv">Hiom</span> : finite_valid_trace_init_to_emit iom_is iom_s iom iom_tl)
      (<span class="nv">l</span> : label X)
      (<span class="nv">Hv</span> : valid X l (s, iom))
      (<span class="nv">s&#39;</span> : state X) (<span class="nv">oom</span> : option message)
      (<span class="nv">Ht</span> : transition X l (s, iom) = (s&#39;, oom)),
        finite_valid_trace_init_to_emit <span class="kr">is</span> s&#39; oom (tl ++ [Build_transition_item l iom s&#39; oom]).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk20f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk20f"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_emit_initial_state</span>
  (<span class="nv">is</span> <span class="nv">f</span> : state X) (<span class="nv">om</span> : option message) (<span class="nv">tl</span> : list (transition_item X))
  (<span class="nv">Htl</span> : finite_valid_trace_init_to_emit <span class="kr">is</span> f om tl) :
    initial_state_prop X <span class="kr">is</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> f om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop <span class="kr">is</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk210" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk210"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> f om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop <span class="kr">is</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">induction</span> Htl.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  A property characterizing the "emit" message of <span class="inlinecode"><span class="id" title="var">finite_valid_trace_init_to_emit</span></span>.

<div class="paragraph"> </div>

  There are two cases: (1) either the trace is empty, and then we require
  the message to be initial; or (2) the trace is not empty, and the message
  is the output of the last transition.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk211" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk211"><span class="kn">Definition</span> <span class="nf">empty_initial_message_or_final_output</span>
  (<span class="nv">tl</span> : list (transition_item X)) (<span class="nv">om</span> : option message) : <span class="kt">Prop</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">Prop</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk212" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk212"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">Prop</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk213" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk213"><span class="nb">destruct</span> (has_last_or_null tl) <span class="kr">as</span> [[_ [item _]] | _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">Prop</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk214" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk214"><hr></label><div class="goal-conclusion"><span class="kt">Prop</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk215" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk215">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">Prop</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (output item  = om).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk216" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk216">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">Prop</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (option_initial_message_prop X om).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Defined</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk217" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk217"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_emit_output</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">om</span> : option message) (<span class="nv">tl</span> : list transition_item)
  (<span class="nv">Htl</span> : finite_valid_trace_init_to_emit s f om tl) :
    empty_initial_message_or_final_output tl om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">empty_initial_message_or_final_output tl om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk218" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk218"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">empty_initial_message_or_final_output tl om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk219" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk219"><span class="nb">unfold</span> empty_initial_message_or_final_output.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">match</span> has_last_or_null tl <span class="kr">with</span>
| inleft (existT x (x0 ‚Üæ _)) =&gt; output x0 = om
| inright _ =&gt; option_initial_message_prop X om
<span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk21a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk21a">destruct_list_last tl tl&#39; item Heqtl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om []</span></span></span><br><span><var>Heqtl</var><span class="hyp-type"><b>: </b><span>tl = []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_initial_message_prop X om</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk21b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl, tl'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om
  (tl&#39; ++ [item])</span></span></span><br><span><var>Heqtl</var><span class="hyp-type"><b>: </b><span>tl = tl&#39; ++ [item]</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk21b"><hr></label><div class="goal-conclusion">output item = om</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk21c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk21c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om []</span></span></span><br><span><var>Heqtl</var><span class="hyp-type"><b>: </b><span>tl = []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_initial_message_prop X om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk21d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk21d"><span class="nb">inversion</span> Htl; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om []</span></span></span><br><span><var>Heqtl</var><span class="hyp-type"><b>: </b><span>tl = []</span></span></span><br><span><var>is, s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl0</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s s1 _om tl0</span></span></span><br><span><var>Hiom</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s1, iom)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s1, iom) = (f, om)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">is</span> = s</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>s&#39; = f</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>oom = om</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>tl0 ++
[{|
   l := l0;
   input := iom;
   destination := f;
   output := om
 |}] = []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">option_initial_message_prop X om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> tl0; <span class="nb">simpl</span> <span class="kr">in</span> *; <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk21e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk21e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl, tl'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om
  (tl&#39; ++ [item])</span></span></span><br><span><var>Heqtl</var><span class="hyp-type"><b>: </b><span>tl = tl&#39; ++ [item]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">output item = om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk21f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk21f"><span class="nb">rewrite</span> &lt;- Heqtl <span class="kr">in</span> Htl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl, tl'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om tl</span></span></span><br><span><var>Heqtl</var><span class="hyp-type"><b>: </b><span>tl = tl&#39; ++ [item]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">output item = om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk220" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk220"><span class="nb">inversion</span> Htl; [<span class="bp">by</span> <span class="nb">destruct</span> tl&#39;; <span class="nb">simpl</span> <span class="kr">in</span> *; <span class="bp">congruence</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl, tl'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om tl</span></span></span><br><span><var>Heqtl</var><span class="hyp-type"><b>: </b><span>tl = tl&#39; ++ [item]</span></span></span><br><span><var>is, s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl0</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s s1 _om tl0</span></span></span><br><span><var>Hiom</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s1, iom)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s1, iom) = (f, om)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">is</span> = s</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>s&#39; = f</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>oom = om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>tl0 ++
[{|
   l := l0;
   input := iom;
   destination := f;
   output := om
 |}] = tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">output item = om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk221" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk221"><span class="nb">revert</span> Heqtl; <span class="nb">subst</span>; <span class="nb">intro</span> Heqtl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tl0</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om
  (tl0 ++
   [{|
      l := l0;
      input := iom;
      destination := f;
      output := om
    |}])</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s s1 _om tl0</span></span></span><br><span><var>Hiom</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s1, iom)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s1, iom) = (f, om)</span></span></span><br><span><var>Heqtl</var><span class="hyp-type"><b>: </b><span>tl0 ++
[{|
   l := l0;
   input := iom;
   destination := f;
   output := om
 |}] = tl&#39; ++ [item]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">output item = om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> app_inj_tail, proj2 <span class="kr">in</span> Heqtl; <span class="nb">subst</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk222" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk222"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_emit_valid_state_message</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">om</span> : option message) (<span class="nv">tl</span> : list transition_item)
  (<span class="nv">Htl</span> : finite_valid_trace_init_to_emit s f om tl) :
    valid_state_message_prop f om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop f om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk223" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk223"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop f om</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk224" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk224"><span class="nb">induction</span> Htl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop <span class="kr">is</span> om</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk225" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtl1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>IHHtl2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop iom_s iom</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk225"><hr></label><div class="goal-conclusion">valid_state_message_prop s&#39; oom</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk226" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk226">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop <span class="kr">is</span> om</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_initial_state_message.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk227" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk227">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtl1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>IHHtl2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop iom_s iom</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_message_prop s&#39; oom</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_generated_state_message <span class="kr">with</span> s _om iom_s iom l0.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk228" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk228"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_emit_valid_state_message_rev</span>
  (<span class="nv">sf</span> : state X) (<span class="nv">om</span> : option message)
  (<span class="nv">Hp</span> : valid_state_message_prop sf om) :
    <span class="kr">exists</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item),
      finite_valid_trace_init_to_emit s sf om tl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop sf om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s sf om tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk229" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk229"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop sf om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s sf om tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk22a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk22a"><span class="nb">induction</span> Hp.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s0</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s0 s om tl</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk22b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHHp1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">s0</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s0 s _om tl</span></span></span><br><span><var>IHHp2</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s _s om tl</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk22b"><hr></label><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s s&#39; om&#39; tl</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk22c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk22c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s0</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s0 s om tl</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="nv">s</span>, []; <span class="nb">constructor</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk22d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk22d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>IHHp1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">s0</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s0 s _om tl</span></span></span><br><span><var>IHHp2</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s _s om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s s&#39; om&#39; tl</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk22e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk22e"><span class="nb">destruct</span> IHHp1 <span class="kr">as</span> [<span class="kr">is</span> [tl Hs]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>IHHp2</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s _s om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s s&#39; om&#39; tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk22f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk22f"><span class="nb">destruct</span> IHHp2 <span class="kr">as</span> [om_is [om_tl Hom]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>om_is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit om_is _s om
  om_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : list transition_item),
  finite_valid_trace_init_to_emit s s&#39; om&#39; tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk230" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk230"><span class="kp">do</span> <span class="mi">2</span> <span class="nb">eexists</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s om</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>om_is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hom</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit om_is _s om
  om_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_emit <span class="nl">?s</span> s&#39; om&#39; <span class="nl">?tl</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eapply</span> finite_valid_trace_init_to_emit_extend; <span class="nb">cycle</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk231" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk231"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_emit_forget_emit</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">_om</span> : option message) (<span class="nv">tl</span> : list transition_item)
  (<span class="nv">Htl</span> : finite_valid_trace_init_to_emit s f _om tl) :
    finite_valid_trace_init_to s f tl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f _om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to s f tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk232" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk232"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f _om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to s f tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk233" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk233"><span class="nb">apply</span> finite_valid_trace_init_to_emit_initial_state <span class="kr">in</span> Htl <span class="kr">as</span> Hinit.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f _om tl</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to s f tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk234" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk234"><span class="nb">split</span>; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f _om tl</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk235" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk235"><span class="nb">clear</span> Hinit.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit s f _om tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s f tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk236" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk236"><span class="nb">induction</span> Htl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to <span class="kr">is</span> <span class="kr">is</span> []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk237" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to iom_is iom_s
  iom_tl</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk237"><hr></label><div class="goal-conclusion">finite_valid_trace_from_to <span class="kr">is</span> s&#39;
  (tl ++
   [{|
      l := l0;
      input := iom;
      destination := s&#39;;
      output := oom
    |}])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk238" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk238">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to <span class="kr">is</span> <span class="kr">is</span> []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>; <span class="nb">apply</span> initial_state_is_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk239" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk239">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to iom_is iom_s
  iom_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to <span class="kr">is</span> s&#39;
  (tl ++
   [{|
      l := l0;
      input := iom;
      destination := s&#39;;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk23a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk23a"><span class="nb">apply</span> finite_valid_trace_from_to_app <span class="kr">with</span> s; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to iom_is iom_s
  iom_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s s&#39;
  [{|
     l := l0;
     input := iom;
     destination := s&#39;;
     output := oom
   |}]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk23b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk23b"><span class="nb">apply</span> finite_valid_trace_from_to_singleton.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to iom_is iom_s
  iom_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (s, iom) (s&#39;, oom)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk23c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk23c"><span class="nb">apply</span> finite_valid_trace_init_to_emit_valid_state_message <span class="kr">in</span> Htl1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to iom_is iom_s
  iom_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (s, iom) (s&#39;, oom)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk23d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk23d"><span class="nb">apply</span> finite_valid_trace_init_to_emit_valid_state_message <span class="kr">in</span> Htl2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop iom_s iom</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtl1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtl2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to iom_is iom_s
  iom_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (s, iom) (s&#39;, oom)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">firstorder</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk23e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk23e"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_add_emit</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tl</span> : list transition_item)
  (<span class="nv">Htl</span> : finite_valid_trace_init_to s f tl) :
    finite_valid_trace_init_to_emit s f (finite_trace_last_output tl) tl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to s f tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_emit s f
  (finite_trace_last_output tl) tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk23f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk23f"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to s f tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_emit s f
  (finite_trace_last_output tl) tl</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk240" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk240"><span class="nb">induction</span> Htl <span class="nb">using</span> finite_valid_trace_init_to_rev_ind; [<span class="bp">by</span> <span class="nb">constructor</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to si s tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (sf, oom)</span></span></span><br><span><var>IHHtl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit si s
  (finite_trace_last_output tr) tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_emit si sf
  (finite_trace_last_output
     (tr ++
      [{|
         l := l0;
         input := iom;
         destination := sf;
         output := oom
       |}]))
  (tr ++
   [{|
      l := l0;
      input := iom;
      destination := sf;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk241" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk241"><span class="nb">rewrite</span> finite_trace_last_output_is_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to si s tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (sf, oom)</span></span></span><br><span><var>IHHtl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit si s
  (finite_trace_last_output tr) tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_emit si sf
  (output
     {|
       l := l0;
       input := iom;
       destination := sf;
       output := oom
     |})
  (tr ++
   [{|
      l := l0;
      input := iom;
      destination := sf;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk242" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk242"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to si s tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (sf, oom)</span></span></span><br><span><var>IHHtl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit si s
  (finite_trace_last_output tr) tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_emit si sf oom
  (tr ++
   [{|
      l := l0;
      input := iom;
      destination := sf;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk243" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk243"><span class="nb">destruct</span> Ht <span class="kr">as</span> [[_ [[_s Hiom] Hv]] Ht].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to si s tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hiom</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s iom</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (sf, oom)</span></span></span><br><span><var>IHHtl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit si s
  (finite_trace_last_output tr) tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_emit si sf oom
  (tr ++
   [{|
      l := l0;
      input := iom;
      destination := sf;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk244" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk244"><span class="nb">destruct</span> (finite_valid_trace_init_to_emit_valid_state_message_rev _ _ Hiom)
    <span class="kr">as</span> [iom_s [iom_tr Hiom_tr]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>si, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to si s tr</span></span></span><br><span><var>sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hiom</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop _s iom</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (sf, oom)</span></span></span><br><span><var>IHHtl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit si s
  (finite_trace_last_output tr) tr</span></span></span><br><span><var>iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hiom_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_s _s iom
  iom_tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_emit si sf oom
  (tr ++
   [{|
      l := l0;
      input := iom;
      destination := sf;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (finite_valid_trace_init_to_emit_extend _ _ _ _ IHHtl _ _ _ _ Hiom_tr _ Hv _ _ Ht).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  Inspired by <span class="inlinecode"><span class="id" title="var">finite_valid_trace_init_to_add_emit</span></span>, we can derive
  an induction principle for <span class="inlinecode"><span class="id" title="var">finite_valid_trace_init_to</span></span> stronger than
  <span class="inlinecode"><span class="id" title="var">finite_valid_trace_init_to_rev_ind</span></span>, which allows the induction hypothesis
  to be used for the trace generating the message received in the last transition.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk245" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk245"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_rev_strong_ind</span>
  (<span class="nv">P</span> : state X -&gt; state X -&gt; list (transition_item X) -&gt; <span class="kt">Prop</span>)
  (<span class="nv">Hempty</span> : <span class="kr">forall</span> (<span class="nv">is</span> : state X) (<span class="nv">His</span> : initial_state_prop X <span class="kr">is</span>), P <span class="kr">is</span> <span class="kr">is</span> nil)
  (<span class="nv">Hextend</span> : <span class="kr">forall</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item)
    (<span class="nv">IHs</span> : P <span class="kr">is</span> s tr)
    (<span class="nv">Hs</span> : finite_valid_trace_init_to <span class="kr">is</span> s tr)
    <span class="nv">iom</span> <span class="nv">iom_si</span> <span class="nv">iom_s</span> <span class="nv">iom_tr</span>
    (<span class="nv">Heqiom</span> : empty_initial_message_or_final_output iom_tr iom)
    (<span class="nv">IHiom</span> : P iom_si iom_s iom_tr)
    (<span class="nv">Hiom</span> : finite_valid_trace_init_to iom_si iom_s iom_tr)
    (<span class="nv">sf</span> : state X) (<span class="nv">oom</span> : option message) (<span class="nv">l</span> : label X)
    (<span class="nv">Ht</span> : input_valid_transition l (s, iom) (sf, oom)),
      P <span class="kr">is</span> sf (tr ++ [Build_transition_item l iom sf oom])) :
  <span class="kr">forall</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_init_to si sf tr -&gt;
    P si sf tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to si sf tr ‚Üí P si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk246" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk246"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">si</span> <span class="nv">sf</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to si sf tr ‚Üí P si sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk247" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk247"><span class="nb">intros</span> <span class="kr">is</span> sf tr Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to <span class="kr">is</span> sf tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk248" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk248"><span class="nb">apply</span> finite_valid_trace_init_to_add_emit <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> sf
  (finite_trace_last_output tr) tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk249" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk249"><span class="nb">remember</span> (finite_trace_last_output tr) <span class="kr">as</span> om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Heqom</var><span class="hyp-type"><b>: </b><span>om = finite_trace_last_output tr</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> sf om tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> sf tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk24a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk24a"><span class="nb">clear</span> Heqom.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, sf</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> sf om tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> sf tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk24b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk24b"><span class="nb">induction</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> <span class="kr">is</span> []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk24c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk24c"><hr></label><div class="goal-conclusion">P <span class="kr">is</span> s&#39;
  (tl ++
   [{|
      l := l0;
      input := iom;
      destination := s&#39;;
      output := oom
    |}])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk24d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk24d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br><span><var>Him</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> <span class="kr">is</span> []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> Hempty.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk24e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk24e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> s&#39;
  (tl ++
   [{|
      l := l0;
      input := iom;
      destination := s&#39;;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk24f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk24f"><span class="nb">assert</span> (Hivt : input_valid_transition l0 (s, iom) (s&#39;, oom)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (s, iom) (s&#39;, oom)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk250" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br><span><var>Hivt</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s&#39;, oom)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk250"><hr></label><div class="goal-conclusion">P <span class="kr">is</span> s&#39;
  (tl ++
   [{|
      l := l0;
      input := iom;
      destination := s&#39;;
      output := oom
    |}])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk251" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk251">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (s, iom) (s&#39;, oom)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk252" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk252"><span class="nb">apply</span> finite_valid_trace_init_to_emit_valid_state_message <span class="kr">in</span> Htr1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (s, iom) (s&#39;, oom)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk253" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk253"><span class="nb">apply</span> finite_valid_trace_init_to_emit_valid_state_message <span class="kr">in</span> Htr2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop iom_s iom</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (s, iom) (s&#39;, oom)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">firstorder</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk254" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk254">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br><span><var>Hivt</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s&#39;, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> s&#39;
  (tl ++
   [{|
      l := l0;
      input := iom;
      destination := s&#39;;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk255" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk255"><span class="nb">apply</span> finite_valid_trace_init_to_emit_output <span class="kr">in</span> Htr2 <span class="kr">as</span> Houtput.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s _om tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br><span><var>Hivt</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s&#39;, oom)</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>empty_initial_message_or_final_output iom_tl
  iom</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> s&#39;
  (tl ++
   [{|
      l := l0;
      input := iom;
      destination := s&#39;;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk256" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk256"><span class="nb">apply</span> finite_valid_trace_init_to_emit_forget_emit <span class="kr">in</span> Htr1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to <span class="kr">is</span> s tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br><span><var>Hivt</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s&#39;, oom)</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>empty_initial_message_or_final_output iom_tl
  iom</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> s&#39;
  (tl ++
   [{|
      l := l0;
      input := iom;
      destination := s&#39;;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk257" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk257"><span class="nb">apply</span> finite_valid_trace_init_to_emit_forget_emit <span class="kr">in</span> Htr2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hempty</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  initial_state_prop <span class="kr">is</span> ‚Üí P <span class="kr">is</span> <span class="kr">is</span> []</span></span></span><br><span><var>Hextend</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : 
                    list transition_item),
  P <span class="kr">is</span> s tr
  ‚Üí finite_valid_trace_init_to <span class="kr">is</span> s tr
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) 
        (<span class="nv">iom_si</span> <span class="nv">iom_s</span> : 
         state X) (<span class="nv">iom_tr</span> : 
                   list transition_item),
        empty_initial_message_or_final_output
          iom_tr iom
        ‚Üí P iom_si iom_s iom_tr
          ‚Üí finite_valid_trace_init_to
              iom_si iom_s iom_tr
            ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sf</span> : state X) 
                (<span class="nv">oom</span> : 
                 option message) 
                (<span class="nv">l</span> : label X),
                input_valid_transition l
                  (s, iom) (
                  sf, oom)
                ‚Üí P <span class="kr">is</span> sf
                    (tr ++
                     [{|
                      l := l;
                      input := iom;
                      destination := sf;
                      output := oom
                      |}])</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr1</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to <span class="kr">is</span> s tl</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr2</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to iom_is iom_s iom_tl</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s, iom)</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s, iom) = (s&#39;, oom)</span></span></span><br><span><var>IHHtr1</var><span class="hyp-type"><b>: </b><span>P <span class="kr">is</span> s tl</span></span></span><br><span><var>IHHtr2</var><span class="hyp-type"><b>: </b><span>P iom_is iom_s iom_tl</span></span></span><br><span><var>Hivt</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s&#39;, oom)</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>empty_initial_message_or_final_output iom_tl
  iom</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P <span class="kr">is</span> s&#39;
  (tl ++
   [{|
      l := l0;
      input := iom;
      destination := s&#39;;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (Hextend _ _ _ IHHtr1 Htr1 _ _ _ _ Houtput IHHtr2 Htr2 _ _ _ Hivt).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab13"></a><h3 class="section">Infinite protocol traces</h3>
<div class="paragraph"> </div>

  We now define <span class="inlinecode"><span class="id" title="var">infinite_valid_trace</span></span>s. The definitions
  resemble their finite counterparts, adapted to the technical
  necessities of defining infinite objects. Notably, <code>steps</code> is
  stored as a stream, as opposed to a list.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">CoInductive</span> <span class="nf">infinite_valid_trace_from</span> :
  state X -&gt; Stream transition_item -&gt; <span class="kt">Prop</span> :=
| infinite_valid_trace_from_extend :
    <span class="kr">forall</span> (<span class="nv">s</span> : state X) (<span class="nv">tl</span> : Stream transition_item)
      (<span class="nv">Htl</span> : infinite_valid_trace_from s tl)
      (<span class="nv">s&#39;</span> : state X) (<span class="nv">iom</span> <span class="nv">oom</span> : option message) (<span class="nv">l</span> : label X)
      (<span class="nv">Ht</span> : input_valid_transition l (s&#39;, iom) (s, oom)),
        infinite_valid_trace_from  s&#39; (Cons (Build_transition_item l iom s oom) tl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">infinite_valid_trace</span> (<span class="nv">s</span> : state X) (<span class="nv">st</span> : Stream (transition_item X)) : <span class="kt">Prop</span> :=
  infinite_valid_trace_from s st /\ initial_state_prop X s.</span></span></pre><div class="doc">
  As for the finite case, the following lemmas help decompose teh above
  definitions, mostly reducing them to properties about their finite segments.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk258" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk258"><span class="kn">Lemma</span> <span class="nf">infinite_valid_trace_consecutive_valid_transition</span>
  (<span class="nv">is</span> : state X)
  (<span class="nv">tr</span> <span class="nv">tr2</span> : Stream transition_item)
  (<span class="nv">tr1</span> : list transition_item)
  (<span class="nv">te1</span> <span class="nv">te2</span> : transition_item)
  (<span class="nv">Htr</span> : infinite_valid_trace_from <span class="kr">is</span> tr)
  (<span class="nv">Heq</span> : tr = stream_app (tr1 ++ [te1; te2]) tr2) :
    input_valid_transition (l te2) (destination te1, input te2) (destination te2, output te2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>tr1</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from <span class="kr">is</span> tr</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = stream_app (tr1 ++ [te1; te2]) tr2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te2)
  (destination te1, input te2)
  (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk259" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk259"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>tr1</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from <span class="kr">is</span> tr</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = stream_app (tr1 ++ [te1; te2]) tr2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te2)
  (destination te1, input te2)
  (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk25a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk25a"><span class="nb">generalize dependent</span> <span class="kr">is</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr, tr2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>tr1</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = stream_app (tr1 ++ [te1; te2]) tr2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  infinite_valid_trace_from <span class="kr">is</span> tr
  ‚Üí input_valid_transition (l te2)
      (destination te1, input te2)
      (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk25b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk25b"><span class="nb">generalize dependent</span> tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>tr1</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Stream transition_item,
  tr = stream_app (tr1 ++ [te1; te2]) tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
      infinite_valid_trace_from <span class="kr">is</span> tr
      ‚Üí input_valid_transition (l te2)
          (destination te1, input te2)
          (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk25c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk25c"><span class="nb">induction</span> tr1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Stream transition_item,
  tr = stream_app ([] ++ [te1; te2]) tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
      infinite_valid_trace_from <span class="kr">is</span> tr
      ‚Üí input_valid_transition (l te2)
          (destination te1, input te2)
          (destination te2, output te2)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk25d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr1</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Stream transition_item,
  tr = stream_app (tr1 ++ [te1; te2]) tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
      infinite_valid_trace_from <span class="kr">is</span> tr
      ‚Üí input_valid_transition 
          (l te2) (destination te1, input te2)
          (destination te2, output te2)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk25d"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Stream transition_item,
  tr = stream_app ((a :: tr1) ++ [te1; te2]) tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
      infinite_valid_trace_from <span class="kr">is</span> tr
      ‚Üí input_valid_transition 
          (l te2) (destination te1, input te2)
          (destination te2, output te2)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk25e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk25e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Stream transition_item,
  tr = stream_app ([] ++ [te1; te2]) tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
      infinite_valid_trace_from <span class="kr">is</span> tr
      ‚Üí input_valid_transition (l te2)
          (destination te1, input te2)
          (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">cbn</span>; <span class="nb">intros</span> tr -&gt; <span class="kr">is</span> Htr; <span class="nb">inversion</span> Htr; <span class="nb">inversion</span> Htl; <span class="nb">subst</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk25f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk25f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr1</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Stream transition_item,
  tr = stream_app (tr1 ++ [te1; te2]) tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
      infinite_valid_trace_from <span class="kr">is</span> tr
      ‚Üí input_valid_transition 
          (l te2) (destination te1, input te2)
          (destination te2, output te2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Stream transition_item,
  tr = stream_app ((a :: tr1) ++ [te1; te2]) tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
      infinite_valid_trace_from <span class="kr">is</span> tr
      ‚Üí input_valid_transition (l te2)
          (destination te1, input te2)
          (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk260" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk260"><span class="nb">specialize</span> (IHtr1 (stream_app (tr1 ++ [te1; te2]) tr2) eq_refl).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr1</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  infinite_valid_trace_from <span class="kr">is</span>
    (stream_app (tr1 ++ [te1; te2]) tr2)
  ‚Üí input_valid_transition 
      (l te2) (destination te1, input te2)
      (destination te2, output te2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Stream transition_item,
  tr = stream_app ((a :: tr1) ++ [te1; te2]) tr2
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
      infinite_valid_trace_from <span class="kr">is</span> tr
      ‚Üí input_valid_transition (l te2)
          (destination te1, input te2)
          (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk261" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk261"><span class="nb">intros</span> tr Heq <span class="kr">is</span> Htr; <span class="nb">subst</span>; <span class="nb">inversion</span> Htr; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>tr1</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>te1, te2</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">is</span> : state X,
  infinite_valid_trace_from <span class="kr">is</span>
    (stream_app (tr1 ++ [te1; te2]) tr2)
  ‚Üí input_valid_transition 
      (l te2) (destination te1, input te2)
      (destination te2, output te2)</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from <span class="kr">is</span>
  (stream_app
     (({|
         l := l0;
         input := iom;
         destination := s;
         output := oom
       |} :: tr1) ++ [te1; te2]) tr2)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app (tr1 ++ [te1; te2]) tr2)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (<span class="kr">is</span>, iom) (s, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition (l te2)
  (destination te1, input te2)
  (destination te2, output te2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (IHtr1 s Htl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk262" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk262"><span class="kn">Lemma</span> <span class="nf">infinite_valid_trace_from_app_iff</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">ls</span> : list transition_item)
  (<span class="nv">ls&#39;</span> : Stream transition_item)
  (<span class="nv">s&#39;</span> := finite_trace_last s ls) :
    finite_valid_trace_from s ls /\ infinite_valid_trace_from s&#39; ls&#39;
      &lt;-&gt;
    infinite_valid_trace_from s (stream_app ls ls&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s ls</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s ls
‚àß infinite_valid_trace_from s&#39; ls&#39;
‚Üî infinite_valid_trace_from s (stream_app ls ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk263" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk263"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s ls</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s ls
‚àß infinite_valid_trace_from s&#39; ls&#39;
‚Üî infinite_valid_trace_from s (stream_app ls ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk264" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk264"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s ls</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s ls
‚àß infinite_valid_trace_from s&#39; ls&#39;
‚Üî infinite_valid_trace_from s (stream_app ls ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk265" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk265"><span class="nb">generalize dependent</span> ls&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s ls</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">ls&#39;</span> : Stream transition_item,
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s (stream_app ls ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk266" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk266"><span class="nb">generalize dependent</span> s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) (<span class="nv">ls&#39;</span> : 
                                                Stream
                                                 transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s (stream_app ls ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk267" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk267"><span class="nb">induction</span> ls; <span class="nb">intros</span>; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s []</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s []
‚àß infinite_valid_trace_from s&#39; ls&#39;
‚Üí infinite_valid_trace_from s (stream_app [] ls&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk268" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s []</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk268"><hr></label><div class="goal-conclusion">infinite_valid_trace_from s (stream_app [] ls&#39;)
‚Üí finite_valid_trace_from s []
  ‚àß infinite_valid_trace_from s&#39; ls&#39;</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk269" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s (a :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk269"><hr></label><div class="goal-conclusion">finite_valid_trace_from s (a :: ls)
‚àß infinite_valid_trace_from s&#39; ls&#39;
‚Üí infinite_valid_trace_from s
    (stream_app (a :: ls) ls&#39;)</div></blockquote><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk26a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s (a :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk26a"><hr></label><div class="goal-conclusion">infinite_valid_trace_from s (stream_app (a :: ls) ls&#39;)
‚Üí finite_valid_trace_from s (a :: ls)
  ‚àß infinite_valid_trace_from s&#39; ls&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk26b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk26b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s []</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s []
‚àß infinite_valid_trace_from s&#39; ls&#39;
‚Üí infinite_valid_trace_from s (stream_app [] ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk26c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk26c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s []</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s (stream_app [] ls&#39;)
‚Üí finite_valid_trace_from s []
  ‚àß infinite_valid_trace_from s&#39; ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk26d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk26d"><span class="nb">simpl</span>; <span class="nb">intros</span> Hls&#39;; <span class="nb">split</span>; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s []</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Hls'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s []</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk26e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk26e"><span class="nb">constructor</span>; <span class="nb">inversion</span> Hls&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s []</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Hls'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls&#39;</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>s'0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s1 tl</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>s&#39;0 = s</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Cons
  {|
    l := l0;
    input := iom;
    destination := s1;
    output := oom
  |} tl = ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (input_valid_transition_origin Ht).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk26f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk26f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s (a :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (a :: ls)
‚àß infinite_valid_trace_from s&#39; ls&#39;
‚Üí infinite_valid_trace_from s
    (stream_app (a :: ls) ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk270" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk270"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s (a :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (a :: ls)
‚àß infinite_valid_trace_from s&#39; ls&#39;
‚Üí infinite_valid_trace_from s
    (Cons a (stream_app ls ls&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk271" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk271"><span class="nb">intros</span> [Htr Htr&#39;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s (a :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (a :: ls)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s&#39; ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s
  (Cons a (stream_app ls ls&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk272" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk272"><span class="nb">destruct</span> a.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s&#39; ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s
  (Cons
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |} (stream_app ls ls&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk273" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk273"><span class="nb">apply</span> infinite_valid_trace_from_extend.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s&#39; ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from destination0
  (stream_app ls ls&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk274" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s&#39; ls&#39;</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk274"><hr></label><div class="goal-conclusion">input_valid_transition l0 (
  s, input0) (destination0, output0)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk275" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk275">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s&#39; ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from destination0
  (stream_app ls ls&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk276" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk276"><span class="nb">apply</span> IHls.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s&#39; ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from destination0 ls
‚àß infinite_valid_trace_from
    (finite_trace_last destination0 ls) ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk277" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk277"><span class="nb">inversion</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s&#39; ls&#39;</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s'0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l1</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from destination0 ls</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (
  s, input0) (destination0, output0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>s&#39;0 = s</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>l1 = l0</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>iom = input0</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>s1 = destination0</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>oom = output0</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>tl = ls</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from destination0 ls
‚àß infinite_valid_trace_from
    (finite_trace_last destination0 ls) ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk278" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk278"><span class="nb">split</span>; [<span class="bp">by</span> <span class="nb">apply</span> Htl |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s&#39; ls&#39;</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s'0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l1</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from destination0 ls</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (
  s, input0) (destination0, output0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>s&#39;0 = s</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>l1 = l0</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>iom = input0</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>s1 = destination0</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>oom = output0</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>tl = ls</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from
  (finite_trace_last destination0 ls) ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk279" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk279"><span class="nb">unfold</span> s&#39; <span class="kr">in</span> Htr&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from
  (finite_trace_last s
     ({|
        l := l0;
        input := input0;
        destination := destination0;
        output := output0
      |} :: ls)) ls&#39;</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s'0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l1</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from destination0 ls</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (
  s, input0) (destination0, output0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>s&#39;0 = s</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>l1 = l0</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>iom = input0</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>s1 = destination0</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>oom = output0</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>tl = ls</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from
  (finite_trace_last destination0 ls) ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> finite_trace_last_cons <span class="kr">in</span> Htr&#39;.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk27a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk27a">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ({|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: ls)</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s&#39; ls&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (s, input0)
  (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> Htr; <span class="nb">apply</span> Ht.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk27b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk27b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s (a :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s (stream_app (a :: ls) ls&#39;)
‚Üí finite_valid_trace_from s (a :: ls)
  ‚àß infinite_valid_trace_from s&#39; ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk27c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk27c"><span class="nb">inversion</span> <span class="mi">1</span>; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s, s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app
     ({|
        l := l0;
        input := iom;
        destination := s1;
        output := oom
      |} :: ls) ls&#39;)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s1 (stream_app ls ls&#39;)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls) ‚àß infinite_valid_trace_from s&#39; ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk27d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk27d"><span class="nb">apply</span> (IHls s1 ls&#39;) <span class="kr">in</span> Htl <span class="kr">as</span> []; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s, s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app
     ({|
        l := l0;
        input := iom;
        destination := s1;
        output := oom
      |} :: ls) ls&#39;)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ls</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from
  (finite_trace_last s1 ls) ls&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk27e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s, s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app
     ({|
        l := l0;
        input := iom;
        destination := s1;
        output := oom
      |} :: ls) ls&#39;)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ls</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from
  (finite_trace_last s1 ls) ls&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk27e"><hr></label><div class="goal-conclusion">infinite_valid_trace_from s&#39; ls&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk27f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk27f">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s, s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app
     ({|
        l := l0;
        input := iom;
        destination := s1;
        output := oom
      |} :: ls) ls&#39;)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ls</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from
  (finite_trace_last s1 ls) ls&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk280" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk280">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">s&#39;</span> := finite_trace_last s ls) 
  (<span class="nv">ls&#39;</span> : Stream transition_item),
  finite_valid_trace_from s ls
  ‚àß infinite_valid_trace_from s&#39; ls&#39;
  ‚Üî infinite_valid_trace_from s
      (stream_app ls ls&#39;)</span></span></span><br><span><var>s, s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>finite_trace_last s
  ({|
     l := l0;
     input := iom;
     destination := s1;
     output := oom
   |} :: ls)</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br><span><var>ls'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app
     ({|
        l := l0;
        input := iom;
        destination := s1;
        output := oom
      |} :: ls) ls&#39;)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 ls</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from
  (finite_trace_last s1 ls) ls&#39;</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s&#39; ls&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">unfold</span> s&#39;; <span class="nb">rewrite</span> finite_trace_last_cons.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk281" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk281"><span class="kn">Lemma</span> <span class="nf">infinite_valid_trace_from_prefix</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">ls</span> : Stream transition_item)
  (<span class="nv">Htr</span> : infinite_valid_trace_from s ls)
  (<span class="nv">n</span> : nat) :
    finite_valid_trace_from s (stream_prefix ls n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (stream_prefix ls n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk282" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk282"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (stream_prefix ls n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk283" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk283"><span class="nb">specialize</span> (stream_prefix_suffix ls n); <span class="nb">intro</span> Hdecompose.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hdecompose</var><span class="hyp-type"><b>: </b><span>stream_app (stream_prefix ls n)
  (stream_suffix ls n) = ls</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (stream_prefix ls n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk284" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk284"><span class="nb">rewrite</span> &lt;- Hdecompose <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app (stream_prefix ls n)
     (stream_suffix ls n))</span></span></span><br><span><var>Hdecompose</var><span class="hyp-type"><b>: </b><span>stream_app (stream_prefix ls n)
  (stream_suffix ls n) = ls</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (stream_prefix ls n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> infinite_valid_trace_from_app_iff <span class="kr">in</span> Htr <span class="kr">as</span> [Hpr _].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk285" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk285"><span class="kn">Lemma</span> <span class="nf">infinite_valid_trace_from_prefix_rev</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">ls</span> : Stream transition_item)
  (<span class="nv">Hpref</span> : <span class="kr">forall</span> <span class="nv">n</span> : nat, finite_valid_trace_from s (stream_prefix ls n)) :
    infinite_valid_trace_from s ls.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
  finite_valid_trace_from s
    (stream_prefix ls n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s ls</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk286" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk286"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
  finite_valid_trace_from s
    (stream_prefix ls n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s ls</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk287" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk287"><span class="nb">revert</span> s ls Hpref.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : Stream transition_item),
  (<span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
     finite_valid_trace_from s (stream_prefix ls n))
  ‚Üí infinite_valid_trace_from s ls</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk288" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk288"><span class="kr">cofix</span> Hls.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Hls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : Stream transition_item),
  (<span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
     finite_valid_trace_from s
       (stream_prefix ls n))
  ‚Üí infinite_valid_trace_from s ls</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : Stream transition_item),
  (<span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
     finite_valid_trace_from s (stream_prefix ls n))
  ‚Üí infinite_valid_trace_from s ls</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk289" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk289"><span class="nb">intros</span> s (a, ls) Hpref.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Hls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : Stream transition_item),
  (<span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
     finite_valid_trace_from s
       (stream_prefix ls n))
  ‚Üí infinite_valid_trace_from s ls</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
  finite_valid_trace_from s
    (stream_prefix (Cons a ls) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s (Cons a ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk28a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk28a"><span class="nb">assert</span> (Hpref0 := Hpref <span class="mi">1</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Hls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : Stream transition_item),
  (<span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
     finite_valid_trace_from s
       (stream_prefix ls n))
  ‚Üí infinite_valid_trace_from s ls</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
  finite_valid_trace_from s
    (stream_prefix (Cons a ls) n)</span></span></span><br><span><var>Hpref0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (stream_prefix (Cons a ls) <span class="mi">1</span>)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s (Cons a ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk28b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk28b"><span class="nb">inversion</span> Hpref0; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Hls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : Stream transition_item),
  (<span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
     finite_valid_trace_from s
       (stream_prefix ls n))
  ‚Üí infinite_valid_trace_from s ls</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hpref0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (stream_prefix
     (Cons
        {|
          l := l0;
          input := iom;
          destination := s1;
          output := oom
        |} ls) <span class="mi">1</span>)</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
  finite_valid_trace_from s
    (stream_prefix
       (Cons
          {|
            l := l0;
            input := iom;
            destination := s1;
            output := oom
          |} ls) n)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s
  (Cons
     {|
       l := l0;
       input := iom;
       destination := s1;
       output := oom
     |} ls)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk28c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk28c"><span class="nb">constructor</span>; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Hls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : Stream transition_item),
  (<span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
     finite_valid_trace_from s
       (stream_prefix ls n))
  ‚Üí infinite_valid_trace_from s ls</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hpref0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (stream_prefix
     (Cons
        {|
          l := l0;
          input := iom;
          destination := s1;
          output := oom
        |} ls) <span class="mi">1</span>)</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
  finite_valid_trace_from s
    (stream_prefix
       (Cons
          {|
            l := l0;
            input := iom;
            destination := s1;
            output := oom
          |} ls) n)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s1 ls</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk28d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk28d"><span class="nb">apply</span> Hls.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Hls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : Stream transition_item),
  (<span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
     finite_valid_trace_from s
       (stream_prefix ls n))
  ‚Üí infinite_valid_trace_from s ls</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hpref0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (stream_prefix
     (Cons
        {|
          l := l0;
          input := iom;
          destination := s1;
          output := oom
        |} ls) <span class="mi">1</span>)</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
  finite_valid_trace_from s
    (stream_prefix
       (Cons
          {|
            l := l0;
            input := iom;
            destination := s1;
            output := oom
          |} ls) n)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
  finite_valid_trace_from s1 (stream_prefix ls n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk28e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk28e"><span class="nb">intro</span> n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Hls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : Stream transition_item),
  (<span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
     finite_valid_trace_from s
       (stream_prefix ls n))
  ‚Üí infinite_valid_trace_from s ls</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hpref0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (stream_prefix
     (Cons
        {|
          l := l0;
          input := iom;
          destination := s1;
          output := oom
        |} ls) <span class="mi">1</span>)</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
  finite_valid_trace_from s
    (stream_prefix
       (Cons
          {|
            l := l0;
            input := iom;
            destination := s1;
            output := oom
          |} ls) n)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s1 (stream_prefix ls n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk28f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk28f"><span class="nb">specialize</span> (Hpref (S n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Hls</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">ls</span> : Stream transition_item),
  (<span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
     finite_valid_trace_from s
       (stream_prefix ls n))
  ‚Üí infinite_valid_trace_from s ls</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hpref0</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (stream_prefix
     (Cons
        {|
          l := l0;
          input := iom;
          destination := s1;
          output := oom
        |} ls) <span class="mi">1</span>)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (stream_prefix
     (Cons
        {|
          l := l0;
          input := iom;
          destination := s1;
          output := oom
        |} ls) (S n))</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s1 []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s, iom) (s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s1 (stream_prefix ls n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> Hpref; <span class="nb">subst</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk290" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk290"><span class="kn">Lemma</span> <span class="nf">infinite_valid_trace_from_EqSt</span> :
  <span class="kr">forall</span> (<span class="nv">s</span> : state X) (<span class="nv">tl1</span> <span class="nv">tl2</span> : Stream transition_item),
    EqSt tl1 tl2 -&gt; infinite_valid_trace_from s tl1 -&gt; infinite_valid_trace_from s tl2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl1</span> <span class="nv">tl2</span> : Stream transition_item),
  EqSt tl1 tl2
  ‚Üí infinite_valid_trace_from s tl1
    ‚Üí infinite_valid_trace_from s tl2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk291" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk291"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : state X) (<span class="nv">tl1</span> <span class="nv">tl2</span> : Stream transition_item),
  EqSt tl1 tl2
  ‚Üí infinite_valid_trace_from s tl1
    ‚Üí infinite_valid_trace_from s tl2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk292" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk292"><span class="nb">intros</span> s tl1 tl2 Heq Htl1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl1, tl2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>EqSt tl1 tl2</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s tl1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">infinite_valid_trace_from s tl2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk293" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk293"><span class="nb">apply</span> infinite_valid_trace_from_prefix_rev.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl1, tl2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>EqSt tl1 tl2</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s tl1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">n</span> : nat,
  finite_valid_trace_from s (stream_prefix tl2 n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk294" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk294"><span class="nb">intro</span> n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl1, tl2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>EqSt tl1 tl2</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s tl1</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (stream_prefix tl2 n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk295" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk295"><span class="nb">rewrite</span> &lt;- (stream_prefix_EqSt _ _ Heq n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl1, tl2</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>EqSt tl1 tl2</span></span></span><br><span><var>Htl1</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s tl1</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (stream_prefix tl1 n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> infinite_valid_trace_from_prefix.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk296" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk296"><span class="kn">Lemma</span> <span class="nf">infinite_valid_trace_from_segment</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">ls</span> : Stream transition_item)
  (<span class="nv">Htr</span> : infinite_valid_trace_from s ls)
  (<span class="nv">n1</span> <span class="nv">n2</span> : nat)
  (<span class="nv">Hle</span> : n1 &lt;= n2)
  (<span class="nv">n1th</span> := Str_nth n1 (Cons s (Streams.map destination ls))) :
    finite_valid_trace_from n1th (stream_segment ls n1 n2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span><span class="hyp-body"><b>:= </b><span>Str_nth n1 (Cons s (map destination ls))</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from n1th (stream_segment ls n1 n2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk297" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk297"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span><span class="hyp-body"><b>:= </b><span>Str_nth n1 (Cons s (map destination ls))</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from n1th (stream_segment ls n1 n2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk298" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk298"><span class="nb">apply</span> finite_valid_trace_from_suffix <span class="kr">with</span> s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span><span class="hyp-body"><b>:= </b><span>Str_nth n1 (Cons s (map destination ls))</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (stream_prefix ls n2)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk299" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span><span class="hyp-body"><b>:= </b><span>Str_nth n1 (Cons s (map destination ls))</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk299"><hr></label><div class="goal-conclusion">finite_trace_nth s (stream_prefix ls n2) n1 =
Some n1th</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk29a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk29a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span><span class="hyp-body"><b>:= </b><span>Str_nth n1 (Cons s (map destination ls))</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (stream_prefix ls n2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> infinite_valid_trace_from_prefix.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk29b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk29b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span><span class="hyp-body"><b>:= </b><span>Str_nth n1 (Cons s (map destination ls))</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth s (stream_prefix ls n2) n1 =
Some n1th</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk29c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk29c"><span class="nb">destruct</span> n1; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>S n1 ‚â§ n2</span></span></span><br><span><var>n1th</var><span><span class="hyp-body"><b>:= </b><span>Str_nth (S n1) (Cons s (map destination ls))</span></span><span class="hyp-type"><b>: </b><span>state X</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth s (stream_prefix ls n2) (S n1) =
Some n1th</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk29d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk29d"><span class="nb">subst</span> n1th; <span class="nb">unfold</span> finite_trace_nth; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ls</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s ls</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>S n1 ‚â§ n2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nth_error (List.map destination (stream_prefix ls n2))
  n1 =
Some (Str_nth (S n1) (Cons s (map destination ls)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> stream_prefix_map, stream_prefix_nth.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab14"></a><h3 class="section">Valid traces</h3>
<div class="paragraph"> </div>

  Finally, we define <span class="inlinecode"><span class="id" title="var">Trace</span></span> as a sum-type of its finite/infinite variants.
  It inherits some previously introduced definitions, culminating with the
  <span class="inlinecode"><span class="id" title="var">valid_trace</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">valid_trace_from_prop</span> (<span class="nv">tr</span> : Trace) : <span class="kt">Prop</span> :=
  <span class="kr">match</span> tr <span class="kr">with</span>
  | Finite s ls =&gt; finite_valid_trace_from s ls
  | Infinite s sm =&gt; infinite_valid_trace_from s sm
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">valid_trace_prop</span> (<span class="nv">tr</span> : Trace) : <span class="kt">Prop</span> :=
  <span class="kr">match</span> tr <span class="kr">with</span>
  | Finite s ls =&gt; finite_valid_trace s ls
  | Infinite s sm =&gt; infinite_valid_trace s sm
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">valid_trace</span> : <span class="kt">Type</span> :=
  {tr : Trace | valid_trace_prop tr}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk29e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk29e"><span class="kn">Lemma</span> <span class="nf">valid_trace_from</span>
  (<span class="nv">tr</span> : Trace)
  (<span class="nv">Htr</span> : valid_trace_prop tr) :
    valid_trace_from_prop tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_from_prop tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk29f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk29f"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_from_prop tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> tr, Htr.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2a0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2a0"><span class="kn">Lemma</span> <span class="nf">valid_trace_initial</span>
  (<span class="nv">tr</span> : Trace)
  (<span class="nv">Htr</span> : valid_trace_prop tr) :
    initial_state_prop X (trace_first tr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop (trace_first tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2a1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2a1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop (trace_first tr)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> tr, Htr.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2a2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2a2"><span class="kn">Lemma</span> <span class="nf">valid_trace_from_iff</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : Trace),
    valid_trace_prop tr &lt;-&gt;
    valid_trace_from_prop tr /\ initial_state_prop X (trace_first tr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Trace,
  valid_trace_prop tr
  ‚Üî valid_trace_from_prop tr
    ‚àß initial_state_prop (trace_first tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2a3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2a3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Trace,
  valid_trace_prop tr
  ‚Üî valid_trace_from_prop tr
    ‚àß initial_state_prop (trace_first tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2a4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2a4"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop tr
‚Üí valid_trace_from_prop tr
  ‚àß initial_state_prop (trace_first tr)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk2a5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk2a5"><hr></label><div class="goal-conclusion">valid_trace_from_prop tr
‚àß initial_state_prop (trace_first tr)
‚Üí valid_trace_prop tr</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2a6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2a6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop tr
‚Üí valid_trace_from_prop tr
  ‚àß initial_state_prop (trace_first tr)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2a7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2a7"><span class="nb">intro</span> Htr; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_from_prop tr</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk2a8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk2a8"><hr></label><div class="goal-conclusion">initial_state_prop (trace_first tr)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2a9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2a9">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_from_prop tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_trace_from.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2aa" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2aa">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop (trace_first tr)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_trace_initial.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ab" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ab">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_from_prop tr
‚àß initial_state_prop (trace_first tr)
‚Üí valid_trace_prop tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> tr; <span class="nb">cbn</span>; <span class="nb">intros</span> [Htr Hinit].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  Having defined <span class="inlinecode"><span class="id" title="var">valid_trace</span></span>s, we now connect them to valid states
  and messages, in the following sense: for each state-message pair (<code>s</code>, <code>m</code>)
  that has the <span class="inlinecode"><span class="id" title="var">valid_state_message_prop</span></span>erty, there exists a <span class="inlinecode"><span class="id" title="var">valid_trace</span></span> which ends
  in <code>s</code> by outputting <code>m</code>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ac" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ac"><span class="kn">Lemma</span> <span class="nf">valid_state_message_has_trace</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">om</span> : option message)
  (<span class="nv">Hp</span> : valid_state_message_prop s om) :
    initial_state_prop X s /\ option_initial_message_prop X om
      \/
    <span class="kr">exists</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
      finite_valid_trace_init_to <span class="kr">is</span> s tr /\ finite_trace_last_output tr = om.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s
‚àß option_initial_message_prop X om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ad" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ad"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s
‚àß option_initial_message_prop X om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ae" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ae"><span class="nb">apply</span> finite_valid_trace_init_to_emit_valid_state_message_rev <span class="kr">in</span> Hp <span class="kr">as</span> [<span class="kr">is</span> [tr Htr]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s om tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s
‚àß option_initial_message_prop X om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2af" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2af"><span class="nb">apply</span> finite_valid_trace_init_to_emit_output <span class="kr">in</span> Htr <span class="kr">as</span> Houtput.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s om tr</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>empty_initial_message_or_final_output tr om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s
‚àß option_initial_message_prop X om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2b0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2b0"><span class="nb">unfold</span> empty_initial_message_or_final_output <span class="kr">in</span> Houtput.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s om tr</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span><span class="kr">match</span> has_last_or_null tr <span class="kr">with</span>
| inleft (existT x (x0 ‚Üæ _)) =&gt;
    output x0 = om
| inright _ =&gt;
    option_initial_message_prop X om
<span class="kr">end</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s
‚àß option_initial_message_prop X om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2b1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2b1">destruct_list_last tr tr&#39; item Heqtr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s om []</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = []</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s
‚àß option_initial_message_prop X om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = om)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk2b2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s om
  (tr&#39; ++ [item])</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = tr&#39; ++ [item]</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>output item = om</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk2b2"><hr></label><div class="goal-conclusion">initial_state_prop s
‚àß option_initial_message_prop X om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = om)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2b3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2b3">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s om []</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = []</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s
‚àß option_initial_message_prop X om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = om)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2b4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2b4"><span class="nb">left</span>; <span class="nb">split</span>; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s om []</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = []</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2b5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2b5"><span class="nb">inversion</span> Htr; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s om []</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = []</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>option_initial_message_prop X om</span></span></span><br><span><var>is0, s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>iom_is, iom_s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>iom_tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s1 _om tl</span></span></span><br><span><var>Hiom</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit iom_is iom_s
  iom iom_tl</span></span></span><br><span><var>Hv</var><span class="hyp-type"><b>: </b><span>valid l0 (s1, iom)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>transition l0 (s1, iom) = (s, om)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is0 = <span class="kr">is</span></span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>s&#39; = s</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>oom = om</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>tl ++
[{|
   l := l0;
   input := iom;
   destination := s;
   output := om
 |}] = []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> tl; <span class="nb">simpl</span> <span class="kr">in</span> *; <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2b6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2b6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to_emit <span class="kr">is</span> s om
  (tr&#39; ++ [item])</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = tr&#39; ++ [item]</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>output item = om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s
‚àß option_initial_message_prop X om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = om)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2b7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2b7"><span class="nb">apply</span> finite_valid_trace_init_to_emit_forget_emit <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to <span class="kr">is</span> s (tr&#39; ++ [item])</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = tr&#39; ++ [item]</span></span></span><br><span><var>Houtput</var><span class="hyp-type"><b>: </b><span>output item = om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop s
‚àß option_initial_message_prop X om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">right</span>; <span class="nb">eexists</span> _, _; <span class="nb">rewrite</span> finite_trace_last_output_is_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  Giving a trace for <span class="inlinecode"><span class="id" title="var">valid_state_prop</span></span> can be stated more
  simply than <span class="inlinecode"><span class="id" title="var">valid_state_message_has_trace</span></span>, because we don't need a
  disjunction because we are not making claims about <span class="inlinecode"><span class="id" title="var">output</span></span>
  messages.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2b8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2b8"><span class="kn">Lemma</span> <span class="nf">valid_state_has_trace</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">Hp</span> : valid_state_prop s) :
    <span class="kr">exists</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
      finite_valid_trace_init_to <span class="kr">is</span> s tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2b9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2b9"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ba" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ba"><span class="nb">destruct</span> Hp <span class="kr">as</span> [_om Hp].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_message_prop s _om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2bb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2bb"><span class="nb">apply</span> valid_state_message_has_trace <span class="kr">in</span> Hp.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>initial_state_prop s
‚àß option_initial_message_prop X _om
‚à® (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to <span class="kr">is</span> s tr
     ‚àß finite_trace_last_output tr = _om)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2bc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2bc"><span class="nb">destruct</span> Hp <span class="kr">as</span> [[Hinit _] | Htrace].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk2bd" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Htrace</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr
  ‚àß finite_trace_last_output tr = _om</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk2bd"><hr></label><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2be" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2be">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2bf" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2bf"><span class="kr">exists</span> <span class="nv">s</span>, [].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to s s []</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c0"><span class="nb">split</span>; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s s []</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c1"><span class="nb">constructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> initial_state_is_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c2">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Htrace</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr
  ‚àß finite_trace_last_output tr = _om</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> Htrace <span class="kr">as</span> [<span class="kr">is</span> [tr [Htr _]]]; <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
For any input valid transition there exists a valid trace ending in it. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c3"><span class="kn">Lemma</span> <span class="nf">exists_right_finite_trace_from</span>
  (<span class="nv">l</span> : label X) (<span class="nv">s1</span> : state X) (<span class="nv">iom</span> : option message) (<span class="nv">s2</span> : state X) (<span class="nv">oom</span> : option message)
  (<span class="nv">Ht</span> : input_valid_transition l (s1, iom) (s2, oom)) :
    <span class="kr">exists</span> (<span class="nv">s0</span> : state X) (<span class="nv">ts</span> : list transition_item),
      finite_valid_trace_init_to s0 s2 (ts ++ [Build_transition_item l iom s2 oom]) /\
      finite_trace_last s0 ts = s1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s1, iom) (s2, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s0</span> : state X) (<span class="nv">ts</span> : list transition_item),
  finite_valid_trace_init_to s0 s2
    (ts ++
     [{|
        l := l;
        input := iom;
        destination := s2;
        output := oom
      |}]) ‚àß finite_trace_last s0 ts = s1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c4"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s1, iom) (s2, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s0</span> : state X) (<span class="nv">ts</span> : list transition_item),
  finite_valid_trace_init_to s0 s2
    (ts ++
     [{|
        l := l;
        input := iom;
        destination := s2;
        output := oom
      |}]) ‚àß finite_trace_last s0 ts = s1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c5"><span class="nb">apply</span> input_valid_transition_origin <span class="kr">in</span> Ht <span class="kr">as</span> Hs1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s1, iom) (s2, oom)</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>valid_state_prop s1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s0</span> : state X) (<span class="nv">ts</span> : list transition_item),
  finite_valid_trace_init_to s0 s2
    (ts ++
     [{|
        l := l;
        input := iom;
        destination := s2;
        output := oom
      |}]) ‚àß finite_trace_last s0 ts = s1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c6"><span class="nb">apply</span> valid_state_has_trace <span class="kr">in</span> Hs1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s1, iom) (s2, oom)</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s1 tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s0</span> : state X) (<span class="nv">ts</span> : list transition_item),
  finite_valid_trace_init_to s0 s2
    (ts ++
     [{|
        l := l;
        input := iom;
        destination := s2;
        output := oom
      |}]) ‚àß finite_trace_last s0 ts = s1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c7"><span class="nb">destruct</span> Hs1 <span class="kr">as</span> [s0 [ts Hts]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s1, iom) (s2, oom)</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ts</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hts</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to s0 s1 ts</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">s0</span> : state X) (<span class="nv">ts</span> : list transition_item),
  finite_valid_trace_init_to s0 s2
    (ts ++
     [{|
        l := l;
        input := iom;
        destination := s2;
        output := oom
      |}]) ‚àß finite_trace_last s0 ts = s1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c8"><span class="kr">exists</span> <span class="nv">s0</span>, ts.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s1, iom) (s2, oom)</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ts</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hts</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to s0 s1 ts</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to s0 s2
  (ts ++
   [{|
      l := l;
      input := iom;
      destination := s2;
      output := oom
    |}]) ‚àß finite_trace_last s0 ts = s1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2c9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2c9"><span class="nb">destruct</span> Hts <span class="kr">as</span> [Hts Hinit].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s1, iom) (s2, oom)</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ts</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hts</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s0 s1 ts</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to s0 s2
  (ts ++
   [{|
      l := l;
      input := iom;
      destination := s2;
      output := oom
    |}]) ‚àß finite_trace_last s0 ts = s1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ca" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ca"><span class="kp">repeat</span> <span class="nb">split</span>; [| <span class="bp">done</span> | <span class="bp">by</span> <span class="nb">revert</span> Hts; <span class="nb">apply</span> finite_valid_trace_from_to_last].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s1, iom) (s2, oom)</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ts</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hts</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s0 s1 ts</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to s0 s2
  (ts ++
   [{|
      l := l;
      input := iom;
      destination := s2;
      output := oom
    |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2cb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2cb"><span class="nb">revert</span> Ht.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>ts</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hts</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s0 s1 ts</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l (s1, iom) (s2, oom)
‚Üí finite_valid_trace_from_to s0 s2
    (ts ++
     [{|
        l := l;
        input := iom;
        destination := s2;
        output := oom
      |}])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> extend_right_finite_trace_from_to.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2cc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2cc"><span class="kn">Lemma</span> <span class="nf">can_emit_has_trace</span> (<span class="nv">m</span> : message) :
  can_emit m -&gt;
  <span class="kr">exists</span> <span class="nv">is</span> <span class="nv">tr</span> <span class="nv">item</span>,
  finite_valid_trace <span class="kr">is</span> (tr ++ [item]) /\
  output item = Some m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_emit m
‚Üí <span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
    finite_valid_trace <span class="kr">is</span> (tr ++ [item])
    ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2cd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2cd"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_emit m
‚Üí <span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
    finite_valid_trace <span class="kr">is</span> (tr ++ [item])
    ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ce" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ce"><span class="nb">intros</span> [(s, im) [l [s&#39; Hm]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>im</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, im) (s&#39;, Some m)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace <span class="kr">is</span> (tr ++ [item])
  ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2cf" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2cf"><span class="nb">apply</span> exists_right_finite_trace_from <span class="kr">in</span> Hm <span class="kr">as</span> [<span class="kr">is</span> [tr [Htr _]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>im</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s', is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_init_to <span class="kr">is</span> s&#39;
  (tr ++
   [{|
      l := l;
      input := im;
      destination := s&#39;;
      output := Some m
    |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace <span class="kr">is</span> (tr ++ [item])
  ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d0"><span class="nb">apply</span> finite_valid_trace_init_to_forget_last <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>im</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s', is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace <span class="kr">is</span>
  (tr ++
   [{|
      l := l;
      input := im;
      destination := s&#39;;
      output := Some m
    |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace <span class="kr">is</span> (tr ++ [item])
  ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eexists</span> <span class="kr">is</span>, tr, _.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  Any trace with the <span class="inlinecode"><span class="id" title="var">finite_valid_trace_from</span></span> property can be completed
  (to the left) to start in an initial state.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d1"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_complete_left</span>
  (<span class="nv">s</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from s tr) :
    <span class="kr">exists</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
      finite_valid_trace <span class="kr">is</span> (trs ++ tr) /\
      finite_trace_last <span class="kr">is</span> trs = s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace <span class="kr">is</span> (trs ++ tr)
  ‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d2"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace <span class="kr">is</span> (trs ++ tr)
  ‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d3"><span class="nb">apply</span> finite_valid_trace_first_pstate <span class="kr">in</span> Htr <span class="kr">as</span> Hs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace <span class="kr">is</span> (trs ++ tr)
  ‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d4"><span class="nb">apply</span> valid_state_has_trace <span class="kr">in</span> Hs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace <span class="kr">is</span> (trs ++ tr)
  ‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d5"><span class="nb">destruct</span> Hs <span class="kr">as</span> [<span class="kr">is</span> [trs [Htrs His]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace <span class="kr">is</span> (trs ++ tr)
  ‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d6"><span class="kr">exists</span> <span class="nv">is</span>, trs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace <span class="kr">is</span> (trs ++ tr)
‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d7"><span class="nb">apply</span> finite_valid_trace_from_to_last <span class="kr">in</span> Htrs <span class="kr">as</span> Hlast.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>finite_trace_last <span class="kr">is</span> trs = s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace <span class="kr">is</span> (trs ++ tr)
‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d8"><span class="nb">rewrite</span> &lt;- Hlast <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last <span class="kr">is</span> trs) tr</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>finite_trace_last <span class="kr">is</span> trs = s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace <span class="kr">is</span> (trs ++ tr)
‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2d9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2d9"><span class="nb">apply</span> finite_valid_trace_from_to_forget_last <span class="kr">in</span> Htrs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (finite_trace_last <span class="kr">is</span> trs) tr</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from <span class="kr">is</span> trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br><span><var>Hlast</var><span class="hyp-type"><b>: </b><span>finite_trace_last <span class="kr">is</span> trs = s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace <span class="kr">is</span> (trs ++ tr)
‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">firstorder using</span> finite_valid_trace_from_app_iff.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  Any trace with the <span class="inlinecode"><span class="id" title="var">finite_valid_trace_from_to</span></span> property can be completed
  (to the left) to start in an initial state.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2da" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2da"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_complete_left</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X)
  (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from_to s f tr) :
    <span class="kr">exists</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
      finite_valid_trace_init_to <span class="kr">is</span> f (trs ++ tr) /\
      finite_trace_last <span class="kr">is</span> trs = s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> f (trs ++ tr)
  ‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2db" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2db"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> f (trs ++ tr)
  ‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2dc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2dc"><span class="nb">assert</span> (Hs : valid_state_prop s).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk2dd" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk2dd"><hr></label><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> f (trs ++ tr)
  ‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2de" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2de">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_forget_last,
      finite_valid_trace_first_pstate <span class="kr">in</span> Htr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2df" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2df">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> f (trs ++ tr)
  ‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2e0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2e0"><span class="nb">apply</span> valid_state_has_trace <span class="kr">in</span> Hs <span class="kr">as</span> (<span class="kr">is</span> &amp; trs &amp; Htrs &amp; His).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> f (trs ++ tr)
  ‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2e1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2e1"><span class="kr">exists</span> <span class="nv">is</span>, trs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to <span class="kr">is</span> f (trs ++ tr)
‚àß finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2e2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2e2"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to <span class="kr">is</span> f (trs ++ tr)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk2e3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk2e3"><hr></label><div class="goal-conclusion">finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2e4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2e4">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to <span class="kr">is</span> f (trs ++ tr)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2e5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2e5"><span class="nb">split</span>; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to <span class="kr">is</span> f (trs ++ tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_app <span class="kr">with</span> s.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2e6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2e6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tr</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s trs</span></span></span><br><span><var>His</var><span class="hyp-type"><b>: </b><span>initial_state_prop <span class="kr">is</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last <span class="kr">is</span> trs = s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_last <span class="kr">in</span> Htrs.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  Another benefit of defining traces is that we can succinctly
  describe indirect transitions between arbitrary pairs of states.

<div class="paragraph"> </div>

  We say that state <code>second</code> is in state <code>first</code>'s futures if
  there exists a finite (possibly empty) valid trace that begins
  with <code>first</code> and ends in <code>second</code>.

<div class="paragraph"> </div>

  This relation is often used in stating safety and liveness properties.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">in_futures</span> (<span class="nv">first</span> <span class="nv">second</span> : state X) : <span class="kt">Prop</span> :=
  <span class="kr">exists</span> (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_from_to <span class="kp">first</span> second tr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2e7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2e7"><span class="kn">Lemma</span> <span class="nf">in_futures_preserving</span>
  (<span class="nv">R</span> : state X -&gt; state X -&gt; <span class="kt">Prop</span>)
  (<span class="nv">Hpre</span> : PreOrder R)
  (<span class="nv">Ht</span> : input_valid_transition_preserving R)
  (<span class="nv">s1</span> <span class="nv">s2</span> : state X)
  (<span class="nv">Hin</span> : in_futures s1 s2) :
    R s1 s2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder R</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2e8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2e8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder R</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2e9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2e9"><span class="nb">unfold</span> in_futures <span class="kr">in</span> Hin.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder R</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> <span class="nv">tr</span> : list transition_item,
  finite_valid_trace_from_to s1 s2 tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ea" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ea"><span class="nb">destruct</span> Hin <span class="kr">as</span> [tr Htr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder R</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s1 s2 tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2eb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2eb"><span class="nb">induction</span> Htr; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder R</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s f tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht0</var><span class="hyp-type"><b>: </b><span>input_valid_transition l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>IHHtr</var><span class="hyp-type"><b>: </b><span>R s f</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s&#39; f</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> Ht <span class="kr">in</span> Ht0; <span class="nb">transitivity</span> s.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[export] <span class="kn">Instance</span> <span class="nf">eq_equiv</span> : @Equivalence (state X) eq := _.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ec" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ec"><span class="kn">Lemma</span> <span class="nf">in_futures_strict_preserving</span>
  (<span class="nv">R</span> : state X -&gt; state X -&gt; <span class="kt">Prop</span>)
  (<span class="nv">Hpre</span> : StrictOrder R)
  (<span class="nv">Ht</span> : input_valid_transition_preserving R)
  (<span class="nv">s1</span> <span class="nv">s2</span> : state X)
  (<span class="nv">Hin</span> : in_futures s1 s2)
  (<span class="nv">Hneq</span> : s1 &lt;&gt; s2) :
    R s1 s2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>StrictOrder R</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ed" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ed"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>StrictOrder R</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ee" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ee"><span class="nb">apply</span> (StrictOrder_PreOrder eq_equiv) <span class="kr">in</span> Hpre.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder (relation_disjunction R eq)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s1 s2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk2ef" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>StrictOrder R</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk2ef"><hr></label><div class="goal-conclusion">Proper (eq ==&gt; eq ==&gt; iff) R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2f0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2f0">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder (relation_disjunction R eq)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2f1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2f1"><span class="nb">specialize</span> (in_futures_preserving (relation_disjunction R eq) Hpre) <span class="kr">as</span> Hpreserve.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder (relation_disjunction R eq)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br><span><var>Hpreserve</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving
  (relation_disjunction R eq)
‚Üí <span class="kr">‚àÄ</span> <span class="nv">s1</span> <span class="nv">s2</span> : state X,
    in_futures s1 s2
    ‚Üí relation_disjunction R eq s1 s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2f2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2f2">spec Hpreserve.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder (relation_disjunction R eq)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br><span><var>Hpreserve</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving
  (relation_disjunction R eq)
‚Üí <span class="kr">‚àÄ</span> <span class="nv">s1</span> <span class="nv">s2</span> : state X,
    in_futures s1 s2
    ‚Üí relation_disjunction R eq s1 s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition_preserving
  (relation_disjunction R eq)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk2f3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder (relation_disjunction R eq)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br><span><var>Hpreserve</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s1</span> <span class="nv">s2</span> : state X,
  in_futures s1 s2
  ‚Üí relation_disjunction R eq s1 s2</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk2f3"><hr></label><div class="goal-conclusion">R s1 s2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2f4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2f4">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder (relation_disjunction R eq)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br><span><var>Hpreserve</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving
  (relation_disjunction R eq)
‚Üí <span class="kr">‚àÄ</span> <span class="nv">s1</span> <span class="nv">s2</span> : state X,
    in_futures s1 s2
    ‚Üí relation_disjunction R eq s1 s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition_preserving
  (relation_disjunction R eq)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intro</span>; <span class="nb">intros</span>; <span class="nb">left</span>; <span class="nb">eapply</span> Ht.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2f5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2f5">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>PreOrder (relation_disjunction R eq)</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br><span><var>Hpreserve</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s1</span> <span class="nv">s2</span> : state X,
  in_futures s1 s2
  ‚Üí relation_disjunction R eq s1 s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> (Hpreserve s1 s2).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2f6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2f6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>state X ‚Üí state X ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>Hpre</var><span class="hyp-type"><b>: </b><span>StrictOrder R</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition_preserving R</span></span></span><br><span><var>s1, s2</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>in_futures s1 s2</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>s1 ‚â† s2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Proper (eq ==&gt; eq ==&gt; iff) R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> x1 x2 -&gt; y1 y2 -&gt;.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2f7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2f7"><span class="kn">Lemma</span> <span class="nf">in_futures_valid_fst</span>
  (<span class="nv">first</span> <span class="nv">second</span> : state X)
  (<span class="nv">Hfuture</span> : in_futures <span class="kp">first</span> second) :
    valid_state_prop <span class="kp">first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfuture</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop <span class="kp">first</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2f8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2f8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfuture</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop <span class="kp">first</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2f9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2f9"><span class="nb">destruct</span> Hfuture <span class="kr">as</span> [tr Htr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kp">first</span> second tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop <span class="kp">first</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_forget_last,
    finite_valid_trace_first_pstate <span class="kr">in</span> Htr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2fa" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2fa"><span class="kn">Lemma</span> <span class="nf">in_futures_refl</span>
  (<span class="nv">first</span> : state X)
  (<span class="nv">Hps</span> : valid_state_prop <span class="kp">first</span>) :
    in_futures <span class="kp">first</span> <span class="kp">first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_prop <span class="kp">first</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kp">first</span> <span class="kp">first</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2fb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2fb"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_prop <span class="kp">first</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kp">first</span> <span class="kp">first</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> []; <span class="nb">constructor</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2fc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2fc">#[export] <span class="kn">Instance</span> <span class="nf">in_futures_trans</span> : Transitive in_futures.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Transitive in_futures</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2fd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2fd"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Transitive in_futures</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2fe" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2fe"><span class="nb">intros</span> s1 s2 s3 [tr12 Htr12] [tr23 Htr23].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s1, s2, s3</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr12</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr12</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s1 s2 tr12</span></span></span><br><span><var>tr23</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr23</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to s2 s3 tr23</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures s1 s3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eexists</span>; <span class="nb">eapply</span> finite_valid_trace_from_to_app.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk2ff" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk2ff"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_in_futures</span>
  {<span class="nv">l</span> <span class="nv">s</span> <span class="nv">im</span> <span class="nv">s&#39;</span> <span class="nv">om</span>}
  (<span class="nv">Ht</span> : input_valid_transition l (s, im) (s&#39;, om)) :
    in_futures s s&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>im</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, im) (s&#39;, om)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures s s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk300" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk300"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>im</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition l (s, im) (s&#39;, om)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures s s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk301" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk301"><span class="nb">apply</span> finite_valid_trace_singleton <span class="kr">in</span> Ht.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>im</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  [{|
     l := l;
     input := im;
     destination := s&#39;;
     output := om
   |}]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures s s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_add_last <span class="kr">with</span> (f := s&#39;) <span class="kr">in</span> Ht; [<span class="nb">eexists</span> |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk302" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk302"><span class="kn">Lemma</span> <span class="nf">elem_of_trace_in_futures_left</span>
  (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from_to <span class="kr">is</span> s tr) :
    <span class="kr">forall</span> <span class="nv">item</span> : transition_item,
      item ‚àà tr -&gt; in_futures (destination item) s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">item</span> : transition_item,
  item ‚àà tr ‚Üí in_futures (destination item) s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk303" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk303"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">item</span> : transition_item,
  item ‚àà tr ‚Üí in_futures (destination item) s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk304" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk304"><span class="nb">intros</span> item Hitem.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>item ‚àà tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures (destination item) s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk305" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk305"><span class="nb">apply</span> elem_of_list_split <span class="kr">in</span> Hitem <span class="kr">as</span> (pre &amp; suf &amp; Heqtr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>pre, suf</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = pre ++ item :: suf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures (destination item) s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk306" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk306"><span class="kr">exists</span> <span class="nv">suf</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>pre, suf</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = pre ++ item :: suf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to (destination item) s suf</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk307" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk307"><span class="nb">erewrite</span> &lt;- finite_trace_last_is_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>pre, suf</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = pre ++ item :: suf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to
  (finite_trace_last <span class="nl">?s</span> (<span class="nl">?tl</span> ++ [item])) s suf</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk308" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk308"><span class="nb">eapply</span> finite_valid_trace_from_to_app_split.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>pre, suf</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = pre ++ item :: suf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to <span class="nl">?s</span> s
  ((<span class="nl">?tl</span> ++ [item]) ++ suf)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> &lt;- app_assoc; <span class="nb">cbn</span>; <span class="nb">rewrite</span> &lt;- Heqtr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk309" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk309"><span class="kn">Lemma</span> <span class="nf">elem_of_trace_in_futures_right</span>
  (<span class="nv">is</span> <span class="nv">s</span> : state X) (<span class="nv">tr</span> : list transition_item)
  (<span class="nv">Htr</span> : finite_valid_trace_from_to <span class="kr">is</span> s tr) :
    <span class="kr">forall</span> <span class="nv">item</span> : transition_item,
      item ‚àà tr -&gt; in_futures <span class="kr">is</span> (destination item).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">item</span> : transition_item,
  item ‚àà tr ‚Üí in_futures <span class="kr">is</span> (destination item)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk30a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk30a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">item</span> : transition_item,
  item ‚àà tr ‚Üí in_futures <span class="kr">is</span> (destination item)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk30b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk30b"><span class="nb">intros</span> item Hitem.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>item ‚àà tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kr">is</span> (destination item)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk30c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk30c"><span class="nb">apply</span> elem_of_list_split <span class="kr">in</span> Hitem <span class="kr">as</span> (pre &amp; suf &amp; Heqtr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>pre, suf</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = pre ++ item :: suf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kr">is</span> (destination item)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk30d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk30d"><span class="kr">exists</span> (<span class="nv">pre</span> ++ [item]).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>pre, suf</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = pre ++ item :: suf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to <span class="kr">is</span> (destination item)
  (pre ++ [item])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk30e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk30e"><span class="nb">erewrite</span> &lt;- finite_trace_last_is_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>pre, suf</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = pre ++ item :: suf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to <span class="kr">is</span>
  (finite_trace_last <span class="nl">?s</span> (<span class="nl">?tl</span> ++ [item]))
  (pre ++ [item])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk30f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk30f"><span class="nb">eapply</span> finite_valid_trace_from_to_app_split.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>is, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kr">is</span> s tr</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>pre, suf</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqtr</var><span class="hyp-type"><b>: </b><span>tr = pre ++ item :: suf</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to <span class="kr">is</span> <span class="nl">?f</span>
  ((pre ++ [item]) ++ <span class="nl">?ls&#39;</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> &lt;- app_assoc; <span class="nb">cbn</span>; <span class="nb">rewrite</span> &lt;- Heqtr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk310" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk310"><span class="kn">Lemma</span> <span class="nf">in_futures_witness</span>
  (<span class="nv">first</span> <span class="nv">second</span> : state X)
  (<span class="nv">Hfutures</span> : in_futures <span class="kp">first</span> second) :
    <span class="kr">exists</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
      n1 &lt;= n2 /\
      trace_nth (proj1_sig tr) n1 = Some <span class="kp">first</span> /\
      trace_nth (proj1_sig tr) n2 = Some second.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfutures</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
  n1 ‚â§ n2
  ‚àß trace_nth (`tr) n1 = Some <span class="kp">first</span>
    ‚àß trace_nth (`tr) n2 = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk311" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk311"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfutures</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
  n1 ‚â§ n2
  ‚àß trace_nth (`tr) n1 = Some <span class="kp">first</span>
    ‚àß trace_nth (`tr) n2 = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk312" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk312"><span class="nb">specialize</span> (in_futures_valid_fst <span class="kp">first</span> second Hfutures); <span class="nb">intro</span> Hps.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfutures</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span>valid_state_prop <span class="kp">first</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
  n1 ‚â§ n2
  ‚àß trace_nth (`tr) n1 = Some <span class="kp">first</span>
    ‚àß trace_nth (`tr) n2 = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk313" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk313"><span class="nb">apply</span> valid_state_has_trace <span class="kr">in</span> Hps.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfutures</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br><span><var>Hps</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
  finite_valid_trace_init_to <span class="kr">is</span> <span class="kp">first</span> tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
  n1 ‚â§ n2
  ‚àß trace_nth (`tr) n1 = Some <span class="kp">first</span>
    ‚àß trace_nth (`tr) n2 = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk314" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk314"><span class="nb">destruct</span> Hps <span class="kr">as</span> [prefix_start [prefix_tr [Hprefix_tr Hinit]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfutures</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to prefix_start
  <span class="kp">first</span> prefix_tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
  n1 ‚â§ n2
  ‚àß trace_nth (`tr) n1 = Some <span class="kp">first</span>
    ‚àß trace_nth (`tr) n2 = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk315" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk315"><span class="nb">destruct</span> Hfutures <span class="kr">as</span> [suffix_tr Hsuffix_tr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kp">first</span> second
  suffix_tr</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to prefix_start
  <span class="kp">first</span> prefix_tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
  n1 ‚â§ n2
  ‚àß trace_nth (`tr) n1 = Some <span class="kp">first</span>
    ‚àß trace_nth (`tr) n2 = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk316" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk316"><span class="nb">specialize</span> (finite_valid_trace_from_to_app _ _ _ _ _ Hprefix_tr Hsuffix_tr) <span class="kr">as</span> Happ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kp">first</span> second
  suffix_tr</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to prefix_start
  <span class="kp">first</span> prefix_tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to prefix_start second
  (prefix_tr ++ suffix_tr)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
  n1 ‚â§ n2
  ‚àß trace_nth (`tr) n1 = Some <span class="kp">first</span>
    ‚àß trace_nth (`tr) n2 = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk317" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk317"><span class="nb">apply</span> finite_valid_trace_from_to_forget_last <span class="kr">in</span> Happ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kp">first</span> second
  suffix_tr</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to prefix_start
  <span class="kp">first</span> prefix_tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
  n1 ‚â§ n2
  ‚àß trace_nth (`tr) n1 = Some <span class="kp">first</span>
    ‚àß trace_nth (`tr) n2 = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk318" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk318"><span class="nb">assert</span> (Htr : valid_trace_prop (Finite prefix_start (prefix_tr ++ suffix_tr))) <span class="bp">by</span> <span class="bp">done</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kp">first</span> second
  suffix_tr</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to prefix_start
  <span class="kp">first</span> prefix_tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
  n1 ‚â§ n2
  ‚àß trace_nth (`tr) n1 = Some <span class="kp">first</span>
    ‚àß trace_nth (`tr) n2 = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk319" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk319"><span class="kr">exists</span> (<span class="nv">exist</span> <span class="nv">_</span> <span class="nv">_</span> <span class="nv">Htr</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kp">first</span> second
  suffix_tr</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to prefix_start
  <span class="kp">first</span> prefix_tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">n1</span> <span class="nv">n2</span> : nat,
  n1 ‚â§ n2
  ‚àß trace_nth
      (`(Finite prefix_start (prefix_tr ++ suffix_tr)
         ‚Üæ Htr)) n1 = Some <span class="kp">first</span>
    ‚àß trace_nth
        (`(Finite prefix_start
             (prefix_tr ++ suffix_tr) ‚Üæ Htr)) n2 =
      Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk31a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk31a"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kp">first</span> second
  suffix_tr</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to prefix_start
  <span class="kp">first</span> prefix_tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">n1</span> <span class="nv">n2</span> : nat,
  n1 ‚â§ n2
  ‚àß finite_trace_nth prefix_start
      (prefix_tr ++ suffix_tr) n1 = Some <span class="kp">first</span>
    ‚àß finite_trace_nth prefix_start
        (prefix_tr ++ suffix_tr) n2 = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk31b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk31b"><span class="kr">exists</span> (<span class="nv">length</span> <span class="nv">prefix_tr</span>), (length prefix_tr + length suffix_tr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kp">first</span> second
  suffix_tr</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to prefix_start
  <span class="kp">first</span> prefix_tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length prefix_tr ‚â§ length prefix_tr + length suffix_tr
‚àß finite_trace_nth prefix_start
    (prefix_tr ++ suffix_tr) (length prefix_tr) =
  Some <span class="kp">first</span>
  ‚àß finite_trace_nth prefix_start
      (prefix_tr ++ suffix_tr)
      (length prefix_tr + length suffix_tr) =
    Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk31c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk31c"><span class="nb">split</span>; [<span class="bp">lia</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kp">first</span> second
  suffix_tr</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to prefix_start
  <span class="kp">first</span> prefix_tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth prefix_start (prefix_tr ++ suffix_tr)
  (length prefix_tr) = Some <span class="kp">first</span>
‚àß finite_trace_nth prefix_start
    (prefix_tr ++ suffix_tr)
    (length prefix_tr + length suffix_tr) =
  Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk31d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk31d"><span class="nb">apply</span> finite_valid_trace_from_to_last <span class="kr">in</span> Hprefix_tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to <span class="kp">first</span> second
  suffix_tr</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last prefix_start prefix_tr =
<span class="kp">first</span></span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth prefix_start (prefix_tr ++ suffix_tr)
  (length prefix_tr) = Some <span class="kp">first</span>
‚àß finite_trace_nth prefix_start
    (prefix_tr ++ suffix_tr)
    (length prefix_tr + length suffix_tr) =
  Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk31e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk31e"><span class="nb">apply</span> finite_valid_trace_from_to_last <span class="kr">in</span> Hsuffix_tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last <span class="kp">first</span> suffix_tr =
second</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last prefix_start prefix_tr =
<span class="kp">first</span></span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth prefix_start (prefix_tr ++ suffix_tr)
  (length prefix_tr) = Some <span class="kp">first</span>
‚àß finite_trace_nth prefix_start
    (prefix_tr ++ suffix_tr)
    (length prefix_tr + length suffix_tr) =
  Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk31f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk31f"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last <span class="kp">first</span> suffix_tr =
second</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last prefix_start prefix_tr =
<span class="kp">first</span></span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth prefix_start (prefix_tr ++ suffix_tr)
  (length prefix_tr) = Some <span class="kp">first</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk320" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last <span class="kp">first</span> suffix_tr =
second</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last prefix_start prefix_tr =
<span class="kp">first</span></span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk320"><hr></label><div class="goal-conclusion">finite_trace_nth prefix_start 
  (prefix_tr ++ suffix_tr)
  (length prefix_tr + length suffix_tr) = 
Some second</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk321" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk321">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last <span class="kp">first</span> suffix_tr =
second</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last prefix_start prefix_tr =
<span class="kp">first</span></span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth prefix_start (prefix_tr ++ suffix_tr)
  (length prefix_tr) = Some <span class="kp">first</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk322" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk322"><span class="nb">rewrite</span> finite_trace_nth_app1; [| <span class="bp">lia</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last <span class="kp">first</span> suffix_tr =
second</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last prefix_start prefix_tr =
<span class="kp">first</span></span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth prefix_start prefix_tr
  (length prefix_tr) = Some <span class="kp">first</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> finite_trace_nth_last; <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk323" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk323">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last <span class="kp">first</span> suffix_tr =
second</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last prefix_start prefix_tr =
<span class="kp">first</span></span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth prefix_start (prefix_tr ++ suffix_tr)
  (length prefix_tr + length suffix_tr) = Some second</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk324" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk324"><span class="nb">rewrite</span> finite_trace_nth_app2; [| <span class="bp">lia</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>suffix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hsuffix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last <span class="kp">first</span> suffix_tr =
second</span></span></span><br><span><var>prefix_start</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix_tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix_tr</var><span class="hyp-type"><b>: </b><span>finite_trace_last prefix_start prefix_tr =
<span class="kp">first</span></span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop prefix_start</span></span></span><br><span><var>Happ</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from prefix_start
  (prefix_tr ++ suffix_tr)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop
  (Finite prefix_start (prefix_tr ++ suffix_tr))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_nth
  (finite_trace_last prefix_start prefix_tr) suffix_tr
  (length prefix_tr + length suffix_tr -
   length prefix_tr) = Some second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> Nat.add_comm, Nat.add_sub, finite_trace_nth_last; <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">trace_segment</span> (<span class="nv">tr</span> : Trace) (<span class="nv">n1</span> <span class="nv">n2</span> : nat) : list (transition_item X) :=
  <span class="kr">match</span> tr <span class="kr">with</span>
  | Finite s l =&gt; list_segment l n1 n2
  | Infinite s l =&gt; stream_segment l n1 n2
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk325" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk325"><span class="kn">Lemma</span> <span class="nf">valid_trace_segment</span>
  (<span class="nv">tr</span> : Trace)
  (<span class="nv">Htr</span> : valid_trace_prop tr)
  (<span class="nv">n1</span> <span class="nv">n2</span> : nat)
  (<span class="nv">Hle</span> : n1 &lt;= n2)
  (<span class="nv">first</span> : state X)
  (<span class="nv">Hfirst</span> : trace_nth tr n1 = Some <span class="kp">first</span>) :
    finite_valid_trace_from <span class="kp">first</span> (trace_segment tr n1 n2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>first</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span>trace_nth tr n1 = Some <span class="kp">first</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from <span class="kp">first</span> (trace_segment tr n1 n2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk326" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk326"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>first</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span>trace_nth tr n1 = Some <span class="kp">first</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from <span class="kp">first</span> (trace_segment tr n1 n2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk327" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk327"><span class="nb">destruct</span> tr <span class="kr">as</span> [s tr | s tr]; <span class="nb">simpl</span> <span class="kr">in</span> *; <span class="nb">destruct</span> Htr <span class="kr">as</span> [Htr Hinit].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>first</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr n1 = Some <span class="kp">first</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from <span class="kp">first</span> (list_segment tr n1 n2)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk328" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>first</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span>Some
  (Str_nth n1 (Cons s (map destination tr))) =
Some <span class="kp">first</span></span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk328"><hr></label><div class="goal-conclusion">finite_valid_trace_from <span class="kp">first</span>
  (stream_segment tr n1 n2)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk329" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk329">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>first</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr n1 = Some <span class="kp">first</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from <span class="kp">first</span> (list_segment tr n1 n2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_segment <span class="kr">with</span> s.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk32a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk32a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>first</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span>Some
  (Str_nth n1 (Cons s (map destination tr))) =
Some <span class="kp">first</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from <span class="kp">first</span>
  (stream_segment tr n1 n2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk32b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk32b"><span class="nb">inversion</span> Hfirst; <span class="nb">subst</span>; <span class="nb">clear</span> Hfirst.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from
  (Str_nth n1 (Cons s (map destination tr)))
  (stream_segment tr n1 n2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (infinite_valid_trace_from_segment s tr Htr n1 n2 Hle).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">Trace_messages</span> : <span class="kt">Type</span> :=
| Finite_messages : list (option message) -&gt; Trace_messages
| Infinite_messages : Stream (option message) -&gt; Trace_messages.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">protocol_output_messages_trace</span> (<span class="nv">tr</span> : valid_trace) : Trace_messages :=
  <span class="kr">match</span> proj1_sig tr <span class="kr">with</span>
  | Finite _ ls =&gt; Finite_messages (List.map output ls)
  | Infinite _ st =&gt; Infinite_messages (map output st)
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">protocol_input_messages_trace</span> (<span class="nv">tr</span> : valid_trace) : Trace_messages :=
  <span class="kr">match</span> proj1_sig tr <span class="kr">with</span>
  | Finite _ ls =&gt; Finite_messages (List.map input ls)
  | Infinite _ st =&gt; Infinite_messages (map input st)
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">trace_prefix</span>
  (<span class="nv">tr</span> : Trace) (<span class="nv">last</span> : transition_item X) (<span class="nv">prefix</span> : list (transition_item X)) : <span class="kt">Prop</span> :=
    <span class="kr">match</span> tr <span class="kr">with</span>
    | Finite s ls =&gt; <span class="kr">exists</span> <span class="nv">suffix</span>, ls = prefix ++ (<span class="nb">last</span> :: suffix)
    | Infinite s st =&gt; <span class="kr">exists</span> <span class="nv">suffix</span>, st = stream_app prefix (Cons <span class="nb">last</span> suffix)
    <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">trace_prefix_fn</span> (<span class="nv">tr</span> : Trace) (<span class="nv">n</span> : nat) : Trace X :=
  <span class="kr">match</span> tr <span class="kr">with</span>
  | Finite s ls =&gt; Finite s (take n ls)
  | Infinite s st =&gt; Finite s (stream_prefix st n)
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk32c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk32c"><span class="kn">Lemma</span> <span class="nf">trace_prefix_valid</span>
  (<span class="nv">tr</span> : valid_trace)
  (<span class="nv">last</span> : transition_item)
  (<span class="nv">prefix</span> : list transition_item)
  (<span class="nv">Hprefix</span> : trace_prefix (proj1_sig tr) <span class="nb">last</span> prefix) :
    valid_trace_prop (Finite (trace_first (proj1_sig tr)) (prefix ++ [<span class="nb">last</span>])).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>valid_trace</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix</var><span class="hyp-type"><b>: </b><span>trace_prefix (`tr) <span class="nb">last</span> prefix</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop
  (Finite (trace_first (`tr)) (prefix ++ [<span class="nb">last</span>]))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk32d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk32d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>valid_trace</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix</var><span class="hyp-type"><b>: </b><span>trace_prefix (`tr) <span class="nb">last</span> prefix</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop
  (Finite (trace_first (`tr)) (prefix ++ [<span class="nb">last</span>]))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk32e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk32e"><span class="nb">destruct</span> tr <span class="kr">as</span> [tr Htr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix</var><span class="hyp-type"><b>: </b><span>trace_prefix (`(tr ‚Üæ Htr)) <span class="nb">last</span> prefix</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop
  (Finite (trace_first (`(tr ‚Üæ Htr)))
     (prefix ++ [<span class="nb">last</span>]))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk32f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk32f"><span class="nb">simpl</span> <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hprefix</var><span class="hyp-type"><b>: </b><span>trace_prefix tr <span class="nb">last</span> prefix</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace (trace_first tr) (prefix ++ [<span class="nb">last</span>])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk330" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk330"><span class="nb">generalize dependent</span> tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">tr</span> : Trace,
  valid_trace_prop tr
  ‚Üí trace_prefix tr <span class="nb">last</span> prefix
    ‚Üí finite_valid_trace (trace_first tr)
        (prefix ++ [<span class="nb">last</span>])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk331" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk331"><span class="nb">generalize dependent</span> <span class="nb">last</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) (<span class="nv">tr</span> : Trace),
  valid_trace_prop tr
  ‚Üí trace_prefix tr <span class="nb">last</span> prefix
    ‚Üí finite_valid_trace (trace_first tr)
        (prefix ++ [<span class="nb">last</span>])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk332" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk332"><span class="nb">apply</span> (rev_ind (<span class="kr">fun</span> <span class="nv">prefix</span> =&gt; <span class="kr">forall</span> (<span class="nv">last</span> : transition_item) (<span class="nv">tr</span> : Trace),
    valid_trace_prop tr -&gt; trace_prefix tr <span class="nb">last</span> prefix -&gt;
      finite_valid_trace (trace_first tr) (prefix ++ [<span class="nb">last</span>]))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) (<span class="nv">tr</span> : Trace),
  valid_trace_prop tr
  ‚Üí trace_prefix tr <span class="nb">last</span> []
    ‚Üí finite_valid_trace (trace_first tr)
        ([] ++ [<span class="nb">last</span>])</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk333" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk333"><hr></label><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">x</span> : transition_item) (<span class="nv">l</span> : list transition_item),
  (<span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) (<span class="nv">tr</span> : Trace),
     valid_trace_prop tr
     ‚Üí trace_prefix tr <span class="nb">last</span> l
       ‚Üí finite_valid_trace 
           (trace_first tr) 
           (l ++ [<span class="nb">last</span>]))
  ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) (<span class="nv">tr</span> : Trace),
      valid_trace_prop tr
      ‚Üí trace_prefix tr <span class="nb">last</span> (l ++ [x])
        ‚Üí finite_valid_trace 
            (trace_first tr) 
            ((l ++ [x]) ++ [<span class="nb">last</span>])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk334" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk334">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) (<span class="nv">tr</span> : Trace),
  valid_trace_prop tr
  ‚Üí trace_prefix tr <span class="nb">last</span> []
    ‚Üí finite_valid_trace (trace_first tr)
        ([] ++ [<span class="nb">last</span>])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> <span class="nb">last</span> tr Htr Hprefix; <span class="nb">destruct</span> tr; <span class="nb">unfold</span> trace_prefix <span class="kr">in</span> Hprefix; <span class="nb">simpl</span> <span class="kr">in</span> Hprefix
    ; <span class="nb">destruct</span> Hprefix <span class="kr">as</span> [suffix Heq]; <span class="nb">subst</span>; <span class="nb">destruct</span> Htr <span class="kr">as</span> [Htr Hinit]
    ; <span class="nb">unfold</span> trace_first; <span class="nb">simpl</span>; <span class="nb">constructor</span>; <span class="kp">try</span> <span class="bp">done</span>
    ; <span class="nb">inversion</span> Htr; <span class="nb">subst</span>; <span class="nb">clear</span> Htr
    ; <span class="nb">apply</span> finite_valid_trace_singleton.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk335" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk335">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">x</span> : transition_item) (<span class="nv">l</span> : list transition_item),
  (<span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) (<span class="nv">tr</span> : Trace),
     valid_trace_prop tr
     ‚Üí trace_prefix tr <span class="nb">last</span> l
       ‚Üí finite_valid_trace (trace_first tr)
           (l ++ [<span class="nb">last</span>]))
  ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) (<span class="nv">tr</span> : Trace),
      valid_trace_prop tr
      ‚Üí trace_prefix tr <span class="nb">last</span> (l ++ [x])
        ‚Üí finite_valid_trace (trace_first tr)
            ((l ++ [x]) ++ [<span class="nb">last</span>])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk336" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk336"><span class="nb">intros</span> last_p p Hind <span class="nb">last</span> tr Htr Hprefix.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hind</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) (<span class="nv">tr</span> : Trace),
  valid_trace_prop tr
  ‚Üí trace_prefix tr <span class="nb">last</span> p
    ‚Üí finite_valid_trace 
        (trace_first tr) 
        (p ++ [<span class="nb">last</span>])</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>Hprefix</var><span class="hyp-type"><b>: </b><span>trace_prefix tr <span class="nb">last</span> (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace (trace_first tr)
  ((p ++ [last_p]) ++ [<span class="nb">last</span>])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk337" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk337"><span class="nb">specialize</span> (Hind last_p tr Htr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Hind</var><span class="hyp-type"><b>: </b><span>trace_prefix tr last_p p
‚Üí finite_valid_trace (trace_first tr)
    (p ++ [last_p])</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>Hprefix</var><span class="hyp-type"><b>: </b><span>trace_prefix tr <span class="nb">last</span> (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace (trace_first tr)
  ((p ++ [last_p]) ++ [<span class="nb">last</span>])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk338" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk338"><span class="nb">destruct</span> tr <span class="kr">as</span> [|]; <span class="nb">unfold</span> trace_prefix <span class="kr">in</span> Hprefix;   <span class="nb">simpl</span> <span class="kr">in</span> Hprefix
    ; <span class="nb">destruct</span> Hprefix <span class="kr">as</span> [suffix Heq]; <span class="nb">subst</span>; <span class="nb">destruct</span> Htr <span class="kr">as</span> [Htr Hinit]; <span class="nb">simpl</span>; <span class="nb">simpl</span> <span class="kr">in</span> Hind
    ; <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">done</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ((p ++ [last_p]) ++ <span class="nb">last</span> :: suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hind</var><span class="hyp-type"><b>: </b><span>(<span class="kr">‚àÉ</span> <span class="nv">suffix0</span> : list transition_item,
   (p ++ [last_p]) ++ <span class="nb">last</span> :: suffix =
   p ++ last_p :: suffix0)
‚Üí finite_valid_trace s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s ((p ++ [last_p]) ++ [<span class="nb">last</span>])</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk339" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app (p ++ [last_p]) (Cons <span class="nb">last</span> suffix))</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hind</var><span class="hyp-type"><b>: </b><span>(<span class="kr">‚àÉ</span> <span class="nv">suffix0</span> : Stream transition_item,
   stream_app (p ++ [last_p])
     (Cons <span class="nb">last</span> suffix) =
   stream_app p (Cons last_p suffix0))
‚Üí finite_valid_trace s (p ++ [last_p])</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk339"><hr></label><div class="goal-conclusion">finite_valid_trace_from s ((p ++ [last_p]) ++ [<span class="nb">last</span>])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk33a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk33a">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ((p ++ [last_p]) ++ <span class="nb">last</span> :: suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hind</var><span class="hyp-type"><b>: </b><span>(<span class="kr">‚àÉ</span> <span class="nv">suffix0</span> : list transition_item,
   (p ++ [last_p]) ++ <span class="nb">last</span> :: suffix =
   p ++ last_p :: suffix0)
‚Üí finite_valid_trace s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s ((p ++ [last_p]) ++ [<span class="nb">last</span>])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk33b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk33b"><span class="nb">assert</span>
        (Hex : <span class="kr">exists</span> <span class="nv">suffix0</span> : list transition_item,
            (p ++ [last_p]) ++ <span class="nb">last</span> :: suffix = p ++ last_p :: suffix0)
          <span class="bp">by</span> (<span class="kr">exists</span> (<span class="nv">last</span> :: suffix); <span class="nb">rewrite</span> &lt;- app_assoc; <span class="bp">done</span>)
      ; <span class="nb">specialize</span> (Hind Hex); <span class="nb">clear</span> Hex
      ; <span class="nb">destruct</span> Hind <span class="kr">as</span> [Hptr _]
      ; <span class="nb">destruct</span> <span class="nb">last</span>
      ; <span class="nb">apply</span> extend_right_finite_trace_from
      ; <span class="kp">try</span> <span class="bp">done</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  ((p ++ [last_p]) ++
   {|
     l := l0;
     input := input0;
     destination := destination0;
     output := output0
   |} :: suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0
  (finite_trace_last s (p ++ [last_p]), input0)
  (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk33c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk33c"><span class="nb">rewrite</span> &lt;- (app_cons {| l := l0; input := input0; destination := destination0;
        output := output0 |} suffix), app_assoc, &lt;- !(app_assoc p _ _) <span class="kr">in</span> Htr; <span class="nb">cbn</span> <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (p ++
   last_p
   :: {|
        l := l0;
        input := input0;
        destination := destination0;
        output := output0
      |} :: suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0
  (finite_trace_last s (p ++ [last_p]), input0)
  (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk33d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk33d"><span class="nb">specialize</span>
        (finite_valid_trace_consecutive_valid_transition _ _ _ _ _ _ Htr eq_refl).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (p ++
   last_p
   :: {|
        l := l0;
        input := input0;
        destination := destination0;
        output := output0
      |} :: suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition
  (l
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |})
  (destination last_p,
   input
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |})
  (destination
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |},
   output
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |})
‚Üí input_valid_transition l0
    (finite_trace_last s (p ++ [last_p]), input0)
    (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk33e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk33e"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s
  (p ++
   last_p
   :: {|
        l := l0;
        input := input0;
        destination := destination0;
        output := output0
      |} :: suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (destination last_p, input0)
  (destination0, output0)
‚Üí input_valid_transition l0
    (finite_trace_last s (p ++ [last_p]), input0)
    (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> finite_trace_last_is_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk33f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk33f">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app (p ++ [last_p]) (Cons <span class="nb">last</span> suffix))</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hind</var><span class="hyp-type"><b>: </b><span>(<span class="kr">‚àÉ</span> <span class="nv">suffix0</span> : Stream transition_item,
   stream_app (p ++ [last_p])
     (Cons <span class="nb">last</span> suffix) =
   stream_app p (Cons last_p suffix0))
‚Üí finite_valid_trace s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s ((p ++ [last_p]) ++ [<span class="nb">last</span>])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk340" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk340"><span class="nb">assert</span>
        (Hex : <span class="kr">exists</span> <span class="nv">suffix0</span> : Stream transition_item,
            stream_app (p ++ [last_p])  (Cons <span class="nb">last</span> suffix) = stream_app p (Cons last_p suffix0))
          <span class="bp">by</span> (<span class="kr">exists</span> (<span class="nv">Cons</span> <span class="nv">last</span> <span class="nv">suffix</span>); <span class="nb">rewrite</span> &lt;- stream_app_assoc; <span class="bp">done</span>)
      ; <span class="nb">specialize</span> (Hind Hex); <span class="nb">clear</span> Hex
      ; <span class="nb">destruct</span> Hind <span class="kr">as</span> [Hptr _]
      ; <span class="nb">destruct</span> <span class="nb">last</span>
      ; <span class="nb">apply</span> extend_right_finite_trace_from
      ; <span class="kp">try</span> <span class="bp">done</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app (p ++ [last_p])
     (Cons
        {|
          l := l0;
          input := input0;
          destination := destination0;
          output := output0
        |} suffix))</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0
  (finite_trace_last s (p ++ [last_p]), input0)
  (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk341" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk341"><span class="nb">rewrite</span> &lt;- stream_app_cons <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app (p ++ [last_p])
     (stream_app
        [{|
           l := l0;
           input := input0;
           destination := destination0;
           output := output0
         |}] suffix))</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0
  (finite_trace_last s (p ++ [last_p]), input0)
  (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk342" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk342"><span class="nb">rewrite</span> stream_app_assoc <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app
     ((p ++ [last_p]) ++
      [{|
         l := l0;
         input := input0;
         destination := destination0;
         output := output0
       |}]) suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0
  (finite_trace_last s (p ++ [last_p]), input0)
  (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk343" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk343"><span class="nb">rewrite</span> &lt;- (app_assoc p _ _) <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app
     (p ++
      [last_p] ++
      [{|
         l := l0;
         input := input0;
         destination := destination0;
         output := output0
       |}]) suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0
  (finite_trace_last s (p ++ [last_p]), input0)
  (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk344" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk344"><span class="nb">simpl</span> <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app
     (p ++
      [last_p;
       {|
         l := l0;
         input := input0;
         destination := destination0;
         output := output0
       |}]) suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0
  (finite_trace_last s (p ++ [last_p]), input0)
  (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk345" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk345"><span class="nb">specialize</span>
        (infinite_valid_trace_consecutive_valid_transition
           s
           (stream_app (p ++ [last_p; {| l := l0; input := input0; destination := destination0;
            output := output0 |}]) suffix)
           suffix
           p
           last_p
           {| l := l0; input := input0; destination := destination0; output := output0 |}
           Htr
           eq_refl).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app
     (p ++
      [last_p;
       {|
         l := l0;
         input := input0;
         destination := destination0;
         output := output0
       |}]) suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition
  (l
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |})
  (destination last_p,
   input
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |})
  (destination
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |},
   output
     {|
       l := l0;
       input := input0;
       destination := destination0;
       output := output0
     |})
‚Üí input_valid_transition l0
    (finite_trace_last s (p ++ [last_p]), input0)
    (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk346" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk346"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last_p</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>input0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>destination0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>output0</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>suffix</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s
  (stream_app
     (p ++
      [last_p;
       {|
         l := l0;
         input := input0;
         destination := destination0;
         output := output0
       |}]) suffix)</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br><span><var>Hptr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (p ++ [last_p])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition l0 (destination last_p, input0)
  (destination0, output0)
‚Üí input_valid_transition l0
    (finite_trace_last s (p ++ [last_p]), input0)
    (destination0, output0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> finite_trace_last_is_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">build_trace_prefix_valid</span>
  {<span class="nv">tr</span> : valid_trace}
  {<span class="nv">last</span> : transition_item}
  {<span class="nv">prefix</span> : list transition_item}
  (<span class="nv">Hprefix</span> : trace_prefix (proj1_sig tr) <span class="nb">last</span> prefix)
  : valid_trace :=
    exist _ (Finite (trace_first (proj1_sig tr)) (prefix ++ [<span class="nb">last</span>]))
      (trace_prefix_valid tr <span class="nb">last</span> prefix Hprefix).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk347" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk347"><span class="kn">Lemma</span> <span class="nf">trace_prefix_fn_valid</span>
  (<span class="nv">tr</span> : Trace)
  (<span class="nv">Htr</span> : valid_trace_prop tr)
  (<span class="nv">n</span> : nat) :
    valid_trace_prop (trace_prefix_fn tr n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (trace_prefix_fn tr n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk348" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk348"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (trace_prefix_fn tr n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk349" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk349"><span class="nb">specialize</span> (trace_prefix_valid (exist _ tr Htr)); <span class="nb">simpl</span>; <span class="nb">intro</span> Hpref.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (trace_prefix_fn tr n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk34a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk34a"><span class="nb">remember</span> (trace_prefix_fn tr n) <span class="kr">as</span> pref_tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>pref_tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>pref_tr = trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop pref_tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk34b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk34b"><span class="nb">destruct</span> pref_tr <span class="kr">as</span> [s l | s l]; <span class="nb">cycle</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Infinite s l = trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (Infinite s l)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk34c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s l = trace_prefix_fn tr n</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk34c"><hr></label><div class="goal-conclusion">valid_trace_prop (Finite s l)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk34d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk34d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Infinite s l = trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (Infinite s l)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> tr <span class="kr">as</span> [s&#39; l&#39; | s&#39; l&#39;]; <span class="nb">inversion</span> Heqpref_tr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk34e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk34e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s l = trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (Finite s l)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk34f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk34f"><span class="nb">destruct</span> l <span class="kr">as</span> [| item l].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s [] = trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (Finite s [])</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk350" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s (item :: l) =
trace_prefix_fn tr n</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk350"><hr></label><div class="goal-conclusion">valid_trace_prop (Finite s (item :: l))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk351" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk351">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s [] = trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (Finite s [])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> tr <span class="kr">as</span> [s&#39; l&#39; | s&#39; l&#39;]
      ; <span class="nb">destruct</span> Htr <span class="kr">as</span> [Htr Hinit]
      ; <span class="nb">inversion</span> Heqpref_tr; <span class="nb">subst</span>
      ; (<span class="nb">split</span>; [| <span class="bp">done</span>])
      ; <span class="nb">constructor</span>
      ; <span class="nb">apply</span> initial_state_is_valid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk352" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk352">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s (item :: l) =
trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (Finite s (item :: l))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk353" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk353"><span class="nb">assert</span> (Hnnil : item :: l &lt;&gt; [])
        <span class="bp">by</span> (<span class="nb">intro</span> Hnil; <span class="nb">inversion</span> Hnil).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s (item :: l) =
trace_prefix_fn tr n</span></span></span><br><span><var>Hnnil</var><span class="hyp-type"><b>: </b><span>item :: l ‚â† []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (Finite s (item :: l))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk354" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk354"><span class="nb">specialize</span> (exists_last Hnnil); <span class="nb">intros</span> [prefix [<span class="nb">last</span> Heq]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s (item :: l) =
trace_prefix_fn tr n</span></span></span><br><span><var>Hnnil</var><span class="hyp-type"><b>: </b><span>item :: l ‚â† []</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>item :: l = prefix ++ [<span class="nb">last</span>]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (Finite s (item :: l))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk355" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk355"><span class="nb">rewrite</span> Heq <span class="kr">in</span> *; <span class="nb">clear</span> Hnnil Heq l item.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s (prefix ++ [<span class="nb">last</span>]) =
trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop (Finite s (prefix ++ [<span class="nb">last</span>]))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk356" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk356"><span class="nb">replace</span> s <span class="kr">with</span> (trace_first (proj1_sig (exist _ tr Htr)))
      ; <span class="kp">try</span> (<span class="bp">by</span> <span class="nb">destruct</span> tr; <span class="nb">inversion</span> Heqpref_tr; <span class="nb">subst</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s (prefix ++ [<span class="nb">last</span>]) =
trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_trace_prop
  (Finite (trace_first (`(tr ‚Üæ Htr)))
     (prefix ++ [<span class="nb">last</span>]))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk357" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk357"><span class="nb">apply</span> trace_prefix_valid.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s (prefix ++ [<span class="nb">last</span>]) =
trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">trace_prefix (`(tr ‚Üæ Htr)) <span class="nb">last</span> prefix</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk358" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk358"><span class="nb">remember</span> (prefix ++ [<span class="nb">last</span>]) <span class="kr">as</span> prefix_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>prefix_last</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqprefix_last</var><span class="hyp-type"><b>: </b><span>prefix_last = prefix ++ [<span class="nb">last</span>]</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s prefix_last =
trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">trace_prefix (`(tr ‚Üæ Htr)) <span class="nb">last</span> prefix</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk359" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk359"><span class="nb">revert</span> Heqprefix_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix tr <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace 
      (trace_first tr) 
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>prefix_last</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Heqpref_tr</var><span class="hyp-type"><b>: </b><span>Finite s prefix_last =
trace_prefix_fn tr n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">prefix_last = prefix ++ [<span class="nb">last</span>]
‚Üí trace_prefix (`(tr ‚Üæ Htr)) <span class="nb">last</span> prefix</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk35a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk35a"><span class="nb">destruct</span> tr <span class="kr">as</span> [s&#39; l&#39; | s&#39; l&#39;]
      ; <span class="nb">inversion</span> Heqpref_tr
      ; <span class="nb">subst</span>
      ; <span class="nb">clear</span> Heqpref_tr
      ; <span class="nb">simpl</span>
      ; <span class="nb">intro</span> Heqprefix.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Finite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Finite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>take n l&#39; = prefix ++ [<span class="nb">last</span>]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">suffix</span> : list transition_item,
  l&#39; = prefix ++ <span class="nb">last</span> :: suffix</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk35b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Infinite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Infinite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>stream_prefix l&#39; n = prefix ++ [<span class="nb">last</span>]</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk35b"><hr></label><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">suffix</span> : Stream transition_item,
  l&#39; = stream_app prefix (Cons <span class="nb">last</span> suffix)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk35c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk35c">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Finite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Finite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>take n l&#39; = prefix ++ [<span class="nb">last</span>]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">suffix</span> : list transition_item,
  l&#39; = prefix ++ <span class="nb">last</span> :: suffix</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk35d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk35d"><span class="nb">specialize</span> (take_drop n l&#39;); <span class="nb">intro</span> Hl&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Finite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Finite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>take n l&#39; = prefix ++ [<span class="nb">last</span>]</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>take n l&#39; ++ drop n l&#39; = l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">suffix</span> : list transition_item,
  l&#39; = prefix ++ <span class="nb">last</span> :: suffix</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk35e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk35e"><span class="nb">rewrite</span> &lt;- Hl&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Finite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Finite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>take n l&#39; = prefix ++ [<span class="nb">last</span>]</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>take n l&#39; ++ drop n l&#39; = l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">suffix</span> : list transition_item,
  take n l&#39; ++ drop n l&#39; = prefix ++ <span class="nb">last</span> :: suffix</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk35f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk35f"><span class="nb">rewrite</span> Heqprefix.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Finite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Finite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>take n l&#39; = prefix ++ [<span class="nb">last</span>]</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>take n l&#39; ++ drop n l&#39; = l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">suffix</span> : list transition_item,
  (prefix ++ [<span class="nb">last</span>]) ++ drop n l&#39; =
  prefix ++ <span class="nb">last</span> :: suffix</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk360" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk360"><span class="kr">exists</span> (<span class="nv">drop</span> <span class="nv">n</span> <span class="nv">l&#39;</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Finite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Finite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>take n l&#39; = prefix ++ [<span class="nb">last</span>]</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>take n l&#39; ++ drop n l&#39; = l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(prefix ++ [<span class="nb">last</span>]) ++ drop n l&#39; =
prefix ++ <span class="nb">last</span> :: drop n l&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> &lt;- app_assoc.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk361" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk361">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Infinite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Infinite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>stream_prefix l&#39; n = prefix ++ [<span class="nb">last</span>]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">suffix</span> : Stream transition_item,
  l&#39; = stream_app prefix (Cons <span class="nb">last</span> suffix)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk362" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk362"><span class="nb">specialize</span> (stream_prefix_suffix l&#39; n); <span class="nb">intro</span> Hl&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Infinite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Infinite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>stream_prefix l&#39; n = prefix ++ [<span class="nb">last</span>]</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>stream_app (stream_prefix l&#39; n)
  (stream_suffix l&#39; n) = l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">suffix</span> : Stream transition_item,
  l&#39; = stream_app prefix (Cons <span class="nb">last</span> suffix)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk363" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk363"><span class="nb">rewrite</span> &lt;- Hl&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Infinite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Infinite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>stream_prefix l&#39; n = prefix ++ [<span class="nb">last</span>]</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>stream_app (stream_prefix l&#39; n)
  (stream_suffix l&#39; n) = l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">suffix</span> : Stream transition_item,
  stream_app (stream_prefix l&#39; n) (stream_suffix l&#39; n) =
  stream_app prefix (Cons <span class="nb">last</span> suffix)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk364" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk364"><span class="nb">rewrite</span> Heqprefix.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Infinite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Infinite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>stream_prefix l&#39; n = prefix ++ [<span class="nb">last</span>]</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>stream_app (stream_prefix l&#39; n)
  (stream_suffix l&#39; n) = l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> <span class="nv">suffix</span> : Stream transition_item,
  stream_app (prefix ++ [<span class="nb">last</span>]) (stream_suffix l&#39; n) =
  stream_app prefix (Cons <span class="nb">last</span> suffix)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk365" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk365"><span class="kr">exists</span> (<span class="nv">stream_suffix</span> <span class="nv">l&#39;</span> <span class="nv">n</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s&#39; l&#39;)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpref</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">last</span> : transition_item) 
  (<span class="nv">prefix</span> : list transition_item),
  trace_prefix (Infinite s&#39; l&#39;) <span class="nb">last</span> prefix
  ‚Üí finite_valid_trace
      (trace_first (Infinite s&#39; l&#39;))
      (prefix ++ [<span class="nb">last</span>])</span></span></span><br><span><var>prefix</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>last</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Heqprefix</var><span class="hyp-type"><b>: </b><span>stream_prefix l&#39; n = prefix ++ [<span class="nb">last</span>]</span></span></span><br><span><var>Hl'</var><span class="hyp-type"><b>: </b><span>stream_app (stream_prefix l&#39; n)
  (stream_suffix l&#39; n) = l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_app (prefix ++ [<span class="nb">last</span>]) (stream_suffix l&#39; n) =
stream_app prefix (Cons <span class="nb">last</span> (stream_suffix l&#39; n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> &lt;- stream_app_assoc.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk366" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk366"><span class="kn">Lemma</span> <span class="nf">valid_trace_nth</span>
  (<span class="nv">tr</span> : Trace)
  (<span class="nv">Htr</span> : valid_trace_prop tr)
  (<span class="nv">n</span> : nat)
  (<span class="nv">s</span> : state X)
  (<span class="nv">Hnth</span> : trace_nth tr n = Some s) :
    valid_state_prop s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth tr n = Some s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk367" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk367"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth tr n = Some s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk368" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk368"><span class="nb">destruct</span> tr <span class="kr">as</span> [s0 l | s0 l]; <span class="nb">destruct</span> Htr <span class="kr">as</span> [Htr Hinit].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s0 l</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth (Finite s0 l) n = Some s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk369" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s0 l</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s0 l) n = Some s</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk369"><hr></label><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk36a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk36a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s0 l</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth (Finite s0 l) n = Some s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk36b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk36b"><span class="nb">specialize</span> (finite_valid_trace_from_suffix s0 l Htr n s Hnth).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s0 l</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth (Finite s0 l) n = Some s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from s (drop n l)
‚Üí valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk36c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk36c"><span class="nb">intro</span> Hsuf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s0 l</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth (Finite s0 l) n = Some s</span></span></span><br><span><var>Hsuf</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from s (drop n l)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_first_pstate <span class="kr">in</span> Hsuf.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk36d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk36d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s0 l</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s0 l) n = Some s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk36e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk36e"><span class="nb">assert</span> (Hle : n &lt;= n) <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s0 l</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s0 l) n = Some s</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n ‚â§ n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk36f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk36f"><span class="nb">specialize</span> (infinite_valid_trace_from_segment s0 l Htr n n Hle)
    ; <span class="nb">simpl</span>; <span class="nb">intros</span> Hseg.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s0 l</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s0 l) n = Some s</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n ‚â§ n</span></span></span><br><span><var>Hseg</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (Str_nth n (Cons s0 (map destination l)))
  (stream_segment l n n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk370" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk370"><span class="nb">inversion</span> Hnth.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>infinite_valid_trace_from s0 l</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s0 l) n = Some s</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n ‚â§ n</span></span></span><br><span><var>Hseg</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from
  (Str_nth n (Cons s0 (map destination l)))
  (stream_segment l n n)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Str_nth n (Cons s0 (map destination l)) = s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop
  (Str_nth n (Cons s0 (map destination l)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_first_pstate <span class="kr">in</span> Hseg.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk371" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk371"><span class="kn">Lemma</span> <span class="nf">in_futures_valid_snd</span>
  (<span class="nv">first</span> <span class="nv">second</span> : state X)
  (<span class="nv">Hfutures</span> : in_futures <span class="kp">first</span> second) :
    valid_state_prop second.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfutures</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk372" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk372"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfutures</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk373" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk373"><span class="nb">specialize</span> (in_futures_witness <span class="kp">first</span> second Hfutures)
  ; <span class="nb">intros</span> [tr [n1 [n2 [Hle [Hn1 Hn2]]]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfutures</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>valid_trace</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>Hn1</var><span class="hyp-type"><b>: </b><span>trace_nth (`tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hn2</var><span class="hyp-type"><b>: </b><span>trace_nth (`tr) n2 = Some second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk374" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk374"><span class="nb">destruct</span> tr <span class="kr">as</span> [tr Htr]; <span class="nb">simpl</span> <span class="kr">in</span> Hn2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hfutures</var><span class="hyp-type"><b>: </b><span>in_futures <span class="kp">first</span> second</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>Hn1</var><span class="hyp-type"><b>: </b><span>trace_nth (`(tr ‚Üæ Htr)) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hn2</var><span class="hyp-type"><b>: </b><span>trace_nth tr n2 = Some second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_trace_nth <span class="kr">with</span> tr n2.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk375" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk375"><span class="kn">Lemma</span> <span class="nf">in_futures_witness_reverse</span>
  (<span class="nv">first</span> <span class="nv">second</span> : state X)
  (<span class="nv">tr</span> : valid_trace)
  (<span class="nv">n1</span> <span class="nv">n2</span> : nat)
  (<span class="nv">Hle</span> : n1 &lt;= n2)
  (<span class="nv">Hs1</span> : trace_nth (proj1_sig tr) n1 = Some <span class="kp">first</span>)
  (<span class="nv">Hs2</span> : trace_nth (proj1_sig tr) n2 = Some second) :
    in_futures <span class="kp">first</span> second.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>valid_trace</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (`tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth (`tr) n2 = Some second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kp">first</span> second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk376" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk376"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>valid_trace</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (`tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth (`tr) n2 = Some second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kp">first</span> second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk377" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk377"><span class="nb">destruct</span> tr <span class="kr">as</span> [tr Htr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (`(tr ‚Üæ Htr)) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth (`(tr ‚Üæ Htr)) n2 = Some second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kp">first</span> second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk378" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk378"><span class="nb">simpl</span> <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ n2</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth tr n2 = Some second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kp">first</span> second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk379" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk379"><span class="nb">inversion</span> Hle; <span class="nb">subst</span>; <span class="nb">clear</span> Hle.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth tr n2 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth tr n2 = Some second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kp">first</span> second</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk37a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth tr (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk37a"><hr></label><div class="goal-conclusion">in_futures <span class="kp">first</span> second</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk37b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk37b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth tr n2 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth tr n2 = Some second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kp">first</span> second</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk37c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk37c"><span class="nb">rewrite</span> Hs1 <span class="kr">in</span> Hs2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth tr n2 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some <span class="kp">first</span> = Some second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kp">first</span> second</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk37d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk37d"><span class="nb">inversion</span> Hs2; <span class="nb">subst</span>; <span class="nb">clear</span> Hs2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth tr n2 = Some second</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures second second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> []; <span class="nb">constructor</span>; <span class="nb">apply</span> valid_trace_nth <span class="kr">with</span> tr n2.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk37e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk37e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth tr (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">in_futures <span class="kp">first</span> second</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk37f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk37f"><span class="kr">exists</span> (<span class="nv">trace_segment</span> <span class="nv">tr</span> <span class="nv">n1</span> (S m)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth tr (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to <span class="kp">first</span> second
  (trace_segment tr n1 (S m))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk380" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk380"><span class="nb">apply</span> finite_valid_trace_from_add_last; [<span class="bp">by</span> <span class="nb">apply</span> valid_trace_segment; [| <span class="bp">lia</span> |] |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Trace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop tr</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth tr (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last <span class="kp">first</span> (trace_segment tr n1 (S m)) =
second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk381" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk381"><span class="nb">destruct</span> tr <span class="kr">as</span> [s tr | s tr]; <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Finite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth (Finite s tr) (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last <span class="kp">first</span> (list_segment tr n1 (S m)) =
second</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk382" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk382"><hr></label><div class="goal-conclusion">finite_trace_last <span class="kp">first</span> (stream_segment tr n1 (S m)) =
second</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk383" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk383">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Finite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth (Finite s tr) (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last <span class="kp">first</span> (list_segment tr n1 (S m)) =
second</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk384" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk384"><span class="nb">simpl</span> <span class="kr">in</span> Hs1, Hs2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last <span class="kp">first</span> (list_segment tr n1 (S m)) =
second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk385" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk385"><span class="nb">unfold</span> list_segment.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last <span class="kp">first</span> (drop n1 (take (S m) tr)) =
second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk386" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk386"><span class="nb">rewrite</span> finite_trace_last_suffix.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last <span class="kp">first</span> (take (S m) tr) = second</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk387" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk387"><hr></label><div class="goal-conclusion">n1 &lt; length (take (S m) tr)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk388" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk388">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last <span class="kp">first</span> (take (S m) tr) = second</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_trace_last_prefix.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk389" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk389">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n1 &lt; length (take (S m) tr)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk38a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk38a"><span class="nb">apply</span> finite_trace_nth_length <span class="kr">in</span> Hs2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Finite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>finite_trace_nth s tr n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>S m ‚â§ length tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n1 &lt; length (take (S m) tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> take_length; <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk38b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk38b">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last <span class="kp">first</span> (stream_segment tr n1 (S m)) =
second</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk38c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk38c"><span class="nb">unfold</span> stream_segment.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_trace_last <span class="kp">first</span>
  (drop n1 (stream_prefix tr (S m))) = second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk38d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk38d"><span class="nb">rewrite</span> unlock_finite_trace_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.<span class="nb">last</span>
  (List.map destination
     (drop n1 (stream_prefix tr (S m)))) <span class="kp">first</span> =
second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk38e" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk38e"><span class="nb">rewrite</span> &lt;- skipn_map, stream_prefix_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) (S m) = Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.<span class="nb">last</span>
  (drop n1 (stream_prefix (map destination tr) (S m)))
  <span class="kp">first</span> = second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk38f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk38f"><span class="nb">simpl</span> <span class="kr">in</span> Hs2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some
  (Str_nth (S m) (Cons s (map destination tr))) =
Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.<span class="nb">last</span>
  (drop n1 (stream_prefix (map destination tr) (S m)))
  <span class="kp">first</span> = second</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk390" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk390"><span class="nb">rewrite</span> drop_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some
  (Str_nth (S m) (Cons s (map destination tr))) =
Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.<span class="nb">last</span> (stream_prefix (map destination tr) (S m))
  <span class="kp">first</span> = second</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk391" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some
  (Str_nth (S m) (Cons s (map destination tr))) =
Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk391"><hr></label><div class="goal-conclusion">n1 &lt; length (stream_prefix (map destination tr) (S m))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk392" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk392">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some
  (Str_nth (S m) (Cons s (map destination tr))) =
Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.<span class="nb">last</span> (stream_prefix (map destination tr) (S m))
  <span class="kp">first</span> = second</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk393" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk393"><span class="nb">symmetry</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some
  (Str_nth (S m) (Cons s (map destination tr))) =
Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">second =
List.<span class="nb">last</span> (stream_prefix (map destination tr) (S m))
  <span class="kp">first</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk394" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk394"><span class="nb">rewrite</span> stream_prefix_nth_last.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some
  (Str_nth (S m) (Cons s (map destination tr))) =
Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">second = Str_nth m (map destination tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk395" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk395"><span class="nb">unfold</span> Str_nth <span class="kr">in</span> Hs2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some
  (hd
     (Str_nth_tl (S m)
        (Cons s (map destination tr)))) =
Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">second = Str_nth m (map destination tr)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk396" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk396"><span class="nb">simpl</span> <span class="kr">in</span> Hs2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some (hd (Str_nth_tl m (map destination tr))) =
Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">second = Str_nth m (map destination tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> Hs2; <span class="nb">subst</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk397" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk397">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some
  (Str_nth (S m) (Cons s (map destination tr))) =
Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n1 &lt; length (stream_prefix (map destination tr) (S m))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk398" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk398"><span class="nb">specialize</span> (stream_prefix_length (Streams.map destination tr) (S m)); <span class="nb">intro</span> Hpref_len.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>first, second, s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>Stream transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>valid_trace_prop (Infinite s tr)</span></span></span><br><span><var>n1, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hs1</var><span class="hyp-type"><b>: </b><span>trace_nth (Infinite s tr) n1 = Some <span class="kp">first</span></span></span></span><br><span><var>Hs2</var><span class="hyp-type"><b>: </b><span>Some
  (Str_nth (S m) (Cons s (map destination tr))) =
Some second</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 ‚â§ m</span></span></span><br><span><var>Hpref_len</var><span class="hyp-type"><b>: </b><span>length
  (stream_prefix (map destination tr)
     (S m)) = S m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n1 &lt; length (stream_prefix (map destination tr) (S m))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> Hpref_len; <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  Stating liveness properties will require quantifying over complete
  executions of the protocol. To make this possible, we will now define
  <i>complete</i> <span class="inlinecode"><span class="id" title="var">valid_trace</span></span>s.

<div class="paragraph"> </div>

  A <span class="inlinecode"><span class="id" title="var">valid_trace</span></span> is <i>terminating</i> if there's no other <span class="inlinecode"><span class="id" title="var">valid_trace</span></span>
  that contains it as a prefix.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">terminating_trace_prop</span> (<span class="nv">tr</span> : Trace) : <span class="kt">Prop</span> :=
  <span class="kr">match</span> tr <span class="kr">with</span>
  | Finite s ls =&gt;
      ~ <span class="kr">exists</span> (<span class="nv">tr</span> : valid_trace) (<span class="nv">last</span> : transition_item),
        trace_prefix (proj1_sig tr) <span class="nb">last</span> ls
  | Infinite s ls =&gt; <span class="kt">False</span>
  <span class="kr">end</span>.</span></span></pre><div class="doc">
A <span class="inlinecode"><span class="id" title="var">valid_trace</span></span> is <i>complete</i>, if it is either <i>terminating</i> or infinite. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">complete_trace_prop</span> (<span class="nv">tr</span> : Trace) : <span class="kt">Prop</span> :=
  valid_trace_prop tr /\
  <span class="kr">match</span> tr <span class="kr">with</span>
  | Finite _ _ =&gt; terminating_trace_prop tr
  | Infinite _ _ =&gt; <span class="kt">True</span>
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(*</span>
<span class="c">  Implicitly, the state itself must be in the trace, and minimally the last</span>
<span class="c">  element of the trace. Also implicitly, the trace leading up to the state</span>
<span class="c">  is finite.</span>

<span class="c">  Defining equivocation on these trace definitions</span>

<span class="c">  Section 7:</span>
<span class="c">  A message m received by a valid state s with a transition label l in a</span>
<span class="c">  valid execution trace is called &quot;an equivocation&quot; if it wasn&#39;t produced</span>
<span class="c">  in that trace</span>
<span class="c">*)</span>

<span class="c">(* 6.2.2 Equivocation-free as a composition constraint *)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">composition_constraint</span> : <span class="kt">Type</span> :=
  label X -&gt; state X * option message -&gt; <span class="kt">Prop</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Decidable VLSMs *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Class</span> <span class="nf">VLSM_vdecidable</span> : <span class="kt">Type</span> :=
{
  valid_decidable :
    <span class="kr">forall</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message),
      {valid X l som} + {~ valid X l som}
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">sec_VLSM</span>.</span></span></pre><div class="doc">
  Make all arguments of <span class="inlinecode"><span class="id" title="var">valid_state_prop_ind</span></span> explicit
  so it will work with the <code>induction using</code> tactic
  (closing the section added <code>{message}</code> as an implicit argument).

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> valid_state_message_prop_ind : <span class="kn">clear implicits</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> valid_state_prop_ind : <span class="kn">clear implicits</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> finite_valid_trace_from_to_ind : <span class="kn">clear implicits</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> finite_valid_trace_rev_ind : <span class="kn">clear implicits</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> finite_valid_trace_from_rev_ind : <span class="kn">clear implicits</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> finite_valid_trace_from_to_rev_ind : <span class="kn">clear implicits</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> finite_valid_trace_init_to_rev_ind : <span class="kn">clear implicits</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> finite_valid_trace_init_to_rev_strong_ind : <span class="kn">clear implicits</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> extend_right_finite_trace_from [message] X [s1 ts] Ht12 [l3 iom3 s3 oom3] Hv23.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> extend_right_finite_trace_from_to [message] X [s1 s2 ts] Ht12 [l3 iom3 s3 oom3] Hv23.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Class</span> <span class="nf">TraceWithLast</span>
  (<span class="nv">base_prop</span> :
    <span class="kr">forall</span> {<span class="nv">message</span>} (<span class="nv">X</span> : VLSM message), state X -&gt; list transition_item -&gt; <span class="kt">Prop</span>)
  (<span class="nv">trace_prop</span> :
    <span class="kr">forall</span> {<span class="nv">message</span>} (<span class="nv">X</span> : VLSM message), state X -&gt; state X -&gt; list transition_item -&gt; <span class="kt">Prop</span>)
  : <span class="kt">Prop</span> :=
{
  valid_trace_add_last :
    <span class="kr">forall</span> [msg] [X : VLSM msg] [s f tr],
      base_prop X s tr -&gt; finite_trace_last s tr = f -&gt; trace_prop X s f tr;
  valid_trace_get_last :
    <span class="kr">forall</span> [msg] [X : VLSM msg] [s f tr],
      trace_prop X s f tr -&gt; finite_trace_last s tr = f;
  valid_trace_last_pstate :
    <span class="kr">forall</span> [msg] [X : VLSM msg] [s f tr],
      trace_prop X s f tr -&gt; valid_state_prop X f;
  valid_trace_forget_last :
    <span class="kr">forall</span> [msg] [X : VLSM msg] [s f tr],
      trace_prop X s f tr -&gt; base_prop X s tr;
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[<span class="kn">global</span>] <span class="kn">Hint Mode</span> TraceWithLast - ! : typeclass_instances.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input">#[<span class="kn">global</span>] <span class="kn">Hint Mode</span> TraceWithLast ! - : typeclass_instances.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk399" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk399"><span class="kn">Definition</span> <span class="nf">valid_trace_add_default_last</span>
  `{TraceWithLast base_prop trace_prop}
  [msg] [X : VLSM msg] [s tr] (Htr : base_prop msg X s tr) :
    trace_prop msg X s (finite_trace_last s tr) tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>base_prop</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">message</span> : <span class="kt">Type</span>) (<span class="nv">X</span> : VLSM message),
  state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>trace_prop</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">message</span> : <span class="kt">Type</span>) (<span class="nv">X</span> : VLSM message),
  state X
  ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>TraceWithLast base_prop trace_prop</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM msg</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>base_prop msg X s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">trace_prop msg X s (finite_trace_last s tr) tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk39a" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk39a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>base_prop</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">message</span> : <span class="kt">Type</span>) (<span class="nv">X</span> : VLSM message),
  state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>trace_prop</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> (<span class="nv">message</span> : <span class="kt">Type</span>) (<span class="nv">X</span> : VLSM message),
  state X
  ‚Üí state X ‚Üí list transition_item ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>TraceWithLast base_prop trace_prop</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM msg</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>base_prop msg X s tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">trace_prop msg X s (finite_trace_last s tr) tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> valid_trace_add_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Defined</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[export] <span class="kn">Instance</span> <span class="nf">trace_with_last_valid_trace_from</span> :
  TraceWithLast (@finite_valid_trace_from) (@finite_valid_trace_from_to) :=
{
  valid_trace_add_last := @finite_valid_trace_from_add_last;
  valid_trace_get_last := @finite_valid_trace_from_to_last;
  valid_trace_last_pstate := @finite_valid_trace_from_to_last_pstate;
  valid_trace_forget_last := @finite_valid_trace_from_to_forget_last;
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[export] <span class="kn">Instance</span> <span class="nf">trace_with_last_valid_trace_init</span> :
  TraceWithLast (@finite_valid_trace) (@finite_valid_trace_init_to) :=
{
  valid_trace_add_last := @finite_valid_trace_init_add_last;
  valid_trace_get_last := @finite_valid_trace_init_to_last;
  valid_trace_last_pstate _ _ _ _ _ H := valid_trace_last_pstate (proj1 H);
  valid_trace_forget_last := @finite_valid_trace_init_to_forget_last;
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Class</span> <span class="nf">TraceWithStart</span>
  {<span class="nv">message</span>} {<span class="nv">X</span> : VLSM message}
  (<span class="nv">start</span> : state X)
  (<span class="nv">trace_prop</span> : list (transition_item X) -&gt; <span class="kt">Prop</span>)
  : <span class="kt">Prop</span> :=
{
  valid_trace_first_pstate :
    <span class="kr">forall</span> [tr], trace_prop tr -&gt; valid_state_prop X start;
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[<span class="kn">global</span>] <span class="kn">Hint Mode</span> TraceWithStart - - - ! : typeclass_instances.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[export] <span class="kn">Instance</span> <span class="nf">trace_with_start_valid_trace_from</span> <span class="nv">message</span> (<span class="nv">X</span> : VLSM message) <span class="nv">s</span> :
  TraceWithStart s (finite_valid_trace_from X s) :=
{
  valid_trace_first_pstate := finite_valid_trace_first_pstate X s
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[export] <span class="kn">Instance</span> <span class="nf">trace_with_start_valid_trace</span> <span class="nv">message</span> (<span class="nv">X</span> : VLSM message) <span class="nv">s</span> :
  TraceWithStart s (finite_valid_trace X s) :=
{
  valid_trace_first_pstate tr H := valid_trace_first_pstate (proj1 H);
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[export] <span class="kn">Instance</span> <span class="nf">trace_with_start_valid_trace_from_to</span> <span class="nv">message</span> (<span class="nv">X</span> : VLSM message) <span class="nv">s</span> <span class="nv">f</span> :
  TraceWithStart s (finite_valid_trace_from_to X s f) :=
{
  valid_trace_first_pstate tr H := valid_trace_first_pstate (valid_trace_forget_last H);
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[export] <span class="kn">Instance</span> <span class="nf">trace_with_start_valid_trace_init_to</span> <span class="nv">message</span> (<span class="nv">X</span> : VLSM message) <span class="nv">s</span> <span class="nv">f</span> :
  TraceWithStart s (finite_valid_trace_init_to X s f) :=
{
  valid_trace_first_pstate tr H := valid_trace_first_pstate (valid_trace_forget_last H);
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk39b" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk39b"><span class="kn">Lemma</span> <span class="nf">non_empty_valid_trace_from_can_produce</span>
  `(X : VLSM message)
  (s : state X)
  (m : message) :
    can_produce X s m &lt;-&gt;
    <span class="kr">exists</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
      finite_valid_trace X <span class="kr">is</span> tr /\
      last_error tr = Some item /\
      destination item = s /\ output item = Some m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m
‚Üî (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
     finite_valid_trace X <span class="kr">is</span> tr
     ‚àß last_error tr = Some item
       ‚àß destination item = s ‚àß output item = Some m)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk39c" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk39c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m
‚Üî (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
     finite_valid_trace X <span class="kr">is</span> tr
     ‚àß last_error tr = Some item
       ‚àß destination item = s ‚àß output item = Some m)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk39d" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk39d"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m
‚Üí <span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
    finite_valid_trace X <span class="kr">is</span> tr
    ‚àß last_error tr = Some item
      ‚àß destination item = s ‚àß output item = Some m</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk39e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk39e"><hr></label><div class="goal-conclusion">(<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) 
   (<span class="nv">item</span> : transition_item),
   finite_valid_trace X <span class="kr">is</span> tr
   ‚àß last_error tr = Some item
     ‚àß destination item = s ‚àß output item = Some m)
‚Üí can_produce X s m</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk39f" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk39f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m
‚Üí <span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
    finite_valid_trace X <span class="kr">is</span> tr
    ‚àß last_error tr = Some item
      ‚àß destination item = s ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a0"><span class="nb">intros</span> [(s&#39;, om&#39;) [l Hsm]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hsm</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l (s&#39;, om&#39;) (s, Some m)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace X <span class="kr">is</span> tr
  ‚àß last_error tr = Some item
    ‚àß destination item = s ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a1"><span class="nb">destruct</span> (id Hsm) <span class="kr">as</span> [[Hp _] _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hsm</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l (s&#39;, om&#39;) (s, Some m)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace X <span class="kr">is</span> tr
  ‚àß last_error tr = Some item
    ‚àß destination item = s ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a2"><span class="nb">pose proof</span> (finite_valid_trace_singleton _ Hsm) <span class="kr">as</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hsm</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l (s&#39;, om&#39;) (s, Some m)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s&#39;</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from X s&#39;
  [{|
     l := l;
     input := om&#39;;
     destination := s;
     output := Some m
   |}]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace X <span class="kr">is</span> tr
  ‚àß last_error tr = Some item
    ‚àß destination item = s ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a3"><span class="nb">apply</span> finite_valid_trace_from_complete_left <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hsm</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l (s&#39;, om&#39;) (s, Some m)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s&#39;</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">trs</span> : list transition_item),
  finite_valid_trace X <span class="kr">is</span>
    (trs ++
     [{|
        l := l;
        input := om&#39;;
        destination := s;
        output := Some m
      |}]) ‚àß finite_trace_last <span class="kr">is</span> trs = s&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace X <span class="kr">is</span> tr
  ‚àß last_error tr = Some item
    ‚àß destination item = s ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a4"><span class="nb">destruct</span>  Htr <span class="kr">as</span> [<span class="kr">is</span> [trs [Htrs _]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hsm</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l (s&#39;, om&#39;) (s, Some m)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s&#39;</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace X <span class="kr">is</span>
  (trs ++
   [{|
      l := l;
      input := om&#39;;
      destination := s;
      output := Some m
    |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
  finite_valid_trace X <span class="kr">is</span> tr
  ‚àß last_error tr = Some item
    ‚àß destination item = s ‚àß output item = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a5"><span class="nb">eexists</span> <span class="kr">is</span>, (trs ++ _), _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hsm</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l (s&#39;, om&#39;) (s, Some m)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s&#39;</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>trs</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htrs</var><span class="hyp-type"><b>: </b><span>finite_valid_trace X <span class="kr">is</span>
  (trs ++
   [{|
      l := l;
      input := om&#39;;
      destination := s;
      output := Some m
    |}])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace X <span class="kr">is</span> (trs ++ <span class="nl">?Goal0</span>)
‚àß last_error (trs ++ <span class="nl">?Goal0</span>) = Some <span class="nl">?Goal1</span>
  ‚àß destination <span class="nl">?Goal1</span> = s ‚àß output <span class="nl">?Goal1</span> = Some m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> last_error_is_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item) (<span class="nv">item</span> : transition_item),
   finite_valid_trace X <span class="kr">is</span> tr
   ‚àß last_error tr = Some item
     ‚àß destination item = s ‚àß output item = Some m)
‚Üí can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a7"><span class="nb">intros</span> [<span class="kr">is</span> [tr [item [Htr [Hitem [Hs Hm]]]]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace X <span class="kr">is</span> tr</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>last_error tr = Some item</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a8">destruct_list_last tr tr&#39; item&#39; Heq; [<span class="bp">by</span> <span class="nb">inversion</span> Hitem |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item'</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace X <span class="kr">is</span> (tr&#39; ++ [item&#39;])</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>last_error (tr&#39; ++ [item&#39;]) = Some item</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>tr = tr&#39; ++ [item&#39;]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3a9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3a9"><span class="nb">clear</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item'</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace X <span class="kr">is</span> (tr&#39; ++ [item&#39;])</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>last_error (tr&#39; ++ [item&#39;]) = Some item</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3aa" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3aa"><span class="nb">rewrite</span> last_error_is_last <span class="kr">in</span> Hitem.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item'</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace X <span class="kr">is</span> (tr&#39; ++ [item&#39;])</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>Some item&#39; = Some item</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ab" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ab"><span class="nb">inversion</span> Hitem.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item'</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace X <span class="kr">is</span> (tr&#39; ++ [item&#39;])</span></span></span><br><span><var>Hitem</var><span class="hyp-type"><b>: </b><span>Some item&#39; = Some item</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>item&#39; = item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ac" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ac"><span class="nb">clear</span> Hitem.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item'</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace X <span class="kr">is</span> (tr&#39; ++ [item&#39;])</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>item&#39; = item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ad" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ad"><span class="nb">subst</span> item&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace X <span class="kr">is</span> (tr&#39; ++ [item])</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ae" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ae"><span class="nb">destruct</span> Htr <span class="kr">as</span> [Htr _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from X <span class="kr">is</span> (tr&#39; ++ [item])</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3af" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3af"><span class="nb">apply</span> finite_valid_trace_from_app_iff <span class="kr">in</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from X <span class="kr">is</span> tr&#39;
‚àß finite_valid_trace_from X
    (finite_trace_last <span class="kr">is</span> tr&#39;) [item]</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b0"><span class="nb">destruct</span> Htr <span class="kr">as</span> [_ Htr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from X
  (finite_trace_last <span class="kr">is</span> tr&#39;) [item]</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b1"><span class="nb">inversion</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from X
  (finite_trace_last <span class="kr">is</span> tr&#39;) [item]</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from X s1 []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l0
  (finite_trace_last <span class="kr">is</span> tr&#39;, iom) (
  s1, oom)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>s&#39; = finite_trace_last <span class="kr">is</span> tr&#39;</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>{|
  l := l0;
  input := iom;
  destination := s1;
  output := oom
|} = item</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>tl = []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b2"><span class="nb">clear</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>destination item = s</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output item = Some m</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from X s1 []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l0
  (finite_trace_last <span class="kr">is</span> tr&#39;, iom) (
  s1, oom)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>s&#39; = finite_trace_last <span class="kr">is</span> tr&#39;</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>{|
  l := l0;
  input := iom;
  destination := s1;
  output := oom
|} = item</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>tl = []</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X s m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b3"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>output
  {|
    l := l0;
    input := iom;
    destination := s1;
    output := oom
  |} = Some m</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from X s1 []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l0
  (finite_trace_last <span class="kr">is</span> tr&#39;, iom) (
  s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X
  (destination
     {|
       l := l0;
       input := iom;
       destination := s1;
       output := oom
     |}) m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b4"><span class="nb">simpl</span> <span class="kr">in</span> Hm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>oom = Some m</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from X s1 []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l0
  (finite_trace_last <span class="kr">is</span> tr&#39;, iom) (
  s1, oom)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X
  (destination
     {|
       l := l0;
       input := iom;
       destination := s1;
       output := oom
     |}) m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b5"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr, tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from X s1 []</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l0
  (finite_trace_last <span class="kr">is</span> tr&#39;, iom) (
  s1, Some m)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">can_produce X
  (destination
     {|
       l := l0;
       input := iom;
       destination := s1;
       output := Some m
     |}) m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eexists</span> _, l0; <span class="nb">apply</span> Ht.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
The last transition of a valid VLSM trace is valid 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b6"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_last_transition</span> `(X : VLSM message) :
  <span class="kr">forall</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> <span class="nv">tr&#39;</span> : list (transition_item X)) (<span class="nv">li</span> : transition_item X),
    finite_valid_trace_from_to X s f tr&#39; -&gt; tr&#39; = tr ++ [li] -&gt;
      input_valid_transition_item X (finite_trace_last s tr) li.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> <span class="nv">tr&#39;</span> : list transition_item) 
  (<span class="nv">li</span> : transition_item),
  finite_valid_trace_from_to X s f tr&#39;
  ‚Üí tr&#39; = tr ++ [li]
    ‚Üí input_valid_transition_item X
        (finite_trace_last s tr) li</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b7"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> <span class="nv">tr&#39;</span> : list transition_item) 
  (<span class="nv">li</span> : transition_item),
  finite_valid_trace_from_to X s f tr&#39;
  ‚Üí tr&#39; = tr ++ [li]
    ‚Üí input_valid_transition_item X
        (finite_trace_last s tr) li</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> * Htr; <span class="nb">eapply</span> input_valid_transition_to, valid_trace_forget_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab15"></a><h3 class="section">Properties of provably-equal VLSMs</h3>
<div class="paragraph"> </div>

  If we know that two VLSMs are provably equal, we could try rewriting by them.
  However, that gets usually quite technical. To go around that, we will prove
  that there is a <span class="inlinecode"><span class="id" title="var">VLSMProjections.VLSM_embedding</span></span> between them which will
  allow trace-based results to be easily moved between the two VLSMs.

<div class="paragraph"> </div>

  Below are some preliminary results; the actual projection is given in
  <span class="inlinecode"><span class="id" title="var">VLSMProjections.same_VLSM_embedding</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">sec_same_VLSM</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  {<span class="nv">message</span> : <span class="kt">Type</span>}
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">sec_definitions</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  [X1 X2 : VLSM message]
  (Heq : X1 = X2)
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">same_VLSM_label_rew</span> (<span class="nv">l1</span> : label X1) : label X2 :=
  eq_rect X1 (@label _) l1 _ Heq.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">same_VLSM_state_rew</span> (<span class="nv">s1</span> : state X1) : state X2 :=
  eq_rect X1 (@state _) s1 _ Heq.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">sec_definitions</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  (<span class="nv">X1</span> <span class="nv">X2</span> : VLSM message)
  (<span class="nv">Heq</span> : X1 = X2)
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b8"><span class="kn">Lemma</span> <span class="nf">same_VLSM_valid_preservation</span> :
  <span class="kr">forall</span> (<span class="nv">l1</span> : label X1) (<span class="nv">s1</span> : state X1) (<span class="nv">om</span> : option message),
    valid X1 l1 (s1, om) -&gt;
    valid X2 (same_VLSM_label_rew Heq l1) (same_VLSM_state_rew Heq s1, om).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X1, X2</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>X1 = X2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l1</span> : label X1) (<span class="nv">s1</span> : state X1) (<span class="nv">om</span> : option message),
  valid l1 (s1, om)
  ‚Üí valid (same_VLSM_label_rew Heq l1)
      (same_VLSM_state_rew Heq s1, om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3b9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3b9"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X1, X2</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>X1 = X2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l1</span> : label X1) (<span class="nv">s1</span> : state X1) (<span class="nv">om</span> : option message),
  valid l1 (s1, om)
  ‚Üí valid (same_VLSM_label_rew Heq l1)
      (same_VLSM_state_rew Heq s1, om)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">subst</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ba" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ba"><span class="kn">Lemma</span> <span class="nf">same_VLSM_transition_preservation</span>
  (<span class="nv">l1</span> : label X1) (<span class="nv">s1</span> : state X1) (<span class="nv">om</span> : option message) (<span class="nv">s1&#39;</span> : state X1) (<span class="nv">om&#39;</span> : option message) :
    transition X1 l1 (s1, om) = (s1&#39;, om&#39;) -&gt;
    transition X2 (same_VLSM_label_rew Heq l1) (same_VLSM_state_rew Heq s1, om) =
      (same_VLSM_state_rew Heq s1&#39;, om&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X1, X2</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>X1 = X2</span></span></span><br><span><var>l1</var><span class="hyp-type"><b>: </b><span>label X1</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X1</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s1'</var><span class="hyp-type"><b>: </b><span>state X1</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">transition l1 (s1, om) = (s1&#39;, om&#39;)
‚Üí transition (same_VLSM_label_rew Heq l1)
    (same_VLSM_state_rew Heq s1, om) =
  (same_VLSM_state_rew Heq s1&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3bb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3bb"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X1, X2</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>X1 = X2</span></span></span><br><span><var>l1</var><span class="hyp-type"><b>: </b><span>label X1</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state X1</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s1'</var><span class="hyp-type"><b>: </b><span>state X1</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">transition l1 (s1, om) = (s1&#39;, om&#39;)
‚Üí transition (same_VLSM_label_rew Heq l1)
    (same_VLSM_state_rew Heq s1, om) =
  (same_VLSM_state_rew Heq s1&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">subst</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3bc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3bc"><span class="kn">Lemma</span> <span class="nf">same_VLSM_initial_state_preservation</span> :
  <span class="kr">forall</span> (<span class="nv">s1</span> : state X1),
    initial_state_prop X1 s1 -&gt; initial_state_prop X2 (same_VLSM_state_rew Heq s1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X1, X2</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>X1 = X2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s1</span> : state X1,
  initial_state_prop s1
  ‚Üí initial_state_prop (same_VLSM_state_rew Heq s1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3bd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3bd"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X1, X2</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>X1 = X2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s1</span> : state X1,
  initial_state_prop s1
  ‚Üí initial_state_prop (same_VLSM_state_rew Heq s1)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">subst</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3be" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3be"><span class="kn">Lemma</span> <span class="nf">same_VLSM_initial_message_preservation</span> :
  <span class="kr">forall</span> (<span class="nv">m</span> : message),
    initial_message_prop X1 m -&gt; initial_message_prop X2 m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X1, X2</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>X1 = X2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m</span> : message,
  initial_message_prop m ‚Üí initial_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3bf" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3bf"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X1, X2</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>X1 = X2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">m</span> : message,
  initial_message_prop m ‚Üí initial_message_prop m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">subst</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">sec_same_VLSM</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Record</span> <span class="nf">valid_transition</span> `(X : VLSM message) l s1 iom s2 oom : <span class="kt">Prop</span> :=
{
  vt_valid : valid X l (s1, iom);
  vt_transition : transition X l (s1, iom) = (s2, oom);
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">valid_transition_next</span> `(X : VLSM message) (s1 s2 : state X) : <span class="kt">Prop</span> :=
| transition_next :
    <span class="kr">forall</span> (<span class="nv">l</span> : label X) (<span class="nv">iom</span> <span class="nv">oom</span> : option message)
      (<span class="nv">Ht</span> : valid_transition X l s1 iom s2 oom),
        valid_transition_next X s1 s2.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">sec_valid_transition_props</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  `(X : VLSM message)
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3c0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3c0"><span class="kn">Lemma</span> <span class="nf">input_valid_transition_forget_input</span> :
  <span class="kr">forall</span> <span class="nv">l</span> <span class="nv">s1</span> <span class="nv">iom</span> <span class="nv">s2</span> <span class="nv">oom</span>,
    input_valid_transition X l (s1, iom) (s2, oom) -&gt;
    valid_transition X l s1 iom s2 oom.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">s1</span> : state X) (<span class="nv">iom</span> : option message) 
  (<span class="nv">s2</span> : state X) (<span class="nv">oom</span> : option message),
  input_valid_transition X l (s1, iom) (s2, oom)
  ‚Üí valid_transition X l s1 iom s2 oom</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3c1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3c1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">l</span> : label X) (<span class="nv">s1</span> : state X) (<span class="nv">iom</span> : option message) 
  (<span class="nv">s2</span> : state X) (<span class="nv">oom</span> : option message),
  input_valid_transition X l (s1, iom) (s2, oom)
  ‚Üí valid_transition X l s1 iom s2 oom</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">firstorder</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">sec_valid_transition_props</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">sec_finite_valid_trace_init_to_alt</span>.</span></span></pre><div class="doc">
<a id="lab16"></a><h2 class="section">Alternate definitions of valid traces and states</h2>
<div class="paragraph"> </div>

  Inspired from the <span class="inlinecode"><span class="id" title="var">constrained_transitions_from_to</span></span> definition we can
  derive an alternate definition for valid traces which is easier to use
  when checking whether a concrete trace is valid.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  `(X : VLSM message)
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">message_valid_transitions_from_to</span> :
  state X -&gt; state X -&gt; list (transition_item X) -&gt; <span class="kt">Prop</span> :=
| mvt_empty :
    <span class="kr">forall</span> (<span class="nv">s</span> : state X),
      message_valid_transitions_from_to s s []
| mvt_extend :
    <span class="kr">forall</span> <span class="nv">s</span> <span class="nv">s&#39;</span> <span class="nv">om</span> <span class="nv">om&#39;</span> <span class="nv">l</span> <span class="nv">f</span> <span class="nv">tr</span>,
      option_valid_message_prop X om -&gt;
      transition X l (s, om) = (s&#39;, om&#39;) -&gt; valid X l (s, om) -&gt;
      message_valid_transitions_from_to s&#39; f tr -&gt;
      message_valid_transitions_from_to s f (Build_transition_item l om s&#39; om&#39; :: tr).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">finite_valid_trace_init_to_alt</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list (transition_item X)) : <span class="kt">Prop</span> :=
    message_valid_transitions_from_to s f tr /\ initial_state_prop X s.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3c2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3c2"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_alt_left_impl</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list (transition_item X)) :
    finite_valid_trace_init_to X s f tr -&gt; finite_valid_trace_init_to_alt s f tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to X s f tr
‚Üí finite_valid_trace_init_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3c3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3c3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to X s f tr
‚Üí finite_valid_trace_init_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3c4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3c4"><span class="nb">intros</span> [Htr Hinit].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3c5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3c5"><span class="nb">constructor</span>; [| <span class="bp">done</span>]; <span class="nb">clear</span> Hinit.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to X s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">message_valid_transitions_from_to s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3c6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3c6"><span class="nb">induction</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">message_valid_transitions_from_to s s []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk3c7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to X s f tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>IHHtr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f tl</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk3c7"><hr></label><div class="goal-conclusion">message_valid_transitions_from_to s&#39; f
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3c8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3c8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">message_valid_transitions_from_to s s []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3c9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3c9">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to X s f tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>IHHtr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">message_valid_transitions_from_to s&#39; f
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>; [<span class="nb">apply</span> Ht.. |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ca" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ca"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_alt_right_impl</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list (transition_item X)) :
    finite_valid_trace_init_to_alt s f tr -&gt; finite_valid_trace_init_to X s f tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_alt s f tr
‚Üí finite_valid_trace_init_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3cb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3cb"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_alt s f tr
‚Üí finite_valid_trace_init_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3cc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3cc"><span class="nb">intros</span> [Htr Hs].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f tr</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3cd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3cd"><span class="nb">split</span>; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f tr</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ce" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ce"><span class="nb">apply</span> (initial_state_is_valid X) <span class="kr">in</span> Hs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f tr</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3cf" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3cf"><span class="nb">revert</span> s Hs Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3d0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3d0"><span class="nb">induction</span> tr; <span class="nb">intros</span>; <span class="nb">inversion</span> Htr; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to f f []</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X f</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X f f []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk3d1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>option_valid_message_prop X om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s&#39; f tr</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk3d1"><hr></label><div class="goal-conclusion">finite_valid_trace_from_to X s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3d2" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3d2">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to f f []</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X f</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X f f []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (finite_valid_trace_from_to_empty X).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3d3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3d3">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>option_valid_message_prop X om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s&#39; f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3d4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3d4"><span class="nb">apply</span> (finite_valid_trace_from_to_extend X); [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>option_valid_message_prop X om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s&#39; f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s&#39; f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3d5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3d5"><span class="nb">apply</span> IHtr; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>option_valid_message_prop X om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s&#39; f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop X s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3d6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3d6"><span class="nb">apply</span> valid_state_prop_iff; <span class="nb">right</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>option_valid_message_prop X om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s&#39; f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) (<span class="nv">om&#39;</span> : 
                                                 option
                                                 message),
  input_valid_transition X l som (s&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="nv">l0</span>, (s, om), om&#39;.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3d7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3d7"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_init_to_alt_equiv</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list (transition_item X)) :
    finite_valid_trace_init_to X s f tr &lt;-&gt; finite_valid_trace_init_to_alt s f tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to X s f tr
‚Üî finite_valid_trace_init_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3d8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3d8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to X s f tr
‚Üî finite_valid_trace_init_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3d9" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3d9"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to X s f tr
‚Üí finite_valid_trace_init_to_alt s f tr</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk3da" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk3da"><hr></label><div class="goal-conclusion">finite_valid_trace_init_to_alt s f tr
‚Üí finite_valid_trace_init_to X s f tr</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3db" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3db">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to X s f tr
‚Üí finite_valid_trace_init_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_init_to_alt_left_impl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3dc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3dc">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_init_to_alt s f tr
‚Üí finite_valid_trace_init_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_init_to_alt_right_impl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">finite_valid_trace_from_to_alt</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list (transition_item X)) : <span class="kt">Prop</span> :=
    message_valid_transitions_from_to s f tr /\ valid_state_prop X s.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3dd" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3dd"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_alt_left_impl</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list (transition_item X)) :
    finite_valid_trace_from_to X s f tr -&gt; finite_valid_trace_from_to_alt s f tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s f tr
‚Üí finite_valid_trace_from_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3de" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3de"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s f tr
‚Üí finite_valid_trace_from_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3df" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3df"><span class="nb">intros</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to X s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3e0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3e0"><span class="nb">split</span>; [| <span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_first_pstate <span class="kr">in</span> Htr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to X s f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">message_valid_transitions_from_to s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3e1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3e1"><span class="nb">induction</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">message_valid_transitions_from_to s s []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk3e2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to X s f tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>IHHtr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f tl</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk3e2"><hr></label><div class="goal-conclusion">message_valid_transitions_from_to s&#39; f
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3e3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3e3">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">message_valid_transitions_from_to s s []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3e4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3e4">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tl</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to X s f tl</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>iom, oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>input_valid_transition X l0 (s&#39;, iom) (s, oom)</span></span></span><br><span><var>IHHtr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f tl</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">message_valid_transitions_from_to s&#39; f
  ({|
     l := l0;
     input := iom;
     destination := s;
     output := oom
   |} :: tl)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">constructor</span>; [<span class="nb">apply</span> Ht.. |].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3e5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3e5"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_alt_right_impl</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list (transition_item X)) :
    finite_valid_trace_from_to_alt s f tr -&gt; finite_valid_trace_from_to X s f tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to_alt s f tr
‚Üí finite_valid_trace_from_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3e6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3e6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to_alt s f tr
‚Üí finite_valid_trace_from_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3e7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3e7"><span class="nb">intros</span> [Htr Hs]; <span class="nb">revert</span> s Hs Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3e8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3e8"><span class="nb">induction</span> tr; <span class="nb">intros</span>; <span class="nb">inversion</span> Htr; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to f f []</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X f</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X f f []</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk3e9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>option_valid_message_prop X om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s&#39; f tr</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk3e9"><hr></label><div class="goal-conclusion">finite_valid_trace_from_to X s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ea" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ea">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to f f []</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X f</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X f f []</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (finite_valid_trace_from_to_empty X).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3eb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3eb">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>option_valid_message_prop X om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s&#39; f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ec" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ec"><span class="nb">apply</span> (finite_valid_trace_from_to_extend X); [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>option_valid_message_prop X om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s&#39; f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s&#39; f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ed" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ed"><span class="nb">apply</span> IHtr; [| <span class="bp">done</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>option_valid_message_prop X om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s&#39; f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop X s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ee" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ee"><span class="nb">apply</span> valid_state_prop_iff; <span class="nb">right</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">s</span> : state X,
  valid_state_prop X s
  ‚Üí message_valid_transitions_from_to s f tr
    ‚Üí finite_valid_trace_from_to X s f tr</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>valid_state_prop X s</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>om, om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>l0</var><span class="hyp-type"><b>: </b><span>label X</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s f
  ({|
     l := l0;
     input := om;
     destination := s&#39;;
     output := om&#39;
   |} :: tr)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>option_valid_message_prop X om</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>transition l0 (s, om) = (s&#39;, om&#39;)</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>valid l0 (s, om)</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>message_valid_transitions_from_to s&#39; f tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÉ</span> (<span class="nv">l</span> : label X) (<span class="nv">som</span> : state X * option message) (<span class="nv">om&#39;</span> : 
                                                 option
                                                 message),
  input_valid_transition X l som (s&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="nv">l0</span>, (s, om), om&#39;.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3ef" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3ef"><span class="kn">Lemma</span> <span class="nf">finite_valid_trace_from_to_alt_equiv</span>
  (<span class="nv">s</span> <span class="nv">f</span> : state X) (<span class="nv">tr</span> : list (transition_item X)) :
    finite_valid_trace_from_to X s f tr &lt;-&gt; finite_valid_trace_from_to_alt s f tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s f tr
‚Üî finite_valid_trace_from_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3f0" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3f0"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s f tr
‚Üî finite_valid_trace_from_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3f1" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3f1"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s f tr
‚Üí finite_valid_trace_from_to_alt s f tr</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk3f2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk3f2"><hr></label><div class="goal-conclusion">finite_valid_trace_from_to_alt s f tr
‚Üí finite_valid_trace_from_to X s f tr</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3f3" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3f3">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to X s f tr
‚Üí finite_valid_trace_from_to_alt s f tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_alt_left_impl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3f4" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3f4">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, f</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">finite_valid_trace_from_to_alt s f tr
‚Üí finite_valid_trace_from_to X s f tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> finite_valid_trace_from_to_alt_right_impl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
  Similarly, we can alternately define valid states as states at the end of
  a trace satisfying <span class="inlinecode"><span class="id" title="var">finite_valid_trace_init_to_alt</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">valid_state_prop_alt</span> (<span class="nv">s</span> : state X) : <span class="kt">Prop</span> :=
  <span class="kr">exists</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list (transition_item X)),
    finite_valid_trace_init_to_alt <span class="kr">is</span> s tr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3f5" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3f5"><span class="kn">Lemma</span> <span class="nf">valid_state_prop_alt_equiv</span> (<span class="nv">s</span> : state X) :
  valid_state_prop X s &lt;-&gt; valid_state_prop_alt s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop X s ‚Üî valid_state_prop_alt s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3f6" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3f6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop X s ‚Üî valid_state_prop_alt s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3f7" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3f7"><span class="nb">unfold</span> valid_state_prop_alt; <span class="nb">setoid_rewrite</span> &lt;- finite_valid_trace_init_to_alt_equiv.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop X s
‚Üî (<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
     finite_valid_trace_init_to X <span class="kr">is</span> s tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3f8" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3f8"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop X s
‚Üí <span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_init_to X <span class="kr">is</span> s tr</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="VLSM-v-chk3f9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><label class="goal-separator" for="VLSM-v-chk3f9"><hr></label><div class="goal-conclusion">(<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
   finite_valid_trace_init_to X <span class="kr">is</span> s tr)
‚Üí valid_state_prop X s</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3fa" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3fa">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop X s
‚Üí <span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
    finite_valid_trace_init_to X <span class="kr">is</span> s tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> Hs; <span class="nb">apply</span> valid_state_has_trace <span class="kr">in</span> Hs.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3fb" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3fb">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">‚àÉ</span> (<span class="nv">is</span> : state X) (<span class="nv">tr</span> : list transition_item),
   finite_valid_trace_init_to X <span class="kr">is</span> s tr)
‚Üí valid_state_prop X s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="VLSM-v-chk3fc" style="display: none" type="checkbox"><label class="alectryon-input" for="VLSM-v-chk3fc"><span class="nb">intros</span> (? &amp; ? &amp; Htr &amp; _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>s, x</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>finite_valid_trace_from_to X x s x0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">valid_state_prop X s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">eapply</span> finite_valid_trace_from_to_last_pstate.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">sec_finite_valid_trace_init_to_alt</span>.</span></span></pre><div class="doc">
Custom tactic used to simplify proofs of valid VLSM transitions. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">app_valid_tran</span> :=
  <span class="kp">repeat</span> <span class="nb">split</span>; <span class="nb">cbn</span>; <span class="kp">try</span> <span class="bp">done</span>;
  <span class="kr">match goal with</span>
  | |- option_valid_message_prop _ _ =&gt; <span class="bp">by</span> <span class="nb">apply</span> initial_message_is_valid
  | |- option_valid_message_prop _ _ =&gt; <span class="nb">eapply</span> emitted_messages_are_valid
  | |- valid_state_prop _ _ =&gt; <span class="bp">by</span> <span class="nb">apply</span> initial_state_is_valid
  | |- valid_state_prop _ _ =&gt; <span class="nb">eapply</span> input_valid_transition_destination
  <span class="kr">end</span>.</span></span></pre></article></body></html>