<!DOCTYPE html>
<html class="alectryon-standalone"><head><title>AnnotatedVLSM.v</title><meta charset="utf-8"><meta content="Alectryon" name="generator"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="alectryon.css" rel="stylesheet"><link href="pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" /><script src="alectryon.js"></script></head><body><article class="alectryon-root alectryon-windowed alectryon-coqdoc"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Coq+SerAPI v8.18.0+0.18.1. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+‚Üë</kbd> <kbd>Ctrl+‚Üì</kbd> to navigate, <kbd>Ctrl+üñ±Ô∏è</kbd> to focus. On Mac, use <kbd>‚åò</kbd> instead of <kbd>Ctrl</kbd>.</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk0"><span class="kn">From</span> VLSM.Lib <span class="kn">Require Import</span> Itauto.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">[Loading ML file ring_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file zify_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file micromega_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file btauto_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file coq-itauto.plugin ... <span class="bp">done</span>]</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> stdpp <span class="kn">Require Import</span> prelude.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> VLSM.Lib <span class="kn">Require Import</span> ListExtras.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> VLSM.Core <span class="kn">Require Import</span> VLSM PreloadedVLSM VLSMProjections Validator Composition.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> VLSM.Core <span class="kn">Require Import</span> ConstrainedVLSM.</span></span></pre><div class="doc">
<a id="lab1"></a><h1 class="section">Core: State-Annotated VLSMs</h1>
<div class="paragraph"> </div>

  This module describes the VLSM obtained by augmenting the states of an existing
  VLSM with annotations and providing additional validity constraints taking into
  account the annotations, and a function for updating the annotations following a
  transition.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">sec_annotated_vlsm</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  {<span class="nv">message</span> : <span class="kt">Type</span>}
  (<span class="nv">X</span> : VLSM message)
  (<span class="nv">annotation</span> : <span class="kt">Type</span>)
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Record</span> <span class="nf">annotated_state</span> : <span class="kt">Type</span> := mk_annotated_state
{
  original_state : state X;
  state_annotation : annotation;
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_type</span> : VLSMType message :=
  {| label := label X;
     state := annotated_state
  |}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  (<span class="nv">initial_annotation_prop</span> : annotation -&gt; <span class="kt">Prop</span>)
  `{Inhabited (sig initial_annotation_prop)}
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_initial_state_prop</span> (<span class="nv">sa</span> : annotated_state) : <span class="kt">Prop</span> :=
  initial_state_prop X (original_state sa) /\ initial_annotation_prop (state_annotation sa).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[export] <span class="kn">Program Instance</span> <span class="nf">annotated_initial_state_prop_inhabited</span> :
  Inhabited {sa : annotated_state | annotated_initial_state_prop sa} :=
    populate (exist _ {| original_state := `(vs0 X); state_annotation := `inhabitant; |} _).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk1"><span class="kn">Next Obligation</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">Œª</span> <span class="nv">sa</span> : annotated_state,
   annotated_initial_state_prop sa)
  {|
    original_state := `(vs0 X);
    state_annotation := `inhabitant
  |}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk2"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">Œª</span> <span class="nv">sa</span> : annotated_state,
   annotated_initial_state_prop sa)
  {|
    original_state := `(vs0 X);
    state_annotation := `inhabitant
  |}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk3"><span class="nb">split</span>; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop (`(vs0 X))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk4"><hr></label><div class="goal-conclusion">initial_annotation_prop (`inhabitant)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk5">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_state_prop (`(vs0 X))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> (vs0 X).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_annotation_prop (`inhabitant)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> inhabitant.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  (<span class="nv">annotated_transition_state</span> :
    label annotated_type -&gt; annotated_state * option message -&gt; annotation)
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_valid</span>
  (<span class="nv">l</span> : label annotated_type)
  (<span class="nv">som</span> : annotated_state * option message)
  : <span class="kt">Prop</span> :=
  valid X l (original_state som.<span class="mi">1</span>, som.<span class="mi">2</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_transition</span>
  (<span class="nv">l</span> : label annotated_type)
  (<span class="nv">som</span> : annotated_state * option message)
  : annotated_state * option message :=
  <span class="kr">let</span> (<span class="nv">s&#39;</span>, om&#39;) := transition X l (original_state som.<span class="mi">1</span>, som.<span class="mi">2</span>) <span class="kr">in</span>
  ({| original_state := s&#39;; state_annotation := annotated_transition_state l som |}, om&#39;).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_vlsm_machine</span> : VLSMMachine annotated_type :=
  {| initial_state_prop := <span class="kr">fun</span> <span class="nv">s</span> : state annotated_type =&gt; annotated_initial_state_prop s
  ; initial_message_prop := <span class="kr">fun</span> <span class="nv">m</span> : message =&gt; initial_message_prop X m
  ; valid := annotated_valid
  ; transition := annotated_transition
  |}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_vlsm</span> : VLSM message := mk_vlsm annotated_vlsm_machine.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotate_trace_item</span>
  (<span class="nv">item</span> : transition_item X)
  (<span class="nv">k</span> : annotated_state -&gt; list (transition_item annotated_type))
  (<span class="nv">sa</span> : annotated_state)
  : list (transition_item annotated_type) :=
    <span class="kr">let</span> <span class="nv">sa&#39;</span> :=
      {|
        original_state := destination item;
        state_annotation := annotated_transition_state (l item) (sa, input item);
      |}
    <span class="kr">in</span>
      Build_transition_item annotated_type (l item) (input item) sa&#39; (output item) :: k sa&#39;.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk7"><span class="kn">Lemma</span> <span class="nf">annotate_trace_item_project</span>
  (<span class="nv">item</span> : transition_item X)
  (<span class="nv">k</span> : annotated_state -&gt; list (transition_item annotated_type))
  (<span class="nv">sa</span> : annotated_state)
  : pre_VLSM_embedding_finite_trace_project
      annotated_type X id original_state
      (annotate_trace_item item k sa)
      = item ::
        pre_VLSM_embedding_finite_trace_project
            annotated_type X id original_state
            (k {| original_state := destination item;
                  state_annotation := annotated_transition_state (l item) (sa, input item) |}).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>annotated_state ‚Üí list transition_item</span></span></span><br><span><var>sa</var><span class="hyp-type"><b>: </b><span>annotated_state</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pre_VLSM_embedding_finite_trace_project annotated_type
  X id original_state (annotate_trace_item item k sa) =
item
:: pre_VLSM_embedding_finite_trace_project
     annotated_type X id original_state
     (k
        {|
          original_state := destination item;
          state_annotation :=
            annotated_transition_state (l item)
              (sa, input item)
        |})</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>annotated_state ‚Üí list transition_item</span></span></span><br><span><var>sa</var><span class="hyp-type"><b>: </b><span>annotated_state</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pre_VLSM_embedding_finite_trace_project annotated_type
  X id original_state (annotate_trace_item item k sa) =
item
:: pre_VLSM_embedding_finite_trace_project
     annotated_type X id original_state
     (k
        {|
          original_state := destination item;
          state_annotation :=
            annotated_transition_state (l item)
              (sa, input item)
        |})</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> item.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotate_trace_from</span> (<span class="nv">sa</span> : state annotated_type) (<span class="nv">tr</span> : list (transition_item X))
  : list (transition_item annotated_type) :=
  fold_right annotate_trace_item (<span class="kr">fun</span> <span class="nv">sa</span> =&gt; []) tr sa.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk9"><span class="kn">Lemma</span> <span class="nf">annotate_trace_from_unroll</span> <span class="nv">sa</span> <span class="nv">item</span> <span class="nv">tr</span>
  : annotate_trace_from sa (item :: tr) =
    <span class="kr">let</span> <span class="nv">sa&#39;</span> :=
      {|
        original_state := destination item;
        state_annotation := annotated_transition_state (l item) (sa, input item)
      |}
    <span class="kr">in</span>
      Build_transition_item annotated_type (l item) (input item) sa&#39; (output item)
        ::
      annotate_trace_from sa&#39; tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>sa</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotate_trace_from sa (item :: tr) =
(<span class="kr">let</span> <span class="nv">sa&#39;</span> :=
   {|
     original_state := destination item;
     state_annotation :=
       annotated_transition_state (l item)
         (sa, input item)
   |} <span class="kr">in</span>
 {|
   l := l item;
   input := input item;
   destination := sa&#39;;
   output := output item
 |} :: annotate_trace_from sa&#39; tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chka"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>sa</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotate_trace_from sa (item :: tr) =
(<span class="kr">let</span> <span class="nv">sa&#39;</span> :=
   {|
     original_state := destination item;
     state_annotation :=
       annotated_transition_state (l item)
         (sa, input item)
   |} <span class="kr">in</span>
 {|
   l := l item;
   input := input item;
   destination := sa&#39;;
   output := output item
 |} :: annotate_trace_from sa&#39; tr)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> item.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chkb"><span class="kn">Lemma</span> <span class="nf">annotate_trace_from_app</span> <span class="nv">sa</span> <span class="nv">tr1</span> <span class="nv">tr2</span>
  : annotate_trace_from sa (tr1 ++ tr2) =
    annotate_trace_from sa tr1 ++
      annotate_trace_from (finite_trace_last sa (annotate_trace_from sa tr1)) tr2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>sa</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotate_trace_from sa (tr1 ++ tr2) =
annotate_trace_from sa tr1 ++
annotate_trace_from
  (finite_trace_last sa (annotate_trace_from sa tr1))
  tr2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chkc"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>sa</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotate_trace_from sa (tr1 ++ tr2) =
annotate_trace_from sa tr1 ++
annotate_trace_from
  (finite_trace_last sa (annotate_trace_from sa tr1))
  tr2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chkd"><span class="nb">revert</span> sa.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">sa</span> : state annotated_type,
  annotate_trace_from sa (tr1 ++ tr2) =
  annotate_trace_from sa tr1 ++
  annotate_trace_from
    (finite_trace_last sa (annotate_trace_from sa tr1))
    tr2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chke"><span class="nb">induction</span> tr1 <span class="kr">as</span> [| item tr1]; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr1, tr2</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr1</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sa</span> : state annotated_type,
  annotate_trace_from sa (tr1 ++ tr2) =
  annotate_trace_from sa tr1 ++
  annotate_trace_from
    (finite_trace_last sa
       (annotate_trace_from sa tr1)) tr2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">sa</span> : state annotated_type,
  annotate_trace_from sa ((item :: tr1) ++ tr2) =
  annotate_trace_from sa (item :: tr1) ++
  annotate_trace_from
    (finite_trace_last sa
       (annotate_trace_from sa (item :: tr1))) tr2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intro</span> sa; <span class="nb">rewrite</span> &lt;- app_comm_cons, !annotate_trace_from_unroll
  ; <span class="nb">simpl</span>; <span class="nb">rewrite</span> IHtr1, finite_trace_last_cons.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chkf"><span class="kn">Lemma</span> <span class="nf">annotate_trace_from_last_original_state</span> <span class="nv">sa</span> <span class="nv">sa&#39;</span> <span class="nv">tr</span>
  : original_state (finite_trace_last sa (annotate_trace_from sa&#39; tr)) =
    finite_trace_last (original_state sa) tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>sa, sa'</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">original_state
  (finite_trace_last sa (annotate_trace_from sa&#39; tr)) =
finite_trace_last (original_state sa) tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk10" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk10"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>sa, sa'</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">original_state
  (finite_trace_last sa (annotate_trace_from sa&#39; tr)) =
finite_trace_last (original_state sa) tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk11">destruct_list_last tr tr&#39; item Heqtr; <span class="nb">subst</span>; [<span class="bp">done</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>sa, sa'</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">original_state
  (finite_trace_last sa
     (annotate_trace_from sa&#39; (tr&#39; ++ [item]))) =
finite_trace_last (original_state sa) (tr&#39; ++ [item])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk12"><span class="nb">rewrite</span> annotate_trace_from_app.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>sa, sa'</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">original_state
  (finite_trace_last sa
     (annotate_trace_from sa&#39; tr&#39; ++
      annotate_trace_from
        (finite_trace_last sa&#39;
           (annotate_trace_from sa&#39; tr&#39;)) [item])) =
finite_trace_last (original_state sa) (tr&#39; ++ [item])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk13"><span class="nb">cbn</span>; <span class="nb">unfold</span> annotate_trace_item.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>sa, sa'</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>tr'</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">original_state
  (finite_trace_last sa
     (annotate_trace_from sa&#39; tr&#39; ++
      [{|
         l := l item;
         input := input item;
         destination :=
           {|
             original_state := destination item;
             state_annotation :=
               annotated_transition_state (l item)
                 (finite_trace_last sa&#39;
                    (annotate_trace_from sa&#39; tr&#39;),
                  input item)
           |};
         output := output item
       |}])) =
finite_trace_last (original_state sa) (tr&#39; ++ [item])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span>! finite_trace_last_is_last.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotate_trace</span> (<span class="nv">s</span> : state X) (<span class="nv">tr</span> : list (transition_item X))
  : list (transition_item annotated_type) :=
  annotate_trace_from {| original_state := s; state_annotation := ` inhabitant |} tr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk14"><span class="kn">Lemma</span> <span class="nf">annotate_trace_last_original_state</span> <span class="nv">s</span> <span class="nv">s&#39;</span> <span class="nv">tr</span>
  : original_state (finite_trace_last s (annotate_trace s&#39; tr)) =
    finite_trace_last (original_state s) tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">original_state
  (finite_trace_last s (annotate_trace s&#39; tr)) =
finite_trace_last (original_state s) tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk15" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk15"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state annotated_type</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">original_state
  (finite_trace_last s (annotate_trace s&#39; tr)) =
finite_trace_last (original_state s) tr</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> annotate_trace_from_last_original_state.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk16"><span class="kn">Lemma</span> <span class="nf">annotate_trace_project</span> <span class="nv">is</span> <span class="nv">tr</span>
  : pre_VLSM_embedding_finite_trace_project
      annotated_type X id original_state
      (annotate_trace <span class="kr">is</span> tr)
      = tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pre_VLSM_embedding_finite_trace_project annotated_type
  X id original_state (annotate_trace <span class="kr">is</span> tr) = tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk17"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pre_VLSM_embedding_finite_trace_project annotated_type
  X id original_state (annotate_trace <span class="kr">is</span> tr) = tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk18" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk18"><span class="nb">unfold</span> annotate_trace
  ; <span class="nb">remember</span> {| original_state := <span class="kr">is</span> |} <span class="kr">as</span> sa; <span class="nb">clear</span> Heqsa; <span class="nb">revert</span> sa.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">sa</span> : annotated_state,
  pre_VLSM_embedding_finite_trace_project
    annotated_type X id original_state
    (annotate_trace_from sa tr) = tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk19" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk19"><span class="nb">induction</span> tr <span class="kr">as</span> [| item]; [<span class="bp">done</span> | <span class="nb">intro</span> sa].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sa</span> : annotated_state,
  pre_VLSM_embedding_finite_trace_project
    annotated_type X id original_state
    (annotate_trace_from sa tr) = tr</span></span></span><br><span><var>sa</var><span class="hyp-type"><b>: </b><span>annotated_state</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pre_VLSM_embedding_finite_trace_project annotated_type
  X id original_state
  (annotate_trace_from sa (item :: tr)) = item :: tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk1a" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk1a"><span class="nb">setoid_rewrite</span> annotate_trace_item_project; <span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label annotated_type
‚Üí annotated_state *
  option message
  ‚Üí annotation</span></span></span><br><span><var>is</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>item</var><span class="hyp-type"><b>: </b><span>transition_item</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>list transition_item</span></span></span><br><span><var>IHtr</var><span class="hyp-type"><b>: </b><span><span class="kr">‚àÄ</span> <span class="nv">sa</span> : annotated_state,
  pre_VLSM_embedding_finite_trace_project
    annotated_type X id original_state
    (annotate_trace_from sa tr) = tr</span></span></span><br><span><var>sa</var><span class="hyp-type"><b>: </b><span>annotated_state</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pre_VLSM_embedding_finite_trace_project annotated_type
  X id original_state
  ((<span class="kr">fix</span> fold_right (l : list transition_item) :
        annotated_state ‚Üí list transition_item :=
      <span class="kr">match</span> l <span class="kr">with</span>
      | [] =&gt; <span class="kr">Œª</span> <span class="nv">_</span> : annotated_state, []
      | b :: t =&gt; annotate_trace_item b (fold_right t)
      <span class="kr">end</span>) tr
     {|
       original_state := destination item;
       state_annotation :=
         annotated_transition_state (l item)
           (sa, input item)
     |}) = tr</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> IHtr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">sec_annotated_vlsm</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> original_state {_ _ _} _ : <span class="nb">assert</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> state_annotation {_ _ _} _ : <span class="nb">assert</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">sec_annotated_vlsm_projections</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  {<span class="nv">message</span> : <span class="kt">Type</span>}
  (<span class="nv">X</span> : VLSM message)
  {<span class="nv">annotation</span> : <span class="kt">Type</span>}
  (<span class="nv">initial_annotation_prop</span> : annotation -&gt; <span class="kt">Prop</span>)
  `{Inhabited (sig initial_annotation_prop)}
  (annotated_constraint :
    label (annotated_type X annotation) -&gt;
      annotated_state X annotation  * option message -&gt; <span class="kt">Prop</span>)
  (annotated_transition_state :
    label (annotated_type X annotation) -&gt;
      annotated_state X annotation * option message -&gt; annotation)
  (AnnotatedX : VLSM message :=
    constrained_vlsm (annotated_vlsm X annotation initial_annotation_prop annotated_transition_state)
      annotated_constraint)
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk1b" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk1b"><span class="kn">Definition</span> <span class="nf">forget_annotations_projection</span>
  : VLSM_embedding AnnotatedX X id original_state.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type X annotation)
‚Üí annotated_state X annotation *
  option message ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type X
     annotation)
‚Üí annotated_state X
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedX</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm X annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">VLSM_embedding AnnotatedX X id original_state</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk1c" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk1c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type X annotation)
‚Üí annotated_state X annotation *
  option message ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type X
     annotation)
‚Üí annotated_state X
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedX</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm X annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">VLSM_embedding AnnotatedX X id original_state</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk1d" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk1d"><span class="nb">apply</span> basic_VLSM_strong_embedding; <span class="nb">cycle</span> <span class="mi">1</span>; [| <span class="bp">by</span> <span class="nb">cbv</span>; itauto..].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type X annotation)
‚Üí annotated_state X annotation *
  option message ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type X
     annotation)
‚Üí annotated_state X
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedX</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm X annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">strong_embedding_transition_preservation AnnotatedX X
  id original_state</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk1e" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk1e"><span class="nb">intros</span> l [s a] om [s&#39; a&#39;] om&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type X annotation)
‚Üí annotated_state X annotation *
  option message ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type X
     annotation)
‚Üí annotated_state X
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedX</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm X annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label AnnotatedX</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">transition l
  ({| original_state := s; state_annotation := a |},
   om) =
({| original_state := s&#39;; state_annotation := a&#39; |},
 om&#39;)
‚Üí transition (id l)
    (original_state
       {|
         original_state := s; state_annotation := a
       |}, om) =
  (original_state
     {|
       original_state := s&#39;; state_annotation := a&#39;
     |}, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk1f" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk1f"><span class="nb">cbn</span>; <span class="nb">unfold</span> annotated_transition; <span class="nb">cbn</span>
  ; <span class="nb">destruct</span> (transition _ _ _) <span class="kr">as</span> (_s&#39;, _om&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type X annotation)
‚Üí annotated_state X annotation *
  option message ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type X
     annotation)
‚Üí annotated_state X
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedX</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm X annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>label AnnotatedX</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>om</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>_s'</var><span class="hyp-type"><b>: </b><span>state X</span></span></span><br><span><var>_om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">({|
   original_state := _s&#39;;
   state_annotation :=
     annotated_transition_state l
       ({|
          original_state := s; state_annotation := a
        |}, om)
 |}, _om&#39;) =
({| original_state := s&#39;; state_annotation := a&#39; |},
 om&#39;) ‚Üí (_s&#39;, _om&#39;) = (s&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">inversion</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">sec_annotated_vlsm_projections</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">sec_composite_annotated_vlsm_projections</span>.</span></span></pre><div class="doc">
<a id="lab2"></a><h2 class="section">Specializing projection validator properties to annotated compositions</h2>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  {<span class="nv">message</span> : <span class="kt">Type</span>}
  `{EqDecision index}
  (IM : index -&gt; VLSM message)
  (Free := free_composite_vlsm IM)
  {annotation : <span class="kt">Type</span>}
  (initial_annotation_prop : annotation -&gt; <span class="kt">Prop</span>)
  `{Inhabited (sig initial_annotation_prop)}
  (annotated_constraint :
    label (annotated_type Free annotation) -&gt;
      annotated_state Free annotation  * option message -&gt; <span class="kt">Prop</span>)
  (annotated_transition_state :
    label (annotated_type Free annotation) -&gt;
      annotated_state Free annotation * option message -&gt; annotation)
  (AnnotatedFree : VLSM message :=
    constrained_vlsm
      (annotated_vlsm Free annotation initial_annotation_prop annotated_transition_state)
      annotated_constraint)
  (i : index)
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_composite_label_project</span> : label AnnotatedFree -&gt; option (label (IM i))
  := composite_project_label IM i.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_composite_state_project</span> : state AnnotatedFree -&gt; state (IM i)
  := <span class="kr">fun</span> <span class="nv">s</span> =&gt; original_state s i.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_projection_validator_prop</span> : <span class="kt">Prop</span> :=
  projection_validator_prop (IM i)
    annotated_composite_label_project annotated_composite_state_project.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_message_validator_prop</span> : <span class="kt">Prop</span> :=
  @message_validator_prop _ AnnotatedFree (IM i).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_composite_label_lift</span> : label (IM i) -&gt; label AnnotatedFree
  := lift_to_composite_label IM i.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_composite_state_lift</span> : state (IM i) -&gt; state AnnotatedFree
  := <span class="kr">fun</span> <span class="nv">si</span> =&gt;
     mk_annotated_state (free_composite_vlsm IM) _
      (lift_to_composite_state&#39; IM i si) (` inhabitant).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_projection_validator_prop_alt</span> : <span class="kt">Prop</span> :=
  projection_validator_prop_alt (IM i)
    annotated_composite_label_project annotated_composite_state_project
    annotated_composite_label_lift annotated_composite_state_lift.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk20"><span class="kn">Lemma</span> <span class="nf">preloaded_annotated_composite_preloaded_projection</span> :
  VLSM_projection
    (preloaded_with_all_messages_vlsm AnnotatedFree)
    (preloaded_with_all_messages_vlsm (IM i))
    annotated_composite_label_project annotated_composite_state_project.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">VLSM_projection
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk21" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk21"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">VLSM_projection
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk22"><span class="nb">apply</span> basic_VLSM_projection.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">weak_projection_valid_preservation
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk23" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk23"><hr></label><div class="goal-conclusion">weak_projection_transition_preservation_Some
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk24" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk24"><hr></label><div class="goal-conclusion">weak_projection_transition_consistency_None
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk25" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk25"><hr></label><div class="goal-conclusion">strong_projection_initial_state_preservation
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_state_project</div></blockquote><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk26" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk26"><hr></label><div class="goal-conclusion">weak_projection_valid_message_preservation
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk27" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk27">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">weak_projection_valid_preservation
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk28" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk28"><span class="nb">intros</span> [_i _li] li.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, _i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM _i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotated_composite_label_project (existT _i _li) =
Some li
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : state
           (preloaded_with_all_messages_vlsm
              AnnotatedFree)) (<span class="nv">om</span> : option message),
    input_valid
      (preloaded_with_all_messages_vlsm AnnotatedFree)
      (existT _i _li) (s, om)
    ‚Üí valid_state_prop
        (preloaded_with_all_messages_vlsm (IM i))
        (annotated_composite_state_project s)
      ‚Üí option_valid_message_prop
          (preloaded_with_all_messages_vlsm (IM i)) om
        ‚Üí valid li
            (annotated_composite_state_project s, om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk29" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk29"><span class="nb">unfold</span> annotated_composite_label_project, composite_project_label; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, _i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM _i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">match</span> decide (i = _i) <span class="kr">with</span>
| <span class="nb">left</span> e =&gt;
    Some (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) _li e)
| <span class="nb">right</span> _ =&gt; None
<span class="kr">end</span> = Some li
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : annotated_state Free annotation) (<span class="nv">om</span> : option
                                                 message),
    valid_state_prop
      (preloaded_with_all_messages_vlsm AnnotatedFree)
      s
    ‚àß option_valid_message_prop
        (preloaded_with_all_messages_vlsm
           AnnotatedFree) om
      ‚àß valid _li (original_state s _i, om)
        ‚àß annotated_constraint (existT _i _li) (s, om)
    ‚Üí valid_state_prop
        (preloaded_with_all_messages_vlsm (IM i))
        (annotated_composite_state_project s)
      ‚Üí option_valid_message_prop
          (preloaded_with_all_messages_vlsm (IM i)) om
        ‚Üí valid li
            (annotated_composite_state_project s, om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk2a" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk2a">case_decide; [| <span class="bp">congruence</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, _i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM _i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>i = _i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) _li H0) =
Some li
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : annotated_state Free annotation) (<span class="nv">om</span> : option
                                                 message),
    valid_state_prop
      (preloaded_with_all_messages_vlsm AnnotatedFree)
      s
    ‚àß option_valid_message_prop
        (preloaded_with_all_messages_vlsm
           AnnotatedFree) om
      ‚àß valid _li (original_state s _i, om)
        ‚àß annotated_constraint (existT _i _li) (s, om)
    ‚Üí valid_state_prop
        (preloaded_with_all_messages_vlsm (IM i))
        (annotated_composite_state_project s)
      ‚Üí option_valid_message_prop
          (preloaded_with_all_messages_vlsm (IM i)) om
        ‚Üí valid li
            (annotated_composite_state_project s, om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk2b" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk2b"><span class="nb">subst</span> _i; <span class="nb">cbn</span>; <span class="nb">inversion_clear</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : annotated_state Free annotation) (<span class="nv">om</span> : option
                                                message),
  valid_state_prop
    (preloaded_with_all_messages_vlsm AnnotatedFree) s
  ‚àß option_valid_message_prop
      (preloaded_with_all_messages_vlsm AnnotatedFree)
      om
    ‚àß valid li (original_state s i, om)
      ‚àß annotated_constraint (existT i li) (s, om)
  ‚Üí valid_state_prop
      (preloaded_with_all_messages_vlsm (IM i))
      (annotated_composite_state_project s)
    ‚Üí option_valid_message_prop
        (preloaded_with_all_messages_vlsm (IM i)) om
      ‚Üí valid li
          (annotated_composite_state_project s, om)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> (s, ann) om (_ &amp; _ &amp; Hv &amp; _) _ _.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk2c" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk2c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">weak_projection_transition_preservation_Some
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk2d" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk2d"><span class="nb">intros</span> [_i _li] li.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, _i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM _i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotated_composite_label_project (existT _i _li) =
Some li
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : state
           (preloaded_with_all_messages_vlsm
              AnnotatedFree)) (<span class="nv">om</span> : option message) 
    (<span class="nv">s&#39;</span> : state
            (preloaded_with_all_messages_vlsm
               AnnotatedFree)) (<span class="nv">om&#39;</span> : option message),
    input_valid_transition
      (preloaded_with_all_messages_vlsm AnnotatedFree)
      (existT _i _li) (s, om) (s&#39;, om&#39;)
    ‚Üí transition li
        (annotated_composite_state_project s, om) =
      (annotated_composite_state_project s&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk2e" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk2e"><span class="nb">unfold</span> annotated_composite_label_project, composite_project_label; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, _i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM _i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">match</span> decide (i = _i) <span class="kr">with</span>
| <span class="nb">left</span> e =&gt;
    Some (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) _li e)
| <span class="nb">right</span> _ =&gt; None
<span class="kr">end</span> = Some li
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : annotated_state Free annotation) (<span class="nv">om</span> : option
                                                 message) 
    (<span class="nv">s&#39;</span> : annotated_state Free annotation) (<span class="nv">om&#39;</span> : 
                                            option
                                              message),
    input_valid_transition
      (preloaded_with_all_messages_vlsm AnnotatedFree)
      (existT _i _li) (s, om) (s&#39;, om&#39;)
    ‚Üí transition li
        (annotated_composite_state_project s, om) =
      (annotated_composite_state_project s&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk2f" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk2f">case_decide; [| <span class="bp">congruence</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, _i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM _i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>i = _i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) _li H0) =
Some li
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : annotated_state Free annotation) (<span class="nv">om</span> : option
                                                 message) 
    (<span class="nv">s&#39;</span> : annotated_state Free annotation) (<span class="nv">om&#39;</span> : 
                                            option
                                              message),
    input_valid_transition
      (preloaded_with_all_messages_vlsm AnnotatedFree)
      (existT _i _li) (s, om) (s&#39;, om&#39;)
    ‚Üí transition li
        (annotated_composite_state_project s, om) =
      (annotated_composite_state_project s&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk30" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk30"><span class="nb">subst</span> _i; <span class="nb">cbn</span>; <span class="nb">inversion_clear</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> (<span class="nv">s</span> : annotated_state Free annotation) (<span class="nv">om</span> : option
                                                message) 
  (<span class="nv">s&#39;</span> : annotated_state Free annotation) (<span class="nv">om&#39;</span> : option
                                                 message),
  input_valid_transition
    (preloaded_with_all_messages_vlsm AnnotatedFree)
    (existT i li) (s, om) (s&#39;, om&#39;)
  ‚Üí transition li
      (annotated_composite_state_project s, om) =
    (annotated_composite_state_project s&#39;, om&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk31" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk31"><span class="nb">intros</span> [s ann] iom [s&#39; ann&#39;] oom.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann'</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (existT i li)
  ({| original_state := s; state_annotation := ann |},
   iom)
  ({|
     original_state := s&#39;; state_annotation := ann&#39;
   |}, oom)
‚Üí transition li
    (annotated_composite_state_project
       {|
         original_state := s; state_annotation := ann
       |}, iom) =
  (annotated_composite_state_project
     {|
       original_state := s&#39;; state_annotation := ann&#39;
     |}, oom)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk32" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk32"><span class="nb">unfold</span> input_valid_transition; <span class="nb">cbn</span>
    ; <span class="nb">unfold</span> annotated_transition; <span class="nb">cbn</span>
    ; <span class="nb">destruct</span> (transition _ _ _) <span class="kr">as</span> (si&#39;, om&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann'</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>si'</var><span class="hyp-type"><b>: </b><span>state (IM i)</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(valid_state_prop
   (preloaded_with_all_messages_vlsm AnnotatedFree)
   {| original_state := s; state_annotation := ann |}
 ‚àß option_valid_message_prop
     (preloaded_with_all_messages_vlsm AnnotatedFree)
     iom
   ‚àß valid li (s i, iom)
     ‚àß annotated_constraint (existT i li)
         ({|
            original_state := s;
            state_annotation := ann
          |}, iom))
‚àß ({|
     original_state := state_update IM s i si&#39;;
     state_annotation :=
       annotated_transition_state (existT i li)
         ({|
            original_state := s;
            state_annotation := ann
          |}, iom)
   |}, om&#39;) =
  ({|
     original_state := s&#39;; state_annotation := ann&#39;
   |}, oom) ‚Üí (si&#39;, om&#39;) = (s&#39; i, oom)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk33" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk33"><span class="nb">intros</span> [_ Ht]; <span class="nb">inversion</span> Ht.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>_li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (preloaded_with_all_messages_vlsm (IM i))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann'</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>si'</var><span class="hyp-type"><b>: </b><span>state (IM i)</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>({|
   original_state := state_update IM s i si&#39;;
   state_annotation :=
     annotated_transition_state 
       (existT i li)
       ({|
          original_state := s;
          state_annotation := ann
        |}, iom)
 |}, om&#39;) =
({|
   original_state := s&#39;; state_annotation := ann&#39;
 |}, oom)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>state_update IM s i si&#39; = s&#39;</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>annotated_transition_state 
  (existT i li)
  ({|
     original_state := s; state_annotation := ann
   |}, iom) = ann&#39;</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>om&#39; = oom</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(si&#39;, oom) = (state_update IM s i si&#39; i, oom)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> state_update_simpl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk34" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk34">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">weak_projection_transition_consistency_None
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk35" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk35"><span class="nb">intros</span> [j lj].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotated_composite_label_project (existT j lj) = None
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : state
           (preloaded_with_all_messages_vlsm
              AnnotatedFree)) (<span class="nv">om</span> : option message) 
    (<span class="nv">s&#39;</span> : state
            (preloaded_with_all_messages_vlsm
               AnnotatedFree)) (<span class="nv">om&#39;</span> : option message),
    input_valid_transition
      (preloaded_with_all_messages_vlsm AnnotatedFree)
      (existT j lj) (s, om) (s&#39;, om&#39;)
    ‚Üí annotated_composite_state_project s&#39; =
      annotated_composite_state_project s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk36" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk36"><span class="nb">unfold</span> annotated_composite_label_project, composite_project_label; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">match</span> decide (i = j) <span class="kr">with</span>
| <span class="nb">left</span> e =&gt;
    Some (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) lj e)
| <span class="nb">right</span> _ =&gt; None
<span class="kr">end</span> = None
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : annotated_state Free annotation) (<span class="nv">om</span> : option
                                                 message) 
    (<span class="nv">s&#39;</span> : annotated_state Free annotation) (<span class="nv">om&#39;</span> : 
                                            option
                                              message),
    input_valid_transition
      (preloaded_with_all_messages_vlsm AnnotatedFree)
      (existT j lj) (s, om) (s&#39;, om&#39;)
    ‚Üí annotated_composite_state_project s&#39; =
      annotated_composite_state_project s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk37" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk37">case_decide <span class="kr">as</span> Hij; [<span class="bp">by</span> <span class="bp">congruence</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br><span><var>Hij</var><span class="hyp-type"><b>: </b><span>i ‚â† j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">None = None
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : annotated_state Free annotation) (<span class="nv">om</span> : option
                                                 message) 
    (<span class="nv">s&#39;</span> : annotated_state Free annotation) (<span class="nv">om&#39;</span> : 
                                            option
                                              message),
    input_valid_transition
      (preloaded_with_all_messages_vlsm AnnotatedFree)
      (existT j lj) (s, om) (s&#39;, om&#39;)
    ‚Üí annotated_composite_state_project s&#39; =
      annotated_composite_state_project s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk38" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk38"><span class="nb">intros</span> _ [s ann] iom [s&#39; ann&#39;] oom.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br><span><var>Hij</var><span class="hyp-type"><b>: </b><span>i ‚â† j</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann'</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">input_valid_transition
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (existT j lj)
  ({| original_state := s; state_annotation := ann |},
   iom)
  ({|
     original_state := s&#39;; state_annotation := ann&#39;
   |}, oom)
‚Üí annotated_composite_state_project
    {|
      original_state := s&#39;; state_annotation := ann&#39;
    |} =
  annotated_composite_state_project
    {| original_state := s; state_annotation := ann |}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk39" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk39"><span class="nb">unfold</span> input_valid_transition; <span class="nb">cbn</span>
    ; <span class="nb">unfold</span> annotated_transition; <span class="nb">cbn</span>
    ; <span class="nb">destruct</span> (transition _ _ _) <span class="kr">as</span> (si&#39;, om&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br><span><var>Hij</var><span class="hyp-type"><b>: </b><span>i ‚â† j</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann'</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>si'</var><span class="hyp-type"><b>: </b><span>state (IM j)</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(valid_state_prop
   (preloaded_with_all_messages_vlsm AnnotatedFree)
   {| original_state := s; state_annotation := ann |}
 ‚àß option_valid_message_prop
     (preloaded_with_all_messages_vlsm AnnotatedFree)
     iom
   ‚àß valid lj (s j, iom)
     ‚àß annotated_constraint (existT j lj)
         ({|
            original_state := s;
            state_annotation := ann
          |}, iom))
‚àß ({|
     original_state := state_update IM s j si&#39;;
     state_annotation :=
       annotated_transition_state (existT j lj)
         ({|
            original_state := s;
            state_annotation := ann
          |}, iom)
   |}, om&#39;) =
  ({|
     original_state := s&#39;; state_annotation := ann&#39;
   |}, oom) ‚Üí s&#39; i = s i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk3a" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk3a"><span class="nb">intros</span> [_ Ht]; <span class="nb">inversion</span> Ht.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br><span><var>Hij</var><span class="hyp-type"><b>: </b><span>i ‚â† j</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann'</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>oom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>si'</var><span class="hyp-type"><b>: </b><span>state (IM j)</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>Ht</var><span class="hyp-type"><b>: </b><span>({|
   original_state := state_update IM s j si&#39;;
   state_annotation :=
     annotated_transition_state 
       (existT j lj)
       ({|
          original_state := s;
          state_annotation := ann
        |}, iom)
 |}, om&#39;) =
({|
   original_state := s&#39;; state_annotation := ann&#39;
 |}, oom)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>state_update IM s j si&#39; = s&#39;</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>annotated_transition_state 
  (existT j lj)
  ({|
     original_state := s; state_annotation := ann
   |}, iom) = ann&#39;</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>om&#39; = oom</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">state_update IM s j si&#39; i = s i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> state_update_simpl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk3b" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk3b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">strong_projection_initial_state_preservation
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> [s ann] [Hs _]; <span class="nb">cbn</span>; <span class="nb">apply</span> Hs.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk3c" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk3c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">weak_projection_valid_message_preservation
  (preloaded_with_all_messages_vlsm AnnotatedFree)
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intro</span>; <span class="nb">intros</span>; <span class="nb">apply</span> any_message_is_valid_in_preloaded.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk3d" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk3d"><span class="kn">Lemma</span> <span class="nf">annotated_composite_preloaded_projection</span> :
  VLSM_projection AnnotatedFree (preloaded_with_all_messages_vlsm (IM i))
    annotated_composite_label_project annotated_composite_state_project.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">VLSM_projection AnnotatedFree
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk3e" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk3e"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">VLSM_projection AnnotatedFree
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk3f" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk3f"><span class="nb">apply</span> @VLSM_incl_projection_trans
    <span class="kr">with</span> (MY := (preloaded_with_all_messages_vlsm AnnotatedFree)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">VLSM_incl
  {|
    vlsm_type :=
      preloaded_with_all_messages_vlsm AnnotatedFree;
    vlsm_machine :=
      constrained_vlsm_machine
        (annotated_vlsm Free annotation
           initial_annotation_prop
           annotated_transition_state)
        annotated_constraint
  |}
  {|
    vlsm_type :=
      preloaded_with_all_messages_vlsm AnnotatedFree;
    vlsm_machine :=
      preloaded_with_all_messages_vlsm AnnotatedFree
  |}</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk40" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk40"><hr></label><div class="goal-conclusion">VLSM_projection
  {|
    vlsm_type :=
      preloaded_with_all_messages_vlsm AnnotatedFree;
    vlsm_machine :=
      preloaded_with_all_messages_vlsm AnnotatedFree
  |} (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk41" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk41">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">VLSM_incl
  {|
    vlsm_type :=
      preloaded_with_all_messages_vlsm AnnotatedFree;
    vlsm_machine :=
      constrained_vlsm_machine
        (annotated_vlsm Free annotation
           initial_annotation_prop
           annotated_transition_state)
        annotated_constraint
  |}
  {|
    vlsm_type :=
      preloaded_with_all_messages_vlsm AnnotatedFree;
    vlsm_machine :=
      preloaded_with_all_messages_vlsm AnnotatedFree
  |}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> (vlsm_incl_preloaded_with_all_messages_vlsm AnnotatedFree).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk42" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk42">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">VLSM_projection
  {|
    vlsm_type :=
      preloaded_with_all_messages_vlsm AnnotatedFree;
    vlsm_machine :=
      preloaded_with_all_messages_vlsm AnnotatedFree
  |} (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> preloaded_annotated_composite_preloaded_projection.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_composite_induced_validator</span> : VLSM message
  := projection_induced_validator AnnotatedFree (IM i)
    annotated_composite_label_project annotated_composite_state_project
    annotated_composite_label_lift annotated_composite_state_lift.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk43" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk43"><span class="kn">Lemma</span> <span class="nf">annotated_composite_induced_validator_transition_None</span> :
  weak_projection_transition_consistency_None _ _ annotated_composite_label_project
    annotated_composite_state_project.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">weak_projection_transition_consistency_None
  AnnotatedFree (IM i)
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk44" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk44"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">weak_projection_transition_consistency_None
  AnnotatedFree (IM i)
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk45" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk45"><span class="nb">intros</span> [j lj].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotated_composite_label_project (existT j lj) = None
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : state AnnotatedFree) (<span class="nv">om</span> : option message) 
    (<span class="nv">s&#39;</span> : state AnnotatedFree) (<span class="nv">om&#39;</span> : option message),
    input_valid_transition AnnotatedFree (existT j lj)
      (s, om) (s&#39;, om&#39;)
    ‚Üí annotated_composite_state_project s&#39; =
      annotated_composite_state_project s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk46" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk46"><span class="nb">unfold</span> annotated_composite_label_project, composite_project_label; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">match</span> decide (i = j) <span class="kr">with</span>
| <span class="nb">left</span> e =&gt;
    Some (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) lj e)
| <span class="nb">right</span> _ =&gt; None
<span class="kr">end</span> = None
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : annotated_state Free annotation) (<span class="nv">om</span> : option
                                                 message) 
    (<span class="nv">s&#39;</span> : annotated_state Free annotation) (<span class="nv">om&#39;</span> : 
                                            option
                                              message),
    input_valid_transition AnnotatedFree (existT j lj)
      (s, om) (s&#39;, om&#39;)
    ‚Üí annotated_composite_state_project s&#39; =
      annotated_composite_state_project s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk47" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk47">case_decide <span class="kr">as</span> Hij; [<span class="bp">by</span> <span class="bp">congruence</span> |].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br><span><var>Hij</var><span class="hyp-type"><b>: </b><span>i ‚â† j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">None = None
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">s</span> : annotated_state Free annotation) (<span class="nv">om</span> : option
                                                 message) 
    (<span class="nv">s&#39;</span> : annotated_state Free annotation) (<span class="nv">om&#39;</span> : 
                                            option
                                              message),
    input_valid_transition AnnotatedFree (existT j lj)
      (s, om) (s&#39;, om&#39;)
    ‚Üí annotated_composite_state_project s&#39; =
      annotated_composite_state_project s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk48" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk48"><span class="nb">intros</span> _ sX omX s&#39;X om&#39;X [_ Ht]; <span class="nb">revert</span> Ht; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br><span><var>Hij</var><span class="hyp-type"><b>: </b><span>i ‚â† j</span></span></span><br><span><var>sX</var><span class="hyp-type"><b>: </b><span>annotated_state Free annotation</span></span></span><br><span><var>omX</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>s'X</var><span class="hyp-type"><b>: </b><span>annotated_state Free annotation</span></span></span><br><span><var>om'X</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotated_transition Free annotation
  annotated_transition_state (existT j lj) (sX, omX) =
(s&#39;X, om&#39;X)
‚Üí annotated_composite_state_project s&#39;X =
  annotated_composite_state_project sX</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk49" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk49"><span class="nb">unfold</span> annotated_transition; <span class="nb">cbn</span>
  ; <span class="nb">destruct</span> (transition _ _ _) <span class="kr">as</span> (si&#39;, om&#39;)
  ; <span class="nb">inversion</span> <span class="mi">1</span>; <span class="nb">clear</span> Ht; <span class="nb">subst</span> om&#39; s&#39;X; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>lj</var><span class="hyp-type"><b>: </b><span>label (IM j)</span></span></span><br><span><var>Hij</var><span class="hyp-type"><b>: </b><span>i ‚â† j</span></span></span><br><span><var>sX</var><span class="hyp-type"><b>: </b><span>annotated_state Free annotation</span></span></span><br><span><var>omX, om'X</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>si'</var><span class="hyp-type"><b>: </b><span>state (IM j)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">state_update IM (original_state sX) j si&#39; i =
annotated_composite_state_project sX</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> state_update_simpl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk4a" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk4a"><span class="kn">Lemma</span> <span class="nf">annotated_composite_induced_validator_label_lift</span>
  : induced_validator_label_lift_prop annotated_composite_label_project annotated_composite_label_lift.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">induced_validator_label_lift_prop
  annotated_composite_label_project
  annotated_composite_label_lift</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk4b" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk4b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">induced_validator_label_lift_prop
  annotated_composite_label_project
  annotated_composite_label_lift</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> component_label_projection_lift.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk4c" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk4c"><span class="kn">Lemma</span> <span class="nf">annotated_composite_induced_validator_state_lift</span>
  : induced_validator_state_lift_prop annotated_composite_state_project annotated_composite_state_lift.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">induced_validator_state_lift_prop
  annotated_composite_state_project
  annotated_composite_state_lift</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk4d" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk4d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">induced_validator_state_lift_prop
  annotated_composite_state_project
  annotated_composite_state_lift</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">intros</span> si; <span class="nb">apply</span> state_update_eq.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk4e" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk4e"><span class="kn">Lemma</span> <span class="nf">annotated_composite_induced_validator_initial_lift</span>
  : strong_projection_initial_state_preservation (IM i) AnnotatedFree
    annotated_composite_state_lift.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">strong_projection_initial_state_preservation (IM i)
  AnnotatedFree annotated_composite_state_lift</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk4f" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk4f"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">strong_projection_initial_state_preservation (IM i)
  AnnotatedFree annotated_composite_state_lift</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk50" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk50"><span class="nb">split</span>; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state (IM i)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">composite_initial_state_prop IM
  (lift_to_composite_state&#39; IM i s)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk51" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state (IM i)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk51"><hr></label><div class="goal-conclusion">initial_annotation_prop (`inhabitant)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk52" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk52">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state (IM i)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">composite_initial_state_prop IM
  (lift_to_composite_state&#39; IM i s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> composite_initial_state_prop_lift.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk53" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk53">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>state (IM i)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>initial_state_prop s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">initial_annotation_prop (`inhabitant)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">destruct</span> inhabitant.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk54" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk54"><span class="kn">Lemma</span> <span class="nf">annotated_composite_induced_validator_transition_consistency</span>
  : induced_validator_transition_consistency_Some _ _
    annotated_composite_label_project annotated_composite_state_project.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">induced_validator_transition_consistency_Some
  AnnotatedFree (IM i)
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk55" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk55"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">induced_validator_transition_consistency_Some
  AnnotatedFree (IM i)
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk56" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk56"><span class="nb">intros</span> [i1 li1] [i2 li2] li.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, i1</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li1</var><span class="hyp-type"><b>: </b><span>label (IM i1)</span></span></span><br><span><var>i2</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li2</var><span class="hyp-type"><b>: </b><span>label (IM i2)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotated_composite_label_project (existT i1 li1) =
Some li
‚Üí annotated_composite_label_project (existT i2 li2) =
  Some li
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">sX1</span> <span class="nv">sX2</span> : state AnnotatedFree,
      annotated_composite_state_project sX1 =
      annotated_composite_state_project sX2
      ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) (<span class="nv">sX1&#39;</span> : state
                                           AnnotatedFree) 
          (<span class="nv">oom1</span> : option message),
          transition (existT i1 li1) (sX1, iom) =
          (sX1&#39;, oom1)
          ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sX2&#39;</span> : state AnnotatedFree) (<span class="nv">oom2</span> : 
                                            option
                                              message),
              transition (existT i2 li2) (sX2, iom) =
              (sX2&#39;, oom2)
              ‚Üí annotated_composite_state_project sX1&#39; =
                annotated_composite_state_project sX2&#39;
                ‚àß oom1 = oom2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk57" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk57"><span class="nb">unfold</span> annotated_composite_label_project, composite_project_label; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, i1</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li1</var><span class="hyp-type"><b>: </b><span>label (IM i1)</span></span></span><br><span><var>i2</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li2</var><span class="hyp-type"><b>: </b><span>label (IM i2)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">match</span> decide (i = i1) <span class="kr">with</span>
| <span class="nb">left</span> e =&gt;
    Some (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) li1 e)
| <span class="nb">right</span> _ =&gt; None
<span class="kr">end</span> = Some li
‚Üí <span class="kr">match</span> decide (i = i2) <span class="kr">with</span>
  | <span class="nb">left</span> e =&gt;
      Some
        (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) li2 e)
  | <span class="nb">right</span> _ =&gt; None
  <span class="kr">end</span> = Some li
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">sX1</span> <span class="nv">sX2</span> : annotated_state Free annotation,
      annotated_composite_state_project sX1 =
      annotated_composite_state_project sX2
      ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) (<span class="nv">sX1&#39;</span> : annotated_state
                                           Free
                                           annotation) 
          (<span class="nv">oom1</span> : option message),
          annotated_transition Free annotation
            annotated_transition_state (existT i1 li1)
            (sX1, iom) = (sX1&#39;, oom1)
          ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sX2&#39;</span> : annotated_state Free annotation) 
              (<span class="nv">oom2</span> : option message),
              annotated_transition Free annotation
                annotated_transition_state
                (existT i2 li2) (sX2, iom) =
              (sX2&#39;, oom2)
              ‚Üí annotated_composite_state_project sX1&#39; =
                annotated_composite_state_project sX2&#39;
                ‚àß oom1 = oom2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk58" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk58">case_decide <span class="kr">as</span> Hi1; [| <span class="bp">by</span> <span class="bp">congruence</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i, i1</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li1</var><span class="hyp-type"><b>: </b><span>label (IM i1)</span></span></span><br><span><var>i2</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li2</var><span class="hyp-type"><b>: </b><span>label (IM i2)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>Hi1</var><span class="hyp-type"><b>: </b><span>i = i1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) li1 Hi1) =
Some li
‚Üí <span class="kr">match</span> decide (i = i2) <span class="kr">with</span>
  | <span class="nb">left</span> e =&gt;
      Some
        (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) li2 e)
  | <span class="nb">right</span> _ =&gt; None
  <span class="kr">end</span> = Some li
  ‚Üí <span class="kr">‚àÄ</span> <span class="nv">sX1</span> <span class="nv">sX2</span> : annotated_state Free annotation,
      annotated_composite_state_project sX1 =
      annotated_composite_state_project sX2
      ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) (<span class="nv">sX1&#39;</span> : annotated_state
                                           Free
                                           annotation) 
          (<span class="nv">oom1</span> : option message),
          annotated_transition Free annotation
            annotated_transition_state (existT i1 li1)
            (sX1, iom) = (sX1&#39;, oom1)
          ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sX2&#39;</span> : annotated_state Free annotation) 
              (<span class="nv">oom2</span> : option message),
              annotated_transition Free annotation
                annotated_transition_state
                (existT i2 li2) (sX2, iom) =
              (sX2&#39;, oom2)
              ‚Üí annotated_composite_state_project sX1&#39; =
                annotated_composite_state_project sX2&#39;
                ‚àß oom1 = oom2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk59" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk59"><span class="nb">subst</span> i1; <span class="nb">cbn</span>; <span class="nb">inversion_clear</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li1</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>i2</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li2</var><span class="hyp-type"><b>: </b><span>label (IM i2)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">match</span> decide (i = i2) <span class="kr">with</span>
| <span class="nb">left</span> e =&gt;
    Some (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) li2 e)
| <span class="nb">right</span> _ =&gt; None
<span class="kr">end</span> = Some li
‚Üí <span class="kr">‚àÄ</span> <span class="nv">sX1</span> <span class="nv">sX2</span> : annotated_state Free annotation,
    annotated_composite_state_project sX1 =
    annotated_composite_state_project sX2
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) (<span class="nv">sX1&#39;</span> : annotated_state
                                         Free
                                         annotation) 
        (<span class="nv">oom1</span> : option message),
        annotated_transition Free annotation
          annotated_transition_state (existT i li)
          (sX1, iom) = (sX1&#39;, oom1)
        ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sX2&#39;</span> : annotated_state Free annotation) 
            (<span class="nv">oom2</span> : option message),
            annotated_transition Free annotation
              annotated_transition_state
              (existT i2 li2) (sX2, iom) =
            (sX2&#39;, oom2)
            ‚Üí annotated_composite_state_project sX1&#39; =
              annotated_composite_state_project sX2&#39;
              ‚àß oom1 = oom2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk5a" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk5a">case_decide <span class="kr">as</span> Hi2; [| <span class="bp">by</span> <span class="bp">congruence</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li1</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>i2</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li2</var><span class="hyp-type"><b>: </b><span>label (IM i2)</span></span></span><br><span><var>li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>Hi2</var><span class="hyp-type"><b>: </b><span>i = i2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some (eq_rect_r (<span class="kr">Œª</span> <span class="nv">n</span> : index, label (IM n)) li2 Hi2) =
Some li
‚Üí <span class="kr">‚àÄ</span> <span class="nv">sX1</span> <span class="nv">sX2</span> : annotated_state Free annotation,
    annotated_composite_state_project sX1 =
    annotated_composite_state_project sX2
    ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) (<span class="nv">sX1&#39;</span> : annotated_state
                                         Free
                                         annotation) 
        (<span class="nv">oom1</span> : option message),
        annotated_transition Free annotation
          annotated_transition_state (existT i li)
          (sX1, iom) = (sX1&#39;, oom1)
        ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sX2&#39;</span> : annotated_state Free annotation) 
            (<span class="nv">oom2</span> : option message),
            annotated_transition Free annotation
              annotated_transition_state
              (existT i2 li2) (sX2, iom) =
            (sX2&#39;, oom2)
            ‚Üí annotated_composite_state_project sX1&#39; =
              annotated_composite_state_project sX2&#39;
              ‚àß oom1 = oom2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk5b" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk5b"><span class="nb">subst</span> i2; <span class="nb">cbn</span>; <span class="nb">inversion_clear</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li1, li2, li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">‚àÄ</span> <span class="nv">sX1</span> <span class="nv">sX2</span> : annotated_state Free annotation,
  annotated_composite_state_project sX1 =
  annotated_composite_state_project sX2
  ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">iom</span> : option message) (<span class="nv">sX1&#39;</span> : annotated_state
                                       Free annotation) 
      (<span class="nv">oom1</span> : option message),
      annotated_transition Free annotation
        annotated_transition_state (existT i li)
        (sX1, iom) = (sX1&#39;, oom1)
      ‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sX2&#39;</span> : annotated_state Free annotation) 
          (<span class="nv">oom2</span> : option message),
          annotated_transition Free annotation
            annotated_transition_state (existT i li)
            (sX2, iom) = (sX2&#39;, oom2)
          ‚Üí annotated_composite_state_project sX1&#39; =
            annotated_composite_state_project sX2&#39;
            ‚àß oom1 = oom2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk5c" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk5c"><span class="nb">intros</span> [s1 ann1] [s2 ann2]
  ; <span class="nb">unfold</span> annotated_transition; <span class="nb">cbn</span>
  ; <span class="nb">intros</span> &lt;- iom sX1&#39; oom1
  ; <span class="nb">destruct</span> (transition _ _ _) <span class="kr">as</span> (si&#39;, om&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li1, li2, li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann1</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann2</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>sX1'</var><span class="hyp-type"><b>: </b><span>annotated_state Free annotation</span></span></span><br><span><var>oom1</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>si'</var><span class="hyp-type"><b>: </b><span>state (IM i)</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">({|
   original_state := state_update IM s1 i si&#39;;
   state_annotation :=
     annotated_transition_state (existT i li)
       ({|
          original_state := s1;
          state_annotation := ann1
        |}, iom)
 |}, om&#39;) = (sX1&#39;, oom1)
‚Üí <span class="kr">‚àÄ</span> (<span class="nv">sX2&#39;</span> : annotated_state Free annotation) (<span class="nv">oom2</span> : 
                                              option
                                                message),
    ({|
       original_state := state_update IM s2 i si&#39;;
       state_annotation :=
         annotated_transition_state (existT i li)
           ({|
              original_state := s2;
              state_annotation := ann2
            |}, iom)
     |}, om&#39;) = (sX2&#39;, oom2)
    ‚Üí annotated_composite_state_project sX1&#39; =
      annotated_composite_state_project sX2&#39;
      ‚àß oom1 = oom2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk5d" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk5d"><span class="nb">inversion_clear</span> <span class="mi">1</span>; <span class="nb">intros</span> sX2&#39; oom2; <span class="nb">inversion_clear</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br><span><var>li1, li2, li</var><span class="hyp-type"><b>: </b><span>label (IM i)</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann1</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>state Free</span></span></span><br><span><var>ann2</var><span class="hyp-type"><b>: </b><span>annotation</span></span></span><br><span><var>iom</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>sX1'</var><span class="hyp-type"><b>: </b><span>annotated_state Free annotation</span></span></span><br><span><var>oom1</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>si'</var><span class="hyp-type"><b>: </b><span>state (IM i)</span></span></span><br><span><var>om'</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br><span><var>sX2'</var><span class="hyp-type"><b>: </b><span>annotated_state Free annotation</span></span></span><br><span><var>oom2</var><span class="hyp-type"><b>: </b><span>option message</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotated_composite_state_project
  {|
    original_state := state_update IM s1 i si&#39;;
    state_annotation :=
      annotated_transition_state (existT i li)
        ({|
           original_state := s1;
           state_annotation := ann1
         |}, iom)
  |} =
annotated_composite_state_project
  {|
    original_state := state_update IM s2 i si&#39;;
    state_annotation :=
      annotated_transition_state (existT i li)
        ({|
           original_state := s2;
           state_annotation := ann2
         |}, iom)
  |} ‚àß oom2 = oom2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">cbn</span>; state_update_simpl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">annotated_composite_induced_validator_is_projection</span> :=
  projection_induced_validator_is_projection _ _ _ _ _ _
    annotated_composite_induced_validator_label_lift
    annotated_composite_induced_validator_state_lift
    annotated_composite_induced_validator_transition_consistency
    annotated_composite_induced_validator_transition_None.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk5e" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk5e"><span class="kn">Lemma</span> <span class="nf">annotated_projection_validator_prop_alt_iff</span>
  : annotated_projection_validator_prop_alt &lt;-&gt; annotated_projection_validator_prop.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotated_projection_validator_prop_alt
‚Üî annotated_projection_validator_prop</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk5f" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk5f"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">annotated_projection_validator_prop_alt
‚Üî annotated_projection_validator_prop</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk60" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk60"><span class="nb">apply</span> projection_validator_prop_alt_iff.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">weak_projection_transition_consistency_None
  AnnotatedFree (IM i)
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk61" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk61"><hr></label><div class="goal-conclusion">induced_validator_label_lift_prop
  annotated_composite_label_project
  annotated_composite_label_lift</div></blockquote><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk62" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk62"><hr></label><div class="goal-conclusion">induced_validator_state_lift_prop
  annotated_composite_state_project
  annotated_composite_state_lift</div></blockquote><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk63" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk63"><hr></label><div class="goal-conclusion">strong_projection_initial_state_preservation 
  (IM i) AnnotatedFree annotated_composite_state_lift</div></blockquote><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk64" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk64"><hr></label><div class="goal-conclusion">induced_validator_transition_consistency_Some
  AnnotatedFree (IM i)
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote><input class="alectryon-extra-goal-toggle" id="AnnotatedVLSM-v-chk65" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><label class="goal-separator" for="AnnotatedVLSM-v-chk65"><hr></label><div class="goal-conclusion">VLSM_projection AnnotatedFree
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk66" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk66">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">weak_projection_transition_consistency_None
  AnnotatedFree (IM i)
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> annotated_composite_induced_validator_transition_None.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk67" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk67">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">induced_validator_label_lift_prop
  annotated_composite_label_project
  annotated_composite_label_lift</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> annotated_composite_induced_validator_label_lift.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk68" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk68">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">induced_validator_state_lift_prop
  annotated_composite_state_project
  annotated_composite_state_lift</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> annotated_composite_induced_validator_state_lift.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk69" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk69">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">strong_projection_initial_state_preservation (IM i)
  AnnotatedFree annotated_composite_state_lift</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> annotated_composite_induced_validator_initial_lift.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk6a" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk6a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">induced_validator_transition_consistency_Some
  AnnotatedFree (IM i)
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> annotated_composite_induced_validator_transition_consistency.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="AnnotatedVLSM-v-chk6b" style="display: none" type="checkbox"><label class="alectryon-input" for="AnnotatedVLSM-v-chk6b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>message, index</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>EqDecision0</var><span class="hyp-type"><b>: </b><span>EqDecision index</span></span></span><br><span><var>IM</var><span class="hyp-type"><b>: </b><span>index ‚Üí VLSM message</span></span></span><br><span><var>Free</var><span><span class="hyp-body"><b>:= </b><span>free_composite_vlsm IM</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>annotation</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>initial_annotation_prop</var><span class="hyp-type"><b>: </b><span>annotation ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Inhabited
  {x : annotation | initial_annotation_prop x}</span></span></span><br><span><var>annotated_constraint</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation * option message
  ‚Üí <span class="kt">Prop</span></span></span></span><br><span><var>annotated_transition_state</var><span class="hyp-type"><b>: </b><span>label
  (annotated_type Free
     annotation)
‚Üí annotated_state Free
    annotation *
  option message
  ‚Üí annotation</span></span></span><br><span><var>AnnotatedFree</var><span><span class="hyp-body"><b>:= </b><span>constrained_vlsm
  (annotated_vlsm Free annotation
     initial_annotation_prop
     annotated_transition_state)
  annotated_constraint</span></span><span class="hyp-type"><b>: </b><span>VLSM message</span></span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>index</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">VLSM_projection AnnotatedFree
  (preloaded_with_all_messages_vlsm (IM i))
  annotated_composite_label_project
  annotated_composite_state_project</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> annotated_composite_preloaded_projection.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">sec_composite_annotated_vlsm_projections</span>.</span></span></pre></article></body></html>