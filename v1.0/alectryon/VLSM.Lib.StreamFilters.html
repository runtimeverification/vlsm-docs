<!DOCTYPE html>
<html class="alectryon-standalone"><head><title>StreamFilters.v</title><meta charset="utf-8"><meta content="Alectryon" name="generator"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="alectryon.css" rel="stylesheet"><link href="pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" /><script src="alectryon.js"></script></head><body><article class="alectryon-root alectryon-windowed alectryon-coqdoc"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Coq+SerAPI v8.13.0+0.13.0. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+↑</kbd> <kbd>Ctrl+↓</kbd> to navigate, <kbd>Ctrl+🖱️</kbd> to focus. On Mac, use <kbd>⌘</kbd> instead of <kbd>Ctrl</kbd>.</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> stdpp <span class="kn">Require Import</span> prelude.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> Coq <span class="kn">Require Import</span> Streams Sorted.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> VLSM.Lib <span class="kn">Require Import</span> Preamble StreamExtras SortedLists ListExtras.</span></span></pre><div class="doc">
Given a predicate <code>P</code> and a stream <code>s</code>, a stream of naturals <code>ns</code>
determines a <span class="inlinecode"><span class="id" title="var">filtering_subsequence</span></span> for <code>P</code> on <code>s</code> if it corresponds to
the list of positions in <code>ss</code> where <code>P</code> holds, increasingly ordered.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">filtering_subsequence</span>
  {<span class="nv">A</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ns</span> : Stream nat)
  : <span class="kt">Prop</span>
  := (<span class="kr">forall</span> <span class="nv">i</span>, i &lt; hd ns -&gt; ~P (Str_nth i s)) /\
     ForAll2 (<span class="kr">fun</span> <span class="nv">m</span> <span class="nv">n</span> =&gt; P (Str_nth m s) /\ m &lt; n /\ <span class="kr">forall</span> <span class="nv">i</span>, m &lt; i &lt; n -&gt; ~ P (Str_nth i s)) ns.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk0"><span class="kn">Lemma</span> <span class="nf">filtering_subsequence_sorted</span>
  {<span class="nv">A</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ns</span> : Stream nat)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ns)
  : ForAll2 lt ns.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ns</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2 lt ns</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ns</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2 lt ns</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk2"><span class="nb">apply</span> proj2 <span class="kr">in</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>ForAll2
(<span class="kr">λ</span> <span class="nv">m</span> <span class="nv">n</span> : nat,
P (Str_nth m s) ∧ m &lt; n ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, m &lt; i &lt; n → ¬ P (Str_nth i s))) ns</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2 lt ns</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk3"><span class="nb">revert</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2
  (<span class="kr">λ</span> <span class="nv">m</span> <span class="nv">n</span> : nat,
     P (Str_nth m s)
     ∧ m &lt; n
       ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, m &lt; i &lt; n → ¬ P (Str_nth i s)))
  ns → ForAll2 lt ns</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk4"><span class="nb">apply</span> ForAll2_subsumption.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">a</span> <span class="nv">b</span> : nat,
  P (Str_nth a s)
  ∧ a &lt; b ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, a &lt; i &lt; b → ¬ P (Str_nth i s))
  → a &lt; b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk5"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>a, b</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth a s)
∧ a &lt; b
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, a &lt; i &lt; b → ¬ P (Str_nth i s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a &lt; b</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> H.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk6"><span class="kn">Lemma</span> <span class="nf">filtering_subsequence_prefix_sorted</span>
  {<span class="nv">A</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ns</span> : Stream nat)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ns)
  : <span class="kr">forall</span> <span class="nv">n</span>, LocallySorted lt (stream_prefix ns n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ns</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">n</span> : nat, LocallySorted lt (stream_prefix ns n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk7"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ns</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">n</span> : nat, LocallySorted lt (stream_prefix ns n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk8"><span class="nb">intro</span> n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ns</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">LocallySorted lt (stream_prefix ns n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk9"><span class="nb">apply</span> LocallySorted_ForAll2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ns</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAllSuffix2 lt (stream_prefix ns n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka"><span class="nb">apply</span> stream_prefix_ForAll2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ns</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2 lt ns</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkb"><span class="nb">apply</span> filtering_subsequence_sorted <span class="kr">in</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ns</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>ForAll2 lt ns</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2 lt ns</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc"><span class="kn">Lemma</span> <span class="nf">filtering_subsequence_iff</span>
  {<span class="nv">A</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> <span class="nv">Q</span> : A -&gt; <span class="kt">Prop</span>)
  (<span class="nv">HPQ</span> : <span class="kr">forall</span> <span class="nv">a</span>, P a &lt;-&gt; Q a)
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ss</span> : Stream nat)
  : filtering_subsequence P s ss &lt;-&gt; filtering_subsequence Q s ss.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>HPQ</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, P a ↔ Q a</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">filtering_subsequence P s ss
↔ filtering_subsequence Q s ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>HPQ</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, P a ↔ Q a</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">filtering_subsequence P s ss
↔ filtering_subsequence Q s ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chke"><span class="nb">unfold</span> filtering_subsequence.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>HPQ</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, P a ↔ Q a</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; hd ss → ¬ P (Str_nth i s))
∧ ForAll2
    (<span class="kr">λ</span> <span class="nv">m</span> <span class="nv">n</span> : nat,
       P (Str_nth m s)
       ∧ m &lt; n
         ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, m &lt; i &lt; n → ¬ P (Str_nth i s)))
    ss
↔ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; hd ss → ¬ Q (Str_nth i s))
  ∧ ForAll2
      (<span class="kr">λ</span> <span class="nv">m</span> <span class="nv">n</span> : nat,
         Q (Str_nth m s)
         ∧ m &lt; n
           ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, m &lt; i &lt; n → ¬ Q (Str_nth i s)))
      ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkf"><span class="nb">rewrite</span> !ForAll2_forall.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>HPQ</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, P a ↔ Q a</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; hd ss → ¬ P (Str_nth i s))
∧ (<span class="kr">∀</span> <span class="nv">n</span> : nat,
     P (Str_nth (Str_nth n ss) s)
     ∧ Str_nth n ss &lt; Str_nth (S n) ss
       ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
            Str_nth n ss &lt; i &lt; Str_nth (S n) ss
            → ¬ P (Str_nth i s)))
↔ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; hd ss → ¬ Q (Str_nth i s))
  ∧ (<span class="kr">∀</span> <span class="nv">n</span> : nat,
       Q (Str_nth (Str_nth n ss) s)
       ∧ Str_nth n ss &lt; Str_nth (S n) ss
         ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
              Str_nth n ss &lt; i &lt; Str_nth (S n) ss
              → ¬ Q (Str_nth i s)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk10" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk10"><span class="nb">setoid_rewrite</span> &lt;- HPQ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>HPQ</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, P a ↔ Q a</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; hd ss → ¬ P (Str_nth i s))
∧ (<span class="kr">∀</span> <span class="nv">n</span> : nat,
     P (Str_nth (Str_nth n ss) s)
     ∧ Str_nth n ss &lt; Str_nth (S n) ss
       ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
            Str_nth n ss &lt; i &lt; Str_nth (S n) ss
            → ¬ P (Str_nth i s)))
↔ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; hd ss → ¬ P (Str_nth i s))
  ∧ (<span class="kr">∀</span> <span class="nv">n</span> : nat,
       P (Str_nth (Str_nth n ss) s)
       ∧ Str_nth n ss &lt; Str_nth (S n) ss
         ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
              Str_nth n ss &lt; i &lt; Str_nth (S n) ss
              → ¬ P (Str_nth i s)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">split</span>; <span class="bp">exact</span> id.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
Each element in a <span class="inlinecode"><span class="id" title="var">filtering_subsequence</span></span> is a position in the base
stream for which the predicate holds.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk11"><span class="kn">Lemma</span> <span class="nf">filtering_subsequence_witness</span>
  {<span class="nv">A</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ss</span> : Stream nat)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss)
  (<span class="nv">k</span> : nat)
  : P (Str_nth (Str_nth k ss) s).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth (Str_nth k ss) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk12"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth (Str_nth k ss) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk13"><span class="nb">apply</span> proj2 <span class="kr">in</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>ForAll2
(<span class="kr">λ</span> <span class="nv">m</span> <span class="nv">n</span> : nat,
P (Str_nth m s) ∧ m &lt; n ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, m &lt; i &lt; n → ¬ P (Str_nth i s))) ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth (Str_nth k ss) s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk14"><span class="nb">rewrite</span> ForAll2_forall <span class="kr">in</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">n</span> : nat,
P (Str_nth (Str_nth n ss) s)
∧ Str_nth n ss &lt; Str_nth (S n) ss
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, Str_nth n ss &lt; i &lt; Str_nth (S n) ss → ¬ P (Str_nth i s))</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth (Str_nth k ss) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> Hfs.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
For each position in the base stream for which the predicate holds is
present in the <span class="inlinecode"><span class="id" title="var">filtering_subsequence</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk15" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk15"><span class="kn">Lemma</span> <span class="nf">filtering_subsequence_witness_rev</span>
  {<span class="nv">A</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ss</span> : Stream nat)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss)
  (<span class="nv">n</span> : nat)
  (<span class="nv">Hn</span> : P (Str_nth n s))
  : <span class="kr">exists</span> <span class="nv">k</span>, n = Str_nth k ss.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat, n = Str_nth k ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk16"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat, n = Str_nth k ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk17"><span class="nb">apply</span> filtering_subsequence_sorted <span class="kr">in</span> Hfs <span class="kr">as</span> Hss_sorted.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>Hss_sorted</var><span class="hyp-type"><b>: </b><span>ForAll2 lt ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat, n = Str_nth k ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk18" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk18"><span class="nb">apply</span> monotone_nat_stream_prop_from_successor <span class="kr">in</span> Hss_sorted.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>Hss_sorted</var><span class="hyp-type"><b>: </b><span>monotone_nat_stream_prop ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat, n = Str_nth k ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk19" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk19"><span class="nb">apply</span> monotone_nat_stream_find <span class="kr">with</span> (n := n) <span class="kr">in</span> Hss_sorted.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hss_sorted</var><span class="hyp-type"><b>: </b><span>n &lt; hd ss
∨ (<span class="kr">∃</span> <span class="nv">k</span> : nat,
     Str_nth k ss = n
     ∨ Str_nth k ss &lt; n &lt;
       Str_nth (S k) ss)</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat, n = Str_nth k ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk1a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk1a"><span class="nb">destruct</span> Hss_sorted  <span class="kr">as</span> [Hlt | [k Hk]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>n &lt; hd ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat, n = Str_nth k ss</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chk1b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>Str_nth k ss = n
∨ Str_nth k ss &lt; n &lt; Str_nth (S k) ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chk1b"><hr></label><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat, n = Str_nth k ss</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk1c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk1c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>n &lt; hd ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat, n = Str_nth k ss</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk1d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk1d"><span class="nb">exfalso</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>n &lt; hd ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk1e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk1e"><span class="nb">apply</span> proj1 <span class="kr">in</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; hd ss → ¬ P (Str_nth i s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>n &lt; hd ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">elim</span> (Hfs n); <span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk1f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk1f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>Str_nth k ss = n
∨ Str_nth k ss &lt; n &lt; Str_nth (S k) ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat, n = Str_nth k ss</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk20"><span class="nb">destruct</span> Hk <span class="kr">as</span> [Heq | Hk]; <span class="nb">subst</span>; [<span class="kr">exists</span> <span class="nv">k</span>; <span class="bp">reflexivity</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>Str_nth k ss &lt; n &lt; Str_nth (S k) ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat, n = Str_nth k ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk21" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk21"><span class="nb">exfalso</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>Str_nth k ss &lt; n &lt; Str_nth (S k) ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk22"><span class="nb">apply</span> proj2 <span class="kr">in</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>ForAll2
(<span class="kr">λ</span> <span class="nv">m</span> <span class="nv">n</span> : nat,
P (Str_nth m s) ∧ m &lt; n ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, m &lt; i &lt; n → ¬ P (Str_nth i s))) ss</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>Str_nth k ss &lt; n &lt; Str_nth (S k) ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk23" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk23"><span class="nb">rewrite</span> ForAll2_forall <span class="kr">in</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">n</span> : nat,
P (Str_nth (Str_nth n ss) s)
∧ Str_nth n ss &lt; Str_nth (S n) ss
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, Str_nth n ss &lt; i &lt; Str_nth (S n) ss → ¬ P (Str_nth i s))</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>Str_nth k ss &lt; n &lt; Str_nth (S k) ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk24" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk24"><span class="nb">specialize</span> (Hfs k) <span class="kr">as</span> [_ [_ Hfs]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>k, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>Str_nth k ss &lt; n &lt; Str_nth (S k) ss</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, Str_nth k ss &lt; i &lt; Str_nth (S k) ss → ¬ P (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">elim</span> (Hfs n); <span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
Prefixes of the filtering subsequence expressed as filters.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk25" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk25"><span class="kn">Lemma</span> <span class="nf">filtering_subsequence_prefix_is_filter</span>
  {<span class="nv">A</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  {<span class="nv">Pdec</span> : <span class="kr">forall</span> <span class="nv">a</span>, Decision (P a)}
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ss</span> : Stream nat)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss)
  : <span class="kr">forall</span> (<span class="nv">k</span> : nat),
    stream_prefix ss (S k) =
    filter (<span class="kr">fun</span> <span class="nv">i</span> =&gt; P (Str_nth i s)) (stream_prefix nat_sequence (S (Str_nth k ss))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">k</span> : nat,
  stream_prefix ss (S k) =
  filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
    (stream_prefix nat_sequence (S (Str_nth k ss)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk26" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk26"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">k</span> : nat,
  stream_prefix ss (S k) =
  filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
    (stream_prefix nat_sequence (S (Str_nth k ss)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk27" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk27"><span class="nb">intro</span> k.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix ss (S k) =
filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
  (stream_prefix nat_sequence (S (Str_nth k ss)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk28" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk28"><span class="nb">apply</span> (@set_equality_predicate _ lt _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">LocallySorted lt (stream_prefix ss (S k))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chk29" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chk29"><hr></label><div class="goal-conclusion">LocallySorted lt
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence (S (Str_nth k ss))))</div></blockquote><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chk2a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chk2a"><hr></label><div class="goal-conclusion">ListSetExtras.set_eq (stream_prefix ss (S k))
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence (S (Str_nth k ss))))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk2b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk2b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">LocallySorted lt (stream_prefix ss (S k))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk2c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk2c"><span class="nb">apply</span> filtering_subsequence_prefix_sorted <span class="kr">with</span> P s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">filtering_subsequence P s ss</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk2d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk2d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">LocallySorted lt
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence (S (Str_nth k ss))))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk2e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk2e"><span class="nb">apply</span> LocallySorted_filter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Transitive lt</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chk2f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chk2f"><hr></label><div class="goal-conclusion">LocallySorted lt
  (stream_prefix nat_sequence (S (Str_nth k ss)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk30" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk30">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Transitive lt</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk31" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk31"><span class="nb">unfold</span> Transitive.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> : nat, x &lt; y → y &lt; z → x &lt; z</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk32" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk32">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">LocallySorted lt
  (stream_prefix nat_sequence (S (Str_nth k ss)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> nat_sequence_prefix_sorted.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk33" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk33">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ListSetExtras.set_eq (stream_prefix ss (S k))
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence (S (Str_nth k ss))))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk34" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk34"><span class="nb">unfold</span> ListSetExtras.set_eq, subseteq, list_subseteq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">∀</span> <span class="nv">x</span> : nat,
   x ∈ stream_prefix ss (S k)
   → x
     ∈ filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
         (stream_prefix nat_sequence
            (S (Str_nth k ss))))
∧ (<span class="kr">∀</span> <span class="nv">x</span> : nat,
     x
     ∈ filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
         (stream_prefix nat_sequence
            (S (Str_nth k ss)))
     → x ∈ stream_prefix ss (S k))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk35" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk35"><span class="nb">setoid_rewrite</span> elem_of_list_filter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">∀</span> <span class="nv">x</span> : nat,
   x ∈ stream_prefix ss (S k)
   → P (Str_nth x s)
     ∧ x
       ∈ stream_prefix nat_sequence (S (Str_nth k ss)))
∧ (<span class="kr">∀</span> <span class="nv">x</span> : nat,
     P (Str_nth x s)
     ∧ x
       ∈ stream_prefix nat_sequence (S (Str_nth k ss))
     → x ∈ stream_prefix ss (S k))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk36" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk36"><span class="nb">setoid_rewrite</span> elem_of_stream_prefix.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">∀</span> <span class="nv">x</span> : nat,
   (<span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x)
   → P (Str_nth x s)
     ∧ (<span class="kr">∃</span> <span class="nv">k0</span> : nat,
          k0 &lt; S (Str_nth k ss)
          ∧ Str_nth k0 nat_sequence = x))
∧ (<span class="kr">∀</span> <span class="nv">x</span> : nat,
     P (Str_nth x s)
     ∧ (<span class="kr">∃</span> <span class="nv">k0</span> : nat,
          k0 &lt; S (Str_nth k ss)
          ∧ Str_nth k0 nat_sequence = x)
     → <span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk37" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk37"><span class="nb">setoid_rewrite</span> nat_sequence_nth.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">∀</span> <span class="nv">x</span> : nat,
   (<span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x)
   → P (Str_nth x s)
     ∧ (<span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S (Str_nth k ss) ∧ k0 = x))
∧ (<span class="kr">∀</span> <span class="nv">x</span> : nat,
     P (Str_nth x s)
     ∧ (<span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S (Str_nth k ss) ∧ k0 = x)
     → <span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk38" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk38"><span class="nb">split</span>; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth x s)
∧ (<span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S (Str_nth k ss) ∧ k0 = x)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chk39" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth x s)
∧ (<span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S (Str_nth k ss) ∧ k0 = x)</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chk39"><hr></label><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk3a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk3a">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth x s)
∧ (<span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S (Str_nth k ss) ∧ k0 = x)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk3b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk3b"><span class="nb">destruct</span> H <span class="kr">as</span> [i [Hi Ha]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, x, i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hi</var><span class="hyp-type"><b>: </b><span>i &lt; S k</span></span></span><br><span><var>Ha</var><span class="hyp-type"><b>: </b><span>Str_nth i ss = x</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth x s)
∧ (<span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S (Str_nth k ss) ∧ k0 = x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk3c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk3c"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hi</var><span class="hyp-type"><b>: </b><span>i &lt; S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth (Str_nth i ss) s)
∧ (<span class="kr">∃</span> <span class="nv">k0</span> : nat,
     k0 &lt; S (Str_nth k ss) ∧ k0 = Str_nth i ss)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk3d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk3d"><span class="nb">split</span>; [<span class="nb">apply</span> filtering_subsequence_witness; <span class="bp">assumption</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hi</var><span class="hyp-type"><b>: </b><span>i &lt; S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S (Str_nth k ss) ∧ k0 = Str_nth i ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk3e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk3e"><span class="nb">eexists</span>; <span class="nb">split</span>; [|<span class="bp">reflexivity</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hi</var><span class="hyp-type"><b>: </b><span>i &lt; S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth i ss &lt; S (Str_nth k ss)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk3f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk3f"><span class="nb">destruct</span> (decide (i = k)); [<span class="nb">subst</span>; <span class="bp">lia</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hi</var><span class="hyp-type"><b>: </b><span>i &lt; S k</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>i ≠ k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth i ss &lt; S (Str_nth k ss)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk40" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk40"><span class="nb">cut</span> (Str_nth i ss &lt; Str_nth k ss); [<span class="bp">lia</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hi</var><span class="hyp-type"><b>: </b><span>i &lt; S k</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>i ≠ k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth i ss &lt; Str_nth k ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk41" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk41"><span class="nb">apply</span> ForAll2_transitive_lookup; [<span class="nb">unfold</span> Transitive; <span class="bp">lia</span>| | <span class="bp">lia</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hi</var><span class="hyp-type"><b>: </b><span>i &lt; S k</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>i ≠ k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2 lt ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk42" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk42"><span class="nb">apply</span> filtering_subsequence_sorted <span class="kr">in</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>ForAll2 lt ss</span></span></span><br><span><var>k, i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hi</var><span class="hyp-type"><b>: </b><span>i &lt; S k</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>i ≠ k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2 lt ss</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk43" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk43">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth x s)
∧ (<span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S (Str_nth k ss) ∧ k0 = x)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk44" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk44"><span class="nb">destruct</span> H <span class="kr">as</span> [Hpa [_a [Hlt H_a]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpa</var><span class="hyp-type"><b>: </b><span>P (Str_nth x s)</span></span></span><br><span><var>_a</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>_a &lt; S (Str_nth k ss)</span></span></span><br><span><var>H_a</var><span class="hyp-type"><b>: </b><span>_a = x</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk45" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk45"><span class="nb">subst</span> _a.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpa</var><span class="hyp-type"><b>: </b><span>P (Str_nth x s)</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>x &lt; S (Str_nth k ss)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk46" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk46"><span class="nb">specialize</span> (filtering_subsequence_witness_rev _ _ _ Hfs _ Hpa)
        <span class="kr">as</span> [k&#39; Hk&#39;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hpa</var><span class="hyp-type"><b>: </b><span>P (Str_nth x s)</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>x &lt; S (Str_nth k ss)</span></span></span><br><span><var>k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk'</var><span class="hyp-type"><b>: </b><span>x = Str_nth k&#39; ss</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk47" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk47"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>Str_nth k&#39; ss &lt; S (Str_nth k ss)</span></span></span><br><span><var>Hpa</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth k&#39; ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k0</span> : nat, k0 &lt; S k ∧ Str_nth k0 ss = Str_nth k&#39; ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk48" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk48"><span class="kr">exists</span> <span class="nv">k&#39;</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>Str_nth k&#39; ss &lt; S (Str_nth k ss)</span></span></span><br><span><var>Hpa</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth k&#39; ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k&#39; &lt; S k ∧ Str_nth k&#39; ss = Str_nth k&#39; ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk49" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk49"><span class="nb">split</span>; [|<span class="bp">reflexivity</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k, k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>Str_nth k&#39; ss &lt; S (Str_nth k ss)</span></span></span><br><span><var>Hpa</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth k&#39; ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k&#39; &lt; S k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk4a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk4a"><span class="nb">apply</span> filtering_subsequence_sorted <span class="kr">in</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>ForAll2 lt ss</span></span></span><br><span><var>k, k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>Str_nth k&#39; ss &lt; S (Str_nth k ss)</span></span></span><br><span><var>Hpa</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth k&#39; ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k&#39; &lt; S k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk4b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk4b"><span class="nb">apply</span> monotone_nat_stream_prop_from_successor <span class="kr">in</span> Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>monotone_nat_stream_prop ss</span></span></span><br><span><var>k, k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>Str_nth k&#39; ss &lt; S (Str_nth k ss)</span></span></span><br><span><var>Hpa</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth k&#39; ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k&#39; &lt; S k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk4c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk4c"><span class="nb">specialize</span> (monotone_nat_stream_rev _ Hfs k&#39; k) <span class="kr">as</span> Hle.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>monotone_nat_stream_prop ss</span></span></span><br><span><var>k, k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>Str_nth k&#39; ss &lt; S (Str_nth k ss)</span></span></span><br><span><var>Hpa</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth k&#39; ss) s)</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>Str_nth k&#39; ss ≤ Str_nth k ss → k&#39; ≤ k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k&#39; &lt; S k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input">feed <span class="nb">specialize</span> Hle; <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk4d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk4d"><span class="kn">Lemma</span> <span class="nf">filtering_subsequence_prefix_length</span>
  {<span class="nv">A</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  {<span class="nv">Pdec</span> : <span class="kr">forall</span> <span class="nv">a</span>, Decision (P a)}
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ss</span> : Stream nat)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss)
  (<span class="nv">m</span> : nat)
  : length (filter P (stream_prefix s (S (Str_nth m ss)))) = S m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (S (Str_nth m ss)))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk4e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk4e"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (S (Str_nth m ss)))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk4f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk4f"><span class="nb">specialize</span> (filtering_subsequence_prefix_is_filter _ _ _ Hfs m) <span class="kr">as</span> Hfilter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>stream_prefix ss (S m) =
filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
  (stream_prefix nat_sequence
     (S (Str_nth m ss)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (S (Str_nth m ss)))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk50" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk50"><span class="nb">apply</span> <span class="nb">f_equal</span> <span class="kr">with</span> (f := length) <span class="kr">in</span> Hfilter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>length (stream_prefix ss (S m)) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (S (Str_nth m ss))))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (S (Str_nth m ss)))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk51" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk51"><span class="nb">rewrite</span> stream_prefix_length <span class="kr">in</span> Hfilter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (S (Str_nth m ss))))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (S (Str_nth m ss)))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk52" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk52"><span class="nb">rewrite</span>! stream_prefix_S, filter_app <span class="kr">in</span> Hfilter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)) ++
   filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     [Str_nth (Str_nth m ss) nat_sequence])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (S (Str_nth m ss)))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk53" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk53"><span class="nb">unfold</span> filter <span class="nb">at</span> <span class="mi">2</span> <span class="kr">in</span> Hfilter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)) ++
   list_filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (<span class="kr">λ</span> <span class="nv">x</span> : nat, Pdec (Str_nth x s))
     [Str_nth (Str_nth m ss) nat_sequence])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (S (Str_nth m ss)))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk54" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk54"><span class="nb">simpl</span> <span class="kr">in</span> Hfilter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)) ++
   (<span class="kr">if</span>
     decide
       (P
          (Str_nth
             (Str_nth (Str_nth m ss)
                nat_sequence) s))
    <span class="kr">then</span>
     Str_nth (Str_nth m ss) nat_sequence
     :: filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
          []
    <span class="kr">else</span>
     filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s)) []))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (S (Str_nth m ss)))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk55" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk55"><span class="nb">rewrite</span> nat_sequence_nth <span class="kr">in</span> Hfilter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)) ++
   (<span class="kr">if</span> decide (P (Str_nth (Str_nth m ss) s))
    <span class="kr">then</span>
     Str_nth m ss
     :: filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
          []
    <span class="kr">else</span>
     filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s)) []))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (S (Str_nth m ss)))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk56" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk56"><span class="nb">rewrite</span> stream_prefix_S, filter_app.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)) ++
   (<span class="kr">if</span> decide (P (Str_nth (Str_nth m ss) s))
    <span class="kr">then</span>
     Str_nth m ss
     :: filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
          []
    <span class="kr">else</span>
     filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s)) []))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter P (stream_prefix s (Str_nth m ss)) ++
   filter P [Str_nth (Str_nth m ss) s]) = S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk57" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk57"><span class="nb">unfold</span> filter <span class="nb">at</span> <span class="mi">2</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)) ++
   (<span class="kr">if</span> decide (P (Str_nth (Str_nth m ss) s))
    <span class="kr">then</span>
     Str_nth m ss
     :: filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
          []
    <span class="kr">else</span>
     filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s)) []))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter P (stream_prefix s (Str_nth m ss)) ++
   list_filter P Pdec [Str_nth (Str_nth m ss) s]) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk58" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk58"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)) ++
   (<span class="kr">if</span> decide (P (Str_nth (Str_nth m ss) s))
    <span class="kr">then</span>
     Str_nth m ss
     :: filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
          []
    <span class="kr">else</span>
     filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s)) []))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter P (stream_prefix s (Str_nth m ss)) ++
   (<span class="kr">if</span> decide (P (Str_nth (Str_nth m ss) s))
    <span class="kr">then</span> Str_nth (Str_nth m ss) s :: filter P []
    <span class="kr">else</span> filter P [])) = S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk59" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk59"><span class="nb">specialize</span> (filtering_subsequence_witness _ _ _ Hfs m) <span class="kr">as</span> Hm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)) ++
   (<span class="kr">if</span> decide (P (Str_nth (Str_nth m ss) s))
    <span class="kr">then</span>
     Str_nth m ss
     :: filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
          []
    <span class="kr">else</span>
     filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s)) []))</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth m ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter P (stream_prefix s (Str_nth m ss)) ++
   (<span class="kr">if</span> decide (P (Str_nth (Str_nth m ss) s))
    <span class="kr">then</span> Str_nth (Str_nth m ss) s :: filter P []
    <span class="kr">else</span> filter P [])) = S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk5a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk5a"><span class="nb">rewrite</span> decide_True <span class="kr">in</span> Hfilter <span class="bp">by</span> <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)) ++
   Str_nth m ss
   :: filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s)) [])</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth m ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter P (stream_prefix s (Str_nth m ss)) ++
   (<span class="kr">if</span> decide (P (Str_nth (Str_nth m ss) s))
    <span class="kr">then</span> Str_nth (Str_nth m ss) s :: filter P []
    <span class="kr">else</span> filter P [])) = S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk5b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk5b"><span class="nb">rewrite</span> decide_True <span class="bp">by</span> <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)) ++
   Str_nth m ss
   :: filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s)) [])</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth m ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter P (stream_prefix s (Str_nth m ss)) ++
   Str_nth (Str_nth m ss) s :: filter P []) = S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk5c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk5c"><span class="nb">rewrite</span> app_length, Plus.plus_comm <span class="kr">in</span> Hfilter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
length
  (Str_nth m ss
   :: filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s)) []) +
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence
        (Str_nth m ss)))</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth m ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter P (stream_prefix s (Str_nth m ss)) ++
   Str_nth (Str_nth m ss) s :: filter P []) = S m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk5d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk5d"><span class="nb">simpl</span> <span class="kr">in</span> Hfilter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
S
  (length
     (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
        (stream_prefix nat_sequence
           (Str_nth m ss))))</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth m ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter P (stream_prefix s (Str_nth m ss)) ++
   Str_nth (Str_nth m ss) s :: filter P []) = S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk5e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk5e"><span class="nb">rewrite</span> app_length, Plus.plus_comm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
S
  (length
     (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
        (stream_prefix nat_sequence
           (Str_nth m ss))))</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth m ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (Str_nth (Str_nth m ss) s :: filter P []) +
length (filter P (stream_prefix s (Str_nth m ss))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk5f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk5f"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
S
  (length
     (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
        (stream_prefix nat_sequence
           (Str_nth m ss))))</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth m ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S (length (filter P (stream_prefix s (Str_nth m ss)))) =
S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk60" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk60"><span class="nb">rewrite</span> Hfilter.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
S
  (length
     (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
        (stream_prefix nat_sequence
           (Str_nth m ss))))</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth m ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S (length (filter P (stream_prefix s (Str_nth m ss)))) =
S
  (length
     (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
        (stream_prefix nat_sequence (Str_nth m ss))))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk61" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk61"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfilter</var><span class="hyp-type"><b>: </b><span>S m =
S
  (length
     (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
        (stream_prefix nat_sequence
           (Str_nth m ss))))</span></span></span><br><span><var>Hm</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth m ss) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (Str_nth m ss))) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence (Str_nth m ss)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk62" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk62"><span class="nb">clear</span> -Hfs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (Str_nth m ss))) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence (Str_nth m ss)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk63" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk63"><span class="nb">generalize</span> (Str_nth m ss).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">n</span> : nat,
  length (filter P (stream_prefix s n)) =
  length
    (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
       (stream_prefix nat_sequence n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk64" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk64"><span class="nb">induction</span> n; [<span class="bp">reflexivity</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>length (filter P (stream_prefix s n)) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (S n))) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence (S n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk65" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk65"><span class="nb">rewrite</span> !stream_prefix_S, !filter_app, !app_length, IHn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>length (filter P (stream_prefix s n)) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence n)) +
length (filter P [Str_nth n s]) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence n)) +
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     [Str_nth n nat_sequence])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk66" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk66"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>length (filter P (stream_prefix s n)) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P [Str_nth n s]) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     [Str_nth n nat_sequence])</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk67" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk67"><span class="nb">rewrite</span> nat_sequence_nth.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>length (filter P (stream_prefix s n)) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P [Str_nth n s]) =
length (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s)) [n])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk68" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk68"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>length (filter P (stream_prefix s n)) =
length
  (filter (<span class="kr">λ</span> <span class="nv">i</span> : nat, P (Str_nth i s))
     (stream_prefix nat_sequence n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (<span class="kr">if</span> decide (P (Str_nth n s))
   <span class="kr">then</span> [Str_nth n s]
   <span class="kr">else</span> []) =
length (<span class="kr">if</span> decide (P (Str_nth n s)) <span class="kr">then</span> [n] <span class="kr">else</span> [])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input">case_decide; <span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk69" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk69"><span class="kn">Lemma</span> <span class="nf">filtering_subsequence_prefix_is_filter_last</span>
  {<span class="nv">A</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  {<span class="nv">Pdec</span> : <span class="kr">forall</span> <span class="nv">a</span>, Decision (P a)}
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ss</span> : Stream nat)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss)
  (<span class="nv">n</span> : nat)
  (<span class="nv">Hn</span> : P (Str_nth n s))
  : Str_nth (length (filter P (stream_prefix s n))) ss = n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth (length (filter P (stream_prefix s n))) ss = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk6a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk6a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth (length (filter P (stream_prefix s n))) ss = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk6b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk6b"><span class="nb">specialize</span> (filtering_subsequence_witness_rev _ _ _ Hfs _ Hn) <span class="kr">as</span> [k Heqn].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heqn</var><span class="hyp-type"><b>: </b><span>n = Str_nth k ss</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth (length (filter P (stream_prefix s n))) ss = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk6c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk6c"><span class="nb">replace</span> (length _) <span class="kr">with</span> k; [<span class="nb">subst</span>; <span class="bp">reflexivity</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heqn</var><span class="hyp-type"><b>: </b><span>n = Str_nth k ss</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k = length (filter P (stream_prefix s n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk6d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk6d"><span class="nb">specialize</span> (filtering_subsequence_prefix_length _ _ _ Hfs k) <span class="kr">as</span> Hlength.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heqn</var><span class="hyp-type"><b>: </b><span>n = Str_nth k ss</span></span></span><br><span><var>Hlength</var><span class="hyp-type"><b>: </b><span>length
  (filter P
     (stream_prefix s (S (Str_nth k ss)))) =
S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k = length (filter P (stream_prefix s n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk6e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk6e"><span class="nb">rewrite</span>! stream_prefix_S, filter_app <span class="kr">in</span> Hlength.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heqn</var><span class="hyp-type"><b>: </b><span>n = Str_nth k ss</span></span></span><br><span><var>Hlength</var><span class="hyp-type"><b>: </b><span>length
  (filter P (stream_prefix s (Str_nth k ss)) ++
   filter P [Str_nth (Str_nth k ss) s]) =
S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k = length (filter P (stream_prefix s n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk6f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk6f"><span class="nb">unfold</span> filter <span class="nb">at</span> <span class="mi">2</span> <span class="kr">in</span> Hlength.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heqn</var><span class="hyp-type"><b>: </b><span>n = Str_nth k ss</span></span></span><br><span><var>Hlength</var><span class="hyp-type"><b>: </b><span>length
  (filter P (stream_prefix s (Str_nth k ss)) ++
   list_filter P Pdec
     [Str_nth (Str_nth k ss) s]) = 
S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k = length (filter P (stream_prefix s n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk70" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk70"><span class="nb">simpl</span> <span class="kr">in</span> Hlength.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heqn</var><span class="hyp-type"><b>: </b><span>n = Str_nth k ss</span></span></span><br><span><var>Hlength</var><span class="hyp-type"><b>: </b><span>length
  (filter P (stream_prefix s (Str_nth k ss)) ++
   (<span class="kr">if</span> decide (P (Str_nth (Str_nth k ss) s))
    <span class="kr">then</span>
     Str_nth (Str_nth k ss) s :: filter P []
    <span class="kr">else</span> filter P [])) = 
S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k = length (filter P (stream_prefix s n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk71" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk71"><span class="nb">rewrite</span> decide_True <span class="kr">in</span> Hlength <span class="bp">by</span> (<span class="nb">subst</span>; <span class="bp">assumption</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heqn</var><span class="hyp-type"><b>: </b><span>n = Str_nth k ss</span></span></span><br><span><var>Hlength</var><span class="hyp-type"><b>: </b><span>length
  (filter P (stream_prefix s (Str_nth k ss)) ++
   Str_nth (Str_nth k ss) s :: filter P []) =
S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k = length (filter P (stream_prefix s n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk72" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk72"><span class="nb">rewrite</span> app_length, Plus.plus_comm <span class="kr">in</span> Hlength.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heqn</var><span class="hyp-type"><b>: </b><span>n = Str_nth k ss</span></span></span><br><span><var>Hlength</var><span class="hyp-type"><b>: </b><span>length
  (Str_nth (Str_nth k ss) s :: filter P []) +
length
  (filter P (stream_prefix s (Str_nth k ss))) =
S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k = length (filter P (stream_prefix s n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk73" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk73"><span class="nb">simpl</span> <span class="kr">in</span> Hlength.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heqn</var><span class="hyp-type"><b>: </b><span>n = Str_nth k ss</span></span></span><br><span><var>Hlength</var><span class="hyp-type"><b>: </b><span>S
  (length
     (filter P
        (stream_prefix s (Str_nth k ss)))) =
S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k = length (filter P (stream_prefix s n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk74" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk74"><span class="nb">inversion</span> Hlength.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heqn</var><span class="hyp-type"><b>: </b><span>n = Str_nth k ss</span></span></span><br><span><var>Hlength</var><span class="hyp-type"><b>: </b><span>S
  (length
     (filter P
        (stream_prefix s (Str_nth k ss)))) =
S k</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>length
  (filter P (stream_prefix s (Str_nth k ss))) = k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (Str_nth k ss))) =
length (filter P (stream_prefix s n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk75" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk75"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hn</var><span class="hyp-type"><b>: </b><span>P (Str_nth (Str_nth k ss) s)</span></span></span><br><span><var>Hlength</var><span class="hyp-type"><b>: </b><span>S
  (length
     (filter P
        (stream_prefix s (Str_nth k ss)))) =
S k</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>length
  (filter P (stream_prefix s (Str_nth k ss))) = k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (filter P (stream_prefix s (Str_nth k ss))) =
length (filter P (stream_prefix s (Str_nth k ss)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
Given a <span class="inlinecode"><span class="id" title="var">filtering_subsequence</span></span> for property <code>P</code> over a stream <code>s</code> and
a function <code>f</code> transforming elements with property <code>P</code>, we can define the
filtering of <code>s</code> by <code>P</code> mapped through the function <code>f</code>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">fitering_subsequence_stream_filter_map</span>
  {<span class="nv">A</span> <span class="nv">B</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  {<span class="nv">Pdec</span> : <span class="kr">forall</span> <span class="nv">a</span>, Decision (P a)}
  (<span class="nv">f</span> : dsig P -&gt; B)
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ss</span> : Stream nat)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss)
  : Stream B
  := map (<span class="kr">fun</span> <span class="nv">k</span> =&gt; f (dexist _ (filtering_subsequence_witness P s ss Hfs k))) nat_sequence.</span></span></pre><div class="doc">
Connecting prefixes of <span class="inlinecode"><span class="id" title="var">fitering_subsequence_stream_filter_map</span></span> with <span class="inlinecode"><span class="id" title="var">list_filter_map</span></span>s on
prefixes.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk76" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk76"><span class="kn">Lemma</span> <span class="nf">fitering_subsequence_stream_filter_map_prefix</span>
  {<span class="nv">A</span> <span class="nv">B</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  {<span class="nv">Pdec</span> : <span class="kr">forall</span> <span class="nv">a</span>, Decision (P a)}
  (<span class="nv">f</span> : dsig P -&gt; B)
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ss</span> : Stream nat)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss)
  (<span class="nv">n</span> : nat)
  (<span class="nv">pre_filter_map</span> := list_filter_map P f (stream_prefix s n))
  (<span class="nv">m</span> := length pre_filter_map)
  : stream_prefix (fitering_subsequence_stream_filter_map P f s ss Hfs) m = pre_filter_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>pre_filter_map</var><span><span class="hyp-body"><b>:= </b><span>list_filter_map P f
  (stream_prefix s n)</span></span><span class="hyp-type"><b>: </b><span>list B</span></span></span></span><br><span><var>m</var><span><span class="hyp-body"><b>:= </b><span>length pre_filter_map</span></span><span class="hyp-type"><b>: </b><span>nat</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  m = pre_filter_map</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk77" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk77"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>pre_filter_map</var><span><span class="hyp-body"><b>:= </b><span>list_filter_map P f
  (stream_prefix s n)</span></span><span class="hyp-type"><b>: </b><span>list B</span></span></span></span><br><span><var>m</var><span><span class="hyp-body"><b>:= </b><span>length pre_filter_map</span></span><span class="hyp-type"><b>: </b><span>nat</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  m = pre_filter_map</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk78" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk78"><span class="nb">subst</span> m pre_filter_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk79" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk79"><span class="nb">induction</span> n; [<span class="bp">reflexivity</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s (S n)))) =
list_filter_map P f (stream_prefix s (S n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk7a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk7a"><span class="nb">rewrite</span> stream_prefix_S, list_filter_map_app, app_length.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n)) +
   length (list_filter_map P f [Str_nth n s])) =
list_filter_map P f (stream_prefix s n) ++
list_filter_map P f [Str_nth n s]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk7b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk7b"><span class="nb">remember</span> (list_filter_map P f [Str_nth n s]) <span class="kr">as</span> lst.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>lst</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>Heqlst</var><span class="hyp-type"><b>: </b><span>lst = list_filter_map P f [Str_nth n s]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n)) +
   length lst) =
list_filter_map P f (stream_prefix s n) ++ lst</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk7c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk7c"><span class="nb">unfold</span> list_filter_map <span class="kr">in</span> Heqlst.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>lst</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>Heqlst</var><span class="hyp-type"><b>: </b><span>lst =
List.map f (filter_annotate P [Str_nth n s])</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n)) +
   length lst) =
list_filter_map P f (stream_prefix s n) ++ lst</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk7d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk7d"><span class="nb">rewrite</span> filter_annotate_unroll <span class="kr">in</span> Heqlst.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>lst</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>Heqlst</var><span class="hyp-type"><b>: </b><span>lst =
List.map f
  (<span class="kr">let</span> <span class="nv">fa</span> := filter_annotate P [] <span class="kr">in</span>
   <span class="kr">match</span> decide (P (Str_nth n s)) <span class="kr">with</span>
   | <span class="nb">left</span> pa =&gt; dexist (Str_nth n s) pa :: fa
   | <span class="nb">right</span> _ =&gt; fa
   <span class="kr">end</span>)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n)) +
   length lst) =
list_filter_map P f (stream_prefix s n) ++ lst</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk7e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk7e"><span class="nb">simpl</span> <span class="kr">in</span> Heqlst.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>lst</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>Heqlst</var><span class="hyp-type"><b>: </b><span>lst =
List.map f
  <span class="kr">match</span> decide (P (Str_nth n s)) <span class="kr">with</span>
  | <span class="nb">left</span> pa =&gt;
      dexist (Str_nth n s) pa
      :: filter_annotate P []
  | <span class="nb">right</span> _ =&gt; filter_annotate P []
  <span class="kr">end</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n)) +
   length lst) =
list_filter_map P f (stream_prefix s n) ++ lst</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk7f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk7f">case_decide; <span class="nb">subst</span> lst; <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n)) +
   <span class="mi">1</span>) =
list_filter_map P f (stream_prefix s n) ++
[f (dexist (Str_nth n s) H)]</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chk80" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>¬ P (Str_nth n s)</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chk80"><hr></label><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n)) +
   <span class="mi">0</span>) = list_filter_map P f (stream_prefix s n) ++ []</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk81" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk81"><span class="mi">2</span>: {</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>¬ P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n)) +
   <span class="mi">0</span>) = list_filter_map P f (stream_prefix s n) ++ []</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk82" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk82"><span class="nb">rewrite</span> Plus.plus_comm, app_nil_r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>¬ P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (<span class="mi">0</span> +
   length (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk83" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk83"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>¬ P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk84" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk84">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n)) +
   <span class="mi">1</span>) =
list_filter_map P f (stream_prefix s n) ++
[f (dexist (Str_nth n s) H)]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk85" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk85"><span class="nb">replace</span> (length (list_filter_map P f (stream_prefix s n)) + <span class="mi">1</span>)
    <span class="kr">with</span> (S (length (list_filter_map P f (stream_prefix s n))))
    <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (S
     (length (list_filter_map P f (stream_prefix s n)))) =
list_filter_map P f (stream_prefix s n) ++
[f (dexist (Str_nth n s) H)]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk86" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk86"><span class="nb">rewrite</span> stream_prefix_S.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length (list_filter_map P f (stream_prefix s n))) ++
[Str_nth
   (length (list_filter_map P f (stream_prefix s n)))
   (fitering_subsequence_stream_filter_map P f s ss
      Hfs)] =
list_filter_map P f (stream_prefix s n) ++
[f (dexist (Str_nth n s) H)]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk87" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk87"><span class="nb">rewrite</span> IHn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">list_filter_map P f (stream_prefix s n) ++
[Str_nth
   (length (list_filter_map P f (stream_prefix s n)))
   (fitering_subsequence_stream_filter_map P f s ss
      Hfs)] =
list_filter_map P f (stream_prefix s n) ++
[f (dexist (Str_nth n s) H)]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk88" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk88"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">[Str_nth
   (length (list_filter_map P f (stream_prefix s n)))
   (fitering_subsequence_stream_filter_map P f s ss
      Hfs)] = [f (dexist (Str_nth n s) H)]</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk89" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk89"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth
  (length (list_filter_map P f (stream_prefix s n)))
  (fitering_subsequence_stream_filter_map P f s ss Hfs) =
f (dexist (Str_nth n s) H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk8a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk8a"><span class="nb">unfold</span> fitering_subsequence_stream_filter_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth
  (length (list_filter_map P f (stream_prefix s n)))
  (map
     (<span class="kr">λ</span> <span class="nv">k</span> : nat,
        f
          (dexist (Str_nth (Str_nth k ss) s)
             (filtering_subsequence_witness P s ss Hfs
                k))) nat_sequence) =
f (dexist (Str_nth n s) H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk8b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk8b"><span class="nb">rewrite</span> Str_nth_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f
  (dexist
     (Str_nth
        (Str_nth
           (Str_nth
              (length
                 (list_filter_map P f
                    (stream_prefix s n))) nat_sequence)
           ss) s)
     (filtering_subsequence_witness P s ss Hfs
        (Str_nth
           (length
              (list_filter_map P f (stream_prefix s n)))
           nat_sequence))) =
f (dexist (Str_nth n s) H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk8c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk8c"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">dexist
  (Str_nth
     (Str_nth
        (Str_nth
           (length
              (list_filter_map P f (stream_prefix s n)))
           nat_sequence) ss) s)
  (filtering_subsequence_witness P s ss Hfs
     (Str_nth
        (length
           (list_filter_map P f (stream_prefix s n)))
        nat_sequence)) = dexist (Str_nth n s) H</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk8d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk8d"><span class="nb">apply</span> dsig_eq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">`(dexist
    (Str_nth
       (Str_nth
          (Str_nth
             (length
                (list_filter_map P f
                   (stream_prefix s n))) nat_sequence)
          ss) s)
    (filtering_subsequence_witness P s ss Hfs
       (Str_nth
          (length
             (list_filter_map P f (stream_prefix s n)))
          nat_sequence))) = `(dexist (Str_nth n s) H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk8e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk8e"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth
  (Str_nth
     (Str_nth
        (length
           (list_filter_map P f (stream_prefix s n)))
        nat_sequence) ss) s = Str_nth n s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk8f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk8f"><span class="nb">rewrite</span> nat_sequence_nth.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth
  (Str_nth
     (length (list_filter_map P f (stream_prefix s n)))
     ss) s = Str_nth n s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk90" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk90"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth
  (length (list_filter_map P f (stream_prefix s n)))
  ss = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk91" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk91"><span class="nb">unfold</span> list_filter_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth
  (length
     (List.map f
        (filter_annotate P (stream_prefix s n)))) ss =
n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk92" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk92"><span class="nb">rewrite</span> map_length.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth
  (length (filter_annotate P (stream_prefix s n))) ss =
n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk93" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk93"><span class="nb">rewrite</span> filter_annotate_length.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f (stream_prefix s n))) =
list_filter_map P f (stream_prefix s n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P (Str_nth n s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Str_nth (length (filter P (stream_prefix s n))) ss = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> filtering_subsequence_prefix_is_filter_last; <span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Program Definition</span> <span class="nf">fitering_subsequence_stream_filter_map_prefix_ex</span>
  {<span class="nv">A</span> <span class="nv">B</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  {<span class="nv">Pdec</span> : <span class="kr">forall</span> <span class="nv">a</span>, Decision (P a)}
  (<span class="nv">f</span> : dsig P -&gt; B)
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ss</span> : Stream nat)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss)
  (<span class="nv">m</span> : nat)
  : { n : nat | stream_prefix (fitering_subsequence_stream_filter_map P f s ss Hfs) m = list_filter_map P f (stream_prefix s n) } :=
  <span class="kr">match</span> m <span class="kr">with</span>
  | <span class="mi">0</span> =&gt; exist _ <span class="mi">0</span> _
  | S m =&gt; exist _ (S (Str_nth m ss)) _
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk94" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk94"><span class="kn">Next Obligation</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">A</span> <span class="nv">B</span> : <span class="kt">Type</span>) (<span class="nv">P</span> : A → <span class="kt">Prop</span>) (<span class="nv">Pdec</span> : <span class="kr">∀</span> <span class="nv">a</span> : A,
                                        Decision (P a)) 
  (<span class="nv">f</span> : dsig P → B) (<span class="nv">s</span> : Stream A) (<span class="nv">ss</span> : Stream nat) 
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss) (<span class="nv">m</span> : nat),
  <span class="mi">0</span> = m
  → (<span class="kr">λ</span> <span class="nv">n</span> : nat,
       stream_prefix
         (fitering_subsequence_stream_filter_map P f s
            ss Hfs) <span class="mi">0</span> =
       list_filter_map P f (stream_prefix s n)) <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk95" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk95"><span class="kn">Next Obligation</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">A</span> <span class="nv">B</span> : <span class="kt">Type</span>) (<span class="nv">P</span> : A → <span class="kt">Prop</span>) (<span class="nv">Pdec</span> : <span class="kr">∀</span> <span class="nv">a</span> : A,
                                        Decision (P a)) 
  (<span class="nv">f</span> : dsig P → B) (<span class="nv">s</span> : Stream A) (<span class="nv">ss</span> : Stream nat) 
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss) (<span class="nv">m0</span> <span class="nv">m</span> : nat),
  S m = m0
  → (<span class="kr">λ</span> <span class="nv">n</span> : nat,
       stream_prefix
         (fitering_subsequence_stream_filter_map P f s
            ss Hfs) (S m) =
       list_filter_map P f (stream_prefix s n))
      (S (Str_nth m ss))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk96" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk96"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m0, m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq_m</var><span class="hyp-type"><b>: </b><span>S m = m0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">λ</span> <span class="nv">n</span> : nat,
   stream_prefix
     (fitering_subsequence_stream_filter_map P f s ss
        Hfs) (S m) =
   list_filter_map P f (stream_prefix s n))
  (S (Str_nth m ss))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk97" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk97"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">λ</span> <span class="nv">n</span> : nat,
   stream_prefix
     (fitering_subsequence_stream_filter_map P f s ss
        Hfs) (S m) =
   list_filter_map P f (stream_prefix s n))
  (S (Str_nth m ss))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk98" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk98"><span class="nb">specialize</span> (fitering_subsequence_stream_filter_map_prefix P f _ _ Hfs (S (Str_nth m ss))) <span class="kr">as</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span><span class="kr">let</span> <span class="nv">pre_filter_map</span> :=
  list_filter_map P f
    (stream_prefix s (S (Str_nth m ss))) <span class="kr">in</span>
<span class="kr">let</span> <span class="nv">m</span> := length pre_filter_map <span class="kr">in</span>
stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs) m = pre_filter_map</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">λ</span> <span class="nv">n</span> : nat,
   stream_prefix
     (fitering_subsequence_stream_filter_map P f s ss
        Hfs) (S m) =
   list_filter_map P f (stream_prefix s n))
  (S (Str_nth m ss))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk99" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk99"><span class="nb">remember</span> (S m) <span class="kr">as</span> Sm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span><span class="kr">let</span> <span class="nv">pre_filter_map</span> :=
  list_filter_map P f
    (stream_prefix s (S (Str_nth m ss))) <span class="kr">in</span>
<span class="kr">let</span> <span class="nv">m</span> := length pre_filter_map <span class="kr">in</span>
stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs) m = pre_filter_map</span></span></span><br><span><var>Sm</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>HeqSm</var><span class="hyp-type"><b>: </b><span>Sm = S m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">λ</span> <span class="nv">n</span> : nat,
   stream_prefix
     (fitering_subsequence_stream_filter_map P f s ss
        Hfs) Sm =
   list_filter_map P f (stream_prefix s n))
  (S (Str_nth m ss))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk9a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk9a"><span class="nb">simpl</span> <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>)) =
list_filter_map P f
  <span class="kr">match</span> s <span class="kr">with</span>
  | Cons a l =&gt;
      a :: stream_prefix l (Str_nth m ss)
  <span class="kr">end</span></span></span></span><br><span><var>Sm</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>HeqSm</var><span class="hyp-type"><b>: </b><span>Sm = S m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  Sm =
list_filter_map P f
  <span class="kr">match</span> s <span class="kr">with</span>
  | Cons a l =&gt; a :: stream_prefix l (Str_nth m ss)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk9b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk9b"><span class="nb">rewrite</span> &lt;- Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>)) =
list_filter_map P f
  <span class="kr">match</span> s <span class="kr">with</span>
  | Cons a l =&gt;
      a :: stream_prefix l (Str_nth m ss)
  <span class="kr">end</span></span></span></span><br><span><var>Sm</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>HeqSm</var><span class="hyp-type"><b>: </b><span>Sm = S m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  Sm =
stream_prefix
  (fitering_subsequence_stream_filter_map P f s ss Hfs)
  (length
     (list_filter_map P f
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk9c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk9c"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>)) =
list_filter_map P f
  <span class="kr">match</span> s <span class="kr">with</span>
  | Cons a l =&gt;
      a :: stream_prefix l (Str_nth m ss)
  <span class="kr">end</span></span></span></span><br><span><var>Sm</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>HeqSm</var><span class="hyp-type"><b>: </b><span>Sm = S m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Sm =
length
  (list_filter_map P f
     <span class="kr">match</span> s <span class="kr">with</span>
     | Cons a l =&gt; a :: stream_prefix l (Str_nth m ss)
     <span class="kr">end</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk9d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk9d"><span class="nb">unfold</span> list_filter_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>)) =
list_filter_map P f
  <span class="kr">match</span> s <span class="kr">with</span>
  | Cons a l =&gt;
      a :: stream_prefix l (Str_nth m ss)
  <span class="kr">end</span></span></span></span><br><span><var>Sm</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>HeqSm</var><span class="hyp-type"><b>: </b><span>Sm = S m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Sm =
length
  (List.map f
     (filter_annotate P
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk9e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk9e"><span class="nb">rewrite</span> map_length.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>)) =
list_filter_map P f
  <span class="kr">match</span> s <span class="kr">with</span>
  | Cons a l =&gt;
      a :: stream_prefix l (Str_nth m ss)
  <span class="kr">end</span></span></span></span><br><span><var>Sm</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>HeqSm</var><span class="hyp-type"><b>: </b><span>Sm = S m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Sm =
length
  (filter_annotate P
     <span class="kr">match</span> s <span class="kr">with</span>
     | Cons a l =&gt; a :: stream_prefix l (Str_nth m ss)
     <span class="kr">end</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk9f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk9f"><span class="nb">rewrite</span> filter_annotate_length.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>)) =
list_filter_map P f
  <span class="kr">match</span> s <span class="kr">with</span>
  | Cons a l =&gt;
      a :: stream_prefix l (Str_nth m ss)
  <span class="kr">end</span></span></span></span><br><span><var>Sm</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>HeqSm</var><span class="hyp-type"><b>: </b><span>Sm = S m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Sm =
length
  (filter P
     <span class="kr">match</span> s <span class="kr">with</span>
     | Cons a l =&gt; a :: stream_prefix l (Str_nth m ss)
     <span class="kr">end</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka0" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka0"><span class="nb">symmetry</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>)) =
list_filter_map P f
  <span class="kr">match</span> s <span class="kr">with</span>
  | Cons a l =&gt;
      a :: stream_prefix l (Str_nth m ss)
  <span class="kr">end</span></span></span></span><br><span><var>Sm</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>HeqSm</var><span class="hyp-type"><b>: </b><span>Sm = S m</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter P
     <span class="kr">match</span> s <span class="kr">with</span>
     | Cons a l =&gt; a :: stream_prefix l (Str_nth m ss)
     <span class="kr">end</span>) = Sm</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka1" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka1"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>)) =
list_filter_map P f
  <span class="kr">match</span> s <span class="kr">with</span>
  | Cons a l =&gt;
      a :: stream_prefix l (Str_nth m ss)
  <span class="kr">end</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length
  (filter P
     <span class="kr">match</span> s <span class="kr">with</span>
     | Cons a l =&gt; a :: stream_prefix l (Str_nth m ss)
     <span class="kr">end</span>) = S m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka2" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka2"><span class="nb">apply</span> filtering_subsequence_prefix_length.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>dsig P → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P f s
     ss Hfs)
  (length
     (list_filter_map P f
        <span class="kr">match</span> s <span class="kr">with</span>
        | Cons a l =&gt;
            a :: stream_prefix l (Str_nth m ss)
        <span class="kr">end</span>)) =
list_filter_map P f
  <span class="kr">match</span> s <span class="kr">with</span>
  | Cons a l =&gt;
      a :: stream_prefix l (Str_nth m ss)
  <span class="kr">end</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">filtering_subsequence P s ss</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka3" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka3"><span class="kn">Lemma</span> <span class="nf">stream_filter_Forall</span>
  {<span class="nv">A</span> : <span class="kt">Type</span>}
  (<span class="nv">P</span> : A -&gt; <span class="kt">Prop</span>)
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">ss</span> : Stream nat)
  (<span class="nv">s&#39;</span> := stream_subsequence s ss)
  (<span class="nv">Hfs</span> : filtering_subsequence P s ss)
  : ForAll1 P s&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>stream_subsequence s ss</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll1 P s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka4" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka4"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>stream_subsequence s ss</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll1 P s&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka5" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka5"><span class="nb">apply</span> ForAll1_forall.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>stream_subsequence s ss</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">n</span> : nat, P (Str_nth n s&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka6" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka6"><span class="nb">intro</span> n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>stream_subsequence s ss</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth n s&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka7" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka7"><span class="nb">unfold</span> s&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>stream_subsequence s ss</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth n (stream_subsequence s ss))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka8" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka8"><span class="nb">unfold</span> stream_subsequence.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>stream_subsequence s ss</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth n (map (<span class="kr">λ</span> <span class="nv">k</span> : nat, Str_nth k s) ss))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chka9" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chka9"><span class="nb">rewrite</span> Str_nth_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>stream_subsequence s ss</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth (Str_nth n ss) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkaa" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkaa"><span class="nb">apply</span> filtering_subsequence_witness.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>s'</var><span><span class="hyp-body"><b>:= </b><span>stream_subsequence s ss</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hfs</var><span class="hyp-type"><b>: </b><span>filtering_subsequence P s ss</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">filtering_subsequence (<span class="kr">λ</span> <span class="nv">a</span> : A, P a) s ss</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab1"></a><h2 class="section">Obtaining <span class="inlinecode"><span class="id" title="var">filtering_sequences</span></span> for streams</h2>
<div class="paragraph"> </div>

Given a stream, a decidable predicate on its elements, and a guarantee that the
predicates holds <span class="inlinecode"><span class="id" title="var">InfinitelyOften</span></span> on the elements of the stream, we can
(coinductively) obtain a <span class="inlinecode"><span class="id" title="var">filtering_sequence</span></span>.

<div class="paragraph"> </div>

The approach below follows closely the one proposed by the following paper,
except that instead of obtaining the filtered sequence itself we obtain the
stream of all positions corresponding to the filtered sequence.

<div class="paragraph"> </div>

Yves Bertot. Filters on Co-Inductive streams: an application to Eratosthenes’ sieve. RR-5343, INRIA.
2004, pp.21. ffinria-00070658 https://hal.inria.fr/inria-00070658/document

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">stream_filter_positions</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  [A : <span class="kt">Type</span>]
  (P : A -&gt; <span class="kt">Prop</span>)
  {Pdec : <span class="kr">forall</span> <span class="nv">a</span>, Decision (P a)}
  .</span></span></pre><div class="doc">
Given a stream <code>s</code> and a proof that there exists an element of <code>s</code> for
which <code>P</code> holds, computes the first position of <code>s</code> in which <code>P</code> holds
(shifted by the given argument <code>n</code>) and the remainder of <code>s</code> after that
position.

<div class="paragraph"> </div>

The definition iterates looking for the first position in which <code>P</code> holds,
termination being ensured by the fact that <span class="inlinecode"><span class="id" title="var">Exists1</span></span> is inductive.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkab" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkab"><span class="kn">Fixpoint</span> <span class="nf">stream_filter_fst_pos</span>
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">Hev</span> : Exists1 P s)
  (<span class="nv">n</span> : nat)
  {<span class="nv">struct</span> <span class="nv">Hev</span>}
  : nat * Stream A.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>stream_filter_fst_pos</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">s</span> : Stream A,
  Exists1 P s
  → nat → nat * Stream A</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(nat * Stream A)%type</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkac" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkac"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>stream_filter_fst_pos</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">s</span> : Stream A,
  Exists1 P s
  → nat → nat * Stream A</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(nat * Stream A)%type</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkad" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkad"><span class="nb">refine</span>
    (<span class="kr">match</span> decide (P (hd s)) <span class="kr">with</span>
      | <span class="nb">left</span> p =&gt; (n, tl s)
      | <span class="nb">right</span> _ =&gt;
        stream_filter_fst_pos (tl s) _ (S n)
     <span class="kr">end</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>stream_filter_fst_pos</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">s</span> : Stream A,
  Exists1 P s
  → nat → nat * Stream A</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Exists1 P (tl s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> Hev; [<span class="bp">contradiction</span>|<span class="bp">assumption</span>].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Defined</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkae" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkae"><span class="kn">Lemma</span> <span class="nf">stream_filter_fst_pos_characterization</span>
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">Hev</span> : Exists1 P s)
  (<span class="nv">n</span> : nat)
  : <span class="kr">exists</span> <span class="nv">k</span>,
    stream_filter_fst_pos s Hev n = (n + k, Str_nth_tl (S k) s) /\
    P (Str_nth k s) /\ (<span class="kr">forall</span> <span class="nv">i</span>, i &lt; k -&gt; ~ P (Str_nth i s)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  stream_filter_fst_pos s Hev n =
  (n + k, Str_nth_tl (S k) s)
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkaf" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkaf"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  stream_filter_fst_pos s Hev n =
  (n + k, Str_nth_tl (S k) s)
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkb0" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkb0"><span class="nb">revert</span> s Hev n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkb1" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkb1"><span class="kr">fix</span> H <span class="mi">2</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkb2" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkb2"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  stream_filter_fst_pos s Hev n =
  (n + k, Str_nth_tl (S k) s)
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkb3" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkb3"><span class="nb">destruct</span> Hev; <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  <span class="kr">match</span> decide (P (hd s)) <span class="kr">with</span>
  | <span class="nb">left</span> _ =&gt; (n, tl s)
  | <span class="nb">right</span> n0 =&gt;
      stream_filter_fst_pos (tl s)
        (False_ind (Exists1 P (tl s)) (n0 p)) (S n)
  <span class="kr">end</span> = (n + k, Str_nth_tl k (tl s))
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chkb4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chkb4"><hr></label><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  (<span class="kr">if</span> decide (P (hd s))
   <span class="kr">then</span> (n, tl s)
   <span class="kr">else</span> stream_filter_fst_pos (tl s) Hev (S n)) =
  (n + k, Str_nth_tl k (tl s))
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkb5" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkb5">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  <span class="kr">match</span> decide (P (hd s)) <span class="kr">with</span>
  | <span class="nb">left</span> _ =&gt; (n, tl s)
  | <span class="nb">right</span> n0 =&gt;
      stream_filter_fst_pos (tl s)
        (False_ind (Exists1 P (tl s)) (n0 p)) (S n)
  <span class="kr">end</span> = (n + k, Str_nth_tl k (tl s))
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkb6" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkb6"><span class="nb">destruct</span> (decide _); [|<span class="bp">contradiction</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  (n, tl s) = (n + k, Str_nth_tl k (tl s))
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkb7" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkb7"><span class="kr">exists</span> <span class="mi">0</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(n, tl s) = (n + <span class="mi">0</span>, Str_nth_tl <span class="mi">0</span> (tl s))
∧ P (Str_nth <span class="mi">0</span> s)
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; <span class="mi">0</span> → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkb8" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkb8"><span class="kp">repeat</span> <span class="nb">split</span>; [|<span class="bp">assumption</span>|<span class="bp">lia</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(n, tl s) = (n + <span class="mi">0</span>, Str_nth_tl <span class="mi">0</span> (tl s))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkb9" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkb9"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n = n + <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkba" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkba">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  (<span class="kr">if</span> decide (P (hd s))
   <span class="kr">then</span> (n, tl s)
   <span class="kr">else</span> stream_filter_fst_pos (tl s) Hev (S n)) =
  (n + k, Str_nth_tl k (tl s))
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkbb" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkbb"><span class="nb">destruct</span> (decide _); <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  (n, tl s) = (n + k, Str_nth_tl k (tl s))
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chkbc" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chkbc"><hr></label><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  stream_filter_fst_pos (tl s) Hev (S n) =
  (n + k, Str_nth_tl k (tl s))
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkbd" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkbd"><span class="mi">1</span>: {</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  (n, tl s) = (n + k, Str_nth_tl k (tl s))
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkbe" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkbe"><span class="kr">exists</span> <span class="mi">0</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(n, tl s) = (n + <span class="mi">0</span>, Str_nth_tl <span class="mi">0</span> (tl s))
∧ P (Str_nth <span class="mi">0</span> s)
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; <span class="mi">0</span> → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkbf" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkbf"><span class="kp">repeat</span> <span class="nb">split</span>; [|<span class="bp">assumption</span>|<span class="bp">lia</span>].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(n, tl s) = (n + <span class="mi">0</span>, Str_nth_tl <span class="mi">0</span> (tl s))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc0" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc0"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n = n + <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc1" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc1">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hev</span> : Exists1 P s) (<span class="nv">n</span> : nat),
  <span class="kr">∃</span> <span class="nv">k</span> : nat,
    stream_filter_fst_pos s Hev n =
    (n + k, Str_nth_tl (S k) s)
    ∧ P (Str_nth k s)
      ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  stream_filter_fst_pos (tl s) Hev (S n) =
  (n + k, Str_nth_tl k (tl s))
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc2" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc2"><span class="nb">specialize</span> (H (tl s) Hev (S n))
      <span class="kr">as</span> [k [Heq [Hp Hnp]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (tl s) Hev (S n) =
(S n + k, Str_nth_tl (S k) (tl s))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (tl s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">k</span> : nat,
  stream_filter_fst_pos (tl s) Hev (S n) =
  (n + k, Str_nth_tl k (tl s))
  ∧ P (Str_nth k s)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc3" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc3"><span class="kr">exists</span> (<span class="nv">S</span> <span class="nv">k</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (tl s) Hev (S n) =
(S n + k, Str_nth_tl (S k) (tl s))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (tl s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_filter_fst_pos (tl s) Hev (S n) =
(n + S k, Str_nth_tl (S k) (tl s))
∧ P (Str_nth (S k) s)
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; S k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc4" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc4"><span class="nb">rewrite</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (tl s) Hev (S n) =
(S n + k, Str_nth_tl (S k) (tl s))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (tl s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(S n + k, Str_nth_tl (S k) (tl s)) =
(n + S k, Str_nth_tl (S k) (tl s))
∧ P (Str_nth (S k) s)
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; S k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc5" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc5"><span class="nb">split</span>; [<span class="nb">f_equal</span>; <span class="bp">lia</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (tl s) Hev (S n) =
(S n + k, Str_nth_tl (S k) (tl s))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (tl s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth (S k) s)
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; S k → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc6" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc6"><span class="nb">split</span>; [<span class="bp">assumption</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (tl s) Hev (S n) =
(S n + k, Str_nth_tl (S k) (tl s))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (tl s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; S k → ¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc7" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc7"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (tl s) Hev (S n) =
(S n + k, Str_nth_tl (S k) (tl s))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (tl s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (tl s))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>i &lt; S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc8" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc8"><span class="nb">destruct</span> i; [<span class="bp">assumption</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (tl s) Hev (S n) =
(S n + k, Str_nth_tl (S k) (tl s))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (tl s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (tl s))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>S i &lt; S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (Str_nth (S i) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkc9" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkc9"><span class="nb">apply</span> Hnp.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists (<span class="kr">λ</span> <span class="nv">s</span> : Stream A, P (hd s)) (tl s)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>¬ P (hd s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (tl s) Hev (S n) =
(S n + k, Str_nth_tl (S k) (tl s))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (tl s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (tl s))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>S i &lt; S k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i &lt; k</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkca" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkca"><span class="kn">Lemma</span> <span class="nf">stream_filter_fst_pos_infinitely_often</span>
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">Hev</span> : Exists1 P s)
  (<span class="nv">n</span> : nat)
  : InfinitelyOften P s -&gt; InfinitelyOften P (stream_filter_fst_pos s Hev n).<span class="mi">2</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">InfinitelyOften P s
→ InfinitelyOften P (stream_filter_fst_pos s Hev n).<span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkcb" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkcb"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">InfinitelyOften P s
→ InfinitelyOften P (stream_filter_fst_pos s Hev n).<span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkcc" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkcc"><span class="nb">destruct</span> (stream_filter_fst_pos_characterization s Hev n) <span class="kr">as</span> [k [Heq _]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s Hev n =
(n + k, Str_nth_tl (S k) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">InfinitelyOften P s
→ InfinitelyOften P (stream_filter_fst_pos s Hev n).<span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkcd" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkcd"><span class="nb">rewrite</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s Hev n =
(n + k, Str_nth_tl (S k) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">InfinitelyOften P s
→ InfinitelyOften P (n + k, Str_nth_tl (S k) s).<span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> InfinitelyOften_nth_tl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkce" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkce"><span class="kn">Lemma</span> <span class="nf">stream_filter_fst_pos_le</span>
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">Hev</span> : Exists1 P s)
  (<span class="nv">n</span> : nat)
  : n &lt;= (stream_filter_fst_pos s Hev n).<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n ≤ (stream_filter_fst_pos s Hev n).<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkcf" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkcf"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n ≤ (stream_filter_fst_pos s Hev n).<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd0" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd0"><span class="nb">destruct</span> (stream_filter_fst_pos_characterization s Hev n) <span class="kr">as</span> [k [Heq _]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s Hev n =
(n + k, Str_nth_tl (S k) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n ≤ (stream_filter_fst_pos s Hev n).<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd1" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd1"><span class="nb">rewrite</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s Hev n =
(n + k, Str_nth_tl (S k) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n ≤ (n + k, Str_nth_tl (S k) s).<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd2" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd2"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P s</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s Hev n =
(n + k, Str_nth_tl (S k) s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n ≤ n + k</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd3" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd3"><span class="kn">Lemma</span> <span class="nf">stream_filter_fst_pos_nth_tl_has_property</span>
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">n</span> : nat)
  (<span class="nv">sn</span> := Str_nth_tl n s)
  (<span class="nv">Hev</span> : Exists1 P sn)
  (<span class="nv">fpair</span> := stream_filter_fst_pos (Str_nth_tl n s) Hev n)
  : P (Str_nth fpair.<span class="mi">1</span> s) /\
    <span class="kr">forall</span> <span class="nv">i</span>, n &lt;= i &lt; fpair.<span class="mi">1</span> -&gt; ~ P (Str_nth i s).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>sn</var><span><span class="hyp-body"><b>:= </b><span>Str_nth_tl n s</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P sn</span></span></span><br><span><var>fpair</var><span><span class="hyp-body"><b>:= </b><span>stream_filter_fst_pos (Str_nth_tl n s) Hev n</span></span><span class="hyp-type"><b>: </b><span>(nat * Stream A)%type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth fpair.<span class="mi">1</span> s)
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, n &lt;= i &lt; fpair.<span class="mi">1</span> → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd4" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd4"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>sn</var><span><span class="hyp-body"><b>:= </b><span>Str_nth_tl n s</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P sn</span></span></span><br><span><var>fpair</var><span><span class="hyp-body"><b>:= </b><span>stream_filter_fst_pos (Str_nth_tl n s) Hev n</span></span><span class="hyp-type"><b>: </b><span>(nat * Stream A)%type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth fpair.<span class="mi">1</span> s)
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, n &lt;= i &lt; fpair.<span class="mi">1</span> → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd5" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd5"><span class="nb">specialize</span> (stream_filter_fst_pos_characterization sn Hev n)
    <span class="kr">as</span> [k [Heq [Hp Hnp]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>sn</var><span><span class="hyp-body"><b>:= </b><span>Str_nth_tl n s</span></span><span class="hyp-type"><b>: </b><span>Stream A</span></span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P sn</span></span></span><br><span><var>fpair</var><span><span class="hyp-body"><b>:= </b><span>stream_filter_fst_pos (Str_nth_tl n s) Hev n</span></span><span class="hyp-type"><b>: </b><span>(nat * Stream A)%type</span></span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos sn Hev n =
(n + k, Str_nth_tl (S k) sn)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k sn)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i sn)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth fpair.<span class="mi">1</span> s)
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, n &lt;= i &lt; fpair.<span class="mi">1</span> → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd6" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd6"><span class="nb">subst</span> sn fpair.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P (Str_nth_tl n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl n s) Hev n =
(n + k, Str_nth_tl (S k) (Str_nth_tl n s))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl n s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P
  (Str_nth
     (stream_filter_fst_pos (Str_nth_tl n s) Hev n).<span class="mi">1</span>
     s)
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
     n &lt;= i &lt;
     (stream_filter_fst_pos (Str_nth_tl n s) Hev n).<span class="mi">1</span>
     → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd7" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd7"><span class="nb">rewrite</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hev</var><span class="hyp-type"><b>: </b><span>Exists1 P (Str_nth_tl n s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl n s) Hev n =
(n + k, Str_nth_tl (S k) (Str_nth_tl n s))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl n s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P
  (Str_nth
     (n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span> s)
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
     n &lt;= i &lt;
     (n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span>
     → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd8" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd8"><span class="nb">clear</span> -Hp Hnp.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl n s))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P
  (Str_nth
     (n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span> s)
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
     n &lt;= i &lt;
     (n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span>
     → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkd9" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkd9"><span class="nb">rewrite</span> Str_nth_plus, Plus.plus_comm <span class="kr">in</span> Hp.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (n + k) s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P
  (Str_nth
     (n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span> s)
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
     n &lt;= i &lt;
     (n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span>
     → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkda" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkda"><span class="nb">split</span>; [<span class="bp">assumption</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (n + k) s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">i</span> : nat,
  n &lt;= i &lt;
  (n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span>
  → ¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkdb" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkdb"><span class="nb">intros</span> i [Hlt_i Hilt].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (n + k) s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt_i</var><span class="hyp-type"><b>: </b><span>n ≤ i</span></span></span><br><span><var>Hilt</var><span class="hyp-type"><b>: </b><span>i &lt;
(n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkdc" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkdc"><span class="nb">apply</span> le_plus_dec <span class="kr">in</span> Hlt_i <span class="kr">as</span> [i&#39; Hi].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (n + k) s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br><span><var>i, i'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hi</var><span class="hyp-type"><b>: </b><span>i&#39; + n = i</span></span></span><br><span><var>Hilt</var><span class="hyp-type"><b>: </b><span>i &lt;
(n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkdd" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkdd"><span class="nb">subst</span> i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (n + k) s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br><span><var>i'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hilt</var><span class="hyp-type"><b>: </b><span>i&#39; + n &lt;
(n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (Str_nth (i&#39; + n) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkde" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkde"><span class="nb">rewrite</span> &lt;- Str_nth_plus.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (n + k) s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br><span><var>i'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hilt</var><span class="hyp-type"><b>: </b><span>i&#39; + n &lt;
(n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (Str_nth i&#39; (Str_nth_tl n s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkdf" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkdf"><span class="nb">apply</span> Hnp.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (n + k) s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br><span><var>i'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hilt</var><span class="hyp-type"><b>: </b><span>i&#39; + n &lt;
(n + k, Str_nth_tl (S k) (Str_nth_tl n s)).<span class="mi">1</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i&#39; &lt; k</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chke0" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chke0"><span class="nb">simpl</span> <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>n, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (n + k) s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i (Str_nth_tl n s))</span></span></span><br><span><var>i'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hilt</var><span class="hyp-type"><b>: </b><span>i&#39; + n &lt; n + k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i&#39; &lt; k</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
Given as stream <code>s</code> for which predicate <code>P</code> holds <span class="inlinecode"><span class="id" title="var">InfinitelyOften</span></span>
produces the streams of all its position at which <code>P</code> holds in a stricly
increasing order (shifted by the given argument <code>n</code>).

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">CoFixpoint</span> <span class="nf">stream_filter_positions</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften P s) (<span class="nv">n</span> : nat) : Stream nat :=
  <span class="kr">let</span> <span class="nv">fpair</span> := stream_filter_fst_pos _ (fHere _ _ Hinf) n <span class="kr">in</span>
  Cons fpair.<span class="mi">1</span> (stream_filter_positions fpair.<span class="mi">2</span> (stream_filter_fst_pos_infinitely_often _ (fHere _ _ Hinf) n Hinf)  (S fpair.<span class="mi">1</span>)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chke1" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chke1"><span class="kn">Lemma</span> <span class="nf">stream_filter_positions_unroll</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften P s) (<span class="nv">n</span> : nat)
  (<span class="nv">fpair</span> := stream_filter_fst_pos _ (fHere _ _ Hinf) n)
  : stream_filter_positions s Hinf n =
    Cons fpair.<span class="mi">1</span> (stream_filter_positions fpair.<span class="mi">2</span> (stream_filter_fst_pos_infinitely_often _ (fHere _ _ Hinf) n Hinf)  (S fpair.<span class="mi">1</span>)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>fpair</var><span><span class="hyp-body"><b>:= </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n</span></span><span class="hyp-type"><b>: </b><span>(nat * Stream A)%type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_filter_positions s Hinf n =
Cons fpair.<span class="mi">1</span>
  (stream_filter_positions fpair.<span class="mi">2</span>
     (stream_filter_fst_pos_infinitely_often s
        (fHere (Exists1 P) s Hinf) n Hinf) (S fpair.<span class="mi">1</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chke2" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chke2"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>fpair</var><span><span class="hyp-body"><b>:= </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n</span></span><span class="hyp-type"><b>: </b><span>(nat * Stream A)%type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_filter_positions s Hinf n =
Cons fpair.<span class="mi">1</span>
  (stream_filter_positions fpair.<span class="mi">2</span>
     (stream_filter_fst_pos_infinitely_often s
        (fHere (Exists1 P) s Hinf) n Hinf) (S fpair.<span class="mi">1</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chke3" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chke3"><span class="nb">rewrite</span> &lt;- recons <span class="nb">at</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>fpair</var><span><span class="hyp-body"><b>:= </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n</span></span><span class="hyp-type"><b>: </b><span>(nat * Stream A)%type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Cons (hd (stream_filter_positions s Hinf n))
  (tl (stream_filter_positions s Hinf n)) =
Cons fpair.<span class="mi">1</span>
  (stream_filter_positions fpair.<span class="mi">2</span>
     (stream_filter_fst_pos_infinitely_often s
        (fHere (Exists1 P) s Hinf) n Hinf) (S fpair.<span class="mi">1</span>))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chke4" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chke4"><span class="kn">Lemma</span> <span class="nf">stream_filter_positions_Str_nth_tl</span>
  (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften P s) (<span class="nv">n0</span> : nat) (<span class="nv">n</span> : nat)
  : <span class="kr">exists</span> <span class="nv">kn</span> (<span class="nv">Hinf&#39;</span> : InfinitelyOften P (Str_nth_tl (S kn) s)),
    Str_nth_tl n (stream_filter_positions s Hinf n0) = Cons (n0 + kn) (stream_filter_positions (Str_nth_tl (S kn) s) Hinf&#39; (S (n0 + kn)))
    /\ P (Str_nth kn s).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  Str_nth_tl n (stream_filter_positions s Hinf n0) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl (S kn) s)
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chke5" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chke5"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  Str_nth_tl n (stream_filter_positions s Hinf n0) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl (S kn) s)
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chke6" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chke6"><span class="nb">induction</span> n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  Str_nth_tl <span class="mi">0</span> (stream_filter_positions s Hinf n0) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl (S kn) s)
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chke7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  Str_nth_tl n
    (stream_filter_positions s Hinf n0) =
  Cons (n0 + kn)
    (stream_filter_positions
       (Str_nth_tl (S kn) s) Hinf&#39; 
       (S (n0 + kn))) ∧ P (Str_nth kn s)</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chke7"><hr></label><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  Str_nth_tl (S n) (stream_filter_positions s Hinf n0) =
  Cons (n0 + kn)
    (stream_filter_positions 
       (Str_nth_tl (S kn) s) Hinf&#39; 
       (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chke8" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chke8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  Str_nth_tl <span class="mi">0</span> (stream_filter_positions s Hinf n0) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl (S kn) s)
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chke9" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chke9"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl kn (tl s))),
  stream_filter_positions s Hinf n0 =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl kn (tl s))
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkea" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkea"><span class="nb">rewrite</span> (stream_filter_positions_unroll s Hinf n0).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl kn (tl s))),
  Cons
    (stream_filter_fst_pos s
       (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S
          (stream_filter_fst_pos s
             (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>)) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl kn (tl s))
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkeb" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkeb"><span class="nb">specialize</span>
      (stream_filter_fst_pos_characterization s (fHere _ s Hinf) n0)
        <span class="kr">as</span> [k [Heq [Hp _]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl kn (tl s))),
  Cons
    (stream_filter_fst_pos s
       (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S
          (stream_filter_fst_pos s
             (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>)) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl kn (tl s))
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkec" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkec"><span class="nb">assert</span> (Hk : (stream_filter_fst_pos s (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = n0 + k).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos s (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> =
n0 + k</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chked" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chked"><hr></label><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl kn (tl s))),
  Cons
    (stream_filter_fst_pos s
       (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S
          (stream_filter_fst_pos s
             (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>)) =
  Cons (n0 + kn)
    (stream_filter_positions 
       (Str_nth_tl kn (tl s)) Hinf&#39; 
       (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkee" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkee">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos s (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> =
n0 + k</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkef" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkef"><span class="nb">rewrite</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(n0 + k, Str_nth_tl (S k) s).<span class="mi">1</span> = n0 + k</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkf0" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkf0">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl kn (tl s))),
  Cons
    (stream_filter_fst_pos s
       (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S
          (stream_filter_fst_pos s
             (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>)) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl kn (tl s))
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkf1" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkf1"><span class="nb">assert</span> (Htl : (stream_filter_fst_pos s (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> = Str_nth_tl (S k) s).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos s (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> =
Str_nth_tl (S k) s</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chkf2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> =
Str_nth_tl (S k) s</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chkf2"><hr></label><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl kn (tl s))),
  Cons
    (stream_filter_fst_pos s
       (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S
          (stream_filter_fst_pos s
             (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>)) =
  Cons (n0 + kn)
    (stream_filter_positions 
       (Str_nth_tl kn (tl s)) Hinf&#39; 
       (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkf3" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkf3">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos s (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> =
Str_nth_tl (S k) s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkf4" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkf4"><span class="nb">rewrite</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(n0 + k, Str_nth_tl (S k) s).<span class="mi">2</span> = Str_nth_tl (S k) s</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkf5" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkf5">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> =
Str_nth_tl (S k) s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl kn (tl s))),
  Cons
    (stream_filter_fst_pos s
       (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S
          (stream_filter_fst_pos s
             (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>)) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl kn (tl s))
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkf6" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkf6"><span class="kr">exists</span> <span class="nv">k</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> =
Str_nth_tl (S k) s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P (Str_nth_tl k (tl s)),
  Cons
    (stream_filter_fst_pos s
       (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S
          (stream_filter_fst_pos s
             (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span>)) =
  Cons (n0 + k)
    (stream_filter_positions (Str_nth_tl k (tl s))
       Hinf&#39; (S (n0 + k))) ∧ P (Str_nth k s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkf7" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkf7"><span class="nb">rewrite</span> Hk.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> =
Str_nth_tl (S k) s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P (Str_nth_tl k (tl s)),
  Cons (n0 + k)
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S (n0 + k))) =
  Cons (n0 + k)
    (stream_filter_positions (Str_nth_tl k (tl s))
       Hinf&#39; (S (n0 + k))) ∧ P (Str_nth k s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkf8" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkf8"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> =
Str_nth_tl (S k) s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P (Str_nth_tl k (tl s)),
  Cons (n0 + k)
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S (n0 + k))) =
  Cons (n0 + k)
    (stream_filter_positions (Str_nth_tl k (tl s))
       Hinf&#39; (S (n0 + k))) ∧ P (Str_nth k s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkf9" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkf9"><span class="nb">simpl</span> <span class="kr">in</span> Htl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> =
Str_nth_tl k (tl s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P (Str_nth_tl k (tl s)),
  Cons (n0 + k)
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S (n0 + k))) =
  Cons (n0 + k)
    (stream_filter_positions (Str_nth_tl k (tl s))
       Hinf&#39; (S (n0 + k))) ∧ P (Str_nth k s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkfa" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkfa"><span class="nb">rewrite</span> &lt;- Htl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) n0 =
(n0 + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">1</span> = 
n0 + k</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos s
   (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> =
Str_nth_tl k (tl s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P
            (stream_filter_fst_pos s
               (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>,
  Cons (n0 + k)
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often s
          (fHere (Exists1 P) s Hinf) n0 Hinf)
       (S (n0 + k))) =
  Cons (n0 + k)
    (stream_filter_positions
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) n0).<span class="mi">2</span> Hinf&#39;
       (S (n0 + k))) ∧ P (Str_nth k s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eexists</span>; <span class="nb">split</span>; [<span class="bp">reflexivity</span>|<span class="bp">assumption</span>].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkfb" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkfb">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  Str_nth_tl n
    (stream_filter_positions s Hinf n0) =
  Cons (n0 + kn)
    (stream_filter_positions
       (Str_nth_tl (S kn) s) Hinf&#39; 
       (S (n0 + kn))) ∧ P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  Str_nth_tl (S n) (stream_filter_positions s Hinf n0) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl (S kn) s)
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkfc" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkfc"><span class="nb">replace</span>
      (Str_nth_tl (S n) (stream_filter_positions s Hinf n0))
      <span class="kr">with</span> (tl (Str_nth_tl n (stream_filter_positions s Hinf n0)))
      <span class="bp">by</span> <span class="nb">apply</span> tl_nth_tl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  Str_nth_tl n
    (stream_filter_positions s Hinf n0) =
  Cons (n0 + kn)
    (stream_filter_positions
       (Str_nth_tl (S kn) s) Hinf&#39; 
       (S (n0 + kn))) ∧ P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  tl
    (Str_nth_tl n (stream_filter_positions s Hinf n0)) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl (S kn) s)
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkfd" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkfd"><span class="nb">destruct</span> IHn <span class="kr">as</span> [kn [Hinfn [Hsn Hpn]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  tl
    (Str_nth_tl n (stream_filter_positions s Hinf n0)) =
  Cons (n0 + kn)
    (stream_filter_positions (Str_nth_tl (S kn) s)
       Hinf&#39; (S (n0 + kn))) ∧ P (Str_nth kn s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkfe" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkfe"><span class="nb">rewrite</span> Hsn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn0</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                         (Str_nth_tl (S kn0) s)),
  tl
    (Cons (n0 + kn)
       (stream_filter_positions (Str_nth_tl (S kn) s)
          Hinfn (S (n0 + kn)))) =
  Cons (n0 + kn0)
    (stream_filter_positions (Str_nth_tl (S kn0) s)
       Hinf&#39; (S (n0 + kn0))) ∧ P (Str_nth kn0 s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chkff" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chkff"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn0</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                         (Str_nth_tl kn0 (tl s))),
  stream_filter_positions (Str_nth_tl kn (tl s)) Hinfn
    (S (n0 + kn)) =
  Cons (n0 + kn0)
    (stream_filter_positions (Str_nth_tl kn0 (tl s))
       Hinf&#39; (S (n0 + kn0))) ∧ P (Str_nth kn0 s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk100" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk100"><span class="nb">rewrite</span> (stream_filter_positions_unroll (Str_nth_tl kn (tl s)) Hinfn (S (n0 + kn))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn0</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                         (Str_nth_tl kn0 (tl s))),
  Cons
    (stream_filter_fst_pos (Str_nth_tl kn (tl s))
       (fHere (Exists1 P) (Str_nth_tl kn (tl s)) Hinfn)
       (S (n0 + kn))).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S
          (stream_filter_fst_pos
             (Str_nth_tl kn (tl s))
             (fHere (Exists1 P) (Str_nth_tl kn (tl s))
                Hinfn) (S (n0 + kn))).<span class="mi">1</span>)) =
  Cons (n0 + kn0)
    (stream_filter_positions (Str_nth_tl kn0 (tl s))
       Hinf&#39; (S (n0 + kn0))) ∧ P (Str_nth kn0 s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk101" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk101"><span class="nb">specialize</span>
      (stream_filter_fst_pos_characterization (Str_nth_tl kn (tl s)) (fHere _ _ Hinfn) (S (n0 + kn)))
        <span class="kr">as</span> [k [Heq [Hp _]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn0</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                         (Str_nth_tl kn0 (tl s))),
  Cons
    (stream_filter_fst_pos (Str_nth_tl kn (tl s))
       (fHere (Exists1 P) (Str_nth_tl kn (tl s)) Hinfn)
       (S (n0 + kn))).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S
          (stream_filter_fst_pos
             (Str_nth_tl kn (tl s))
             (fHere (Exists1 P) (Str_nth_tl kn (tl s))
                Hinfn) (S (n0 + kn))).<span class="mi">1</span>)) =
  Cons (n0 + kn0)
    (stream_filter_positions (Str_nth_tl kn0 (tl s))
       Hinf&#39; (S (n0 + kn0))) ∧ P (Str_nth kn0 s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk102" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk102"><span class="kr">match</span> <span class="kp">type of</span> Heq <span class="kr">with</span>
    | <span class="nl">?pair</span> = (<span class="nl">?f</span>, <span class="nl">?s</span>) =&gt;
      <span class="nb">assert</span> (Hk : pair.<span class="mi">1</span> = f) <span class="bp">by</span> (<span class="nb">rewrite</span> Heq; <span class="bp">reflexivity</span>);
      <span class="nb">assert</span> (Htl : pair.<span class="mi">2</span> = s) <span class="bp">by</span> (<span class="nb">rewrite</span> Heq; <span class="bp">reflexivity</span>)
    <span class="kr">end</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
   (S (n0 + kn))).<span class="mi">1</span> = S (n0 + kn) + k</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl (S kn) s)
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl (S k) (Str_nth_tl kn (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn0</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                         (Str_nth_tl kn0 (tl s))),
  Cons
    (stream_filter_fst_pos (Str_nth_tl kn (tl s))
       (fHere (Exists1 P) (Str_nth_tl kn (tl s)) Hinfn)
       (S (n0 + kn))).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S
          (stream_filter_fst_pos
             (Str_nth_tl kn (tl s))
             (fHere (Exists1 P) (Str_nth_tl kn (tl s))
                Hinfn) (S (n0 + kn))).<span class="mi">1</span>)) =
  Cons (n0 + kn0)
    (stream_filter_positions (Str_nth_tl kn0 (tl s))
       Hinf&#39; (S (n0 + kn0))) ∧ P (Str_nth kn0 s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk103" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk103"><span class="nb">simpl</span> <span class="kr">in</span> Hk.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">1</span> = 
S (n0 + kn + k)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl (S kn) s)
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl (S k) (Str_nth_tl kn (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn0</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                         (Str_nth_tl kn0 (tl s))),
  Cons
    (stream_filter_fst_pos (Str_nth_tl kn (tl s))
       (fHere (Exists1 P) (Str_nth_tl kn (tl s)) Hinfn)
       (S (n0 + kn))).<span class="mi">1</span>
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S
          (stream_filter_fst_pos
             (Str_nth_tl kn (tl s))
             (fHere (Exists1 P) (Str_nth_tl kn (tl s))
                Hinfn) (S (n0 + kn))).<span class="mi">1</span>)) =
  Cons (n0 + kn0)
    (stream_filter_positions (Str_nth_tl kn0 (tl s))
       Hinf&#39; (S (n0 + kn0))) ∧ P (Str_nth kn0 s)</div></blockquote></div></div></small><span class="alectryon-wsp">  </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk104" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk104"><span class="nb">rewrite</span> Hk.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">1</span> = 
S (n0 + kn + k)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl (S kn) s)
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl (S k) (Str_nth_tl kn (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn0</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                         (Str_nth_tl kn0 (tl s))),
  Cons (S (n0 + kn + k))
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S (S (n0 + kn + k)))) =
  Cons (n0 + kn0)
    (stream_filter_positions (Str_nth_tl kn0 (tl s))
       Hinf&#39; (S (n0 + kn0))) ∧ P (Str_nth kn0 s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk105" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk105"><span class="nb">simpl</span> <span class="kr">in</span> Htl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">1</span> = 
S (n0 + kn + k)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl k (tl (Str_nth_tl kn (tl s)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> (<span class="nv">kn0</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                         (Str_nth_tl kn0 (tl s))),
  Cons (S (n0 + kn + k))
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S (S (n0 + kn + k)))) =
  Cons (n0 + kn0)
    (stream_filter_positions (Str_nth_tl kn0 (tl s))
       Hinf&#39; (S (n0 + kn0))) ∧ P (Str_nth kn0 s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk106" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk106"><span class="kr">exists</span> (<span class="nv">S</span> (k + kn)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">1</span> = 
S (n0 + kn + k)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl k (tl (Str_nth_tl kn (tl s)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P
            (Str_nth_tl (S (k + kn)) (tl s)),
  Cons (S (n0 + kn + k))
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S (S (n0 + kn + k)))) =
  Cons (n0 + S (k + kn))
    (stream_filter_positions
       (Str_nth_tl (S (k + kn)) (tl s)) Hinf&#39;
       (S (n0 + S (k + kn))))
  ∧ P (Str_nth (S (k + kn)) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk107" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk107"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">1</span> = 
S (n0 + kn + k)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl k (tl (Str_nth_tl kn (tl s)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P
            (Str_nth_tl (k + kn) (tl (tl s))),
  Cons (S (n0 + kn + k))
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S (S (n0 + kn + k)))) =
  Cons (n0 + S (k + kn))
    (stream_filter_positions
       (Str_nth_tl (k + kn) (tl (tl s))) Hinf&#39;
       (S (n0 + S (k + kn))))
  ∧ P (Str_nth (S (k + kn)) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk108" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk108"><span class="nb">rewrite</span> tl_nth_tl, Str_nth_tl_plus <span class="kr">in</span> Htl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">1</span> = 
S (n0 + kn + k)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl (k + kn) (tl (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P
            (Str_nth_tl (k + kn) (tl (tl s))),
  Cons (S (n0 + kn + k))
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S (S (n0 + kn + k)))) =
  Cons (n0 + S (k + kn))
    (stream_filter_positions
       (Str_nth_tl (k + kn) (tl (tl s))) Hinf&#39;
       (S (n0 + S (k + kn))))
  ∧ P (Str_nth (S (k + kn)) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk109" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk109"><span class="nb">rewrite</span> Str_nth_plus <span class="kr">in</span> Hp.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (k + kn) (tl s))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">1</span> = 
S (n0 + kn + k)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl (k + kn) (tl (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P
            (Str_nth_tl (k + kn) (tl (tl s))),
  Cons (S (n0 + kn + k))
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S (S (n0 + kn + k)))) =
  Cons (n0 + S (k + kn))
    (stream_filter_positions
       (Str_nth_tl (k + kn) (tl (tl s))) Hinf&#39;
       (S (n0 + S (k + kn))))
  ∧ P (Str_nth (S (k + kn)) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk10a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk10a"><span class="nb">rewrite</span> &lt;- Htl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (k + kn) (tl s))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">1</span> = 
S (n0 + kn + k)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl (k + kn) (tl (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P
            (stream_filter_fst_pos
               (Str_nth_tl kn (tl s))
               (fHere (Exists1 P)
                  (Str_nth_tl kn (tl s)) Hinfn)
               (S (n0 + kn))).<span class="mi">2</span>,
  Cons (S (n0 + kn + k))
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S (S (n0 + kn + k)))) =
  Cons (n0 + S (k + kn))
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span> Hinf&#39;
       (S (n0 + S (k + kn))))
  ∧ P (Str_nth (S (k + kn)) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk10b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk10b"><span class="nb">replace</span> (n0 + S (k + kn)) <span class="kr">with</span> (S (n0 + kn + k)) <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (k + kn) (tl s))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">1</span> = 
S (n0 + kn + k)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl (k + kn) (tl (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∃</span> <span class="nv">Hinf&#39;</span> : InfinitelyOften P
            (stream_filter_fst_pos
               (Str_nth_tl kn (tl s))
               (fHere (Exists1 P)
                  (Str_nth_tl kn (tl s)) Hinfn)
               (S (n0 + kn))).<span class="mi">2</span>,
  Cons (S (n0 + kn + k))
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span>
       (stream_filter_fst_pos_infinitely_often
          (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn)) Hinfn)
       (S (S (n0 + kn + k)))) =
  Cons (S (n0 + kn + k))
    (stream_filter_positions
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hinfn) (S (n0 + kn))).<span class="mi">2</span> Hinf&#39;
       (S (S (n0 + kn + k))))
  ∧ P (Str_nth (S (k + kn)) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk10c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk10c"><span class="nb">eexists</span>; <span class="nb">split</span>; [<span class="bp">reflexivity</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n0, n, kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hinfn</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl (S kn) s)</span></span></span><br><span><var>Hsn</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n (stream_filter_positions s Hinf n0) =
Cons (n0 + kn)
  (stream_filter_positions 
     (Str_nth_tl (S kn) s) Hinfn 
     (S (n0 + kn)))</span></span></span><br><span><var>Hpn</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl (S kn) s) Hinfn)
  (S (n0 + kn)) =
(S (n0 + kn) + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hp</var><span class="hyp-type"><b>: </b><span>P (Str_nth (k + kn) (tl s))</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">1</span> = 
S (n0 + kn + k)</span></span></span><br><span><var>Htl</var><span class="hyp-type"><b>: </b><span>(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s))
      Hinfn) (S (n0 + kn))).<span class="mi">2</span> =
Str_nth_tl (k + kn) (tl (tl s))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth (S (k + kn)) s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk10d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk10d"><span class="kn">Lemma</span> <span class="nf">stream_filter_positions_monotone</span>
  (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften P s) (<span class="nv">n</span> : nat)
  : monotone_nat_stream_prop (stream_filter_positions s Hinf n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">monotone_nat_stream_prop
  (stream_filter_positions s Hinf n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk10e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk10e"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">monotone_nat_stream_prop
  (stream_filter_positions s Hinf n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk10f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk10f"><span class="nb">apply</span> monotone_nat_stream_prop_from_successor.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2 lt (stream_filter_positions s Hinf n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk110" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk110"><span class="nb">revert</span> s Hinf n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften P s) (<span class="nv">n</span> : nat),
  ForAll2 lt (stream_filter_positions s Hinf n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk111" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk111"><span class="kr">cofix</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften P s) 
  (<span class="nv">n</span> : nat),
  ForAll2 lt (stream_filter_positions s Hinf n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften P s) (<span class="nv">n</span> : nat),
  ForAll2 lt (stream_filter_positions s Hinf n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk112" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk112"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften P s) 
  (<span class="nv">n</span> : nat),
  ForAll2 lt (stream_filter_positions s Hinf n)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2 lt (stream_filter_positions s Hinf n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk113" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk113"><span class="nb">constructor</span>; <span class="nb">simpl</span>; [|<span class="nb">apply</span> H].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften P s) 
  (<span class="nv">n</span> : nat),
  ForAll2 lt (stream_filter_positions s Hinf n)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos s (fHere (Exists1 P) s Hinf) n).<span class="mi">1</span> &lt;
(stream_filter_fst_pos
   (stream_filter_fst_pos s (fHere (Exists1 P) s Hinf)
      n).<span class="mi">2</span>
   (fHere (Exists1 P)
      (stream_filter_fst_pos s
         (fHere (Exists1 P) s Hinf) n).<span class="mi">2</span>
      (stream_filter_fst_pos_infinitely_often s
         (fHere (Exists1 P) s Hinf) n Hinf))
   (S
      (stream_filter_fst_pos s
         (fHere (Exists1 P) s Hinf) n).<span class="mi">1</span>)).<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> stream_filter_fst_pos_le.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<span class="inlinecode"><span class="id" title="var">stream_filter_positions</span></span> produces a <span class="inlinecode"><span class="id" title="var">filtering_sequence</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk114" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk114"><span class="kn">Lemma</span> <span class="nf">stream_filter_positions_fitering_subsequence</span>
  (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften P s)
  : filtering_subsequence P s (stream_filter_positions s Hinf <span class="mi">0</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">filtering_subsequence P s
  (stream_filter_positions s Hinf <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk115" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk115"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">filtering_subsequence P s
  (stream_filter_positions s Hinf <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk116" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk116"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; hd (stream_filter_positions s Hinf <span class="mi">0</span>)
  → ¬ P (Str_nth i s)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chk117" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chk117"><hr></label><div class="goal-conclusion">ForAll2
  (<span class="kr">λ</span> <span class="nv">m</span> <span class="nv">n</span> : nat,
     P (Str_nth m s)
     ∧ m &lt; n
       ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, m &lt; i &lt; n → ¬ P (Str_nth i s)))
  (stream_filter_positions s Hinf <span class="mi">0</span>)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk118" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk118">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; hd (stream_filter_positions s Hinf <span class="mi">0</span>)
  → ¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk119" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk119"><span class="nb">specialize</span> (stream_filter_fst_pos_characterization s (fHere (Exists1 P) s Hinf) <span class="mi">0</span>)
      <span class="kr">as</span> [k [Heq [Hpk Hnp]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) <span class="mi">0</span> =
(<span class="mi">0</span> + k, Str_nth_tl (S k) s)</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; hd (stream_filter_positions s Hinf <span class="mi">0</span>)
  → ¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk11a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk11a"><span class="nb">simpl</span> <span class="kr">in</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) <span class="mi">0</span> =
(k, Str_nth_tl k (tl s))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; hd (stream_filter_positions s Hinf <span class="mi">0</span>)
  → ¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk11b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk11b"><span class="nb">rewrite</span> stream_filter_positions_unroll.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) <span class="mi">0</span> =
(k, Str_nth_tl k (tl s))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt;
  hd
    (Cons
       (stream_filter_fst_pos s
          (fHere (Exists1 P) s Hinf) <span class="mi">0</span>).<span class="mi">1</span>
       (stream_filter_positions
          (stream_filter_fst_pos s
             (fHere (Exists1 P) s Hinf) <span class="mi">0</span>).<span class="mi">2</span>
          (stream_filter_fst_pos_infinitely_often s
             (fHere (Exists1 P) s Hinf) <span class="mi">0</span> Hinf)
          (S
             (stream_filter_fst_pos s
                (fHere (Exists1 P) s Hinf) <span class="mi">0</span>).<span class="mi">1</span>)))
  → ¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk11c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk11c"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) <span class="mi">0</span> =
(k, Str_nth_tl k (tl s))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt;
  (stream_filter_fst_pos s (fHere (Exists1 P) s Hinf)
     <span class="mi">0</span>).<span class="mi">1</span> → ¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk11d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk11d"><span class="nb">rewrite</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos s
  (fHere (Exists1 P) s Hinf) <span class="mi">0</span> =
(k, Str_nth_tl k (tl s))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k s)</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat, i &lt; k → ¬ P (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; (k, Str_nth_tl k (tl s)).<span class="mi">1</span> → ¬ P (Str_nth i s)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk11e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk11e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ForAll2
  (<span class="kr">λ</span> <span class="nv">m</span> <span class="nv">n</span> : nat,
     P (Str_nth m s)
     ∧ m &lt; n
       ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat, m &lt; i &lt; n → ¬ P (Str_nth i s)))
  (stream_filter_positions s Hinf <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk11f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk11f"><span class="nb">apply</span> ForAll2_forall.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">n</span> : nat,
  P
    (Str_nth
       (Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>))
       s)
  ∧ Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>) &lt;
    Str_nth (S n) (stream_filter_positions s Hinf <span class="mi">0</span>)
    ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
         Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>) &lt;
         i &lt;
         Str_nth (S n)
           (stream_filter_positions s Hinf <span class="mi">0</span>)
         → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk120" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk120"><span class="nb">intro</span> n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P
  (Str_nth
     (Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>)) s)
∧ Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>) &lt;
  Str_nth (S n) (stream_filter_positions s Hinf <span class="mi">0</span>)
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>) &lt;
       i &lt;
       Str_nth (S n)
         (stream_filter_positions s Hinf <span class="mi">0</span>)
       → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk121" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk121"><span class="nb">specialize</span> (stream_filter_positions_Str_nth_tl s Hinf <span class="mi">0</span> n) <span class="kr">as</span> Hnth_tl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_tl</var><span class="hyp-type"><b>: </b><span><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl (S kn) s)),
  Str_nth_tl n
    (stream_filter_positions s Hinf <span class="mi">0</span>) =
  Cons (<span class="mi">0</span> + kn)
    (stream_filter_positions
       (Str_nth_tl (S kn) s) Hinf&#39;
       (S (<span class="mi">0</span> + kn))) ∧ P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P
  (Str_nth
     (Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>)) s)
∧ Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>) &lt;
  Str_nth (S n) (stream_filter_positions s Hinf <span class="mi">0</span>)
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>) &lt;
       i &lt;
       Str_nth (S n)
         (stream_filter_positions s Hinf <span class="mi">0</span>)
       → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk122" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk122"><span class="nb">simpl</span> <span class="kr">in</span> Hnth_tl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_tl</var><span class="hyp-type"><b>: </b><span><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl kn
                        (tl s))),
  Str_nth_tl n
    (stream_filter_positions s Hinf <span class="mi">0</span>) =
  Cons kn
    (stream_filter_positions
       (Str_nth_tl kn (tl s)) Hinf&#39; 
       (S kn)) ∧ P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P
  (Str_nth
     (Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>)) s)
∧ Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>) &lt;
  Str_nth (S n) (stream_filter_positions s Hinf <span class="mi">0</span>)
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       Str_nth n (stream_filter_positions s Hinf <span class="mi">0</span>) &lt;
       i &lt;
       Str_nth (S n)
         (stream_filter_positions s Hinf <span class="mi">0</span>)
       → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk123" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk123"><span class="nb">remember</span> (stream_filter_positions s Hinf <span class="mi">0</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>Hnth_tl</var><span class="hyp-type"><b>: </b><span><span class="kr">∃</span> (<span class="nv">kn</span> : nat) (<span class="nv">Hinf&#39;</span> : InfinitelyOften P
                        (Str_nth_tl kn
                        (tl s))),
  Str_nth_tl n s0 =
  Cons kn
    (stream_filter_positions
       (Str_nth_tl kn (tl s)) Hinf&#39; 
       (S kn)) ∧ P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth (Str_nth n s0) s)
∧ Str_nth n s0 &lt; Str_nth (S n) s0
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       Str_nth n s0 &lt; i &lt; Str_nth (S n) s0
       → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk124" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk124"><span class="nb">destruct</span> Hnth_tl <span class="kr">as</span> [kn [Hnth_inf [Hnth Hnth_p]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (stream_filter_positions
     (Str_nth_tl kn (tl s)) Hnth_inf 
     (S kn))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (Str_nth (Str_nth n s0) s)
∧ Str_nth n s0 &lt; Str_nth (S n) s0
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       Str_nth n s0 &lt; i &lt; Str_nth (S n) s0
       → ¬ P (Str_nth i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk125" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk125"><span class="nb">unfold</span> Str_nth.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (stream_filter_positions
     (Str_nth_tl kn (tl s)) Hnth_inf 
     (S kn))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (hd (Str_nth_tl (hd (Str_nth_tl n s0)) s))
∧ hd (Str_nth_tl n s0) &lt; hd (Str_nth_tl (S n) s0)
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       hd (Str_nth_tl n s0) &lt; i &lt;
       hd (Str_nth_tl (S n) s0)
       → ¬ P (hd (Str_nth_tl i s)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk126" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk126"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (stream_filter_positions
     (Str_nth_tl kn (tl s)) Hnth_inf 
     (S kn))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (hd (Str_nth_tl (hd (Str_nth_tl n s0)) s))
∧ hd (Str_nth_tl n s0) &lt; hd (Str_nth_tl n (tl s0))
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       hd (Str_nth_tl n s0) &lt; i &lt;
       hd (Str_nth_tl n (tl s0))
       → ¬ P (hd (Str_nth_tl i s)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk127" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk127"><span class="nb">rewrite</span> &lt;- tl_nth_tl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (stream_filter_positions
     (Str_nth_tl kn (tl s)) Hnth_inf 
     (S kn))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (hd (Str_nth_tl (hd (Str_nth_tl n s0)) s))
∧ hd (Str_nth_tl n s0) &lt; hd (tl (Str_nth_tl n s0))
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       hd (Str_nth_tl n s0) &lt; i &lt;
       hd (tl (Str_nth_tl n s0))
       → ¬ P (hd (Str_nth_tl i s)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk128" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk128"><span class="nb">rewrite</span> stream_filter_positions_unroll <span class="kr">in</span> Hnth.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (hd (Str_nth_tl (hd (Str_nth_tl n s0)) s))
∧ hd (Str_nth_tl n s0) &lt; hd (tl (Str_nth_tl n s0))
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       hd (Str_nth_tl n s0) &lt; i &lt;
       hd (tl (Str_nth_tl n s0))
       → ¬ P (hd (Str_nth_tl i s)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk129" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk129"><span class="nb">specialize</span> (stream_filter_fst_pos_characterization (Str_nth_tl kn (tl s)) (fHere _ _ Hnth_inf) (S kn))
      <span class="kr">as</span> [k [Heq [Hpk Hnp]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (hd (Str_nth_tl (hd (Str_nth_tl n s0)) s))
∧ hd (Str_nth_tl n s0) &lt; hd (tl (Str_nth_tl n s0))
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       hd (Str_nth_tl n s0) &lt; i &lt;
       hd (tl (Str_nth_tl n s0))
       → ¬ P (hd (Str_nth_tl i s)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk12a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk12a"><span class="nb">rewrite</span> Hnth; <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (hd (Str_nth_tl kn s))
∧ kn &lt;
  (stream_filter_fst_pos (Str_nth_tl kn (tl s))
     (fHere (Exists1 P) (Str_nth_tl kn (tl s))
        Hnth_inf) (S kn)).<span class="mi">1</span>
  ∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
       kn &lt; i &lt;
       (stream_filter_fst_pos (Str_nth_tl kn (tl s))
          (fHere (Exists1 P) (Str_nth_tl kn (tl s))
             Hnth_inf) (S kn)).<span class="mi">1</span>
       → ¬ P (hd (Str_nth_tl i s)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk12b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk12b"><span class="nb">split</span>; [<span class="bp">assumption</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">kn &lt;
(stream_filter_fst_pos (Str_nth_tl kn (tl s))
   (fHere (Exists1 P) (Str_nth_tl kn (tl s)) Hnth_inf)
   (S kn)).<span class="mi">1</span>
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
     kn &lt; i &lt;
     (stream_filter_fst_pos (Str_nth_tl kn (tl s))
        (fHere (Exists1 P) (Str_nth_tl kn (tl s))
           Hnth_inf) (S kn)).<span class="mi">1</span>
     → ¬ P (hd (Str_nth_tl i s)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk12c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk12c"><span class="nb">rewrite</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">kn &lt;
(S kn + k, Str_nth_tl (S k) (Str_nth_tl kn (tl s))).<span class="mi">1</span>
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
     kn &lt; i &lt;
     (S kn + k,
     Str_nth_tl (S k) (Str_nth_tl kn (tl s))).<span class="mi">1</span>
     → ¬ P (hd (Str_nth_tl i s)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk12d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk12d"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">kn &lt; S (kn + k)
∧ (<span class="kr">∀</span> <span class="nv">i</span> : nat,
     kn &lt; i &lt; S (kn + k) → ¬ P (hd (Str_nth_tl i s)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk12e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk12e"><span class="nb">split</span>; [<span class="bp">lia</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">i</span> : nat,
  kn &lt; i &lt; S (kn + k) → ¬ P (hd (Str_nth_tl i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk12f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk12f"><span class="nb">intros</span> i [Hle Hlt].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>kn &lt; i</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>i &lt; S (kn + k)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (hd (Str_nth_tl i s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk130" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk130"><span class="nb">apply</span> le_plus_dec <span class="kr">in</span> Hle <span class="kr">as</span> [k&#39; Hle].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>i, k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hle</var><span class="hyp-type"><b>: </b><span>k&#39; + S kn = i</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>i &lt; S (kn + k)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (hd (Str_nth_tl i s))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk131" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk131"><span class="nb">subst</span> i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>k&#39; + S kn &lt; S (kn + k)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (hd (Str_nth_tl (k&#39; + S kn) s))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk132" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk132"><span class="nb">rewrite</span> &lt;- Str_nth_tl_plus.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>k&#39; + S kn &lt; S (kn + k)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (hd (Str_nth_tl k&#39; (Str_nth_tl (S kn) s)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk133" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk133"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>k&#39; + S kn &lt; S (kn + k)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">¬ P (hd (Str_nth_tl k&#39; (Str_nth_tl kn (tl s))))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk134" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk134"><span class="nb">apply</span> Hnp.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span><br><span><var>Pdec</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">a</span> : A, Decision (P a)</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>Stream nat</span></span></span><br><span><var>Heqs0</var><span class="hyp-type"><b>: </b><span>s0 = stream_filter_positions s Hinf <span class="mi">0</span></span></span></span><br><span><var>kn</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hnth_inf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P (Str_nth_tl kn (tl s))</span></span></span><br><span><var>Hnth</var><span class="hyp-type"><b>: </b><span>Str_nth_tl n s0 =
Cons kn
  (Cons
     (stream_filter_fst_pos
        (Str_nth_tl kn (tl s))
        (fHere (Exists1 P)
           (Str_nth_tl kn (tl s)) Hnth_inf)
        (S kn)).<span class="mi">1</span>
     (stream_filter_positions
        (stream_filter_fst_pos
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn)).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (Str_nth_tl kn (tl s))
           (fHere (Exists1 P)
              (Str_nth_tl kn (tl s)) Hnth_inf)
           (S kn) Hnth_inf)
        (S
           (stream_filter_fst_pos
              (Str_nth_tl kn (tl s))
              (fHere (Exists1 P)
                 (Str_nth_tl kn (tl s))
                 Hnth_inf) 
              (S kn)).<span class="mi">1</span>)))</span></span></span><br><span><var>Hnth_p</var><span class="hyp-type"><b>: </b><span>P (Str_nth kn s)</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (Str_nth_tl kn (tl s))
  (fHere (Exists1 P) (Str_nth_tl kn (tl s))
     Hnth_inf) (S kn) =
(S kn + k,
Str_nth_tl (S k) (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hpk</var><span class="hyp-type"><b>: </b><span>P (Str_nth k (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>Hnp</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; k → ¬ P (Str_nth i (Str_nth_tl kn (tl s)))</span></span></span><br><span><var>k'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hlt</var><span class="hyp-type"><b>: </b><span>k&#39; + S kn &lt; S (kn + k)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k&#39; &lt; k</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
A restatement of <span class="inlinecode"><span class="id" title="var">filtering_subsequence_stream_filter_map</span></span> based on the
<span class="inlinecode"><span class="id" title="var">InfinitelyOften</span></span> predicate, using the <span class="inlinecode"><span class="id" title="var">stream_filter_positions_fitering_subsequence</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">stream_filter_map</span>
  [B : <span class="kt">Type</span>]
  (f : dsig P -&gt; B)
  (s : Stream A)
  (Hinf : InfinitelyOften P s)
  : Stream B :=
  fitering_subsequence_stream_filter_map P f _ _ (stream_filter_positions_fitering_subsequence s Hinf).</span></span></pre><div class="doc">
Stream filtering is obtained as a specialization of <span class="inlinecode"><span class="id" title="var">stream_filter_map</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">stream_filter</span>
  (<span class="nv">s</span> : Stream A)
  (<span class="nv">Hinf</span> : InfinitelyOften P s)
  : Stream A :=
  stream_filter_map proj1_sig s Hinf.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">stream_filter_positions</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">stream_map_option</span>.</span></span></pre><div class="doc">
<a id="lab2"></a><h2 class="section">Mapping a partial function on a stream</h2>
<div class="paragraph"> </div>

Given a partial function <code>f</code> which is <span class="inlinecode"><span class="id" title="var">InfinitelyOften</span></span> defined on the
elements of a stream <code>s</code>, we can define the stream of the defined mapped
values of <code>s</code> through <code>f</code> as a particular <span class="inlinecode"><span class="id" title="var">stream_filter_map</span></span>.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
  [A B : <span class="kt">Type</span>]
  (f : A -&gt; option B)
  (P : A -&gt; <span class="kt">Prop</span> := is_Some ∘ f)
  (s : Stream A)
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">stream_map_option</span>
  (<span class="nv">Hinf</span> : InfinitelyOften P s)
  : Stream B :=
  stream_filter_map P (<span class="kr">fun</span> <span class="nv">k</span> : dsig P =&gt; is_Some_proj (proj2_dsig k)) s Hinf.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk135" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk135"><span class="kn">Lemma</span> <span class="nf">stream_map_option_prefix</span>
  (<span class="nv">Hinf</span> : InfinitelyOften P s)
  (<span class="nv">n</span> : nat)
  (<span class="nv">map_opt_pre</span> := map_option f (stream_prefix s n))
  (<span class="nv">m</span> := length map_opt_pre)
  : stream_prefix (stream_map_option Hinf) m = map_opt_pre.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → option B</span></span></span><br><span><var>P</var><span><span class="hyp-body"><b>:= </b><span>is_Some ∘ f</span></span><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>map_opt_pre</var><span><span class="hyp-body"><b>:= </b><span>map_option f (stream_prefix s n)</span></span><span class="hyp-type"><b>: </b><span>list B</span></span></span></span><br><span><var>m</var><span><span class="hyp-body"><b>:= </b><span>length map_opt_pre</span></span><span class="hyp-type"><b>: </b><span>nat</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix (stream_map_option Hinf) m = map_opt_pre</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk136" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk136"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → option B</span></span></span><br><span><var>P</var><span><span class="hyp-body"><b>:= </b><span>is_Some ∘ f</span></span><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>map_opt_pre</var><span><span class="hyp-body"><b>:= </b><span>map_option f (stream_prefix s n)</span></span><span class="hyp-type"><b>: </b><span>list B</span></span></span></span><br><span><var>m</var><span><span class="hyp-body"><b>:= </b><span>length map_opt_pre</span></span><span class="hyp-type"><b>: </b><span>nat</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix (stream_map_option Hinf) m = map_opt_pre</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk137" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk137"><span class="nb">subst</span> map_opt_pre m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → option B</span></span></span><br><span><var>P</var><span><span class="hyp-body"><b>:= </b><span>is_Some ∘ f</span></span><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix (stream_map_option Hinf)
  (length (map_option f (stream_prefix s n))) =
map_option f (stream_prefix s n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk138" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk138"><span class="nb">rewrite</span> !(map_option_as_filter f (stream_prefix s n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → option B</span></span></span><br><span><var>P</var><span><span class="hyp-body"><b>:= </b><span>is_Some ∘ f</span></span><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix (stream_map_option Hinf)
  (length
     (list_filter_map (is_Some ∘ f)
        (<span class="kr">λ</span> <span class="nv">x</span> : dsig (is_Some ∘ f),
           is_Some_proj (proj2_dsig x))
        (stream_prefix s n))) =
list_filter_map (is_Some ∘ f)
  (<span class="kr">λ</span> <span class="nv">x</span> : dsig (is_Some ∘ f),
     is_Some_proj (proj2_dsig x)) (stream_prefix s n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> fitering_subsequence_stream_filter_map_prefix.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Program Definition</span> <span class="nf">stream_map_option_prefix_ex</span>
  (<span class="nv">Hinf</span> : InfinitelyOften P s)
  (<span class="nv">Hfs</span> := stream_filter_positions_fitering_subsequence _ _ Hinf)
  (<span class="nv">k</span> : nat)
  : { n | stream_prefix (stream_map_option Hinf) k = map_option f (stream_prefix s n)} :=
  <span class="kr">let</span> (<span class="nv">n</span>, Heq) := (fitering_subsequence_stream_filter_map_prefix_ex P (<span class="kr">fun</span> <span class="nv">k</span> =&gt; is_Some_proj (proj2_dsig k)) _ _ Hfs k) <span class="kr">in</span>
  exist _ n _.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk139" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk139"><span class="kn">Next Obligation</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → option B</span></span></span><br><span><var>P</var><span><span class="hyp-body"><b>:= </b><span>is_Some ∘ f</span></span><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">Hinf</span> : InfinitelyOften P s) (<span class="nv">Hfs</span> :
                                filtering_subsequence
                                  P s
                                  (stream_filter_positions
                                     P s Hinf <span class="mi">0</span>) :=
                                stream_filter_positions_fitering_subsequence
                                  P s Hinf) (<span class="nv">k</span>
                                             <span class="nv">n</span> : nat),
  stream_prefix
    (fitering_subsequence_stream_filter_map P
       (<span class="kr">λ</span> <span class="nv">k0</span> : dsig P, is_Some_proj (proj2_dsig k0)) s
       (stream_filter_positions P s Hinf <span class="mi">0</span>) Hfs) k =
  list_filter_map P
    (<span class="kr">λ</span> <span class="nv">k0</span> : dsig P, is_Some_proj (proj2_dsig k0))
    (stream_prefix s n)
  → (<span class="kr">λ</span> <span class="nv">n0</span> : nat,
       stream_prefix (stream_map_option Hinf) k =
       map_option f (stream_prefix s n0)) n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk13a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk13a"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → option B</span></span></span><br><span><var>P</var><span><span class="hyp-body"><b>:= </b><span>is_Some ∘ f</span></span><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>Hfs</var><span><span class="hyp-body"><b>:= </b><span>stream_filter_positions_fitering_subsequence P s
  Hinf</span></span><span class="hyp-type"><b>: </b><span>filtering_subsequence P s
  (stream_filter_positions P s Hinf <span class="mi">0</span>)</span></span></span></span><br><span><var>k, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P
     (<span class="kr">λ</span> <span class="nv">k</span> : dsig P, is_Some_proj (proj2_dsig k))
     s (stream_filter_positions P s Hinf <span class="mi">0</span>) Hfs)
  k =
list_filter_map P
  (<span class="kr">λ</span> <span class="nv">k</span> : dsig P, is_Some_proj (proj2_dsig k))
  (stream_prefix s n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">λ</span> <span class="nv">n</span> : nat,
   stream_prefix (stream_map_option Hinf) k =
   map_option f (stream_prefix s n)) n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk13b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk13b"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → option B</span></span></span><br><span><var>P</var><span><span class="hyp-body"><b>:= </b><span>is_Some ∘ f</span></span><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>Hfs</var><span><span class="hyp-body"><b>:= </b><span>stream_filter_positions_fitering_subsequence P s
  Hinf</span></span><span class="hyp-type"><b>: </b><span>filtering_subsequence P s
  (stream_filter_positions P s Hinf <span class="mi">0</span>)</span></span></span></span><br><span><var>k, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P
     (<span class="kr">λ</span> <span class="nv">k</span> : dsig P, is_Some_proj (proj2_dsig k))
     s (stream_filter_positions P s Hinf <span class="mi">0</span>) Hfs)
  k =
list_filter_map P
  (<span class="kr">λ</span> <span class="nv">k</span> : dsig P, is_Some_proj (proj2_dsig k))
  (stream_prefix s n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix (stream_map_option Hinf) k =
map_option f (stream_prefix s n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk13c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk13c"><span class="nb">rewrite</span> !(map_option_as_filter f (stream_prefix s n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → option B</span></span></span><br><span><var>P</var><span><span class="hyp-body"><b>:= </b><span>is_Some ∘ f</span></span><span class="hyp-type"><b>: </b><span>A → <span class="kt">Prop</span></span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften P s</span></span></span><br><span><var>Hfs</var><span><span class="hyp-body"><b>:= </b><span>stream_filter_positions_fitering_subsequence P s
  Hinf</span></span><span class="hyp-type"><b>: </b><span>filtering_subsequence P s
  (stream_filter_positions P s Hinf <span class="mi">0</span>)</span></span></span></span><br><span><var>k, n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>stream_prefix
  (fitering_subsequence_stream_filter_map P
     (<span class="kr">λ</span> <span class="nv">k</span> : dsig P, is_Some_proj (proj2_dsig k))
     s (stream_filter_positions P s Hinf <span class="mi">0</span>) Hfs)
  k =
list_filter_map P
  (<span class="kr">λ</span> <span class="nv">k</span> : dsig P, is_Some_proj (proj2_dsig k))
  (stream_prefix s n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix (stream_map_option Hinf) k =
list_filter_map (is_Some ∘ f)
  (<span class="kr">λ</span> <span class="nv">x</span> : dsig (is_Some ∘ f),
     is_Some_proj (proj2_dsig x)) (stream_prefix s n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">bounded_stream_map_option</span>
  (<span class="nv">Hfin</span> : FinitelyManyBound P s)
  : list B :=
  map_option f (stream_prefix s (` Hfin)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">stream_map_option</span>.</span></span></pre><div class="doc">
For a totally defined function, <span class="inlinecode"><span class="id" title="var">stream_map_option</span></span> correspondes to the
regular <span class="inlinecode"><span class="id" title="var">map</span></span> on streams.

</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk13d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk13d"><span class="kn">Lemma</span> <span class="nf">stream_map_option_EqSt</span> [A B : <span class="kt">Type</span>] (f : A -&gt; B)
  : <span class="kr">forall</span> <span class="nv">s</span> (<span class="nv">Hinf</span> : InfinitelyOften (is_Some ∘ (Some ∘ f)) s),
  EqSt (map f s) (stream_map_option (Some ∘ f) s Hinf).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften
                           (is_Some ∘ (Some ∘ f)) s),
  EqSt (map f s) (stream_map_option (Some ∘ f) s Hinf)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk13e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk13e"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : InfinitelyOften
                           (is_Some ∘ (Some ∘ f)) s),
  EqSt (map f s) (stream_map_option (Some ∘ f) s Hinf)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk13f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk13f"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">EqSt (map f s) (stream_map_option (Some ∘ f) s Hinf)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk140" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk140"><span class="nb">apply</span> EqSt_stream_prefix.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">n</span> : nat,
  stream_prefix (map f s) n =
  stream_prefix (stream_map_option (Some ∘ f) s Hinf)
    n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk141" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk141"><span class="nb">intro</span> n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix (map f s) n =
stream_prefix (stream_map_option (Some ∘ f) s Hinf) n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk142" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk142"><span class="nb">destruct</span> n; [<span class="bp">reflexivity</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">stream_prefix (map f s) (S n) =
stream_prefix (stream_map_option (Some ∘ f) s Hinf)
  (S n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk143" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk143"><span class="nb">rewrite</span> &lt;- stream_prefix_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.map f (stream_prefix s (S n)) =
stream_prefix (stream_map_option (Some ∘ f) s Hinf)
  (S n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk144" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk144"><span class="nb">pose</span> (stream_map_option_prefix_ex (Some ∘ f) s Hinf (S n)) <span class="kr">as</span> Hrew.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hrew</var><span><span class="hyp-body"><b>:= </b><span>stream_map_option_prefix_ex 
  (Some ∘ f) s Hinf (S n)</span></span><span class="hyp-type"><b>: </b><span>{n0 : nat
| stream_prefix
    (stream_map_option (Some ∘ f) s Hinf) 
    (S n) =
  map_option (Some ∘ f) (stream_prefix s n0)}</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.map f (stream_prefix s (S n)) =
stream_prefix (stream_map_option (Some ∘ f) s Hinf)
  (S n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk145" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk145"><span class="nb">rewrite</span> (proj2_sig Hrew).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hrew</var><span><span class="hyp-body"><b>:= </b><span>stream_map_option_prefix_ex 
  (Some ∘ f) s Hinf (S n)</span></span><span class="hyp-type"><b>: </b><span>{n0 : nat
| stream_prefix
    (stream_map_option (Some ∘ f) s Hinf) 
    (S n) =
  map_option (Some ∘ f) (stream_prefix s n0)}</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">List.map f (stream_prefix s (S n)) =
map_option (Some ∘ f) (stream_prefix s (`Hrew))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk146" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk146"><span class="nb">replace</span> (` Hrew) <span class="kr">with</span> (S n); [<span class="bp">reflexivity</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hrew</var><span><span class="hyp-body"><b>:= </b><span>stream_map_option_prefix_ex 
  (Some ∘ f) s Hinf (S n)</span></span><span class="hyp-type"><b>: </b><span>{n0 : nat
| stream_prefix
    (stream_map_option (Some ∘ f) s Hinf) 
    (S n) =
  map_option (Some ∘ f) (stream_prefix s n0)}</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S n = `Hrew</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk147" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk147"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hrew</var><span><span class="hyp-body"><b>:= </b><span>stream_map_option_prefix_ex 
  (Some ∘ f) s Hinf (S n)</span></span><span class="hyp-type"><b>: </b><span>{n0 : nat
| stream_prefix
    (stream_map_option (Some ∘ f) s Hinf) 
    (S n) =
  map_option (Some ∘ f) (stream_prefix s n0)}</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S n =
S
  (Str_nth n
     (stream_filter_positions 
        (is_Some ∘ (Some ∘ f)) s Hinf <span class="mi">0</span>))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk148" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk148"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hrew</var><span><span class="hyp-body"><b>:= </b><span>stream_map_option_prefix_ex 
  (Some ∘ f) s Hinf (S n)</span></span><span class="hyp-type"><b>: </b><span>{n0 : nat
| stream_prefix
    (stream_map_option (Some ∘ f) s Hinf) 
    (S n) =
  map_option (Some ∘ f) (stream_prefix s n0)}</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n =
Str_nth n
  (stream_filter_positions 
     (is_Some ∘ (Some ∘ f)) s Hinf <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk149" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk149"><span class="nb">clear</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n =
Str_nth n
  (stream_filter_positions 
     (is_Some ∘ (Some ∘ f)) s Hinf <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk14a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk14a"><span class="nb">cut</span>
    (<span class="kr">forall</span> <span class="nv">k</span>, Streams.Str_nth n
      (stream_filter_positions (is_Some ∘ (Some ∘ f)) s Hinf k) = k + n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">∀</span> <span class="nv">k</span> : nat,
   Str_nth n
     (stream_filter_positions 
        (is_Some ∘ (Some ∘ f)) s Hinf k) = 
   k + n)
→ n =
  Str_nth n
    (stream_filter_positions 
       (is_Some ∘ (Some ∘ f)) s Hinf <span class="mi">0</span>)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chk14b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chk14b"><hr></label><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">k</span> : nat,
  Str_nth n
    (stream_filter_positions 
       (is_Some ∘ (Some ∘ f)) s Hinf k) = 
  k + n</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk14c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk14c">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">∀</span> <span class="nv">k</span> : nat,
   Str_nth n
     (stream_filter_positions 
        (is_Some ∘ (Some ∘ f)) s Hinf k) = 
   k + n)
→ n =
  Str_nth n
    (stream_filter_positions 
       (is_Some ∘ (Some ∘ f)) s Hinf <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk14d" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk14d"><span class="nb">intros</span> Hk.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">k</span> : nat,
  Str_nth n
    (stream_filter_positions
       (is_Some ∘ (Some ∘ f)) s Hinf k) = 
  k + n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n =
Str_nth n
  (stream_filter_positions 
     (is_Some ∘ (Some ∘ f)) s Hinf <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk14e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk14e"><span class="nb">specialize</span> (Hk <span class="mi">0</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>Str_nth n
  (stream_filter_positions 
     (is_Some ∘ (Some ∘ f)) s Hinf <span class="mi">0</span>) = 
<span class="mi">0</span> + n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n =
Str_nth n
  (stream_filter_positions 
     (is_Some ∘ (Some ∘ f)) s Hinf <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk14f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk14f"><span class="nb">simpl</span> <span class="kr">in</span> Hk.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hk</var><span class="hyp-type"><b>: </b><span>Str_nth n
  (stream_filter_positions 
     (is_Some ∘ (Some ∘ f)) s Hinf <span class="mi">0</span>) = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n =
Str_nth n
  (stream_filter_positions 
     (is_Some ∘ (Some ∘ f)) s Hinf <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">congruence</span>.</span><span class="alectryon-wsp">  </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk150" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk150">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> <span class="nv">k</span> : nat,
  Str_nth n
    (stream_filter_positions 
       (is_Some ∘ (Some ∘ f)) s Hinf k) = 
  k + n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk151" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk151"><span class="nb">revert</span> s Hinf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  Str_nth n
    (stream_filter_positions 
       (is_Some ∘ (Some ∘ f)) s Hinf k) = 
  k + n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk152" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk152"><span class="nb">assert</span> (Hfirst : <span class="kr">forall</span> <span class="nv">s</span> <span class="nv">Hinf</span> <span class="nv">k</span>,
    (stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s (fHere _ _ Hinf) k).<span class="mi">1</span> = k).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1 (is_Some ∘ (Some ∘ f))) s) 
  (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos 
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf) k).<span class="mi">1</span> =
  k</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chk153" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chk153"><hr></label><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  Str_nth n
    (stream_filter_positions 
       (is_Some ∘ (Some ∘ f)) s Hinf k) = 
  k + n</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk154" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk154">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1 (is_Some ∘ (Some ∘ f))) s) 
  (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos 
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf) k).<span class="mi">1</span> =
  k</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk155" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk155"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>ForAll (Exists1 (is_Some ∘ (Some ∘ f))) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
   (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf) k).<span class="mi">1</span> =
k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk156" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk156"><span class="kr">match goal with</span>
    |- fst (stream_filter_fst_pos <span class="nl">?P</span> s <span class="nl">?Hex</span> k) = k =&gt;
      <span class="nb">specialize</span> (stream_filter_fst_pos_characterization P s Hex k)
        <span class="kr">as</span> [_k [Heq1 [_ H_k]]]
    <span class="kr">end</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>ForAll (Exists1 (is_Some ∘ (Some ∘ f))) s</span></span></span><br><span><var>k, _k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq1</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
  (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
     Hinf) k = (k + _k, Str_nth_tl (S _k) s)</span></span></span><br><span><var>H_k</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; _k
  → ¬ (is_Some ∘ (Some ∘ f)) (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
   (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf) k).<span class="mi">1</span> =
k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk157" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk157"><span class="nb">rewrite</span> Heq1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>ForAll (Exists1 (is_Some ∘ (Some ∘ f))) s</span></span></span><br><span><var>k, _k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq1</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
  (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
     Hinf) k = (k + _k, Str_nth_tl (S _k) s)</span></span></span><br><span><var>H_k</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; _k
  → ¬ (is_Some ∘ (Some ∘ f)) (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(k + _k, Str_nth_tl (S _k) s).<span class="mi">1</span> = k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk158" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk158"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>ForAll (Exists1 (is_Some ∘ (Some ∘ f))) s</span></span></span><br><span><var>k, _k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq1</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
  (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
     Hinf) k = (k + _k, Str_nth_tl (S _k) s)</span></span></span><br><span><var>H_k</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; _k
  → ¬ (is_Some ∘ (Some ∘ f)) (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k + _k = k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk159" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk159"><span class="nb">destruct</span> _k; [<span class="bp">lia</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>ForAll (Exists1 (is_Some ∘ (Some ∘ f))) s</span></span></span><br><span><var>k, _k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq1</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
  (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
     Hinf) k =
(k + S _k, Str_nth_tl (S (S _k)) s)</span></span></span><br><span><var>H_k</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; S _k
  → ¬ (is_Some ∘ (Some ∘ f)) (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k + S _k = k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk15a" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk15a"><span class="nb">exfalso</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>ForAll (Exists1 (is_Some ∘ (Some ∘ f))) s</span></span></span><br><span><var>k, _k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Heq1</var><span class="hyp-type"><b>: </b><span>stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
  (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
     Hinf) k =
(k + S _k, Str_nth_tl (S (S _k)) s)</span></span></span><br><span><var>H_k</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> <span class="nv">i</span> : nat,
  i &lt; S _k
  → ¬ (is_Some ∘ (Some ∘ f)) (Str_nth i s)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> (H_k <span class="mi">0</span>); [<span class="bp">lia</span>| <span class="nb">eexists</span>; <span class="bp">reflexivity</span>].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk15b" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk15b">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  Str_nth n
    (stream_filter_positions 
       (is_Some ∘ (Some ∘ f)) s Hinf k) = 
  k + n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk15c" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk15c"><span class="nb">induction</span> n; <span class="nb">intros</span>; <span class="nb">rewrite</span> stream_filter_positions_unroll; <span class="nb">unfold</span> Streams.Str_nth; <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
   (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf) k).<span class="mi">1</span> =
k + <span class="mi">0</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="StreamFilters-v-chk15d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  Str_nth n
    (stream_filter_positions
       (is_Some ∘ (Some ∘ f)) s Hinf k) = 
  k + n</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><label class="goal-separator" for="StreamFilters-v-chk15d"><hr></label><div class="goal-conclusion">hd
  (Str_nth_tl n
     (stream_filter_positions 
        (is_Some ∘ (Some ∘ f))
        (stream_filter_fst_pos 
           (is_Some ∘ (Some ∘ f)) s
           (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
              Hinf) k).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (is_Some ∘ (Some ∘ f)) s
           (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
              Hinf) k Hinf)
        (S
           (stream_filter_fst_pos
              (is_Some ∘ (Some ∘ f)) s
              (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
                 s Hinf) k).<span class="mi">1</span>))) = 
k + S n</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk15e" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk15e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
   (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf) k).<span class="mi">1</span> =
k + <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk15f" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk15f"><span class="nb">replace</span> (k + <span class="mi">0</span>) <span class="kr">with</span> k <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
   (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf) k).<span class="mi">1</span> =
k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> Hfirst.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk160" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk160">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  Str_nth n
    (stream_filter_positions
       (is_Some ∘ (Some ∘ f)) s Hinf k) = 
  k + n</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hd
  (Str_nth_tl n
     (stream_filter_positions 
        (is_Some ∘ (Some ∘ f))
        (stream_filter_fst_pos 
           (is_Some ∘ (Some ∘ f)) s
           (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
              Hinf) k).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (is_Some ∘ (Some ∘ f)) s
           (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
              Hinf) k Hinf)
        (S
           (stream_filter_fst_pos
              (is_Some ∘ (Some ∘ f)) s
              (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
                 s Hinf) k).<span class="mi">1</span>))) = 
k + S n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk161" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk161"><span class="nb">unfold</span> Streams.Str_nth <span class="kr">in</span> IHn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  hd
    (Str_nth_tl n
       (stream_filter_positions
          (is_Some ∘ (Some ∘ f)) s Hinf k)) =
  k + n</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hd
  (Str_nth_tl n
     (stream_filter_positions 
        (is_Some ∘ (Some ∘ f))
        (stream_filter_fst_pos 
           (is_Some ∘ (Some ∘ f)) s
           (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
              Hinf) k).<span class="mi">2</span>
        (stream_filter_fst_pos_infinitely_often
           (is_Some ∘ (Some ∘ f)) s
           (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s
              Hinf) k Hinf)
        (S
           (stream_filter_fst_pos
              (is_Some ∘ (Some ∘ f)) s
              (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
                 s Hinf) k).<span class="mi">1</span>))) = 
k + S n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk162" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk162"><span class="nb">rewrite</span> IHn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  hd
    (Str_nth_tl n
       (stream_filter_positions
          (is_Some ∘ (Some ∘ f)) s Hinf k)) =
  k + n</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S
  (stream_filter_fst_pos 
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf) k).<span class="mi">1</span> +
n = k + S n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk163" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk163"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  hd
    (Str_nth_tl n
       (stream_filter_positions
          (is_Some ∘ (Some ∘ f)) s Hinf k)) =
  k + n</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S
  ((stream_filter_fst_pos 
      (is_Some ∘ (Some ∘ f)) s
      (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf)
      k).<span class="mi">1</span> + n) = k + S n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk164" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk164"><span class="nb">replace</span> (k + S n) <span class="kr">with</span> (S (k + n)) <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  hd
    (Str_nth_tl n
       (stream_filter_positions
          (is_Some ∘ (Some ∘ f)) s Hinf k)) =
  k + n</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S
  ((stream_filter_fst_pos 
      (is_Some ∘ (Some ∘ f)) s
      (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf)
      k).<span class="mi">1</span> + n) = S (k + n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk165" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk165"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  hd
    (Str_nth_tl n
       (stream_filter_positions
          (is_Some ∘ (Some ∘ f)) s Hinf k)) =
  k + n</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
   (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf) k).<span class="mi">1</span> +
n = k + n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="StreamFilters-v-chk166" style="display: none" type="checkbox"><label class="alectryon-input" for="StreamFilters-v-chk166"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A → B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>Hfirst</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  ForAll
                    (Exists1
                       (is_Some ∘ (Some ∘ f)))
                    s) (<span class="nv">k</span> : nat),
  (stream_filter_fst_pos
     (is_Some ∘ (Some ∘ f)) s
     (fHere (Exists1 (is_Some ∘ (Some ∘ f)))
        s Hinf) k).<span class="mi">1</span> = k</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span><span class="kr">∀</span> (<span class="nv">s</span> : Stream A) (<span class="nv">Hinf</span> : 
                  InfinitelyOften
                    (is_Some ∘ (Some ∘ f)) s) 
  (<span class="nv">k</span> : nat),
  hd
    (Str_nth_tl n
       (stream_filter_positions
          (is_Some ∘ (Some ∘ f)) s Hinf k)) =
  k + n</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>Stream A</span></span></span><br><span><var>Hinf</var><span class="hyp-type"><b>: </b><span>InfinitelyOften (is_Some ∘ (Some ∘ f)) s</span></span></span><br><span><var>k</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(stream_filter_fst_pos (is_Some ∘ (Some ∘ f)) s
   (fHere (Exists1 (is_Some ∘ (Some ∘ f))) s Hinf) k).<span class="mi">1</span> =
k</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> Hfirst.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre></article></body></html>